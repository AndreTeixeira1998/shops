"use strict";(self.webpackChunkvendure_admin_ui=self.webpackChunkvendure_admin_ui||[]).push([[122],{31122:function(t,e,n){n.r(e),n.d(e,{ApplyFacetDialogComponent:function(){return Do},AssetDetailComponent:function(){return Mo},AssetListComponent:function(){return Lo},AssetResolver:function(){return Ro},AssetsComponent:function(){return vi},AssignProductsToChannelDialogComponent:function(){return Qo},CatalogModule:function(){return wi},CollectionContentsComponent:function(){return Zi},CollectionDetailComponent:function(){return Jo},CollectionListComponent:function(){return Uo},CollectionResolver:function(){return Ko},CollectionTreeComponent:function(){return Ci},CollectionTreeNodeComponent:function(){return bi},ConfirmVariantDeletionDialogComponent:function(){return Eo},FacetDetailComponent:function(){return No},FacetListComponent:function(){return Vo},FacetResolver:function(){return zo},GenerateProductVariantsComponent:function(){return yi},GeneratedVariant:function(){return Ho},OPTION_VALUE_INPUT_VALUE_ACCESSOR:function(){return Pi},OptionValueInputComponent:function(){return Ti},ProductDetailComponent:function(){return Yo},ProductDetailService:function(){return So},ProductListComponent:function(){return jo},ProductOptionsEditorComponent:function(){return Go},ProductResolver:function(){return Wo},ProductVariantsEditorComponent:function(){return Bo},ProductVariantsListComponent:function(){return Ii},ProductVariantsResolver:function(){return Xo},ProductVariantsTableComponent:function(){return Oi},UpdateProductOptionDialogComponent:function(){return Fi},VariantPriceDetailComponent:function(){return qi},arrayToTree:function(){return xi},assetBreadcrumb:function(){return fi},catalogRoutes:function(){return di},collectionBreadcrumb:function(){return hi},facetBreadcrumb:function(){return mi},productBreadcrumb:function(){return ui},productOptionsEditorBreadcrumb:function(){return gi},productVariantEditorBreadcrumb:function(){return pi},replaceLast:function(){return $o},"\u02750":function(){return ti},"\u02751":function(){return ei},"\u02752":function(){return ni},"\u02753":function(){return oi},"\u02754":function(){return ii},"\u02755":function(){return ai},"\u02756":function(){return ri},"\u02757":function(){return si},"\u02758":function(){return ci},"\u02759":function(){return li}});var o=n(51694),i=n(41460),a=n(90417),r=n(24791),s=n(23215);class c{constructor(t){this.notifier=t}call(t,e){return e.subscribe(new l(t,this.notifier))}}class l extends s.Ds{constructor(t,e){super(t),this.hasValue=!1;const n=new s.IY(this);this.add(n),this.innerSubscription=n;const o=(0,s.ft)(e,n);o!==n&&(this.add(o),this.innerSubscription=o)}_next(t){this.hasValue&&super._next(t)}notifyNext(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()}notifyComplete(){}}var d=n(37097),u=n(72041),p=n(8603),g=n(39990),m=n(86184),h=n(90026),f=n(94769),v=n(15405),Z=n(56971),x=n(90380),C=n(9219),b=n(1956),A=n(69874),y=n(49358),P=n(73341),T=n(23651),F=n(6584),I=n(21067),O=n(14416),q=n(75250),w=n(65519),_=n(22277),k=n(82957),M=n(80188),L=n(40561),J=n(92919),U=n(39945),N=n(98059),V=n(48304),$=n(33950),S=n(70942),D=n(61607),Q=n(84435),Y=n(3189),j=n(48279),G=n(3292),E=n(53198),H=n(50327),B=n(56258);function R(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",4),o.NdJ("click",function(){return o.CHM(t),o.oxw().save()}),o._uU(1),o.ALo(2,"translate"),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("disabled",t.detailForm.invalid||t.detailForm.pristine),o.xp6(1),o.hij(" ",o.lcZ(2,2,"common.update")," ")}}const K=function(){return["UpdateCatalog","UpdateAsset"]},z=function(){return{}},W=function(){return["DeleteCatalog","DeleteAsset"]},X=["collectionContents"];function tt(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",6),o.NdJ("click",function(){return o.CHM(t),o.oxw().create()}),o._uU(1),o.ALo(2,"translate"),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("disabled",t.detailForm.invalid||t.detailForm.pristine),o.xp6(1),o.hij(" ",o.lcZ(2,2,"common.create")," ")}}function et(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",6),o.NdJ("click",function(){return o.CHM(t),o.oxw(2).save()}),o._uU(1),o.ALo(2,"translate"),o.qZA()}if(2&t){const t=o.oxw(2);o.Q6J("disabled",(t.detailForm.invalid||t.detailForm.pristine)&&!t.assetsChanged()),o.xp6(1),o.hij(" ",o.lcZ(2,2,"common.update")," ")}}function nt(t,e){if(1&t&&o.YNc(0,et,3,4,"button",7),2&t){const t=o.oxw();o.Q6J("vdrIfPermissions",t.updatePermission)}}function ot(t,e){1&t&&(o.ynx(0),o._uU(1),o.ALo(2,"translate"),o.BQk()),2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"catalog.public")))}function it(t,e){1&t&&(o._uU(0),o.ALo(1,"translate")),2&t&&o.Oqu(o.lcZ(1,1,"catalog.private"))}const at=function(){return["customFields"]};function rt(t,e){if(1&t&&(o.TgZ(0,"section",30),o.TgZ(1,"label"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o._UZ(4,"vdr-tabbed-custom-fields",31),o.ALo(5,"hasPermission"),o.qZA()),2&t){const t=o.oxw(2);o.xp6(2),o.Oqu(o.lcZ(3,4,"common.custom-fields")),o.xp6(2),o.Q6J("customFields",t.customFields)("customFieldsFormGroup",t.detailForm.get(o.DdM(8,at)))("readonly",!o.lcZ(5,6,t.updatePermission))}}function st(t,e){if(1&t){const t=o.EpF();o.ynx(0),o.TgZ(1,"vdr-configurable-input",32),o.NdJ("remove",function(){const e=o.CHM(t).index;return o.oxw(2).removeFilter(e)}),o.ALo(2,"hasPermission"),o.qZA(),o.BQk()}if(2&t){const t=e.$implicit,n=e.index,i=o.oxw(2);o.xp6(1),o.Q6J("position",n)("operation",t)("operationDefinition",i.getFilterDefinition(t))("formControlName",n)("readonly",!o.lcZ(2,5,i.updatePermission))}}function ct(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",37),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw(3).addFilter(e)}),o._uU(1),o.qZA()}if(2&t){const t=e.$implicit;o.xp6(1),o.hij(" ",t.description," ")}}function lt(t,e){if(1&t&&(o.TgZ(0,"div"),o.TgZ(1,"vdr-dropdown"),o.TgZ(2,"button",33),o._UZ(3,"clr-icon",34),o._uU(4),o.ALo(5,"translate"),o.qZA(),o.TgZ(6,"vdr-dropdown-menu",35),o.YNc(7,ct,2,1,"button",36),o.qZA(),o.qZA(),o.qZA()),2&t){const t=o.oxw(2);o.xp6(4),o.hij(" ",o.lcZ(5,2,"marketing.add-condition")," "),o.xp6(3),o.Q6J("ngForOf",t.allFilters)}}const dt=function(t){return{count:t}},ut=function(){return{standalone:!0}};function pt(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",38),o._uU(1),o.ALo(2,"translate"),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"clr-checkbox-wrapper"),o.TgZ(5,"input",39),o.NdJ("ngModelChange",function(){return o.CHM(t),o.oxw(2).toggleLivePreview()}),o.qZA(),o.TgZ(6,"label"),o._uU(7),o.ALo(8,"translate"),o.qZA(),o.qZA()}if(2&t){const t=e.$implicit,n=o.oxw(2);let i,a;o.xp6(1),o.AsE(" ",o.lcZ(2,8,"catalog.collection-contents")," (",o.xi3(3,10,"common.results-count",o.VKq(15,dt,t)),") "),o.xp6(3),o.ekj("disabled",null==(i=n.detailForm.get("filters"))?null:i.pristine),o.xp6(1),o.Q6J("ngModelOptions",o.DdM(17,ut))("disabled",null==(a=n.detailForm.get("filters"))?null:a.pristine)("ngModel",n.livePreview),o.xp6(2),o.Oqu(o.lcZ(8,13,"catalog.live-preview-contents"))}}const gt=function(t){return{pattern:t}};function mt(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"form",8),o.TgZ(1,"div",9),o.TgZ(2,"div",10),o.TgZ(3,"vdr-form-field",11),o.ALo(4,"translate"),o.TgZ(5,"clr-toggle-wrapper"),o._UZ(6,"input",12),o.ALo(7,"hasPermission"),o.TgZ(8,"label",13),o.YNc(9,ot,3,3,"ng-container",14),o.YNc(10,it,2,3,"ng-template",null,15,o.W1O),o.qZA(),o.qZA(),o.qZA(),o.TgZ(12,"vdr-form-field",16),o.ALo(13,"translate"),o.TgZ(14,"input",17),o.NdJ("input",function(e){return o.CHM(t),o.oxw().updateSlug(e.target.value)}),o.ALo(15,"hasPermission"),o.qZA(),o.qZA(),o.TgZ(16,"vdr-form-field",18),o.ALo(17,"translate"),o.ALo(18,"translate"),o._UZ(19,"input",19),o.ALo(20,"hasPermission"),o.qZA(),o._UZ(21,"vdr-rich-text-editor",20),o.ALo(22,"hasPermission"),o.ALo(23,"translate"),o.YNc(24,rt,6,9,"section",21),o._UZ(25,"vdr-custom-detail-component-host",22),o.qZA(),o.TgZ(26,"div",23),o.TgZ(27,"vdr-assets",24),o.NdJ("change",function(e){o.CHM(t);return o.oxw().assetChanges=e}),o.qZA(),o.qZA(),o.qZA(),o.TgZ(28,"div",25),o.TgZ(29,"div",10),o.TgZ(30,"label"),o._uU(31),o.ALo(32,"translate"),o.qZA(),o.YNc(33,st,3,7,"ng-container",26),o.YNc(34,lt,8,4,"div",27),o.qZA(),o.TgZ(35,"div",10),o.TgZ(36,"vdr-collection-contents",28,29),o.ALo(38,"async"),o.ALo(39,"async"),o.YNc(40,pt,9,18,"ng-template"),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=e.ngIf,n=o.MAs(11),i=o.oxw();o.Q6J("formGroup",i.detailForm),o.xp6(3),o.Q6J("label",o.lcZ(4,26,"catalog.visibility")),o.xp6(3),o.Q6J("vdrDisabled",!o.lcZ(7,28,i.updatePermission)),o.xp6(3),o.Q6J("ngIf",i.detailForm.value.visible)("ngIfElse",n),o.xp6(3),o.Q6J("label",o.lcZ(13,30,"common.name")),o.xp6(2),o.Q6J("readonly",!o.lcZ(15,32,i.updatePermission)),o.xp6(2),o.Q6J("label",o.lcZ(17,34,"catalog.slug"))("errors",o.VKq(50,gt,o.lcZ(18,36,"catalog.slug-pattern-error"))),o.xp6(3),o.Q6J("readonly",!o.lcZ(20,38,i.updatePermission)),o.xp6(2),o.Q6J("readonly",!o.lcZ(22,40,i.updatePermission))("label",o.lcZ(23,42,"common.description")),o.xp6(3),o.Q6J("ngIf",i.customFields.length),o.xp6(1),o.Q6J("entity$",i.entity$)("detailForm",i.detailForm),o.xp6(2),o.Q6J("assets",t.assets)("featuredAsset",t.featuredAsset)("updatePermissions",i.updatePermission),o.xp6(4),o.Oqu(o.lcZ(32,44,"catalog.filters")),o.xp6(2),o.Q6J("ngForOf",i.filters)("ngForTrackBy",i.trackByFn),o.xp6(1),o.Q6J("vdrIfPermissions",i.updatePermission),o.xp6(2),o.Q6J("collectionId",i.id)("parentId",o.lcZ(38,46,i.parentId$))("updatedFilters",o.lcZ(39,48,i.updatedFilters$))("previewUpdatedFilters",i.livePreview)}}const ht=function(){return["./create"]};function ft(t,e){1&t&&(o.TgZ(0,"a",11),o._UZ(1,"clr-icon",12),o._uU(2),o.ALo(3,"translate"),o.qZA()),2&t&&(o.Q6J("routerLink",o.DdM(4,ht)),o.xp6(2),o.hij(" ",o.lcZ(3,2,"catalog.create-new-collection")," "))}function vt(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",13),o._uU(1),o.ALo(2,"async"),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"button",14),o.NdJ("click",function(){return o.CHM(t),o.oxw().closeContents()}),o._UZ(5,"clr-icon",15),o.qZA()}if(2&t){const t=e.$implicit,n=o.oxw();o.xp6(1),o.AsE(" ",o.lcZ(2,2,n.activeCollectionTitle$)," (",o.xi3(3,4,"common.results-count",o.VKq(7,dt,t)),") ")}}const Zt=function(){return["CreateCatalog","CreateCollection"]};function xt(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",6),o.NdJ("click",function(){return o.CHM(t),o.oxw().create()}),o._uU(1),o.ALo(2,"translate"),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("disabled",t.detailForm.invalid||t.detailForm.pristine),o.xp6(1),o.hij(" ",o.lcZ(2,2,"common.create")," ")}}function Ct(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",6),o.NdJ("click",function(){return o.CHM(t),o.oxw(2).save()}),o._uU(1),o.ALo(2,"translate"),o.qZA()}if(2&t){const t=o.oxw(2);o.Q6J("disabled",t.detailForm.invalid||t.detailForm.pristine),o.xp6(1),o.hij(" ",o.lcZ(2,2,"common.update")," ")}}function bt(t,e){if(1&t&&o.YNc(0,Ct,3,4,"button",7),2&t){const t=o.oxw();o.Q6J("vdrIfPermissions",t.updatePermission)}}function At(t,e){1&t&&(o.ynx(0),o._uU(1),o.ALo(2,"translate"),o.BQk()),2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"catalog.public")))}function yt(t,e){1&t&&(o._uU(0),o.ALo(1,"translate")),2&t&&o.Oqu(o.lcZ(1,1,"catalog.private"))}const Pt=function(){return["facet","customFields"]};function Tt(t,e){if(1&t&&(o.TgZ(0,"section",22),o.TgZ(1,"label"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o._UZ(4,"vdr-tabbed-custom-fields",23),o.ALo(5,"hasPermission"),o.qZA()),2&t){const t=o.oxw(2);o.xp6(2),o.Oqu(o.lcZ(3,4,"common.custom-fields")),o.xp6(2),o.Q6J("customFields",t.customFields)("customFieldsFormGroup",t.detailForm.get(o.DdM(8,Pt)))("readonly",!o.lcZ(5,6,t.updatePermission))}}function Ft(t,e){1&t&&(o.ynx(0),o.TgZ(1,"th"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.BQk()),2&t&&(o.xp6(2),o.Oqu(o.lcZ(3,1,"common.custom-fields")))}const It=function(t){return["values",t,"customFields"]};function Ot(t,e){if(1&t&&(o.TgZ(0,"td",40),o._UZ(1,"vdr-tabbed-custom-fields",41),o.ALo(2,"hasPermission"),o.qZA()),2&t){const t=o.oxw().index,e=o.oxw(4);o.xp6(1),o.Q6J("customFields",e.customValueFields)("compact",!0)("customFieldsFormGroup",e.detailForm.get(o.VKq(6,It,t)))("readonly",!o.lcZ(2,4,e.updatePermission))}}function qt(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"tr",30),o.TgZ(1,"td",31),o._UZ(2,"vdr-entity-info",0),o.qZA(),o.TgZ(3,"td",31),o.TgZ(4,"input",32),o.NdJ("input",function(e){const n=o.CHM(t).index,i=o.oxw(3).ngIf;return o.oxw().updateValueCode(null==i.values[n]?null:i.values[n].code,e.target.value,n)}),o.ALo(5,"hasPermission"),o.qZA(),o.qZA(),o.TgZ(6,"td",31),o._UZ(7,"input",33),o.qZA(),o.YNc(8,Ot,3,8,"td",34),o.TgZ(9,"td",31),o.TgZ(10,"vdr-dropdown"),o.TgZ(11,"button",35),o._uU(12),o.ALo(13,"translate"),o._UZ(14,"clr-icon",36),o.qZA(),o.TgZ(15,"vdr-dropdown-menu",37),o.TgZ(16,"button",38),o.NdJ("click",function(){const e=o.CHM(t).index,n=o.oxw(3).ngIf;return o.oxw().deleteFacetValue(null==n.values[e]?null:n.values[e].id,e)}),o.ALo(17,"hasPermission"),o._UZ(18,"clr-icon",39),o._uU(19),o.ALo(20,"translate"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=e.$implicit,n=e.index,i=o.oxw(4);o.Q6J("formGroupName",n),o.xp6(2),o.Q6J("entity",t),o.xp6(2),o.Q6J("readonly",!o.lcZ(5,7,i.updatePermission)),o.xp6(4),o.Q6J("ngIf",i.customValueFields.length),o.xp6(4),o.hij(" ",o.lcZ(13,9,"common.actions")," "),o.xp6(4),o.Q6J("disabled",!o.lcZ(17,11,i.updatePermission)),o.xp6(3),o.hij(" ",o.lcZ(20,13,"common.delete")," ")}}function wt(t,e){if(1&t&&(o.TgZ(0,"table",27),o.TgZ(1,"thead"),o.TgZ(2,"tr"),o._UZ(3,"th"),o.TgZ(4,"th"),o._uU(5),o.ALo(6,"translate"),o.qZA(),o.TgZ(7,"th"),o._uU(8),o.ALo(9,"translate"),o.qZA(),o.YNc(10,Ft,4,3,"ng-container",28),o._UZ(11,"th"),o.qZA(),o.qZA(),o.TgZ(12,"tbody"),o.YNc(13,qt,21,15,"tr",29),o.qZA(),o.qZA()),2&t){const t=o.oxw(3);o.xp6(5),o.Oqu(o.lcZ(6,4,"common.name")),o.xp6(3),o.Oqu(o.lcZ(9,6,"common.code")),o.xp6(2),o.Q6J("ngIf",t.customValueFields.length),o.xp6(3),o.Q6J("ngForOf",t.values)}}function _t(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",42),o.NdJ("click",function(){return o.CHM(t),o.oxw(3).addFacetValue()}),o._UZ(1,"clr-icon",43),o._uU(2),o.ALo(3,"translate"),o.qZA()}2&t&&(o.xp6(2),o.hij(" ",o.lcZ(3,1,"catalog.add-facet-value")," "))}const kt=function(){return["CreateCatalog","CreateFacet"]};function Mt(t,e){if(1&t&&(o.TgZ(0,"section",24),o.TgZ(1,"label"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.YNc(4,wt,14,8,"table",25),o.TgZ(5,"div"),o.YNc(6,_t,4,3,"button",26),o.qZA(),o.qZA()),2&t){const t=o.oxw(2);o.xp6(2),o.Oqu(o.lcZ(3,3,"catalog.facet-values")),o.xp6(2),o.Q6J("ngIf",0<t.getValuesFormArray().length),o.xp6(2),o.Q6J("vdrIfPermissions",o.DdM(5,kt))}}function Lt(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"form",8),o.TgZ(1,"section",9),o.TgZ(2,"vdr-form-field",10),o.ALo(3,"translate"),o.TgZ(4,"clr-toggle-wrapper"),o._UZ(5,"input",11),o.ALo(6,"hasPermission"),o.TgZ(7,"label",12),o.YNc(8,At,3,3,"ng-container",13),o.YNc(9,yt,2,3,"ng-template",null,14,o.W1O),o.qZA(),o.qZA(),o.qZA(),o.TgZ(11,"vdr-form-field",15),o.ALo(12,"translate"),o.TgZ(13,"input",16),o.NdJ("input",function(e){const n=o.CHM(t).ngIf;return o.oxw().updateCode(n.code,e.target.value)}),o.ALo(14,"hasPermission"),o.qZA(),o.qZA(),o.TgZ(15,"vdr-form-field",17),o.ALo(16,"translate"),o.ALo(17,"hasPermission"),o._UZ(18,"input",18),o.ALo(19,"hasPermission"),o.qZA(),o.YNc(20,Tt,6,9,"section",19),o._UZ(21,"vdr-custom-detail-component-host",20),o.qZA(),o.YNc(22,Mt,7,6,"section",21),o.ALo(23,"async"),o.qZA()}if(2&t){const t=o.MAs(10),e=o.oxw();o.Q6J("formGroup",e.detailForm),o.xp6(2),o.Q6J("label",o.lcZ(3,14,"catalog.visibility")),o.xp6(3),o.Q6J("vdrDisabled",!o.lcZ(6,16,e.updatePermission)),o.xp6(3),o.Q6J("ngIf",e.detailForm.value.facet.visible)("ngIfElse",t),o.xp6(3),o.Q6J("label",o.lcZ(12,18,"common.name")),o.xp6(2),o.Q6J("readonly",!o.lcZ(14,20,e.updatePermission)),o.xp6(2),o.Q6J("label",o.lcZ(16,22,"common.code"))("readOnlyToggle",o.lcZ(17,24,e.updatePermission)),o.xp6(3),o.Q6J("readonly",!o.lcZ(19,26,e.updatePermission)),o.xp6(2),o.Q6J("ngIf",e.customFields.length),o.xp6(1),o.Q6J("entity$",e.entity$)("detailForm",e.detailForm),o.xp6(1),o.Q6J("ngIf",!o.lcZ(23,28,e.isNew$))}}function Jt(t,e){1&t&&(o.TgZ(0,"a",7),o._UZ(1,"clr-icon",8),o._uU(2),o.ALo(3,"translate"),o.qZA()),2&t&&(o.Q6J("routerLink",o.DdM(4,ht)),o.xp6(2),o.hij(" ",o.lcZ(3,2,"catalog.create-new-facet")," "))}function Ut(t,e){if(1&t&&o._UZ(0,"vdr-facet-value-chip",21),2&t){const t=e.$implicit;o.Q6J("facetValue",t)("removable",!1)("displayFacetName",!1)}}function Nt(t,e){if(1&t&&(o.ynx(0),o._UZ(1,"clr-icon",8),o._uU(2),o.BQk()),2&t){const t=o.oxw(2).item,e=o.oxw();o.xp6(2),o.hij(" ",t.values.length-e.initialLimit," ")}}function Vt(t,e){1&t&&o._UZ(0,"clr-icon",24)}function $t(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",22),o.NdJ("click",function(){o.CHM(t);const e=o.oxw().item;return o.oxw().toggleDisplayLimit(e)}),o.YNc(1,Nt,3,1,"ng-container",12),o.YNc(2,Vt,1,0,"ng-template",null,23,o.W1O),o.qZA()}if(2&t){const t=o.MAs(3),e=o.oxw().item,n=o.oxw();o.xp6(1),o.Q6J("ngIf",(n.displayLimit[e.id]||0)<e.values.length)("ngIfElse",t)}}function St(t,e){1&t&&(o.ynx(0),o._uU(1),o.ALo(2,"translate"),o.BQk()),2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"catalog.public")))}function Dt(t,e){1&t&&(o._uU(0),o.ALo(1,"translate")),2&t&&o.Oqu(o.lcZ(1,1,"catalog.private"))}const Qt=function(t){return["./",t]},Yt=function(){return["DeleteCatalog","DeleteFacet"]};function jt(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"td",9),o._uU(1),o.qZA(),o.TgZ(2,"td",9),o._uU(3),o.qZA(),o.TgZ(4,"td",9),o.YNc(5,Ut,1,3,"vdr-facet-value-chip",10),o.ALo(6,"slice"),o.YNc(7,$t,4,2,"button",11),o.qZA(),o.TgZ(8,"td",9),o.TgZ(9,"vdr-chip"),o.YNc(10,St,3,3,"ng-container",12),o.YNc(11,Dt,2,3,"ng-template",null,13,o.W1O),o.qZA(),o.qZA(),o.TgZ(13,"td",14),o._UZ(14,"vdr-table-row-action",15),o.ALo(15,"translate"),o.qZA(),o.TgZ(16,"td",14),o.TgZ(17,"vdr-dropdown"),o.TgZ(18,"button",16),o._uU(19),o.ALo(20,"translate"),o._UZ(21,"clr-icon",17),o.qZA(),o.TgZ(22,"vdr-dropdown-menu",18),o.TgZ(23,"button",19),o.NdJ("click",function(){const e=o.CHM(t).item;return o.oxw().deleteFacet(e.id)}),o.ALo(24,"hasPermission"),o._UZ(25,"clr-icon",20),o._uU(26),o.ALo(27,"translate"),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=e.item,n=o.MAs(12),i=o.oxw();o.ekj("private",t.isPrivate),o.xp6(1),o.Oqu(t.code),o.xp6(1),o.ekj("private",t.isPrivate),o.xp6(1),o.Oqu(t.name),o.xp6(1),o.ekj("private",t.isPrivate),o.xp6(1),o.Q6J("ngForOf",o.Dn7(6,23,t.values,0,i.displayLimit[t.id]||3)),o.xp6(2),o.Q6J("ngIf",t.values.length>i.initialLimit),o.xp6(1),o.ekj("private",t.isPrivate),o.xp6(2),o.Q6J("ngIf",!t.isPrivate)("ngIfElse",n),o.xp6(3),o.ekj("private",t.isPrivate),o.xp6(1),o.Q6J("label",o.lcZ(15,27,"common.edit"))("linkTo",o.VKq(35,Qt,t.id)),o.xp6(2),o.ekj("private",t.isPrivate),o.xp6(3),o.hij(" ",o.lcZ(20,29,"common.actions")," "),o.xp6(4),o.Q6J("disabled",!o.lcZ(24,31,o.DdM(37,Yt))),o.xp6(3),o.hij(" ",o.lcZ(27,33,"common.delete")," ")}}function Gt(t,e){1&t&&(o._uU(0),o.ALo(1,"translate")),2&t&&o.Oqu(o.lcZ(1,1,"catalog.add-facets"))}function Et(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",3),o.NdJ("click",function(){return o.CHM(t),o.oxw().cancel()}),o._uU(1),o.ALo(2,"translate"),o.qZA(),o.TgZ(3,"button",4),o.NdJ("click",function(){return o.CHM(t),o.oxw().selectValues()}),o._uU(4),o.ALo(5,"translate"),o.qZA()}if(2&t){const t=o.oxw();o.xp6(1),o.Oqu(o.lcZ(2,3,"common.cancel")),o.xp6(2),o.Q6J("disabled",0===t.selectedValues.length),o.xp6(1),o.hij(" ",o.lcZ(5,5,"catalog.add-facets")," ")}}function Ht(t,e){1&t&&(o.ynx(0),o._uU(1),o.ALo(2,"translate"),o.BQk()),2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"catalog.assign-variants-to-channel")))}function Bt(t,e){1&t&&(o._uU(0),o.ALo(1,"translate")),2&t&&o.Oqu(o.lcZ(1,1,"catalog.assign-products-to-channel"))}function Rt(t,e){if(1&t&&(o.YNc(0,Ht,3,3,"ng-container",12),o.YNc(1,Bt,2,3,"ng-template",null,13,o.W1O)),2&t){const t=o.MAs(2),e=o.oxw();o.Q6J("ngIf",e.isProductVariantMode)("ngIfElse",t)}}const Kt=function(t){return{channel:t}};function zt(t,e){if(1&t&&(o._uU(0),o.ALo(1,"translate")),2&t){const t=o.oxw();o.hij(" ",o.xi3(1,1,"catalog.price-in-channel",o.VKq(4,Kt,null==t.selectedChannel?null:t.selectedChannel.code))," ")}}function Wt(t,e){1&t&&(o._uU(0),o.ALo(1,"translate")),2&t&&o.hij(" ",o.lcZ(1,1,"catalog.no-channel-selected")," ")}function Xt(t,e){if(1&t&&(o._uU(0),o.ALo(1,"localeCurrency")),2&t){const t=o.oxw().$implicit,e=o.oxw();o.hij(" ",o.xi3(1,1,t.pricePreview,null==e.selectedChannel?null:e.selectedChannel.currencyCode)," ")}}function te(t,e){1&t&&o._uU(0," - ")}function ee(t,e){if(1&t&&(o.TgZ(0,"tr"),o.TgZ(1,"td"),o._uU(2),o.qZA(),o.TgZ(3,"td"),o._uU(4),o.ALo(5,"localeCurrency"),o.qZA(),o.TgZ(6,"td"),o.YNc(7,Xt,2,4,"ng-template",8),o.YNc(8,te,1,0,"ng-template",null,14,o.W1O),o.qZA(),o.qZA()),2&t){const t=e.$implicit,n=o.MAs(9),i=o.oxw();o.xp6(2),o.Oqu(t.name),o.xp6(2),o.Oqu(o.xi3(5,4,t.price,null==i.currentChannel?null:i.currentChannel.currencyCode)),o.xp6(3),o.Q6J("ngIf",i.selectedChannel)("ngIfElse",n)}}const ne=function(t){return{channelCode:t}};function oe(t,e){if(1&t&&(o._uU(0),o.ALo(1,"translate")),2&t){const t=o.oxw(2);o.hij(" ",o.xi3(1,1,"catalog.assign-to-named-channel",o.VKq(4,ne,null==t.selectedChannel?null:t.selectedChannel.code))," ")}}function ie(t,e){1&t&&(o._uU(0),o.ALo(1,"translate")),2&t&&o.hij(" ",o.lcZ(1,1,"catalog.no-channel-selected")," ")}function ae(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",15),o.NdJ("click",function(){return o.CHM(t),o.oxw().cancel()}),o._uU(1),o.ALo(2,"translate"),o.qZA(),o.TgZ(3,"button",16),o.NdJ("click",function(){return o.CHM(t),o.oxw().assign()}),o.YNc(4,oe,2,6,"ng-template",8),o.YNc(5,ie,2,3,"ng-template",null,9,o.W1O),o.qZA()}if(2&t){const t=o.MAs(6),e=o.oxw();o.xp6(1),o.Oqu(o.lcZ(2,4,"common.cancel")),o.xp6(2),o.Q6J("disabled",!e.selectedChannel),o.xp6(1),o.Q6J("ngIf",e.selectedChannel)("ngIfElse",t)}}const re=function(){return["product","enabled"]};function se(t,e){if(1&t&&(o.TgZ(0,"clr-toggle-wrapper"),o._UZ(1,"input",8),o.TgZ(2,"label"),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.Q6J("formControl",t.detailForm.get(o.DdM(4,re))),o.xp6(2),o.Oqu(o.lcZ(4,2,"common.enabled"))}}function ce(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",9),o.NdJ("click",function(){return o.CHM(t),o.oxw().create()}),o._uU(1),o.ALo(2,"translate"),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("disabled",t.detailForm.invalid||t.detailForm.pristine||!t.variantsToCreateAreValid()),o.xp6(1),o.hij(" ",o.lcZ(2,2,"common.create")," ")}}function le(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",9),o.NdJ("click",function(){return o.CHM(t),o.oxw(2).save()}),o._uU(1),o.ALo(2,"translate"),o.qZA()}if(2&t){const t=o.oxw(2);o.Q6J("disabled",(t.detailForm.invalid||t.detailForm.pristine)&&!t.assetsChanged()&&!t.variantAssetsChanged()),o.xp6(1),o.hij(" ",o.lcZ(2,2,"common.update")," ")}}const de=function(){return["UpdateCatalog","UpdateProduct"]};function ue(t,e){1&t&&o.YNc(0,le,3,4,"button",10),2&t&&o.Q6J("vdrIfPermissions",o.DdM(1,de))}function pe(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"vdr-chip",41),o.NdJ("iconClick",function(){o.CHM(t);const e=o.oxw().$implicit;return o.oxw(6).removeFromChannel(e.id)}),o._UZ(1,"vdr-channel-badge",42),o._uU(2),o.ALo(3,"channelCodeToLabel"),o.qZA()}if(2&t){const t=o.oxw().$implicit;o.xp6(1),o.Q6J("channelCode",t.code),o.xp6(1),o.hij(" ",o.lcZ(3,2,t.code)," ")}}function ge(t,e){if(1&t&&(o.ynx(0),o.YNc(1,pe,4,4,"vdr-chip",40),o.BQk()),2&t){const t=e.$implicit,n=o.oxw(6);o.xp6(1),o.Q6J("ngIf",!n.isDefaultChannel(t.code))}}function me(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"vdr-form-item",35),o.ALo(1,"translate"),o.TgZ(2,"div",36),o.YNc(3,ge,2,1,"ng-container",37),o.ALo(4,"async"),o.TgZ(5,"button",38),o.NdJ("click",function(){return o.CHM(t),o.oxw(5).assignToChannel()}),o._UZ(6,"clr-icon",39),o._uU(7),o.ALo(8,"translate"),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=o.oxw(5);o.Q6J("label",o.lcZ(1,3,"common.channels")),o.xp6(3),o.Q6J("ngForOf",o.lcZ(4,5,t.productChannels$)),o.xp6(4),o.hij(" ",o.lcZ(8,7,"catalog.assign-to-channel")," ")}}function he(t,e){1&t&&(o.ynx(0),o.YNc(1,me,9,9,"vdr-form-item",34),o.BQk())}function fe(t,e){1&t&&(o.ynx(0),o.YNc(1,he,2,0,"ng-container",33),o.BQk())}const ve=function(){return["product","customFields"]};function Ze(t,e){if(1&t&&(o.TgZ(0,"section",43),o.TgZ(1,"label"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o._UZ(4,"vdr-tabbed-custom-fields",44),o.ALo(5,"hasPermission"),o.qZA()),2&t){const t=o.oxw(3);o.xp6(2),o.Oqu(o.lcZ(3,4,"common.custom-fields")),o.xp6(2),o.Q6J("customFields",t.customFields)("customFieldsFormGroup",t.detailForm.get(o.DdM(8,ve)))("readonly",!o.lcZ(5,6,o.DdM(9,de)))}}function xe(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"vdr-facet-value-chip",45),o.NdJ("remove",function(){const e=o.CHM(t).$implicit;return o.oxw(3).removeProductFacetValue(e.id)}),o.ALo(1,"hasPermission"),o.qZA()}if(2&t){const t=e.$implicit;o.Q6J("facetValue",t)("removable",o.lcZ(1,2,o.DdM(4,de)))}}function Ce(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",46),o.NdJ("click",function(){return o.CHM(t),o.oxw(3).selectProductFacetValue()}),o._UZ(1,"clr-icon",47),o._uU(2),o.ALo(3,"translate"),o.qZA()}2&t&&(o.xp6(2),o.hij(" ",o.lcZ(3,1,"catalog.add-facets")," "))}function be(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div"),o.TgZ(1,"h4"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"vdr-generate-product-variants",48),o.NdJ("variantsChange",function(e){o.CHM(t);return o.oxw(3).createVariantsConfig=e}),o.qZA(),o.qZA()}2&t&&(o.xp6(2),o.Oqu(o.lcZ(3,1,"catalog.product-variants")))}const Ae=function(){return["product","name"]};function ye(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"clr-tab-content"),o.TgZ(1,"div",16),o.TgZ(2,"div",17),o.TgZ(3,"section",18),o.YNc(4,fe,2,0,"ng-container",15),o.ALo(5,"async"),o.TgZ(6,"vdr-form-field",19),o.ALo(7,"translate"),o.TgZ(8,"input",20),o.NdJ("input",function(e){return o.CHM(t),o.oxw(2).updateSlug(e.target.value)}),o.ALo(9,"hasPermission"),o.qZA(),o.qZA(),o.TgZ(10,"div",21),o.ALo(11,"async"),o.TgZ(12,"clr-checkbox-wrapper"),o._UZ(13,"input",22),o.TgZ(14,"label"),o._uU(15),o.ALo(16,"translate"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(17,"vdr-form-field",23),o.ALo(18,"translate"),o.ALo(19,"translate"),o._UZ(20,"input",24),o.ALo(21,"hasPermission"),o.qZA(),o._UZ(22,"vdr-rich-text-editor",25),o.ALo(23,"hasPermission"),o.ALo(24,"translate"),o.YNc(25,Ze,6,10,"section",26),o._UZ(26,"vdr-custom-detail-component-host",27),o.qZA(),o.qZA(),o.TgZ(27,"div",28),o.TgZ(28,"vdr-assets",29),o.NdJ("change",function(e){o.CHM(t);return o.oxw(2).assetChanges=e}),o.qZA(),o.TgZ(29,"div",30),o.YNc(30,xe,2,5,"vdr-facet-value-chip",31),o.ALo(31,"async"),o.YNc(32,Ce,4,3,"button",32),o.qZA(),o.qZA(),o.qZA(),o.YNc(33,be,5,3,"div",15),o.ALo(34,"async"),o.qZA()}if(2&t){const t=o.oxw().ngIf,e=o.oxw();let n;o.xp6(4),o.Q6J("ngIf",!o.lcZ(5,20,e.isNew$)),o.xp6(2),o.Q6J("label",o.lcZ(7,22,"catalog.product-name")),o.xp6(2),o.Q6J("readonly",!o.lcZ(9,24,o.DdM(44,de))),o.xp6(2),o.ekj("visible",!1===o.lcZ(11,26,e.isNew$)&&(null==(n=e.detailForm.get(o.DdM(45,Ae)))?null:n.dirty)),o.xp6(5),o.Oqu(o.lcZ(16,28,"catalog.auto-update-product-variant-name")),o.xp6(2),o.Q6J("label",o.lcZ(18,30,"catalog.slug"))("errors",o.VKq(46,gt,o.lcZ(19,32,"catalog.slug-pattern-error"))),o.xp6(3),o.Q6J("readonly",!o.lcZ(21,34,o.DdM(48,de))),o.xp6(2),o.Q6J("readonly",!o.lcZ(23,36,o.DdM(49,de)))("label",o.lcZ(24,38,"common.description")),o.xp6(3),o.Q6J("ngIf",e.customFields.length),o.xp6(1),o.Q6J("entity$",e.entity$)("detailForm",e.detailForm),o.xp6(2),o.Q6J("assets",e.assetChanges.assets||t.assets)("featuredAsset",e.assetChanges.featuredAsset||t.featuredAsset)("updatePermissions",e.updatePermissions),o.xp6(2),o.Q6J("ngForOf",o.lcZ(31,40,e.facetValues$)),o.xp6(2),o.Q6J("vdrIfPermissions",o.DdM(50,de)),o.xp6(1),o.Q6J("ngIf",o.lcZ(34,42,e.isNew$))}}const Pe=function(){return["./","manage-variants"]};function Te(t,e){1&t&&(o.TgZ(0,"a",65),o._UZ(1,"clr-icon",66),o._uU(2),o.ALo(3,"translate"),o.qZA()),2&t&&(o.Q6J("routerLink",o.DdM(4,Pe)),o.xp6(2),o.hij(" ",o.lcZ(3,2,"catalog.manage-variants")," "))}function Fe(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",67),o.TgZ(1,"vdr-items-per-page-controls",68),o.NdJ("itemsPerPageChange",function(e){return o.CHM(t),o.oxw(4).setItemsPerPage(e)}),o.ALo(2,"async"),o.qZA(),o.TgZ(3,"vdr-pagination-controls",69),o.NdJ("pageChange",function(e){return o.CHM(t),o.oxw(4).setPage(e)}),o.ALo(4,"async"),o.ALo(5,"async"),o.ALo(6,"async"),o.qZA(),o.qZA()}if(2&t){const t=o.oxw(4);let e;o.xp6(1),o.Q6J("itemsPerPage",o.lcZ(2,4,t.itemsPerPage$)),o.xp6(2),o.Q6J("id",null==(e=o.lcZ(4,6,t.paginationConfig$))?null:e.id)("currentPage",o.lcZ(5,8,t.currentPage$))("itemsPerPage",o.lcZ(6,10,t.itemsPerPage$))}}function Ie(t,e){if(1&t&&(o._UZ(0,"vdr-product-variants-table",70),o.ALo(1,"async"),o.ALo(2,"async"),o.ALo(3,"async")),2&t){const t=o.oxw(3).ngIf,e=o.oxw();o.Q6J("variants",o.lcZ(1,6,e.variants$))("paginationConfig",o.lcZ(2,8,e.paginationConfig$))("optionGroups",t.optionGroups)("channelPriceIncludesTax",o.lcZ(3,10,e.channelPriceIncludesTax$))("productVariantsFormArray",e.detailForm.get("variants"))("pendingAssetChanges",e.variantAssetChanges)}}function Oe(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"vdr-product-variants-list",71),o.NdJ("assignToChannel",function(e){return o.CHM(t),o.oxw(4).assignVariantToChannel(e)})("removeFromChannel",function(e){return o.CHM(t),o.oxw(4).removeVariantFromChannel(e)})("assetChange",function(e){return o.CHM(t),o.oxw(4).variantAssetChange(e)})("updateProductOption",function(e){return o.CHM(t),o.oxw(4).updateProductOption(e)})("selectionChange",function(e){o.CHM(t);return o.oxw(4).selectedVariantIds=e})("selectFacetValueClick",function(e){return o.CHM(t),o.oxw(4).selectVariantFacetValue(e)}),o.ALo(1,"async"),o.ALo(2,"async"),o.ALo(3,"async"),o.ALo(4,"async"),o.ALo(5,"async"),o.ALo(6,"async"),o.qZA()}if(2&t){const t=o.oxw(3).ngIf,e=o.oxw();o.Q6J("variants",o.lcZ(1,11,e.variants$))("paginationConfig",o.lcZ(2,13,e.paginationConfig$))("channelPriceIncludesTax",o.lcZ(3,15,e.channelPriceIncludesTax$))("facets",o.lcZ(4,17,e.facets$))("optionGroups",t.optionGroups)("productVariantsFormArray",e.detailForm.get("variants"))("taxCategories",o.lcZ(5,19,e.taxCategories$))("customFields",e.customVariantFields)("customOptionFields",e.customOptionFields)("activeLanguage",o.lcZ(6,21,e.languageCode$))("pendingAssetChanges",e.variantAssetChanges)}}function qe(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",67),o.TgZ(1,"vdr-items-per-page-controls",68),o.NdJ("itemsPerPageChange",function(e){return o.CHM(t),o.oxw(4).setItemsPerPage(e)}),o.ALo(2,"async"),o.qZA(),o.TgZ(3,"vdr-pagination-controls",69),o.NdJ("pageChange",function(e){return o.CHM(t),o.oxw(4).setPage(e)}),o.ALo(4,"async"),o.ALo(5,"async"),o.ALo(6,"async"),o.qZA(),o.qZA()}if(2&t){const t=o.oxw(4);let e;o.xp6(1),o.Q6J("itemsPerPage",o.lcZ(2,4,t.itemsPerPage$)),o.xp6(2),o.Q6J("id",null==(e=o.lcZ(4,6,t.paginationConfig$))?null:e.id)("currentPage",o.lcZ(5,8,t.currentPage$))("itemsPerPage",o.lcZ(6,10,t.itemsPerPage$))}}function we(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"clr-tab-content"),o.TgZ(1,"section",49),o.TgZ(2,"div",50),o.TgZ(3,"div",51),o.TgZ(4,"button",52),o.NdJ("click",function(){o.CHM(t);return o.oxw(3).variantDisplayMode="card"}),o._UZ(5,"clr-icon",53),o._uU(6),o.ALo(7,"translate"),o.qZA(),o.TgZ(8,"button",54),o.NdJ("click",function(){o.CHM(t);return o.oxw(3).variantDisplayMode="table"}),o._UZ(9,"clr-icon",55),o._uU(10),o.ALo(11,"translate"),o.qZA(),o.qZA(),o.TgZ(12,"div",56),o._UZ(13,"input",57),o.ALo(14,"translate"),o.TgZ(15,"button",58),o.NdJ("click",function(){return o.CHM(t),o.oxw(3).filterInput.setValue("")}),o._UZ(16,"clr-icon",59),o.qZA(),o.qZA(),o._UZ(17,"div",60),o.YNc(18,Te,4,5,"a",61),o.qZA(),o.YNc(19,Fe,7,12,"div",62),o.ALo(20,"async"),o.YNc(21,Ie,4,12,"vdr-product-variants-table",63),o.YNc(22,Oe,7,23,"vdr-product-variants-list",64),o.qZA(),o.YNc(23,qe,7,12,"div",62),o.ALo(24,"async"),o.qZA()}if(2&t){const t=o.oxw(3);let e,n;o.xp6(4),o.ekj("btn-primary","card"===t.variantDisplayMode),o.xp6(2),o.hij(" ",o.lcZ(7,13,"catalog.display-variant-cards")," "),o.xp6(2),o.ekj("btn-primary","table"===t.variantDisplayMode),o.xp6(2),o.hij(" ",o.lcZ(11,15,"catalog.display-variant-table")," "),o.xp6(3),o.Q6J("formControl",t.filterInput)("placeholder",o.lcZ(14,17,"catalog.filter-by-name-or-sku")),o.xp6(5),o.Q6J("vdrIfPermissions",o.DdM(23,de)),o.xp6(1),o.Q6J("ngIf",10<(null==(e=o.lcZ(20,19,t.paginationConfig$))?null:e.totalItems)),o.xp6(2),o.Q6J("ngIf","table"===t.variantDisplayMode),o.xp6(1),o.Q6J("ngIf","card"===t.variantDisplayMode),o.xp6(1),o.Q6J("ngIf",10<(null==(n=o.lcZ(24,21,t.paginationConfig$))?null:n.totalItems))}}function _e(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"clr-tab"),o.TgZ(1,"button",13),o.NdJ("click",function(){return o.CHM(t),o.oxw(2).navigateToTab("variants")}),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.YNc(4,we,25,24,"clr-tab-content",14),o.ALo(5,"async"),o.qZA()}if(2&t){const t=o.oxw(2);o.xp6(2),o.hij(" ",o.lcZ(3,2,"catalog.product-variants")," "),o.xp6(2),o.Q6J("clrIfActive","variants"===o.lcZ(5,4,t.activeTab$))}}function ke(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"form",11),o._UZ(1,"button",12),o.TgZ(2,"clr-tabs"),o.TgZ(3,"clr-tab"),o.TgZ(4,"button",13),o.NdJ("click",function(){return o.CHM(t),o.oxw().navigateToTab("details")}),o._uU(5),o.ALo(6,"translate"),o.qZA(),o.YNc(7,ye,35,51,"clr-tab-content",14),o.ALo(8,"async"),o.qZA(),o.YNc(9,_e,6,6,"clr-tab",15),o.ALo(10,"async"),o.qZA(),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("formGroup",t.detailForm),o.xp6(5),o.hij(" ",o.lcZ(6,4,"catalog.product-details")," "),o.xp6(2),o.Q6J("clrIfActive","details"===o.lcZ(8,6,t.activeTab$)),o.xp6(2),o.Q6J("ngIf",!o.lcZ(10,8,t.isNew$))}}const Me=["productSearchInputComponent"];function Le(t,e){1&t&&o._UZ(0,"vdr-status-badge",19)}function Je(t,e){if(1&t){const t=o.EpF();o.ynx(0),o.TgZ(1,"button",20),o.NdJ("click",function(){return o.CHM(t),o.oxw().runPendingSearchIndexUpdates()}),o.ALo(2,"hasPermission"),o._UZ(3,"vdr-status-badge",19),o._uU(4),o.ALo(5,"translate"),o.qZA(),o._UZ(6,"div",21),o.BQk()}if(2&t){const t=o.oxw();o.xp6(1),o.Q6J("disabled",!o.lcZ(2,2,o.DdM(7,de))),o.xp6(3),o.hij(" ",o.xi3(5,4,"catalog.run-pending-search-index-updates",o.VKq(8,dt,t.pendingSearchIndexUpdates))," ")}}function Ue(t,e){1&t&&(o.TgZ(0,"a",22),o._UZ(1,"clr-icon",23),o.TgZ(2,"span",24),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.qZA()),2&t&&(o.Q6J("routerLink",o.DdM(4,ht)),o.xp6(3),o.Oqu(o.lcZ(4,2,"catalog.create-new-product")))}function Ne(t,e){if(1&t&&(o._UZ(0,"img",37),o.ALo(1,"assetPreview")),2&t){const t=e.ngIf;o.Q6J("src",o.xi3(1,1,t,"tiny"),o.LSH)}}function Ve(t,e){1&t&&(o.TgZ(0,"div",38),o._UZ(1,"clr-icon",39),o.qZA())}function $e(t,e){1&t&&(o.TgZ(0,"vdr-chip"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"common.disabled")))}const Se=function(){return["DeleteCatalog","DeleteProduct"]};function De(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"td",25),o.TgZ(1,"div",26),o.YNc(2,Ne,2,4,"img",27),o.YNc(3,Ve,2,0,"ng-template",null,28,o.W1O),o.qZA(),o.qZA(),o.TgZ(5,"td",29),o._uU(6),o.qZA(),o.TgZ(7,"td",30),o.YNc(8,$e,3,3,"vdr-chip",10),o.qZA(),o.TgZ(9,"td",31),o._UZ(10,"vdr-table-row-action",32),o.ALo(11,"translate"),o.TgZ(12,"vdr-dropdown"),o.TgZ(13,"button",33),o._uU(14),o.ALo(15,"translate"),o._UZ(16,"clr-icon",34),o.qZA(),o.TgZ(17,"vdr-dropdown-menu",8),o.TgZ(18,"button",35),o.NdJ("click",function(){const e=o.CHM(t).item;return o.oxw().deleteProduct(e.productId)}),o.ALo(19,"hasPermission"),o._UZ(20,"clr-icon",36),o._uU(21),o.ALo(22,"translate"),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=e.item,n=o.MAs(4),i=o.oxw();o.ekj("disabled",!t.enabled),o.xp6(2),o.Q6J("ngIf",i.groupByProduct?t.productAsset:t.productVariantAsset||t.productAsset)("ngIfElse",n),o.xp6(3),o.ekj("disabled",!t.enabled),o.xp6(1),o.hij(" ",i.groupByProduct?t.productName:t.productVariantName," "),o.xp6(1),o.ekj("disabled",!t.enabled),o.xp6(1),o.Q6J("ngIf",!t.enabled),o.xp6(1),o.ekj("disabled",!t.enabled),o.xp6(1),o.Q6J("label",o.lcZ(11,17,"common.edit"))("linkTo",o.VKq(25,Qt,t.productId)),o.xp6(4),o.hij(" ",o.lcZ(15,19,"common.actions")," "),o.xp6(4),o.Q6J("disabled",!o.lcZ(19,21,o.DdM(27,Se))),o.xp6(3),o.hij(" ",o.lcZ(22,23,"common.delete")," ")}}const Qe=function(){return["CreateCatalog","CreateProduct"]};function Ye(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",6),o.NdJ("click",function(){return o.CHM(t),o.oxw().save()}),o._uU(1),o.ALo(2,"translate"),o.qZA()}if(2&t){const t=o.oxw();o.Q6J("disabled",t.detailForm.pristine||t.detailForm.invalid),o.xp6(1),o.hij(" ",o.lcZ(2,2,"common.update")," ")}}function je(t,e){if(1&t&&(o.TgZ(0,"tr",22),o.TgZ(1,"td",23),o._UZ(2,"vdr-entity-info",13),o.qZA(),o.TgZ(3,"td",23),o._UZ(4,"input",24),o.ALo(5,"hasPermission"),o.qZA(),o.TgZ(6,"td",23),o._UZ(7,"input",25),o.qZA(),o.qZA()),2&t){const t=e.$implicit,n=e.index,i=o.oxw(3);o.Q6J("formGroupName",n),o.xp6(2),o.Q6J("entity",t.value),o.xp6(2),o.Q6J("readonly",!o.lcZ(5,3,i.updatePermission))}}function Ge(t,e){if(1&t&&(o.TgZ(0,"div",10),o.TgZ(1,"section",11),o.TgZ(2,"div",12),o._UZ(3,"vdr-entity-info",13),o.TgZ(4,"div",14),o._uU(5),o.qZA(),o.qZA(),o.TgZ(6,"div",15),o.TgZ(7,"vdr-form-field",16),o.ALo(8,"translate"),o._UZ(9,"input",17),o.ALo(10,"hasPermission"),o.qZA(),o.TgZ(11,"vdr-form-field",18),o.ALo(12,"translate"),o._UZ(13,"input",19),o.ALo(14,"hasPermission"),o.qZA(),o.qZA(),o.TgZ(15,"section",15),o.TgZ(16,"table",20),o.TgZ(17,"thead"),o.TgZ(18,"tr"),o._UZ(19,"th"),o.TgZ(20,"th"),o._uU(21),o.ALo(22,"translate"),o.qZA(),o.TgZ(23,"th"),o._uU(24),o.ALo(25,"translate"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(26,"tbody"),o.YNc(27,je,8,5,"tr",21),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&t){const t=e.$implicit,n=e.index,i=o.oxw(2);o.xp6(1),o.Q6J("formArrayName",n),o.xp6(2),o.Q6J("entity",t.value),o.xp6(2),o.Oqu(t.value.code),o.xp6(2),o.Q6J("label",o.lcZ(8,12,"common.name")),o.xp6(2),o.Q6J("id","name-"+n)("readonly",!o.lcZ(10,14,i.updatePermission)),o.xp6(2),o.Q6J("label",o.lcZ(12,16,"common.code")),o.xp6(2),o.Q6J("id","code-"+n)("readonly",!o.lcZ(14,18,i.updatePermission)),o.xp6(8),o.Oqu(o.lcZ(22,20,"common.name")),o.xp6(3),o.Oqu(o.lcZ(25,22,"common.code")),o.xp6(3),o.Q6J("ngForOf",i.getOptions(t))}}function Ee(t,e){if(1&t&&(o.TgZ(0,"form",7),o.TgZ(1,"div",8),o.YNc(2,Ge,28,24,"div",9),o.qZA(),o.qZA()),2&t){const t=o.oxw();o.Q6J("formGroup",t.detailForm),o.xp6(2),o.Q6J("ngForOf",t.getOptionGroups())}}function He(t,e){1&t&&(o._uU(0),o.ALo(1,"translate")),2&t&&o.hij(" ",o.lcZ(1,1,"catalog.confirm-deletion-of-unused-variants-title"),"\n")}function Be(t,e){if(1&t&&(o.TgZ(0,"li"),o._uU(1),o.qZA()),2&t){const t=e.$implicit;o.xp6(1),o.AsE("",t.name," (",t.sku,")")}}function Re(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",3),o.NdJ("click",function(){return o.CHM(t),o.oxw().cancel()}),o._uU(1),o.ALo(2,"translate"),o.qZA(),o.TgZ(3,"button",4),o.NdJ("click",function(){return o.CHM(t),o.oxw().confirm()}),o._uU(4),o.ALo(5,"translate"),o.qZA()}2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,2,"common.cancel")),o.xp6(3),o.hij(" ",o.lcZ(5,4,"common.confirm")," "))}function Ke(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",14),o.NdJ("click",function(){o.CHM(t);const e=o.oxw().$implicit;return o.oxw().removeOption(e)}),o._UZ(1,"clr-icon",15),o.qZA()}}function ze(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",7),o.TgZ(1,"div",8),o.TgZ(2,"label"),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.TgZ(5,"input",9),o.NdJ("ngModelChange",function(e){return o.CHM(t).$implicit.name=e}),o.qZA(),o.qZA(),o.TgZ(6,"div",10),o.TgZ(7,"label"),o._uU(8),o.ALo(9,"translate"),o.qZA(),o.TgZ(10,"vdr-option-value-input",11,12),o.NdJ("ngModelChange",function(e){return o.CHM(t).$implicit.values=e})("ngModelChange",function(){return o.CHM(t),o.oxw().generateVariants()}),o.qZA(),o.qZA(),o.TgZ(12,"div"),o.YNc(13,Ke,2,0,"button",13),o.qZA(),o.qZA()}if(2&t){const t=e.$implicit;o.xp6(3),o.Oqu(o.lcZ(4,8,"catalog.option")),o.xp6(2),o.Q6J("ngModel",t.name)("readonly",!t.isNew),o.xp6(3),o.Oqu(o.lcZ(9,10,"catalog.option-values")),o.xp6(2),o.Q6J("ngModel",t.values)("groupName",t.name)("disabled",""===t.name),o.xp6(3),o.Q6J("ngIf",t.isNew)}}function We(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"input",18),o.NdJ("ngModelChange",function(e){o.CHM(t);return o.oxw().$implicit.enabled=e})("ngModelChange",function(){o.CHM(t);return o.oxw(2).formValueChanged=!0}),o.qZA()}if(2&t){const t=o.oxw().$implicit;o.Q6J("ngModel",t.enabled)}}function Xe(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"clr-input-container"),o.TgZ(1,"input",19),o.NdJ("ngModelChange",function(e){o.CHM(t);return o.oxw().$implicit.sku=e})("ngModelChange",function(){o.CHM(t);const e=o.oxw().$implicit;return o.oxw().onFormChanged(e)}),o.ALo(2,"translate"),o.qZA(),o.qZA()}if(2&t){const t=o.oxw().$implicit;o.xp6(1),o.Q6J("ngModel",t.sku)("placeholder",o.lcZ(2,2,"catalog.sku"))}}function tn(t,e){if(1&t&&(o.TgZ(0,"span"),o._uU(1),o.qZA()),2&t){const t=o.oxw().$implicit;o.xp6(1),o.Oqu(t.sku)}}function en(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"clr-input-container"),o.TgZ(1,"vdr-currency-input",20),o.NdJ("ngModelChange",function(e){o.CHM(t);return o.oxw().$implicit.price=e})("ngModelChange",function(){o.CHM(t);const e=o.oxw().$implicit;return o.oxw().onFormChanged(e)}),o.qZA(),o.qZA()}if(2&t){const t=o.oxw().$implicit,e=o.oxw();o.xp6(1),o.Q6J("ngModel",t.price)("currencyCode",e.currencyCode)}}function nn(t,e){if(1&t&&(o.TgZ(0,"span"),o._uU(1),o.ALo(2,"localeCurrency"),o.qZA()),2&t){const t=o.oxw().$implicit,e=o.oxw();o.xp6(1),o.Oqu(o.xi3(2,1,t.price,e.currencyCode))}}function on(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"clr-input-container"),o.TgZ(1,"input",21),o.NdJ("ngModelChange",function(e){o.CHM(t);return o.oxw().$implicit.stock=e})("ngModelChange",function(){o.CHM(t);const e=o.oxw().$implicit;return o.oxw().onFormChanged(e)}),o.qZA(),o.qZA()}if(2&t){const t=o.oxw().$implicit;o.xp6(1),o.Q6J("ngModel",t.stock)}}function an(t,e){if(1&t&&(o.TgZ(0,"span"),o._uU(1),o.qZA()),2&t){const t=o.oxw().$implicit;o.xp6(1),o.Oqu(t.stock)}}function rn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"vdr-dropdown"),o.TgZ(1,"button",22),o._UZ(2,"clr-icon",23),o.qZA(),o.TgZ(3,"vdr-dropdown-menu",24),o.TgZ(4,"button",25),o.NdJ("click",function(){const e=o.CHM(t).ngIf;return o.oxw(2).deleteVariant(e)}),o._UZ(5,"clr-icon",26),o._uU(6),o.ALo(7,"translate"),o.qZA(),o.qZA(),o.qZA()}2&t&&(o.xp6(6),o.hij(" ",o.lcZ(7,1,"common.delete")," "))}function sn(t,e){if(1&t&&(o.TgZ(0,"tr"),o.TgZ(1,"td"),o.YNc(2,We,1,1,"input",16),o.qZA(),o.TgZ(3,"td"),o._uU(4),o.ALo(5,"translate"),o.qZA(),o.TgZ(6,"td"),o.YNc(7,Xe,3,4,"clr-input-container",17),o.YNc(8,tn,2,1,"span",17),o.qZA(),o.TgZ(9,"td"),o.YNc(10,en,2,2,"clr-input-container",17),o.YNc(11,nn,3,4,"span",17),o.qZA(),o.TgZ(12,"td"),o.YNc(13,on,2,1,"clr-input-container",17),o.YNc(14,an,2,1,"span",17),o.qZA(),o.TgZ(15,"td"),o.YNc(16,rn,8,3,"vdr-dropdown",17),o.qZA(),o.qZA()),2&t){const t=e.$implicit,n=o.oxw();o.ekj("disabled",!t.enabled||t.existing),o.xp6(2),o.Q6J("ngIf",!t.existing),o.xp6(2),o.hij(" ",o.lcZ(5,11,n.getVariantName(t))," "),o.xp6(3),o.Q6J("ngIf",!t.existing),o.xp6(1),o.Q6J("ngIf",t.existing),o.xp6(2),o.Q6J("ngIf",!t.existing),o.xp6(1),o.Q6J("ngIf",t.existing),o.xp6(2),o.Q6J("ngIf",!t.existing),o.xp6(1),o.Q6J("ngIf",t.existing),o.xp6(2),o.Q6J("ngIf",t.productVariantId)}}function cn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"img",11),o.NdJ("click",function(){o.CHM(t);const e=o.oxw(2);return e.previewAsset(e.featuredAsset)}),o.ALo(1,"assetPreview"),o.qZA()}if(2&t){const t=o.oxw(2);o.Q6J("src",o.xi3(1,1,t.featuredAsset,"small"),o.LSH)}}function ln(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",12),o.NdJ("click",function(){return o.CHM(t),o.oxw(2).selectAssets()}),o._UZ(1,"clr-icon",13),o.TgZ(2,"div"),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.qZA()}2&t&&(o.xp6(3),o.Oqu(o.lcZ(4,1,"catalog.no-featured-asset")))}function dn(t,e){1&t&&o.GkF(0)}function un(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",14),o.TgZ(1,"button",15),o.NdJ("click",function(){return o.CHM(t),o.oxw(2).selectAssets()}),o._UZ(2,"clr-icon",16),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.qZA()}2&t&&(o.xp6(3),o.hij(" ",o.lcZ(4,1,"asset.add-asset")," "))}function pn(t,e){if(1&t&&(o.TgZ(0,"div",3),o.TgZ(1,"div",4),o.TgZ(2,"div",5),o.YNc(3,cn,2,4,"img",6),o.YNc(4,ln,5,3,"div",7),o.qZA(),o.qZA(),o.TgZ(5,"div",8),o.YNc(6,dn,1,0,"ng-container",9),o.qZA(),o.YNc(7,un,5,3,"div",10),o.qZA()),2&t){const t=o.oxw(),e=o.MAs(4);o.xp6(3),o.Q6J("ngIf",t.featuredAsset),o.xp6(1),o.Q6J("ngIf",!t.featuredAsset),o.xp6(2),o.Q6J("ngTemplateOutlet",e),o.xp6(1),o.Q6J("vdrIfPermissions",t.updatePermissions)}}function gn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"img",11),o.NdJ("click",function(){o.CHM(t);const e=o.oxw(2);return e.previewAsset(e.featuredAsset)}),o.ALo(1,"assetPreview"),o.qZA()}if(2&t){const t=o.oxw(2);o.Q6J("src",o.xi3(1,1,t.featuredAsset,"thumb"),o.LSH)}}function mn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",12),o.NdJ("click",function(){return o.CHM(t),o.oxw(2).selectAssets()}),o._UZ(1,"clr-icon",19),o.qZA()}}function hn(t,e){1&t&&o.GkF(0)}function fn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",20),o.NdJ("click",function(){return o.CHM(t),o.oxw(2).selectAssets()}),o.ALo(1,"translate"),o._UZ(2,"clr-icon",16),o._uU(3),o.ALo(4,"translate"),o.qZA()}2&t&&(o.Q6J("title",o.lcZ(1,2,"asset.add-asset")),o.xp6(3),o.hij(" ",o.lcZ(4,4,"asset.add-asset")," "))}function vn(t,e){if(1&t&&(o.TgZ(0,"div",17),o.YNc(1,gn,2,4,"img",6),o.YNc(2,mn,2,0,"div",7),o.qZA(),o.YNc(3,hn,1,0,"ng-container",9),o.YNc(4,fn,5,6,"button",18)),2&t){const t=o.oxw(),e=o.MAs(4);o.xp6(1),o.Q6J("ngIf",t.featuredAsset),o.xp6(1),o.Q6J("ngIf",!t.featuredAsset),o.xp6(1),o.Q6J("ngTemplateOutlet",e),o.xp6(1),o.Q6J("vdrIfPermissions",t.updatePermissions)}}function Zn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",23),o.NdJ("cdkDropListDropped",function(e){return o.CHM(t),o.oxw(2).dropListDropped(e)}),o.ALo(1,"hasPermission"),o.TgZ(2,"vdr-dropdown",24),o.TgZ(3,"div",25),o._UZ(4,"img",26),o.ALo(5,"assetPreview"),o.qZA(),o.TgZ(6,"vdr-dropdown-menu",27),o.TgZ(7,"button",28),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw(2).previewAsset(e)}),o._uU(8),o.ALo(9,"translate"),o.qZA(),o.TgZ(10,"button",29),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw(2).setAsFeatured(e)}),o.ALo(11,"hasPermission"),o._uU(12),o.ALo(13,"translate"),o.qZA(),o._UZ(14,"div",30),o.TgZ(15,"button",31),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw(2).removeAsset(e)}),o.ALo(16,"hasPermission"),o._uU(17),o.ALo(18,"translate"),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=e.$implicit,n=e.index,i=o.oxw(2);o.Q6J("cdkDropListData",n)("cdkDropListDisabled",!o.lcZ(1,10,i.updatePermissions)),o.xp6(3),o.ekj("featured",i.isFeatured(t)),o.xp6(1),o.Q6J("src",o.xi3(5,12,t,"tiny"),o.LSH),o.xp6(4),o.hij(" ",o.lcZ(9,15,"asset.preview")," "),o.xp6(2),o.Q6J("disabled",i.isFeatured(t)||!o.lcZ(11,17,i.updatePermissions)),o.xp6(2),o.hij(" ",o.lcZ(13,19,"asset.set-as-featured-asset")," "),o.xp6(3),o.Q6J("disabled",!o.lcZ(16,21,i.updatePermissions)),o.xp6(2),o.hij(" ",o.lcZ(18,23,"asset.remove-asset")," ")}}function xn(t,e){if(1&t&&(o.TgZ(0,"div",21),o.YNc(1,Zn,19,25,"div",22),o.qZA()),2&t){const t=o.oxw();o.ekj("compact",t.compact),o.xp6(1),o.Q6J("ngForOf",t.assets)}}function Cn(t,e){1&t&&o.GkF(0)}const bn=function(){return{tab:"variants"}},An=function(t,e){return["/catalog/products",t,e]};function yn(t,e){if(1&t&&(o.TgZ(0,"td",7),o._uU(1),o.qZA(),o.TgZ(2,"td",7),o.TgZ(3,"small",8),o._uU(4),o.qZA(),o.qZA(),o.TgZ(5,"td",9),o._UZ(6,"vdr-table-row-action",10),o.ALo(7,"translate"),o.qZA()),2&t){const t=e.item;o.xp6(1),o.Oqu(t.name),o.xp6(3),o.Oqu(t.sku),o.xp6(2),o.Q6J("label",o.lcZ(7,4,"common.edit"))("linkTo",o.WLB(7,An,t.productId,o.DdM(6,bn)))}}const Pn=function(t){return{$implicit:t}};function Tn(t,e){if(1&t&&o._UZ(0,"vdr-collection-tree-node",1),2&t){const t=o.oxw();o.Q6J("expandAll",t.expandAll)("collectionTree",t.collectionTree)("activeCollectionId",t.activeCollectionId)}}function Fn(t,e){1&t&&o._UZ(0,"clr-icon",31)}function In(t,e){1&t&&o._UZ(0,"clr-icon",32)}function On(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",28),o.NdJ("click",function(){o.CHM(t);const e=o.oxw().$implicit;return o.oxw().toggleExpanded(e)}),o.YNc(1,Fn,1,0,"clr-icon",29),o.YNc(2,In,1,0,"clr-icon",30),o.qZA()}if(2&t){const t=o.oxw().$implicit,e=o.oxw();o.Q6J("disabled",e.expandAll),o.xp6(1),o.Q6J("ngIf",!t.expanded&&!e.expandAll),o.xp6(1),o.Q6J("ngIf",t.expanded||e.expandAll)}}function qn(t,e){1&t&&o._UZ(0,"div",33)}function wn(t,e){1&t&&(o.TgZ(0,"vdr-chip"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"catalog.private")))}function _n(t,e){1&t&&(o.TgZ(0,"div",34),o._UZ(1,"clr-icon",35),o.qZA())}const kn=function(t){return{parentId:t}},Mn=function(t){return["./","create",t]};function Ln(t,e){if(1&t&&(o.TgZ(0,"a",36),o._UZ(1,"clr-icon",37),o._uU(2),o.ALo(3,"translate"),o.qZA()),2&t){const t=o.oxw().$implicit;o.Q6J("routerLink",o.VKq(6,Mn,o.VKq(4,kn,t.id))),o.xp6(2),o.hij(" ",o.lcZ(3,2,"catalog.create-new-collection")," ")}}function Jn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",20),o.NdJ("click",function(){const e=o.CHM(t).$implicit,n=o.oxw().$implicit;return o.oxw().move(n,e.id)}),o.ALo(1,"async"),o.TgZ(2,"div",38),o.TgZ(3,"div",39),o._UZ(4,"clr-icon",40),o.qZA(),o.TgZ(5,"div",41),o._uU(6),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=e.$implicit,n=o.oxw(2);o.Q6J("disabled",!o.lcZ(1,2,n.hasUpdatePermission$)),o.xp6(6),o.hij(" ",t.path," ")}}function Un(t,e){if(1&t&&o._UZ(0,"vdr-collection-tree-node",42),2&t){const t=o.oxw().$implicit,e=o.oxw();o.Q6J("expandAll",e.expandAll)("collectionTree",t)("activeCollectionId",e.activeCollectionId)}}const Nn=function(t){return{contents:t}},Vn=function(t){return["/catalog/collections/",t]},$n=function(){return["UpdateCatalog","UpdateCollection"]};function Sn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",3),o.TgZ(1,"div",4),o.TgZ(2,"div",5),o.YNc(3,On,3,3,"button",6),o.YNc(4,qn,1,0,"ng-template",null,7,o.W1O),o._uU(6),o.qZA(),o._UZ(7,"div",8),o.YNc(8,wn,3,3,"vdr-chip",9),o.TgZ(9,"a",10),o._UZ(10,"clr-icon",11),o._uU(11),o.ALo(12,"translate"),o.qZA(),o.TgZ(13,"a",12),o._UZ(14,"clr-icon",13),o._uU(15),o.ALo(16,"translate"),o.qZA(),o.YNc(17,_n,2,0,"div",14),o.TgZ(18,"vdr-dropdown"),o.TgZ(19,"button",15),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw().getMoveListItems(e)}),o._UZ(20,"clr-icon",16),o.qZA(),o.TgZ(21,"vdr-dropdown-menu",17),o.YNc(22,Ln,4,8,"a",18),o._UZ(23,"div",19),o.TgZ(24,"button",20),o.NdJ("click",function(){const e=o.CHM(t),n=e.$implicit,i=e.index;return o.oxw().moveUp(n,i)}),o.ALo(25,"async"),o._UZ(26,"clr-icon",21),o._uU(27),o.ALo(28,"translate"),o.qZA(),o.TgZ(29,"button",20),o.NdJ("click",function(){const e=o.CHM(t),n=e.$implicit,i=e.index;return o.oxw().moveDown(n,i)}),o.ALo(30,"async"),o._UZ(31,"clr-icon",22),o._uU(32),o.ALo(33,"translate"),o.qZA(),o.TgZ(34,"h4",23),o._uU(35),o.ALo(36,"translate"),o.qZA(),o.YNc(37,Jn,7,4,"button",24),o._UZ(38,"div",19),o.TgZ(39,"button",25),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw().delete(e.id)}),o.ALo(40,"async"),o._UZ(41,"clr-icon",26),o._uU(42),o.ALo(43,"translate"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.YNc(44,Un,1,3,"vdr-collection-tree-node",27),o.qZA()}if(2&t){const t=e.$implicit,n=e.index,i=o.MAs(5),a=o.oxw();o.ekj("private",t.isPrivate),o.Q6J("cdkDragData",t),o.xp6(1),o.ekj("active",t.id===a.activeCollectionId),o.Q6J("ngClass","depth-"+a.depth),o.xp6(2),o.Q6J("ngIf",null==t.children?null:t.children.length)("ngIfElse",i),o.xp6(3),o.hij(" ",t.name," "),o.xp6(2),o.Q6J("ngIf",t.isPrivate),o.xp6(1),o.Q6J("routerLink",o.VKq(45,Qt,o.VKq(43,Nn,t.id))),o.xp6(2),o.hij(" ",o.lcZ(12,25,"catalog.view-contents")," "),o.xp6(2),o.Q6J("routerLink",o.VKq(47,Vn,t.id)),o.xp6(2),o.hij(" ",o.lcZ(16,27,"common.edit")," "),o.xp6(2),o.Q6J("vdrIfPermissions",o.DdM(49,$n)),o.xp6(5),o.Q6J("vdrIfPermissions",o.DdM(50,Zt)),o.xp6(2),o.Q6J("disabled",0===n||!o.lcZ(25,29,a.hasUpdatePermission$)),o.xp6(3),o.hij(" ",o.lcZ(28,31,"catalog.move-up")," "),o.xp6(2),o.Q6J("disabled",n===a.collectionTree.children.length-1||!o.lcZ(30,33,a.hasUpdatePermission$)),o.xp6(3),o.hij(" ",o.lcZ(33,35,"catalog.move-down")," "),o.xp6(3),o.Oqu(o.lcZ(36,37,"catalog.move-to")),o.xp6(2),o.Q6J("ngForOf",a.moveListItems),o.xp6(2),o.Q6J("disabled",!o.lcZ(40,39,a.hasDeletePermission$)),o.xp6(3),o.hij(" ",o.lcZ(43,41,"common.delete")," "),o.xp6(2),o.Q6J("ngIf",t.expanded||a.expandAll)}}function Dn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",7),o.TgZ(1,"div",8),o.TgZ(2,"label"),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.TgZ(5,"input",9),o.NdJ("ngModelChange",function(e){return o.CHM(t).$implicit.name=e})("keydown.enter",function(e){o.CHM(t);const n=o.MAs(11);return o.oxw().handleEnter(e,n)}),o.qZA(),o.qZA(),o.TgZ(6,"div",10),o.TgZ(7,"label"),o._uU(8),o.ALo(9,"translate"),o.qZA(),o.TgZ(10,"vdr-option-value-input",11,12),o.NdJ("ngModelChange",function(e){return o.CHM(t).$implicit.values=e})("ngModelChange",function(){return o.CHM(t),o.oxw().generateVariants()}),o.qZA(),o.qZA(),o.TgZ(12,"div",13),o.TgZ(13,"button",14),o.NdJ("click",function(){const e=o.CHM(t).$implicit;return o.oxw().removeOption(e.name)}),o.ALo(14,"translate"),o._UZ(15,"clr-icon",15),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=e.$implicit;o.xp6(3),o.Oqu(o.lcZ(4,7,"catalog.option")),o.xp6(2),o.Q6J("ngModel",t.name),o.xp6(3),o.Oqu(o.lcZ(9,9,"catalog.option-values")),o.xp6(2),o.Q6J("ngModel",t.values)("groupName",t.name)("disabled",""===t.name),o.xp6(3),o.Q6J("title",o.lcZ(14,11,"catalog.remove-option"))}}function Qn(t,e){1&t&&(o.TgZ(0,"th"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"common.create")))}function Yn(t,e){1&t&&(o.TgZ(0,"th"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"catalog.variant")))}function jn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"td"),o.TgZ(1,"input",19),o.NdJ("change",function(){return o.CHM(t),o.oxw(2).onFormChange()})("ngModelChange",function(e){o.CHM(t);const n=o.oxw().$implicit;return o.oxw().variantFormValues[n.id].enabled=e}),o.qZA(),o.qZA()}if(2&t){const t=o.oxw().$implicit,e=o.oxw();o.xp6(1),o.Q6J("ngModel",e.variantFormValues[t.id].enabled)}}function Gn(t,e){if(1&t&&(o.TgZ(0,"td"),o._uU(1),o.qZA()),2&t){const t=o.oxw().$implicit;o.xp6(1),o.hij(" ",t.values.join(" ")," ")}}function En(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"tr"),o.YNc(1,jn,2,1,"td",5),o.YNc(2,Gn,2,1,"td",5),o.TgZ(3,"td"),o.TgZ(4,"clr-input-container"),o.TgZ(5,"input",16),o.NdJ("change",function(){return o.CHM(t),o.oxw().onFormChange()})("ngModelChange",function(e){const n=o.CHM(t).$implicit;return o.oxw().variantFormValues[n.id].sku=e}),o.ALo(6,"translate"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(7,"td"),o.TgZ(8,"clr-input-container"),o.TgZ(9,"vdr-currency-input",17),o.NdJ("ngModelChange",function(e){const n=o.CHM(t).$implicit;return o.oxw().variantFormValues[n.id].price=e})("ngModelChange",function(){return o.CHM(t),o.oxw().onFormChange()}),o.qZA(),o.qZA(),o.qZA(),o.TgZ(10,"td"),o.TgZ(11,"clr-input-container"),o.TgZ(12,"input",18),o.NdJ("ngModelChange",function(e){const n=o.CHM(t).$implicit;return o.oxw().variantFormValues[n.id].stock=e})("change",function(){return o.CHM(t),o.oxw().onFormChange()}),o.qZA(),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=e.$implicit,n=o.oxw();o.ekj("disabled",!n.variantFormValues[t.id].enabled),o.xp6(1),o.Q6J("ngIf",1<n.variants.length),o.xp6(1),o.Q6J("ngIf",1<n.variants.length),o.xp6(3),o.Q6J("ngModel",n.variantFormValues[t.id].sku)("placeholder",o.lcZ(6,9,"catalog.sku")),o.xp6(4),o.Q6J("ngModel",n.variantFormValues[t.id].price)("currencyCode",n.currencyCode),o.xp6(3),o.Q6J("ngModel",n.variantFormValues[t.id].stock)}}const Hn=["textArea"];function Bn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"vdr-chip",6),o.NdJ("iconClick",function(){const e=o.CHM(t).$implicit;return o.oxw(2).removeOption(e)}),o._uU(1),o.qZA()}if(2&t){const t=e.$implicit,n=e.last,i=o.oxw(2);o.ekj("selected",n&&i.lastSelected)("locked",t.locked),o.Q6J("icon",t.locked?"lock":"times")("colorFrom",i.groupName),o.xp6(1),o.hij(" ",t.name," ")}}function Rn(t,e){if(1&t&&(o.TgZ(0,"div",4),o.YNc(1,Bn,2,7,"vdr-chip",5),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.Q6J("ngForOf",t.options)}}function Kn(t,e){1&t&&(o._uU(0),o.ALo(1,"translate")),2&t&&o.Oqu(o.lcZ(1,1,"catalog.update-product-option"))}function zn(t,e){if(1&t&&(o.TgZ(0,"section"),o.TgZ(1,"label"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o._UZ(4,"vdr-tabbed-custom-fields",10),o.ALo(5,"hasPermission"),o.qZA()),2&t){const t=o.oxw();o.xp6(2),o.Oqu(o.lcZ(3,4,"common.custom-fields")),o.xp6(2),o.Q6J("customFields",t.customFields)("customFieldsFormGroup",t.customFieldsForm)("readonly",!o.lcZ(5,6,o.DdM(8,de)))}}function Wn(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",11),o.NdJ("click",function(){return o.CHM(t),o.oxw().cancel()}),o._uU(1),o.ALo(2,"translate"),o.qZA(),o.TgZ(3,"button",12),o.NdJ("click",function(){return o.CHM(t),o.oxw().update()}),o._uU(4),o.ALo(5,"translate"),o.qZA()}if(2&t){const t=o.oxw(),e=o.MAs(4),n=o.MAs(8);o.xp6(1),o.Oqu(o.lcZ(2,3,"common.cancel")),o.xp6(2),o.Q6J("disabled",e.invalid||n.invalid||e.pristine&&n.pristine&&t.customFieldsForm.pristine),o.xp6(1),o.hij(" ",o.lcZ(5,5,"catalog.update-product-option")," ")}}function Xn(t,e){1&t&&(o.TgZ(0,"clr-toggle-wrapper"),o._UZ(1,"input",45),o.TgZ(2,"label"),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.qZA()),2&t&&(o.xp6(3),o.Oqu(o.lcZ(4,1,"common.enabled")))}function to(t,e){if(1&t&&(o.TgZ(0,"option",48),o._uU(1),o.qZA()),2&t){const t=e.$implicit;o.Q6J("value",t.id),o.xp6(1),o.hij(" ",t.name," ")}}function eo(t,e){if(1&t&&(o.TgZ(0,"clr-select-container"),o.TgZ(1,"label"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.TgZ(4,"select",46),o.YNc(5,to,2,2,"option",47),o.qZA(),o.qZA()),2&t){const t=o.oxw(3);o.xp6(2),o.Oqu(o.lcZ(3,2,"catalog.tax-category")),o.xp6(3),o.Q6J("ngForOf",t.taxCategories)}}function no(t,e){if(1&t&&(o.TgZ(0,"label",29),o._uU(1),o.ALo(2,"translate"),o.qZA(),o.TgZ(3,"div",49),o._uU(4),o.qZA()),2&t){const t=o.oxw().ngIf,e=o.oxw(2);o.xp6(1),o.Oqu(o.lcZ(2,2,"catalog.tax-category")),o.xp6(3),o.hij(" ",e.getTaxCategoryName(t)," ")}}function oo(t,e){if(1&t&&(o._UZ(0,"vdr-currency-input",50),o.ALo(1,"hasPermission")),2&t){const t=o.oxw(2).$implicit,e=o.oxw();o.Q6J("currencyCode",t.currencyCode)("readonly",!o.lcZ(1,2,e.updatePermission))}}function io(t,e){if(1&t&&(o._UZ(0,"vdr-currency-input",51),o.ALo(1,"hasPermission")),2&t){const t=o.oxw(2).$implicit,e=o.oxw();o.Q6J("currencyCode",t.currencyCode)("readonly",!o.lcZ(1,2,e.updatePermission))}}function ao(t,e){if(1&t&&(o.TgZ(0,"clr-select-container"),o.TgZ(1,"label"),o._uU(2),o.ALo(3,"translate"),o._UZ(4,"vdr-help-tooltip",27),o.ALo(5,"translate"),o.qZA(),o.TgZ(6,"select",52),o.TgZ(7,"option",48),o._uU(8),o.ALo(9,"translate"),o.qZA(),o.TgZ(10,"option",48),o._uU(11),o.ALo(12,"translate"),o.qZA(),o.TgZ(13,"option",48),o._uU(14),o.ALo(15,"translate"),o.qZA(),o.qZA(),o.qZA()),2&t){const t=o.oxw(3);o.xp6(2),o.hij("",o.lcZ(3,8,"catalog.track-inventory")," "),o.xp6(2),o.Q6J("content",o.lcZ(5,10,"catalog.track-inventory-tooltip")),o.xp6(3),o.Q6J("value",t.GlobalFlag.TRUE),o.xp6(1),o.hij(" ",o.lcZ(9,12,"catalog.track-inventory-true")," "),o.xp6(2),o.Q6J("value",t.GlobalFlag.FALSE),o.xp6(1),o.hij(" ",o.lcZ(12,14,"catalog.track-inventory-false")," "),o.xp6(2),o.Q6J("value",t.GlobalFlag.INHERIT),o.xp6(1),o.hij(" ",o.lcZ(15,16,"catalog.track-inventory-inherit")," ")}}function ro(t,e){if(1&t&&(o.TgZ(0,"section",53),o._UZ(1,"vdr-tabbed-custom-fields",54),o.ALo(2,"hasPermission"),o.qZA()),2&t){const t=o.oxw().ngIf,e=o.oxw(2);o.xp6(1),o.Q6J("customFields",e.customFields)("compact",!0)("customFieldsFormGroup",t.get("customFields"))("readonly",!o.lcZ(2,4,e.updatePermission))}}function so(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"vdr-chip",58),o.NdJ("iconClick",function(){const e=o.CHM(t).$implicit;return o.oxw(4).editOption(e)}),o.ALo(1,"hasPermission"),o.TgZ(2,"span",59),o._uU(3),o.qZA(),o._uU(4),o.qZA()}if(2&t){const t=e.$implicit,n=o.oxw(4);o.Q6J("colorFrom",n.optionGroupName(t.groupId))("invert",!0)("icon",o.lcZ(1,5,n.updatePermission)&&"pencil"),o.xp6(3),o.Oqu(n.optionGroupName(t.groupId)),o.xp6(1),o.hij(" ",n.optionName(t)," ")}}const co=function(){return["./","options"]};function lo(t,e){if(1&t&&(o.TgZ(0,"div"),o.TgZ(1,"div",55),o.YNc(2,so,5,7,"vdr-chip",56),o.ALo(3,"sort"),o.TgZ(4,"a",57),o._uU(5),o.ALo(6,"translate"),o.qZA(),o.qZA(),o.qZA()),2&t){const t=o.oxw(2).$implicit;o.xp6(2),o.Q6J("ngForOf",o.xi3(3,3,t.options,"groupId")),o.xp6(2),o.Q6J("routerLink",o.DdM(8,co)),o.xp6(1),o.hij("",o.lcZ(6,6,"catalog.edit-options"),"...")}}function uo(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"vdr-facet-value-chip",60),o.NdJ("remove",function(){const e=o.CHM(t).$implicit,n=o.oxw(2).$implicit;return o.oxw().removeFacetValue(n,e.id)}),o.ALo(1,"hasPermission"),o.qZA()}if(2&t){const t=e.$implicit,n=o.oxw(3);o.Q6J("facetValue",t)("removable",o.lcZ(1,2,n.updatePermission))}}function po(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"vdr-facet-value-chip",60),o.NdJ("remove",function(){const e=o.CHM(t).$implicit,n=o.oxw(2).$implicit;return o.oxw().removeFacetValue(n,e.id)}),o.ALo(1,"hasPermission"),o.qZA()}if(2&t){const t=e.$implicit,n=o.oxw(3);o.Q6J("facetValue",t)("removable",o.lcZ(1,2,n.updatePermission))}}function go(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"button",61),o.NdJ("click",function(){o.CHM(t);const e=o.oxw(2).$implicit;return o.oxw().selectFacetValueClick.emit([e.id])}),o._UZ(1,"clr-icon",62),o._uU(2),o.ALo(3,"translate"),o.qZA()}2&t&&(o.xp6(2),o.hij(" ",o.lcZ(3,1,"catalog.add-facets")," "))}function mo(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"vdr-chip",69),o.NdJ("iconClick",function(){o.CHM(t);const e=o.oxw().$implicit,n=o.oxw(4).$implicit;return o.oxw().removeFromChannel.emit({channelId:e.id,variant:n})}),o.ALo(1,"translate"),o._UZ(2,"vdr-channel-badge",70),o._uU(3),o.ALo(4,"channelCodeToLabel"),o.qZA()}if(2&t){const t=o.oxw().$implicit;o.Q6J("title",o.lcZ(1,3,"catalog.remove-from-channel")),o.xp6(2),o.Q6J("channelCode",t.code),o.xp6(1),o.hij(" ",o.lcZ(4,5,t.code)," ")}}function ho(t,e){if(1&t&&(o.ynx(0),o.YNc(1,mo,5,7,"vdr-chip",68),o.BQk()),2&t){const t=e.$implicit,n=o.oxw(5);o.xp6(1),o.Q6J("ngIf",!n.isDefaultChannel(t.code))}}function fo(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",13),o.TgZ(1,"div",64),o.YNc(2,ho,2,1,"ng-container",65),o.TgZ(3,"button",66),o.NdJ("click",function(){o.CHM(t);const e=o.oxw(3).$implicit;return o.oxw().assignToChannel.emit(e)}),o._UZ(4,"clr-icon",67),o._uU(5),o.ALo(6,"translate"),o.qZA(),o.qZA(),o.qZA()}if(2&t){const t=o.oxw(3).$implicit;o.xp6(2),o.Q6J("ngForOf",t.channels),o.xp6(3),o.hij(" ",o.lcZ(6,2,"catalog.assign-to-channel")," ")}}function vo(t,e){1&t&&(o.ynx(0),o.YNc(1,fo,7,4,"div",63),o.BQk())}function Zo(t,e){if(1&t){const t=o.EpF();o.ynx(0,4),o.TgZ(1,"div",5),o.TgZ(2,"div",6),o.TgZ(3,"vdr-title-input",7),o.ALo(4,"hasPermission"),o.TgZ(5,"clr-input-container"),o._UZ(6,"input",8),o.ALo(7,"hasPermission"),o.ALo(8,"translate"),o.qZA(),o.qZA(),o.TgZ(9,"vdr-title-input",9),o.ALo(10,"hasPermission"),o.TgZ(11,"clr-input-container"),o._UZ(12,"input",10),o.ALo(13,"hasPermission"),o.ALo(14,"translate"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(15,"div",11),o.YNc(16,Xn,5,3,"clr-toggle-wrapper",12),o.qZA(),o.qZA(),o.TgZ(17,"div",13),o.TgZ(18,"div",14),o.TgZ(19,"div",15),o.TgZ(20,"vdr-assets",16),o.NdJ("change",function(e){o.CHM(t);const n=o.oxw().$implicit;return o.oxw().onAssetChange(n.id,e)}),o.qZA(),o.qZA(),o.TgZ(21,"div",17),o.TgZ(22,"div",18),o.TgZ(23,"div",19),o.TgZ(24,"div",20),o.YNc(25,eo,6,4,"clr-select-container",21),o.YNc(26,no,5,4,"ng-template",null,22,o.W1O),o.qZA(),o.TgZ(28,"div",23),o.TgZ(29,"clr-input-container"),o.TgZ(30,"label"),o._uU(31),o.ALo(32,"translate"),o.qZA(),o.YNc(33,oo,2,4,"vdr-currency-input",24),o.YNc(34,io,2,4,"vdr-currency-input",25),o.qZA(),o.qZA(),o._UZ(35,"vdr-variant-price-detail",26),o.qZA(),o.TgZ(36,"div",19),o.YNc(37,ao,16,18,"clr-select-container",12),o.TgZ(38,"clr-input-container"),o.TgZ(39,"label"),o._uU(40),o.ALo(41,"translate"),o._UZ(42,"vdr-help-tooltip",27),o.ALo(43,"translate"),o.qZA(),o._UZ(44,"input",28),o.ALo(45,"hasPermission"),o.qZA(),o.TgZ(46,"div"),o.TgZ(47,"label",29),o._uU(48),o.ALo(49,"translate"),o._UZ(50,"vdr-help-tooltip",27),o.ALo(51,"translate"),o.qZA(),o.TgZ(52,"div",30),o._uU(53),o.qZA(),o.qZA(),o.TgZ(54,"div"),o.TgZ(55,"label",29),o._uU(56),o.ALo(57,"translate"),o._UZ(58,"vdr-help-tooltip",27),o.ALo(59,"translate"),o.qZA(),o.TgZ(60,"div",30),o._uU(61),o.qZA(),o.qZA(),o.qZA(),o.TgZ(62,"div",19),o.TgZ(63,"div",31),o.TgZ(64,"label",29),o._uU(65),o.ALo(66,"translate"),o._UZ(67,"vdr-help-tooltip",27),o.ALo(68,"translate"),o.qZA(),o.TgZ(69,"div",32),o.TgZ(70,"clr-input-container"),o._UZ(71,"input",33),o.ALo(72,"hasPermission"),o.qZA(),o.TgZ(73,"clr-toggle-wrapper"),o._UZ(74,"input",34),o.ALo(75,"hasPermission"),o.TgZ(76,"label"),o._uU(77),o.ALo(78,"translate"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(79,"div",35),o.TgZ(80,"div",19),o.YNc(81,ro,3,6,"section",36),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(82,"div",13),o.TgZ(83,"div",37),o._UZ(84,"vdr-entity-info",38),o.YNc(85,lo,7,9,"div",39),o._UZ(86,"div",40),o.TgZ(87,"div",41),o.YNc(88,uo,2,4,"vdr-facet-value-chip",42),o.YNc(89,po,2,4,"vdr-facet-value-chip",42),o.YNc(90,go,4,3,"button",43),o.qZA(),o.qZA(),o.qZA(),o.YNc(91,vo,2,0,"ng-container",44),o.BQk()}if(2&t){const t=e.ngIf,n=o.MAs(27),i=o.oxw().$implicit,a=o.oxw();let r;o.Q6J("formGroup",t),o.xp6(3),o.Q6J("readonly",!o.lcZ(4,55,a.updatePermission)),o.xp6(3),o.Q6J("readonly",!o.lcZ(7,57,a.updatePermission))("placeholder",o.lcZ(8,59,"catalog.sku")),o.xp6(3),o.Q6J("readonly",!o.lcZ(10,61,a.updatePermission)),o.xp6(3),o.Q6J("readonly",!o.lcZ(13,63,a.updatePermission))("placeholder",o.lcZ(14,65,"common.name")),o.xp6(4),o.Q6J("vdrIfPermissions",a.updatePermission),o.xp6(4),o.Q6J("compact",!0)("assets",(null==a.pendingAssetChanges[i.id]?null:a.pendingAssetChanges[i.id].assets)||i.assets)("featuredAsset",(null==a.pendingAssetChanges[i.id]?null:a.pendingAssetChanges[i.id].featuredAsset)||i.featuredAsset)("updatePermissions",a.updatePermission),o.xp6(5),o.Q6J("vdrIfPermissions",a.updatePermission)("vdrIfPermissionsElse",n),o.xp6(6),o.Oqu(o.lcZ(32,67,"catalog.price")),o.xp6(2),o.Q6J("ngIf",!a.channelPriceIncludesTax),o.xp6(1),o.Q6J("ngIf",a.channelPriceIncludesTax),o.xp6(1),o.Q6J("price",t.get("price").value)("currencyCode",i.currencyCode)("priceIncludesTax",a.channelPriceIncludesTax)("taxCategoryId",t.get("taxCategoryId").value),o.xp6(2),o.Q6J("vdrIfPermissions",a.updatePermission),o.xp6(3),o.hij("",o.lcZ(41,69,"catalog.stock-on-hand")," "),o.xp6(2),o.Q6J("content",o.lcZ(43,71,"catalog.stock-on-hand-tooltip")),o.xp6(2),o.ekj("inventory-untracked",a.inventoryIsNotTracked(t)),o.Q6J("min",a.getStockOnHandMinValue(t))("readonly",!o.lcZ(45,73,a.updatePermission))("vdrDisabled",a.inventoryIsNotTracked(t)),o.xp6(2),o.ekj("inventory-untracked",a.inventoryIsNotTracked(t)),o.xp6(2),o.hij("",o.lcZ(49,75,"catalog.stock-allocated")," "),o.xp6(2),o.Q6J("content",o.lcZ(51,77,"catalog.stock-allocated-tooltip")),o.xp6(3),o.hij(" ",i.stockAllocated," "),o.xp6(1),o.ekj("inventory-untracked",a.inventoryIsNotTracked(t)),o.xp6(2),o.hij("",o.lcZ(57,79,"catalog.stock-saleable")," "),o.xp6(2),o.Q6J("content",o.lcZ(59,81,"catalog.stock-saleable-tooltip")),o.xp6(3),o.hij(" ",a.getSaleableStockLevel(i)," "),o.xp6(2),o.ekj("inventory-untracked",a.inventoryIsNotTracked(t)),o.xp6(2),o.Oqu(o.lcZ(66,83,"catalog.out-of-stock-threshold")),o.xp6(2),o.Q6J("content",o.lcZ(68,85,"catalog.out-of-stock-threshold-tooltip")),o.xp6(4),o.Q6J("formControl",t.get("outOfStockThreshold"))("readonly",!o.lcZ(72,87,a.updatePermission))("vdrDisabled",!1!==(null==(r=t.get("useGlobalOutOfStockThreshold"))?null:r.value)||a.inventoryIsNotTracked(t)),o.xp6(3),o.Q6J("vdrDisabled",!o.lcZ(75,89,a.updatePermission)||a.inventoryIsNotTracked(t)),o.xp6(3),o.AsE("",o.lcZ(78,91,"catalog.use-global-value")," (",a.globalOutOfStockThreshold,")"),o.xp6(4),o.Q6J("ngIf",a.customFields.length),o.xp6(3),o.Q6J("entity",i),o.xp6(1),o.Q6J("ngIf",i.options.length),o.xp6(3),o.Q6J("ngForOf",a.existingFacetValues(i)),o.xp6(1),o.Q6J("ngForOf",a.pendingFacetValues(i)),o.xp6(1),o.Q6J("vdrIfPermissions",a.updatePermission)}}function xo(t,e){if(1&t&&(o.TgZ(0,"div",2),o.YNc(1,Zo,92,93,"ng-container",3),o.qZA()),2&t){const t=e.$implicit,n=o.oxw();let i,a;o.ekj("disabled",!(null!=(i=n.formGroupMap.get(t.id))&&null!=(a=i.get("enabled"))&&a.value)),o.xp6(1),o.Q6J("ngIf",n.formGroupMap.get(t.id))}}const Co=function(){return{itemsPerPage:10,currentPage:1}};function bo(t,e){if(1&t&&(o.ynx(0),o.TgZ(1,"th"),o._uU(2),o.qZA(),o.BQk()),2&t){const t=e.$implicit;o.xp6(2),o.Oqu(t.name)}}function Ao(t,e){if(1&t&&(o._UZ(0,"img",18),o.ALo(1,"assetPreview")),2&t){const t=e.ngIf;o.Q6J("src",o.xi3(1,1,t,"tiny"),o.LSH)}}function yo(t,e){1&t&&(o.TgZ(0,"div",19),o._UZ(1,"clr-icon",20),o.qZA())}function Po(t,e){if(1&t&&(o.ynx(0),o.TgZ(1,"td",5),o.ALo(2,"stringToColor"),o._uU(3),o.qZA(),o.BQk()),2&t){const t=e.$implicit,n=o.oxw().ngIf,i=o.oxw(2);o.xp6(1),o.Udp("color",o.lcZ(2,5,i.optionGroupName(t.groupId))),o.ekj("disabled",!n.get("enabled").value),o.xp6(2),o.hij(" ",t.name," ")}}function To(t,e){if(1&t&&(o._UZ(0,"vdr-currency-input",21),o.ALo(1,"hasPermission")),2&t){const t=o.oxw(2).$implicit,e=o.oxw();o.Q6J("currencyCode",t.currencyCode)("readonly",!o.lcZ(1,2,e.updatePermission))}}function Fo(t,e){if(1&t&&(o._UZ(0,"vdr-currency-input",22),o.ALo(1,"hasPermission")),2&t){const t=o.oxw(2).$implicit,e=o.oxw();o.Q6J("currencyCode",t.currencyCode)("readonly",!o.lcZ(1,2,e.updatePermission))}}function Io(t,e){if(1&t&&(o.ynx(0,4),o.TgZ(1,"td",5),o.TgZ(2,"div",6),o.TgZ(3,"div",7),o.YNc(4,Ao,2,4,"img",8),o.YNc(5,yo,2,0,"ng-template",null,9,o.W1O),o.qZA(),o.qZA(),o.qZA(),o.TgZ(7,"td",5),o.TgZ(8,"clr-input-container"),o._UZ(9,"input",10),o.ALo(10,"hasPermission"),o.ALo(11,"translate"),o.qZA(),o.qZA(),o.TgZ(12,"td",5),o.TgZ(13,"clr-input-container"),o._UZ(14,"input",11),o.ALo(15,"hasPermission"),o.ALo(16,"translate"),o.qZA(),o.qZA(),o.YNc(17,Po,4,7,"ng-container",1),o.ALo(18,"sort"),o.TgZ(19,"td",12),o.TgZ(20,"clr-input-container"),o.YNc(21,To,2,4,"vdr-currency-input",13),o.YNc(22,Fo,2,4,"vdr-currency-input",14),o.qZA(),o.qZA(),o.TgZ(23,"td",15),o.TgZ(24,"clr-input-container"),o._UZ(25,"input",16),o.ALo(26,"hasPermission"),o.qZA(),o.qZA(),o.TgZ(27,"td",15),o.TgZ(28,"clr-toggle-wrapper"),o._UZ(29,"input",17),o.ALo(30,"hasPermission"),o.qZA(),o.qZA(),o.BQk()),2&t){const t=e.ngIf,n=o.MAs(6),i=o.oxw().$implicit,a=o.oxw();o.Q6J("formGroup",t),o.xp6(1),o.ekj("disabled",!t.get("enabled").value),o.xp6(3),o.Q6J("ngIf",a.getFeaturedAsset(i))("ngIfElse",n),o.xp6(3),o.ekj("disabled",!t.get("enabled").value),o.xp6(2),o.Q6J("readonly",!o.lcZ(10,24,a.updatePermission))("placeholder",o.lcZ(11,26,"common.name")),o.xp6(3),o.ekj("disabled",!t.get("enabled").value),o.xp6(2),o.Q6J("readonly",!o.lcZ(15,28,a.updatePermission))("placeholder",o.lcZ(16,30,"catalog.sku")),o.xp6(3),o.Q6J("ngForOf",o.xi3(18,32,i.options,"groupId")),o.xp6(2),o.ekj("disabled",!t.get("enabled").value),o.xp6(2),o.Q6J("ngIf",!a.channelPriceIncludesTax),o.xp6(1),o.Q6J("ngIf",a.channelPriceIncludesTax),o.xp6(1),o.ekj("disabled",!t.get("enabled").value),o.xp6(2),o.Q6J("readonly",!o.lcZ(26,35,a.updatePermission)),o.xp6(2),o.ekj("disabled",!t.get("enabled").value),o.xp6(2),o.Q6J("vdrDisabled",!o.lcZ(30,37,a.updatePermission))}}function Oo(t,e){if(1&t&&(o.TgZ(0,"tr"),o.YNc(1,Io,31,39,"ng-container",3),o.qZA()),2&t){const t=e.$implicit,n=o.oxw();o.xp6(1),o.Q6J("ngIf",n.formGroupMap.get(t.id))}}const qo=function(t){return{rate:t}};function wo(t,e){if(1&t&&(o.TgZ(0,"div",2),o._uU(1),o.ALo(2,"translate"),o.ALo(3,"async"),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.hij(" ",o.xi3(2,1,"catalog.price-includes-tax-at",o.VKq(6,qo,o.lcZ(3,4,t.taxRate$))),"\n")}}const _o=function(t,e){return{price:t,rate:e}};function ko(t,e){if(1&t&&(o.TgZ(0,"div",2),o._uU(1),o.ALo(2,"translate"),o.ALo(3,"localeCurrency"),o.ALo(4,"async"),o.ALo(5,"async"),o.qZA()),2&t){const t=o.oxw();o.xp6(1),o.hij(" ",o.xi3(2,1,"catalog.price-with-tax-in-default-zone",o.WLB(11,_o,o.xi3(3,4,o.lcZ(4,7,t.grossPrice$),t.currencyCode),o.lcZ(5,9,t.taxRate$))),"\n")}}class Mo extends a.UT_{constructor(t,e,n,o,i,a){super(e,t,n,i),this.notificationService=o,this.dataService=i,this.formBuilder=a,this.detailForm=new I.cw({}),this.customFields=this.getCustomFieldConfig("Asset")}ngOnInit(){this.detailForm=new I.cw({name:new I.NI(""),tags:new I.NI([]),customFields:this.formBuilder.group(this.customFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{}))}),this.init()}ngOnDestroy(){this.destroy()}onAssetChange(t){var e,n;null===(e=this.detailForm.get("name"))||void 0===e||e.setValue(t.name),null===(n=this.detailForm.get("tags"))||void 0===n||n.setValue(t.tags),this.detailForm.markAsDirty()}save(){this.dataService.product.updateAsset({id:this.id,name:this.detailForm.value.name,tags:this.detailForm.value.tags,customFields:this.detailForm.value.customFields}).subscribe(()=>{this.notificationService.success((0,r.J)("common.notify-update-success"),{entity:"Asset"})},t=>{this.notificationService.error((0,r.J)("common.notify-update-error"),{entity:"Asset"})})}setFormValues(t,e){var n,o;null===(n=this.detailForm.get("name"))||void 0===n||n.setValue(t.name),null===(o=this.detailForm.get("tags"))||void 0===o||o.setValue(t.tags),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),t)}}Mo.\u0275fac=function(t){return new(t||Mo)(o.Y36(i.F0),o.Y36(i.gz),o.Y36(a.iHG),o.Y36(a.gqp),o.Y36(a.DoR),o.Y36(I.qu))},Mo.\u0275cmp=o.Xpm({type:Mo,selectors:[["vdr-asset-detail"]],features:[o.qOj],decls:9,vars:11,consts:[[3,"entity"],["locationId","asset-detail"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"asset","editable","customFields","customFieldsForm","assetChange"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(o.TgZ(0,"vdr-action-bar"),o.TgZ(1,"vdr-ab-left"),o._UZ(2,"vdr-entity-info",0),o.ALo(3,"async"),o.qZA(),o.TgZ(4,"vdr-ab-right"),o._UZ(5,"vdr-action-bar-items",1),o.YNc(6,R,3,4,"button",2),o.qZA(),o.qZA(),o.TgZ(7,"vdr-asset-preview",3),o.NdJ("assetChange",function(t){return e.onAssetChange(t)}),o.ALo(8,"async"),o.qZA()),2&t&&(o.xp6(2),o.Q6J("entity",o.lcZ(3,6,e.entity$)),o.xp6(4),o.Q6J("vdrIfPermissions",o.DdM(10,K)),o.xp6(1),o.Q6J("asset",o.lcZ(8,8,e.entity$))("editable",!0)("customFields",e.customFields)("customFieldsForm",e.detailForm.get("customFields")))},directives:[a.KkL,a.BND,a.Vqt,a.mz,a.WWO,a.HAh,a.Agc],pipes:[S.Ov,E.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"],changeDetection:0}),Mo.ctorParameters=()=>[{type:i.F0},{type:i.gz},{type:a.iHG},{type:a.gqp},{type:a.DoR},{type:I.qu}];class Lo extends a.t7C{constructor(t,e,n,o,i){super(o,i),this.notificationService=t,this.modalService=e,this.dataService=n,this.searchTerm$=new O.X(void 0),this.filterByTags$=new O.X(void 0),this.uploading=!1,super.setQueryFn((...t)=>this.dataService.product.getAssetList(...t),t=>t.assets,(t,e)=>{var n;const o=this.searchTerm$.value,i=null===(n=this.filterByTags$.value)||void 0===n?void 0:n.map(t=>t.value);return{options:Object.assign(Object.assign({skip:t,take:e},o?{filter:{name:{contains:o}}}:{}),{sort:{createdAt:a.Asd.DESC},tags:i,tagsOperator:a.FnJ.AND})}},{take:25,skip:0})}ngOnInit(){super.ngOnInit(),this.paginationConfig$=(0,q.aj)(this.itemsPerPage$,this.currentPage$,this.totalItems$).pipe((0,d.U)(([t,e,n])=>({itemsPerPage:t,currentPage:e,totalItems:n}))),this.searchTerm$.pipe((0,u.b)(250),(0,p.R)(this.destroy$)).subscribe(()=>this.refresh()),this.filterByTags$.pipe((0,p.R)(this.destroy$)).subscribe(()=>this.refresh()),this.allTags$=this.dataService.product.getTagList().mapStream(t=>t.tags.items)}filesSelected(t){t.length&&(this.uploading=!0,this.dataService.product.createAssets(t).pipe((0,g.x)(()=>this.uploading=!1)).subscribe(({createAssets:t})=>{let e=0;for(const n of t)switch(n.__typename){case"Asset":e++;break;case"MimeTypeError":this.notificationService.error(n.message)}0<e&&(super.refresh(),this.notificationService.success((0,r.J)("asset.notify-create-assets-success"),{count:e}))}))}deleteAssets(t){this.showModalAndDelete(t.map(t=>t.id)).pipe((0,m.w)(e=>e.result===a.PcR.DELETED?[!0]:this.showModalAndDelete(t.map(t=>t.id),e.message||"").pipe((0,d.U)(t=>t.result===a.PcR.DELETED)))).subscribe(()=>{this.notificationService.success((0,r.J)("common.notify-delete-success"),{entity:"Assets"}),this.refresh()},t=>{this.notificationService.error((0,r.J)("common.notify-delete-error"),{entity:"Assets"})})}showModalAndDelete(t,e){return this.modalService.dialog({title:(0,r.J)("catalog.confirm-delete-assets"),translationVars:{count:t.length},body:e,buttons:[{type:"secondary",label:(0,r.J)("common.cancel")},{type:"danger",label:(0,r.J)("common.delete"),returnValue:!0}]}).pipe((0,m.w)(n=>n?this.dataService.product.deleteAssets(t,!!e):w.E),(0,d.U)(t=>t.deleteAssets))}}Lo.\u0275fac=function(t){return new(t||Lo)(o.Y36(a.gqp),o.Y36(a.Z7U),o.Y36(a.DoR),o.Y36(i.F0),o.Y36(i.gz))},Lo.\u0275cmp=o.Xpm({type:Lo,selectors:[["vdr-asset-list"]],features:[o.qOj],decls:19,vars:31,consts:[[3,"grow"],[1,"pr4","mt1",3,"tags","searchTermChange","tagsChange"],["locationId","asset-list"],["dropZoneTarget",".content-area",3,"uploading","selectFiles"],[3,"assets","multiSelect","canDelete","deleteAssets"],[1,"paging-controls"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","totalItems","pageChange"]],template:function(t,e){1&t&&(o.TgZ(0,"vdr-action-bar"),o.TgZ(1,"vdr-ab-left",0),o.TgZ(2,"vdr-asset-search-input",1),o.NdJ("searchTermChange",function(t){return e.searchTerm$.next(t)})("tagsChange",function(t){return e.filterByTags$.next(t)}),o.ALo(3,"async"),o.qZA(),o.qZA(),o.TgZ(4,"vdr-ab-right"),o._UZ(5,"vdr-action-bar-items",2),o.TgZ(6,"vdr-asset-file-input",3),o.NdJ("selectFiles",function(t){return e.filesSelected(t)}),o.qZA(),o.qZA(),o.qZA(),o.TgZ(7,"vdr-asset-gallery",4),o.NdJ("deleteAssets",function(t){return e.deleteAssets(t)}),o.ALo(8,"paginate"),o.ALo(9,"async"),o.ALo(10,"async"),o.ALo(11,"hasPermission"),o.qZA(),o.TgZ(12,"div",5),o.TgZ(13,"vdr-items-per-page-controls",6),o.NdJ("itemsPerPageChange",function(t){return e.setItemsPerPage(t)}),o.ALo(14,"async"),o.qZA(),o.TgZ(15,"vdr-pagination-controls",7),o.NdJ("pageChange",function(t){return e.setPageNumber(t)}),o.ALo(16,"async"),o.ALo(17,"async"),o.ALo(18,"async"),o.qZA(),o.qZA()),2&t&&(o.xp6(1),o.Q6J("grow",!0),o.xp6(1),o.Q6J("tags",o.lcZ(3,10,e.allTags$)),o.xp6(4),o.Q6J("uploading",e.uploading),o.xp6(1),o.Q6J("assets",o.xi3(8,12,o.lcZ(9,15,e.items$),o.lcZ(10,17,e.paginationConfig$)||o.DdM(29,z)))("multiSelect",!0)("canDelete",o.lcZ(11,19,o.DdM(30,W))),o.xp6(6),o.Q6J("itemsPerPage",o.lcZ(14,21,e.itemsPerPage$)),o.xp6(2),o.Q6J("currentPage",o.lcZ(16,23,e.currentPage$))("itemsPerPage",o.lcZ(17,25,e.itemsPerPage$))("totalItems",o.lcZ(18,27,e.totalItems$)))},directives:[a.KkL,a.BND,a.Vrp,a.mz,a.WWO,a.eru,a.K8o,a.wAH,a.LSK],pipes:[S.Ov,H._s,a.j$k],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}vdr-asset-gallery[_ngcontent-%COMP%]{flex:1}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]}),Lo.ctorParameters=()=>[{type:a.gqp},{type:a.Z7U},{type:a.DoR},{type:i.F0},{type:i.gz}];class Jo extends a.UT_{constructor(t,e,n,o,i,r,s,c,l){var d;super(e,t,n,i),this.changeDetector=o,this.dataService=i,this.formBuilder=r,this.notificationService=s,this.modalService=c,this.localStorageService=l,this.assetChanges={},this.filters=[],this.allFilters=[],this.livePreview=!1,this.updatePermission=[a.y3$.UpdateCatalog,a.y3$.UpdateCollection],this.filterRemoved$=new _.xQ,this.customFields=this.getCustomFieldConfig("Collection"),this.detailForm=this.formBuilder.group({name:["",I.kI.required],slug:["",(0,a.Foo)(/^[\p{Letter}0-9_-]+$/)],description:"",visible:!1,filters:this.formBuilder.array([]),customFields:this.formBuilder.group(this.customFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{}))}),this.livePreview=null!==(d=this.localStorageService.get("livePreviewCollectionContents"))&&void 0!==d&&d}ngOnInit(){this.init(),this.dataService.collection.getCollectionFilters().single$.subscribe(t=>{this.allFilters=t.collectionFilters});const t=this.detailForm.get("filters");this.updatedFilters$=(0,k.T)(t.statusChanges,this.filterRemoved$).pipe((0,u.b)(200),(0,h.h)(()=>t.touched),(0,d.U)(()=>this.mapOperationsToInputs(this.filters,t.value).filter(t=>{for(const e of t.arguments)if(""===e.value)return!1;return!0}))),this.parentId$=this.route.paramMap.pipe((0,d.U)(t=>t.get("parentId")||void 0),(0,m.w)(t=>t?(0,M.of)(t):this.entity$.pipe((0,d.U)(t=>{var e;return null===(e=t.parent)||void 0===e?void 0:e.id}))))}ngOnDestroy(){this.destroy()}getFilterDefinition(t){return this.allFilters.find(e=>e.code===t.code)}assetsChanged(){return!!Object.values(this.assetChanges).length}updateSlug(t){(0,q.aj)(this.entity$,this.languageCode$).pipe((0,f.q)(1)).subscribe(([e,n])=>{const o=this.detailForm.get(["slug"]),i=(0,a.ZIM)(e,n),r=!i||!i.slug;o&&o.pristine&&r&&o.setValue((0,N.U)(`${t}`,"-"))})}addFilter(t){const e=this.detailForm.get("filters"),n=t.args.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:(0,a.sux)(e.value)}),{});e.push(this.formBuilder.control({code:t.code,args:n})),this.filters.push({code:t.code,args:t.args.map(t=>({name:t.name,value:(0,a.sux)(t.value)}))})}removeFilter(t){const e=this.detailForm.get("filters");-1!==t&&(e.removeAt(t),e.markAsDirty(),e.markAsTouched(),this.filters.splice(t,1),this.filterRemoved$.next())}create(){!this.detailForm.dirty||(0,q.aj)(this.entity$,this.languageCode$).pipe((0,f.q)(1),(0,v.zg)(([t,e])=>{const n=this.getUpdatedCollection(t,this.detailForm,e),o=this.route.snapshot.paramMap.get("parentId");return o&&(n.parentId=o),this.dataService.collection.createCollection(n)})).subscribe(t=>{this.notificationService.success((0,r.J)("common.notify-create-success"),{entity:"Collection"}),this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",t.createCollection.id],{relativeTo:this.route})},t=>{this.notificationService.error((0,r.J)("common.notify-create-error"),{entity:"Collection"})})}save(){(0,q.aj)(this.entity$,this.languageCode$).pipe((0,f.q)(1),(0,v.zg)(([t,e])=>{const n=this.getUpdatedCollection(t,this.detailForm,e);return this.dataService.collection.updateCollection(n)})).subscribe(()=>{this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success((0,r.J)("common.notify-update-success"),{entity:"Collection"}),this.contentsComponent.refresh()},t=>{this.notificationService.error((0,r.J)("common.notify-update-error"),{entity:"Collection"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}toggleLivePreview(){this.livePreview=!this.livePreview,this.localStorageService.set("livePreviewCollectionContents",this.livePreview)}trackByFn(t,e){return JSON.stringify(e)}setFormValues(t,e){const n=(0,a.ZIM)(t,e);this.detailForm.patchValue({name:n?n.name:"",slug:n?n.slug:"",description:n?n.description:"",visible:!t.isPrivate});const o=this.detailForm.get("filters");o.length!==t.filters.length&&(o.clear(),this.filters=[],t.filters.forEach(t=>this.addFilter(t))),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),t,n)}getUpdatedCollection(t,e,n){var o,i;const r=(0,a.iSy)({translatable:t,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:t.name||"",slug:t.slug||"",description:t.description||""}});return Object.assign(Object.assign({},r),{assetIds:null===(o=this.assetChanges.assets)||void 0===o?void 0:o.map(t=>t.id),featuredAssetId:null===(i=this.assetChanges.featuredAsset)||void 0===i?void 0:i.id,isPrivate:!e.value.visible,filters:this.mapOperationsToInputs(this.filters,this.detailForm.value.filters)})}mapOperationsToInputs(t,e){return t.map((t,n)=>({code:t.code,arguments:Object.entries(e[n].args).map(([t,e],n)=>({name:t,value:(0,a.qrw)(e)}))}))}}Jo.\u0275fac=function(t){return new(t||Jo)(o.Y36(i.F0),o.Y36(i.gz),o.Y36(a.iHG),o.Y36(o.sBO),o.Y36(a.DoR),o.Y36(I.qu),o.Y36(a.gqp),o.Y36(a.Z7U),o.Y36(a.n2A))},Jo.\u0275cmp=o.Xpm({type:Jo,selectors:[["vdr-collection-detail"]],viewQuery:function(t,e){if(1&t&&o.Gf(X,5),2&t){let t;o.iGM(t=o.CRH())&&(e.contentsComponent=t.first)}},features:[o.qOj],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],[1,"clr-row"],[1,"clr-col"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],["locationId","collection-detail",3,"entity$","detailForm"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","updatePermissions","change"],["formArrayName","filters",1,"clr-row"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"vdrIfPermissions"],[3,"collectionId","parentId","updatedFilters","previewUpdatedFilters"],["collectionContents",""],["formGroupName","customFields"],["entityName","Collection",3,"customFields","customFieldsFormGroup","readonly"],[3,"position","operation","operationDefinition","formControlName","readonly","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[1,"contents-title"],["type","checkbox","clrCheckbox","",3,"ngModelOptions","disabled","ngModel","ngModelChange"]],template:function(t,e){if(1&t&&(o.TgZ(0,"vdr-action-bar"),o.TgZ(1,"vdr-ab-left"),o._UZ(2,"vdr-entity-info",0),o.ALo(3,"async"),o.TgZ(4,"vdr-language-selector",1),o.NdJ("languageCodeChange",function(t){return e.setLanguage(t)}),o.ALo(5,"async"),o.ALo(6,"async"),o.ALo(7,"async"),o.qZA(),o.qZA(),o.TgZ(8,"vdr-ab-right"),o._UZ(9,"vdr-action-bar-items",2),o.YNc(10,tt,3,4,"button",3),o.ALo(11,"async"),o.YNc(12,nt,1,1,"ng-template",null,4,o.W1O),o.qZA(),o.qZA(),o.YNc(14,mt,41,52,"form",5),o.ALo(15,"async")),2&t){const t=o.MAs(13);o.xp6(2),o.Q6J("entity",o.lcZ(3,7,e.entity$)),o.xp6(2),o.Q6J("disabled",o.lcZ(5,9,e.isNew$))("availableLanguageCodes",o.lcZ(6,11,e.availableLanguages$))("currentLanguageCode",o.lcZ(7,13,e.languageCode$)),o.xp6(6),o.Q6J("ngIf",o.lcZ(11,15,e.isNew$))("ngIfElse",t),o.xp6(4),o.Q6J("ngIf",o.lcZ(15,17,e.entity$))}},directives:function(){return[a.KkL,a.BND,a.Vqt,a.SdP,a.mz,a.WWO,S.O5,a.HAh,I._Y,I.JL,I.sg,a.hgI,B.PEh,a.y_K,I.Wl,B.KKC,I.JJ,I.u,a.x3T,B.MgK,I.Fj,a.YI,a.CWh,vi,I.CE,S.sg,B.q0d,Zi,I.x0,a.yc0,a.qq8,a.JOL,a.UaT,B.qvL,a.N9E,a.HH4,I.On]},pipes:function(){return[S.Ov,E.X$,a.j$k]},styles:[".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}clr-checkbox-wrapper[_ngcontent-%COMP%]{transition:opacity .3s}clr-checkbox-wrapper.disabled[_ngcontent-%COMP%]{opacity:.5}"],changeDetection:0}),Jo.ctorParameters=()=>[{type:i.F0},{type:i.gz},{type:a.iHG},{type:o.sBO},{type:a.DoR},{type:I.qu},{type:a.gqp},{type:a.Z7U},{type:a.n2A}],Jo.propDecorators={contentsComponent:[{type:o.i9L,args:["collectionContents"]}]};class Uo{constructor(t,e,n,o,i,a){this.dataService=t,this.notificationService=e,this.modalService=n,this.router=o,this.route=i,this.serverConfigService=a,this.filterTermControl=new I.NI(""),this.expandAll=!1,this.expandedIds=[],this.destroy$=new _.xQ}ngOnInit(){var t,e;this.queryResult=this.dataService.collection.getCollections(1e3,0).refetchOnChannelChange(),this.items$=this.queryResult.mapStream(t=>t.collections.items).pipe((0,Z.d)(1)),this.activeCollectionId$=this.route.paramMap.pipe((0,d.U)(t=>t.get("contents")),(0,x.x)()),this.expandedIds=null!==(e=null===(t=this.route.snapshot.queryParamMap.get("expanded"))||void 0===t?void 0:t.split(","))&&void 0!==e?e:[],this.expandAll="all"===this.route.snapshot.queryParamMap.get("expanded"),this.activeCollectionTitle$=(0,q.aj)(this.activeCollectionId$,this.items$).pipe((0,d.U)(([t,e])=>{if(t){const n=e.find(e=>e.id===t);return n?n.name:""}return""})),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(({uiState:t})=>t.contentLanguage).pipe((0,C.b)(()=>this.refresh())),this.filterTermControl.valueChanges.pipe((0,u.b)(250),(0,p.R)(this.destroy$)).subscribe(t=>{this.router.navigate(["./"],{queryParams:{q:t||void 0},queryParamsHandling:"merge",relativeTo:this.route})}),this.route.queryParamMap.pipe((0,d.U)(t=>t.get("q")),(0,x.x)(),(0,p.R)(this.destroy$)).subscribe(()=>this.refresh()),this.filterTermControl.patchValue(this.route.snapshot.queryParamMap.get("q"))}ngOnDestroy(){this.queryResult.completed$.next(),this.destroy$.next(void 0),this.destroy$.complete()}toggleExpandAll(){this.router.navigate(["./"],{queryParams:{expanded:this.expandAll?"all":void 0},queryParamsHandling:"merge",relativeTo:this.route})}onRearrange(t){this.dataService.collection.moveCollection([t]).subscribe({next:()=>{this.notificationService.success((0,r.J)("common.notify-saved-changes")),this.refresh()},error:t=>{this.notificationService.error((0,r.J)("common.notify-save-changes-error"))}})}deleteCollection(t){this.items$.pipe((0,f.q)(1),(0,d.U)(e=>-1<e.findIndex(e=>e.parent&&e.parent.id===t)),(0,m.w)(t=>this.modalService.dialog({title:(0,r.J)("catalog.confirm-delete-collection"),body:t?(0,r.J)("catalog.confirm-delete-collection-and-children-body"):void 0,buttons:[{type:"secondary",label:(0,r.J)("common.cancel")},{type:"danger",label:(0,r.J)("common.delete"),returnValue:!0}]})),(0,m.w)(e=>e?this.dataService.collection.deleteCollection(t):w.E)).subscribe(()=>{this.notificationService.success((0,r.J)("common.notify-delete-success"),{entity:"Collection"}),this.refresh()},t=>{this.notificationService.error((0,r.J)("common.notify-delete-error"),{entity:"Collection"})})}closeContents(){const t=Object.assign({},this.route.snapshot.params);delete t.contents,this.router.navigate(["./",t],{relativeTo:this.route,queryParamsHandling:"preserve"})}setLanguage(t){this.dataService.client.setContentLanguage(t).subscribe()}refresh(){const t=this.route.snapshot.queryParamMap.get("q");this.queryResult.ref.refetch({options:Object.assign({skip:0,take:1e3},t?{filter:{name:{contains:t}}}:{})})}}Uo.\u0275fac=function(t){return new(t||Uo)(o.Y36(a.DoR),o.Y36(a.gqp),o.Y36(a.Z7U),o.Y36(i.F0),o.Y36(i.gz),o.Y36(a.iHG))},Uo.\u0275cmp=o.Xpm({type:Uo,selectors:[["vdr-collection-list"]],decls:26,vars:34,consts:[[1,"flex","center","wrap"],[1,"mt2",3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],[1,"expand-all-toggle","ml3",3,"ngClass"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange","change"],["type","text","name","searchTerm",1,"clr-input","search-input","ml4",3,"formControl","placeholder"],["locationId","collection-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[1,"collection-wrapper"],[3,"collections","activeCollectionId","expandAll","expandedIds","rearrange","deleteCollection"],[1,"collection-contents"],[3,"collectionId"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"collection-title"],["type","button",1,"close-button",3,"click"],["shape","close"]],template:function(t,e){if(1&t&&(o.TgZ(0,"vdr-action-bar"),o.TgZ(1,"vdr-ab-left"),o.TgZ(2,"div",0),o.TgZ(3,"vdr-language-selector",1),o.NdJ("languageCodeChange",function(t){return e.setLanguage(t)}),o.ALo(4,"async"),o.ALo(5,"async"),o.qZA(),o.TgZ(6,"clr-checkbox-wrapper",2),o.ALo(7,"async"),o.TgZ(8,"input",3),o.NdJ("ngModelChange",function(t){return e.expandAll=t})("change",function(){return e.toggleExpandAll()}),o.qZA(),o.TgZ(9,"label"),o._uU(10),o.ALo(11,"translate"),o.qZA(),o.qZA(),o._UZ(12,"input",4),o.ALo(13,"translate"),o.qZA(),o.qZA(),o.TgZ(14,"vdr-ab-right"),o._UZ(15,"vdr-action-bar-items",5),o.YNc(16,ft,4,5,"a",6),o.qZA(),o.qZA(),o.TgZ(17,"div",7),o.TgZ(18,"vdr-collection-tree",8),o.NdJ("rearrange",function(t){return e.onRearrange(t)})("deleteCollection",function(t){return e.deleteCollection(t)}),o.ALo(19,"async"),o.ALo(20,"async"),o.qZA(),o.TgZ(21,"div",9),o.ALo(22,"async"),o.TgZ(23,"vdr-collection-contents",10),o.ALo(24,"async"),o.YNc(25,vt,6,9,"ng-template"),o.qZA(),o.qZA(),o.qZA()),2&t){let t;o.xp6(3),o.Q6J("availableLanguageCodes",o.lcZ(4,15,e.availableLanguages$))("currentLanguageCode",o.lcZ(5,17,e.contentLanguage$)),o.xp6(3),o.Q6J("ngClass",1===(null==(t=o.lcZ(7,19,e.availableLanguages$))?null:t.length)?"mt3":"mt1"),o.xp6(2),o.Q6J("ngModel",e.expandAll),o.xp6(2),o.Oqu(o.lcZ(11,21,"catalog.expand-all-collections")),o.xp6(2),o.Q6J("formControl",e.filterTermControl)("placeholder",o.lcZ(13,23,"catalog.filter-by-name")),o.xp6(4),o.Q6J("vdrIfPermissions",o.DdM(33,Zt)),o.xp6(2),o.Q6J("collections",o.lcZ(19,25,e.items$))("activeCollectionId",o.lcZ(20,27,e.activeCollectionId$))("expandAll",e.expandAll)("expandedIds",e.expandedIds),o.xp6(3),o.ekj("expanded",o.lcZ(22,29,e.activeCollectionId$)),o.xp6(2),o.Q6J("collectionId",o.lcZ(24,31,e.activeCollectionId$))}},directives:function(){return[a.KkL,a.BND,a.SdP,B.PEh,S.mk,a.y_K,I.Wl,B.KKC,I.JJ,I.On,B.MgK,I.Fj,I.oH,a.mz,a.WWO,a.HAh,Ci,Zi,i.yS,B.qvL]},pipes:function(){return[S.Ov,E.X$]},styles:["[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column}.expand-all-toggle[_ngcontent-%COMP%]{display:block}.collection-wrapper[_ngcontent-%COMP%]{display:flex;height:calc(100% - 50px)}.collection-wrapper[_ngcontent-%COMP%]   vdr-collection-tree[_ngcontent-%COMP%]{flex:1;height:100%;overflow:auto}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility 0s .3s}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents.expanded[_ngcontent-%COMP%]{width:30vw;visibility:visible;opacity:1;padding-left:12px}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:0;background:none;border:none;cursor:pointer}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}"],changeDetection:0}),Uo.ctorParameters=()=>[{type:a.DoR},{type:a.gqp},{type:a.Z7U},{type:i.F0},{type:i.gz},{type:a.iHG}];class No extends a.UT_{constructor(t,e,n,o,i,r,s,c){super(e,t,n,i),this.changeDetector=o,this.dataService=i,this.formBuilder=r,this.notificationService=s,this.modalService=c,this.updatePermission=[a.y3$.UpdateCatalog,a.y3$.UpdateFacet],this.customFields=this.getCustomFieldConfig("Facet"),this.customValueFields=this.getCustomFieldConfig("FacetValue"),this.detailForm=this.formBuilder.group({facet:this.formBuilder.group({code:["",I.kI.required],name:"",visible:!0,customFields:this.formBuilder.group(this.customFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{}))}),values:this.formBuilder.array([])})}ngOnInit(){this.init()}ngOnDestroy(){this.destroy()}updateCode(t,e){if(!t){const t=this.detailForm.get(["facet","code"]);t&&t.pristine&&t.setValue((0,N.U)(e,"-"))}}updateValueCode(t,e,n){if(!t){const t=this.detailForm.get(["values",n,"code"]);t&&t.pristine&&t.setValue((0,N.U)(e,"-"))}}customValueFieldIsSet(t,e){return!!this.detailForm.get(["values",t,"customFields",e])}getValuesFormArray(){return this.detailForm.get("values")}addFacetValue(){const t=this.detailForm.get("values");if(t){const e=this.formBuilder.group({id:"",name:["",I.kI.required],code:""}),n={name:"",code:""};if(this.customValueFields.length){const t=new I.cw({});n.customFields={};for(const e of this.customValueFields){const n=e.name;t.addControl(n,new I.NI)}e.addControl("customFields",t)}t.insert(t.length,e),this.values.push(n)}}create(){const t=this.detailForm.get("facet");!t||!t.dirty||(0,q.aj)(this.entity$,this.languageCode$).pipe((0,f.q)(1),(0,v.zg)(([e,n])=>{const o=this.getUpdatedFacet(e,t,n);return this.dataService.facet.createFacet(o)}),(0,m.w)(t=>this.dataService.facet.getAllFacets().single$.pipe((0,b.h)(t)))).subscribe(t=>{this.notificationService.success((0,r.J)("common.notify-create-success"),{entity:"Facet"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",t.createFacet.id],{relativeTo:this.route})},t=>{this.notificationService.error((0,r.J)("common.notify-create-error"),{entity:"Facet"})})}save(){(0,q.aj)(this.entity$,this.languageCode$).pipe((0,f.q)(1),(0,v.zg)(([t,e])=>{const n=this.detailForm.get("facet"),o=[];if(n&&n.dirty){const i=this.getUpdatedFacet(t,n,e);i&&o.push(this.dataService.facet.updateFacet(i))}const i=this.detailForm.get("values");if(i&&i.dirty){const n=this.getCreatedFacetValues(t,i,e);n.length&&o.push(this.dataService.facet.createFacetValues(n).pipe((0,m.w)(()=>this.dataService.facet.getFacet(this.id).single$)));const a=this.getUpdatedFacetValues(t,i,e);a.length&&o.push(this.dataService.facet.updateFacetValues(a))}return(0,L.D)(o)}),(0,m.w)(()=>this.dataService.facet.getAllFacets().single$)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success((0,r.J)("common.notify-update-success"),{entity:"Facet"})},t=>{this.notificationService.error((0,r.J)("common.notify-update-error"),{entity:"Facet"})})}deleteFacetValue(t,e){if(!t){const t=this.detailForm.get("values");return t&&t.removeAt(e),void this.values.splice(e,1)}this.showModalAndDelete(t).pipe((0,m.w)(e=>e.result===a.PcR.DELETED?[!0]:this.showModalAndDelete(t,e.message||"").pipe((0,d.U)(t=>t.result===a.PcR.DELETED))),(0,m.w)(t=>t?this.dataService.facet.getFacet(this.id).single$:[])).subscribe(()=>{this.notificationService.success((0,r.J)("common.notify-delete-success"),{entity:"FacetValue"})},t=>{this.notificationService.error((0,r.J)("common.notify-delete-error"),{entity:"FacetValue"})})}showModalAndDelete(t,e){return this.modalService.dialog({title:(0,r.J)("catalog.confirm-delete-facet-value"),body:e,buttons:[{type:"secondary",label:(0,r.J)("common.cancel")},{type:"danger",label:(0,r.J)("common.delete"),returnValue:!0}]}).pipe((0,m.w)(n=>n?this.dataService.facet.deleteFacetValues([t],!!e):w.E),(0,d.U)(t=>t.deleteFacetValues[0]))}setFormValues(t,e){var n;const o=(0,a.ZIM)(t,e);if(this.detailForm.patchValue({facet:{code:t.code,visible:!t.isPrivate,name:null!==(n=null==o?void 0:o.name)&&void 0!==n?n:""}}),this.customFields.length){this.detailForm.get(["facet","customFields"]);this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["facet","customFields"]),t,o)}const i=this.detailForm.get("values");this.values=[...t.values],t.values.forEach((t,n)=>{var o,r,s,c,l;const d=(0,a.ZIM)(t,e),u={id:t.id,code:t.code,name:d?d.name:""},p=i.at(n);if(p?(null===(o=p.get("id"))||void 0===o||o.setValue(u.id),null===(r=p.get("code"))||void 0===r||r.setValue(u.code),null===(s=p.get("name"))||void 0===s||s.setValue(u.name)):i.insert(n,this.formBuilder.group(u)),this.customValueFields.length){let e=this.detailForm.get(["values",n,"customFields"]);if(e||(e=new I.cw({}),this.detailForm.get(["values",n]).addControl("customFields",e)),e)for(const n of this.customValueFields){const o=n.name,i="localeString"===n.type?null===(l=null===(c=d)||void 0===c?void 0:c.customFields)||void 0===l?void 0:l[o]:t.customFields[o],a=e.get(o);a?a.setValue(i):e.addControl(o,new I.NI(i))}}})}getUpdatedFacet(t,e,n){const o=(0,a.iSy)({translatable:t,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:t.name||""}});return o.isPrivate=!e.value.visible,o}getCreatedFacetValues(t,e,n){return e.controls.filter(t=>!t.value.id).map(t=>t.value).map(t=>(0,a.iSy)({translatable:Object.assign(Object.assign({},t),{translations:[]}),updatedFields:t,customFieldConfig:this.customValueFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}})).map(e=>Object.assign({facetId:t.id},e))}getUpdatedFacetValues(t,e,n){const o=t.values.filter((t,n)=>{const o=e.get(n.toString());return o&&o.dirty&&o.value.id}),i=e.controls.filter(t=>t.dirty&&t.value.id).map(t=>t.value);if(o.length!==i.length)throw new Error((0,r.J)("error.facet-value-form-values-do-not-match"));return o.map((t,e)=>(0,a.iSy)({translatable:t,updatedFields:i[e],customFieldConfig:this.customValueFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}})).filter(V.notNullOrUndefined)}}No.\u0275fac=function(t){return new(t||No)(o.Y36(i.F0),o.Y36(i.gz),o.Y36(a.iHG),o.Y36(o.sBO),o.Y36(a.DoR),o.Y36(I.qu),o.Y36(a.gqp),o.Y36(a.Z7U))},No.\u0275cmp=o.Xpm({type:No,selectors:[["vdr-facet-detail"]],features:[o.qOj],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["formGroupName","facet",1,"form-block"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","code",3,"label","readOnlyToggle"],["id","code","type","text","formControlName","code",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["locationId","facet-detail",3,"entity$","detailForm"],["class","form-block",4,"ngIf"],["formGroupName","customFields"],["entityName","Facet",3,"customFields","customFieldsFormGroup","readonly"],[1,"form-block"],["class","facet-values-list table","formArrayName","values",4,"ngIf"],["type","button","class","btn btn-secondary",3,"click",4,"vdrIfPermissions"],["formArrayName","values",1,"facet-values-list","table"],[4,"ngIf"],["class","facet-value",3,"formGroupName",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroupName"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly","input"],["type","text","formControlName","code","readonly",""],["class","",4,"ngIf"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[1,""],["entityName","FacetValue",3,"customFields","compact","customFieldsFormGroup","readonly"],["type","button",1,"btn","btn-secondary",3,"click"],["shape","add"]],template:function(t,e){if(1&t&&(o.TgZ(0,"vdr-action-bar"),o.TgZ(1,"vdr-ab-left"),o._UZ(2,"vdr-entity-info",0),o.ALo(3,"async"),o.TgZ(4,"vdr-language-selector",1),o.NdJ("languageCodeChange",function(t){return e.setLanguage(t)}),o.ALo(5,"async"),o.ALo(6,"async"),o.ALo(7,"async"),o.qZA(),o.qZA(),o.TgZ(8,"vdr-ab-right"),o._UZ(9,"vdr-action-bar-items",2),o.YNc(10,xt,3,4,"button",3),o.ALo(11,"async"),o.YNc(12,bt,1,1,"ng-template",null,4,o.W1O),o.qZA(),o.qZA(),o.YNc(14,Lt,24,30,"form",5),o.ALo(15,"async")),2&t){const t=o.MAs(13);o.xp6(2),o.Q6J("entity",o.lcZ(3,7,e.entity$)),o.xp6(2),o.Q6J("disabled",o.lcZ(5,9,e.isNew$))("availableLanguageCodes",o.lcZ(6,11,e.availableLanguages$))("currentLanguageCode",o.lcZ(7,13,e.languageCode$)),o.xp6(6),o.Q6J("ngIf",o.lcZ(11,15,e.isNew$))("ngIfElse",t),o.xp6(4),o.Q6J("ngIf",o.lcZ(15,17,e.entity$))}},directives:[a.KkL,a.BND,a.Vqt,a.SdP,a.mz,a.WWO,S.O5,a.HAh,I._Y,I.JL,I.sg,I.x0,a.hgI,B.PEh,a.y_K,I.Wl,B.KKC,I.JJ,I.u,a.x3T,B.MgK,I.Fj,a.CWh,a.yc0,I.CE,S.sg,a.JOL,a.UaT,B.qvL,a.N9E,a.HH4],pipes:[S.Ov,E.X$,a.j$k],styles:[".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}"],changeDetection:0}),No.ctorParameters=()=>[{type:i.F0},{type:i.gz},{type:a.iHG},{type:o.sBO},{type:a.DoR},{type:I.qu},{type:a.gqp},{type:a.Z7U}];class Vo extends a.t7C{constructor(t,e,n,o,i,a){super(i,a),this.dataService=t,this.modalService=e,this.notificationService=n,this.serverConfigService=o,this.filterTermControl=new I.NI(""),this.initialLimit=3,this.displayLimit={},super.setQueryFn((...t)=>this.dataService.facet.getFacets(...t).refetchOnChannelChange(),t=>t.facets,(t,e)=>({options:{skip:t,take:e,filter:{name:{contains:this.filterTermControl.value}},sort:{createdAt:$.As.DESC}}}))}ngOnInit(){super.ngOnInit(),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(({uiState:t})=>t.contentLanguage).pipe((0,C.b)(()=>this.refresh())),this.filterTermControl.valueChanges.pipe((0,h.h)(t=>2<=t.length||0===t.length),(0,u.b)(250),(0,p.R)(this.destroy$)).subscribe(()=>this.refresh())}toggleDisplayLimit(t){this.displayLimit[t.id]===t.values.length?this.displayLimit[t.id]=this.initialLimit:this.displayLimit[t.id]=t.values.length}deleteFacet(t){this.showModalAndDelete(t).pipe((0,m.w)(e=>e.result===a.PcR.DELETED?[!0]:this.showModalAndDelete(t,e.message||"").pipe((0,d.U)(t=>t.result===a.PcR.DELETED))),(0,m.w)(()=>this.dataService.facet.getAllFacets().single$)).subscribe(()=>{this.notificationService.success((0,r.J)("common.notify-delete-success"),{entity:"FacetValue"}),this.refresh()},t=>{this.notificationService.error((0,r.J)("common.notify-delete-error"),{entity:"FacetValue"})})}setLanguage(t){this.dataService.client.setContentLanguage(t).subscribe()}showModalAndDelete(t,e){return this.modalService.dialog({title:(0,r.J)("catalog.confirm-delete-facet"),body:e,buttons:[{type:"secondary",label:(0,r.J)("common.cancel")},{type:"danger",label:(0,r.J)("common.delete"),returnValue:!0}]}).pipe((0,m.w)(n=>n?this.dataService.facet.deleteFacet(t,!!e):w.E),(0,d.U)(t=>t.deleteFacet))}}function $o(t,e,n){if(!t)return"";const o=t.lastIndexOf(e);if(-1===o)return t;return t.substr(0,o)+t.substr(o).replace(e,n)}Vo.\u0275fac=function(t){return new(t||Vo)(o.Y36(a.DoR),o.Y36(a.Z7U),o.Y36(a.gqp),o.Y36(a.iHG),o.Y36(i.F0),o.Y36(i.gz))},Vo.\u0275cmp=o.Xpm({type:Vo,selectors:[["vdr-facet-list"]],features:[o.qOj],decls:31,vars:37,consts:[[1,"flex","center","wrap"],[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["type","text","name","searchTerm",1,"clr-input","search-input","ml4",3,"formControl","placeholder"],["locationId","facet-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"expand"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[3,"facetValue","removable","displayFacetName",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary btn-icon",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["private",""],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"facetValue","removable","displayFacetName"],[1,"btn","btn-sm","btn-secondary","btn-icon",3,"click"],["collapse",""],["shape","minus"]],template:function(t,e){1&t&&(o.TgZ(0,"vdr-action-bar"),o.TgZ(1,"vdr-ab-left"),o.TgZ(2,"div",0),o.TgZ(3,"vdr-language-selector",1),o.NdJ("languageCodeChange",function(t){return e.setLanguage(t)}),o.ALo(4,"async"),o.ALo(5,"async"),o.qZA(),o._UZ(6,"input",2),o.ALo(7,"translate"),o.qZA(),o.qZA(),o.TgZ(8,"vdr-ab-right"),o._UZ(9,"vdr-action-bar-items",3),o.YNc(10,Jt,4,5,"a",4),o.qZA(),o.qZA(),o.TgZ(11,"vdr-data-table",5),o.NdJ("pageChange",function(t){return e.setPageNumber(t)})("itemsPerPageChange",function(t){return e.setItemsPerPage(t)}),o.ALo(12,"async"),o.ALo(13,"async"),o.ALo(14,"async"),o.ALo(15,"async"),o.TgZ(16,"vdr-dt-column"),o._uU(17),o.ALo(18,"translate"),o.qZA(),o.TgZ(19,"vdr-dt-column"),o._uU(20),o.ALo(21,"translate"),o.qZA(),o.TgZ(22,"vdr-dt-column",6),o._uU(23),o.ALo(24,"translate"),o.qZA(),o.TgZ(25,"vdr-dt-column"),o._uU(26),o.ALo(27,"translate"),o.qZA(),o._UZ(28,"vdr-dt-column"),o._UZ(29,"vdr-dt-column"),o.YNc(30,jt,28,38,"ng-template"),o.qZA()),2&t&&(o.xp6(3),o.Q6J("availableLanguageCodes",o.lcZ(4,14,e.availableLanguages$))("currentLanguageCode",o.lcZ(5,16,e.contentLanguage$)),o.xp6(3),o.Q6J("formControl",e.filterTermControl)("placeholder",o.lcZ(7,18,"catalog.filter-by-name")),o.xp6(4),o.Q6J("vdrIfPermissions",o.DdM(36,kt)),o.xp6(1),o.Q6J("items",o.lcZ(12,20,e.items$))("itemsPerPage",o.lcZ(13,22,e.itemsPerPage$))("totalItems",o.lcZ(14,24,e.totalItems$))("currentPage",o.lcZ(15,26,e.currentPage$)),o.xp6(6),o.Oqu(o.lcZ(18,28,"common.code")),o.xp6(3),o.Oqu(o.lcZ(21,30,"common.name")),o.xp6(2),o.Q6J("expand",!0),o.xp6(1),o.Oqu(o.lcZ(24,32,"catalog.values")),o.xp6(3),o.Oqu(o.lcZ(27,34,"catalog.visibility")))},directives:[a.KkL,a.BND,a.SdP,a.y_K,I.Fj,I.JJ,I.oH,a.mz,a.WWO,a.HAh,a.Qj_,a.Egy,i.yS,B.qvL,S.sg,S.O5,a.Ywx,a.v_8,a.JOL,a.UaT,a.N9E,a.HH4,a.qt4],pipes:[S.Ov,E.X$,S.OU,a.j$k],styles:["td.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"]}),Vo.ctorParameters=()=>[{type:a.DoR},{type:a.Z7U},{type:a.gqp},{type:a.iHG},{type:i.F0},{type:i.gz}];class So{constructor(t){this.dataService=t}getFacets(){return this.dataService.facet.getAllFacets().mapSingle(t=>t.facets.items)}getTaxCategories(){return this.dataService.settings.getTaxCategories().mapSingle(t=>t.taxCategories).pipe((0,Z.d)(1))}createProductWithVariants(t,e,n){const o=this.dataService.product.createProduct(t),i=e.groups.filter(t=>0<t.values.length),a=this.createProductOptionGroups(i,n);return(0,L.D)(o,a).pipe((0,v.zg)(([{createProduct:t},e])=>(e.length?(0,L.D)(e.map(e=>this.dataService.product.addOptionGroupToProduct({productId:t.id,optionGroupId:e.id}))):(0,M.of)([])).pipe((0,d.U)(()=>({createProduct:t,optionGroups:e})))),(0,v.zg)(({createProduct:t,optionGroups:o})=>{const i=e.variants.map(t=>{const e=o.length?t.optionValues.map((t,e)=>{const n=o[e].options.find(e=>e.name===t);if(!n)throw new Error(`Could not find a matching ProductOption "${t}" when creating variant`);return n.id}):[];return Object.assign(Object.assign({},t),{optionIds:e})}),a=o.map(t=>t.options).reduce((t,e)=>[...t,...e],[]);return this.createProductVariants(t,i,a,n)}))}createProductOptionGroups(t,e){return t.length?(0,L.D)(t.map(t=>this.dataService.product.createProductOptionGroups({code:(0,N.U)(t.name,"-"),translations:[{languageCode:e,name:t.name}],options:t.values.map(t=>({code:(0,N.U)(t,"-"),translations:[{languageCode:e,name:t}]}))}).pipe((0,d.U)(t=>t.createProductOptionGroup)))):(0,M.of)([])}createProductVariants(t,e,n,o){const i=e.map(e=>{const i=n.length?`${t.name} ${e.optionIds.map(t=>n.find(e=>e.id===t)).filter(V.notNullOrUndefined).map(t=>t.name).join(" ")}`:t.name;return{productId:t.id,price:e.price,sku:e.sku,stockOnHand:e.stock,translations:[{languageCode:o,name:i}],optionIds:e.optionIds}});return this.dataService.product.createProductVariants(i).pipe((0,d.U)(({createProductVariants:e})=>({createProductVariants:e,productId:t.id})))}updateProduct(t){const{product:e,languageCode:n,autoUpdate:o,productInput:i,variantsInput:r}=t,s=[],c=r||[];return(o?this.dataService.product.getProductVariants({},e.id).mapSingle(({productVariants:t})=>t.items):(0,M.of)([])).pipe((0,v.zg)(t=>{var r,l,d,u;if(i){s.push(this.dataService.product.updateProduct(i));const p=null!==(l=null===(r=(0,a.ZIM)(e,n))||void 0===r?void 0:r.name)&&void 0!==l?l:"",g=null===(d=(0,a.ZIM)(i,n))||void 0===d?void 0:d.name;if(g&&p!==g&&o)for(const e of t){const t=(null===(u=(0,a.ZIM)(e,n))||void 0===u?void 0:u.name)||"";let o;const i=c.find(t=>t.id===e.id);i?o=i:(o={id:e.id,translations:[{languageCode:n,name:t}]},c.push(o));const r=(0,a.ZIM)(o,n);r&&(r.name?r.name=$o(r.name,p,g):r.name=[g,...e.options.map(t=>t.name)].join(" "))}}return c.length&&s.push(this.dataService.product.updateProductVariants(c)),(0,L.D)(s)}))}updateProductOption(t,e,n){return(t.autoUpdate?this.dataService.product.getProductVariants({},e.id).mapSingle(({productVariants:t})=>t.items):(0,M.of)([])).pipe((0,v.zg)(e=>{var o,i,r;let s=(0,M.of)([]);if(t.autoUpdate){let c;const l=null===(o=(0,a.ZIM)(t,n))||void 0===o?void 0:o.name;l||(s=(0,M.of)([]));const d=[];for(const o of e)if(o.options.map(t=>t.id).includes(t.id)){c||(c=null===(i=(0,a.ZIM)(o.options.find(e=>e.id===t.id),n))||void 0===i?void 0:i.name);const e=(null===(r=(0,a.ZIM)(o,n))||void 0===r?void 0:r.name)||"";c&&l&&e.includes(c)&&d.push({id:o.id,translations:[{languageCode:n,name:$o(e,c,l)}]})}d.length&&(s=this.dataService.product.updateProductVariants(d))}return this.dataService.product.updateProductOption(t).pipe((0,v.zg)(()=>s))}))}deleteProductVariant(t,e){return this.dataService.product.deleteProductVariant(t).pipe((0,m.w)(t=>t.deleteProductVariant.result===a.PcR.DELETED?this.dataService.product.getProduct(e).single$:(0,J._)(t.deleteProductVariant.message)))}}So.\u0275fac=function(t){return new(t||So)(o.LFG(a.DoR))},So.\u0275prov=o.Yz7({factory:function(){return new So(o.LFG(a.DoR))},token:So,providedIn:"root"}),So.ctorParameters=()=>[{type:a.DoR}];class Do{constructor(t){this.changeDetector=t,this.selectedValues=[]}ngAfterViewInit(){setTimeout(()=>this.selector.focus(),0)}selectValues(){this.resolveWith(this.selectedValues)}cancel(){this.resolveWith()}}Do.\u0275fac=function(t){return new(t||Do)(o.Y36(o.sBO))},Do.\u0275cmp=o.Xpm({type:Do,selectors:[["vdr-apply-facet-dialog"]],viewQuery:function(t,e){if(1&t&&o.Gf(a.$MF,5),2&t){let t;o.iGM(t=o.CRH())&&(e.selector=t.first)}},decls:3,vars:1,consts:[["vdrDialogTitle",""],[3,"facets","selectedValuesChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(o.YNc(0,Gt,2,3,"ng-template",0),o.TgZ(1,"vdr-facet-value-selector",1),o.NdJ("selectedValuesChange",function(t){return e.selectedValues=t}),o.qZA(),o.YNc(2,Et,6,7,"ng-template",2)),2&t&&(o.xp6(1),o.Q6J("facets",e.facets))},directives:[a.q6K,a.$MF,a.nPI],pipes:[E.X$],styles:[""],changeDetection:0}),Do.ctorParameters=()=>[{type:o.sBO}],Do.propDecorators={selector:[{type:o.i9L,args:[a.$MF]}]};class Qo{constructor(t,e){this.dataService=t,this.notificationService=e,this.priceFactorControl=new I.NI(1),this.selectedChannelIdControl=new I.NI}get isProductVariantMode(){return null!=this.productVariantIds}ngOnInit(){const t=this.dataService.client.userStatus().mapSingle(({userStatus:t})=>t.activeChannelId),e=this.dataService.settings.getChannels().mapSingle(t=>t.channels);(0,q.aj)(t,e).subscribe(([t,e])=>{this.currentChannel=e.find(e=>e.id===t),this.availableChannels=e}),this.selectedChannelIdControl.valueChanges.subscribe(t=>{this.selectChannel(t)}),this.variantsPreview$=(0,q.aj)((0,U.D)(this.getTopVariants(10)),this.priceFactorControl.valueChanges.pipe((0,A.O)(1))).pipe((0,d.U)(([t,e])=>t.map(t=>({id:t.id,name:t.name,price:t.price,pricePreview:t.price*+e}))))}selectChannel(t){this.selectedChannel=this.availableChannels.find(e=>e.id===t[0])}assign(){const t=this.selectedChannel;t&&(this.isProductVariantMode?this.productVariantIds&&this.dataService.product.assignVariantsToChannel({channelId:t.id,productVariantIds:this.productVariantIds,priceFactor:+this.priceFactorControl.value}).subscribe(()=>{this.notificationService.success((0,r.J)("catalog.assign-variant-to-channel-success"),{channel:t.code}),this.resolveWith(!0)}):this.dataService.product.assignProductsToChannel({channelId:t.id,productIds:this.productIds,priceFactor:+this.priceFactorControl.value}).subscribe(()=>{this.notificationService.success((0,r.J)("catalog.assign-product-to-channel-success"),{channel:t.code}),this.resolveWith(!0)}))}cancel(){this.resolveWith()}getTopVariants(t){return(0,Y.mG)(this,void 0,void 0,function*(){const e=[];for(let n=0;n<this.productIds.length&&e.length<t;n++){const o=yield this.dataService.product.getProduct(this.productIds[n],{take:this.isProductVariantMode?void 0:t}).mapSingle(({product:t})=>(t?t.variantList.items:[]).filter(t=>{var e;return!this.isProductVariantMode||(null===(e=this.productVariantIds)||void 0===e?void 0:e.includes(t.id))})).toPromise();e.push(...o||[])}return e.slice(0,t)})}}Qo.\u0275fac=function(t){return new(t||Qo)(o.Y36(a.DoR),o.Y36(a.gqp))},Qo.\u0275cmp=o.Xpm({type:Qo,selectors:[["vdr-assign-products-to-channel-dialog"]],decls:36,vars:32,consts:[["vdrDialogTitle",""],[1,"flex"],["clrInput","",3,"multiple","includeDefaultChannel","disableChannelIds","formControl"],[1,"flex-spacer"],["clrInput","","type","number","min","0","max","99999",3,"formControl"],[1,"channel-price-preview"],[1,"clr-control-label"],[1,"table"],[3,"ngIf","ngIfElse"],["noSelection",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],[4,"ngIf","ngIfElse"],["productModeTitle",""],["noChannelSelected",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){if(1&t&&(o.YNc(0,Rt,3,2,"ng-template",0),o.TgZ(1,"div",1),o.TgZ(2,"clr-input-container"),o.TgZ(3,"label"),o._uU(4),o.ALo(5,"translate"),o.qZA(),o._UZ(6,"vdr-channel-assignment-control",2),o.qZA(),o._UZ(7,"div",3),o.TgZ(8,"clr-input-container"),o.TgZ(9,"label"),o._uU(10),o.ALo(11,"translate"),o.qZA(),o._UZ(12,"input",4),o.qZA(),o.qZA(),o.TgZ(13,"div",5),o.TgZ(14,"label",6),o._uU(15),o.ALo(16,"translate"),o.qZA(),o.TgZ(17,"table",7),o.TgZ(18,"thead"),o.TgZ(19,"tr"),o.TgZ(20,"th"),o._uU(21),o.ALo(22,"translate"),o.qZA(),o.TgZ(23,"th"),o._uU(24),o.ALo(25,"translate"),o.ALo(26,"translate"),o.ALo(27,"channelCodeToLabel"),o.qZA(),o.TgZ(28,"th"),o.YNc(29,zt,2,6,"ng-template",8),o.YNc(30,Wt,2,3,"ng-template",null,9,o.W1O),o.qZA(),o.qZA(),o.qZA(),o.TgZ(32,"tbody"),o.YNc(33,ee,10,7,"tr",10),o.ALo(34,"async"),o.qZA(),o.qZA(),o.qZA(),o.YNc(35,ae,7,6,"ng-template",11)),2&t){const t=o.MAs(31);o.xp6(4),o.Oqu(o.lcZ(5,13,"common.channel")),o.xp6(2),o.Q6J("multiple",!1)("includeDefaultChannel",!1)("disableChannelIds",e.currentChannelIds)("formControl",e.selectedChannelIdControl),o.xp6(4),o.Oqu(o.lcZ(11,15,"catalog.price-conversion-factor")),o.xp6(2),o.Q6J("formControl",e.priceFactorControl),o.xp6(3),o.Oqu(o.lcZ(16,17,"catalog.channel-price-preview")),o.xp6(6),o.Oqu(o.lcZ(22,19,"common.name")),o.xp6(3),o.hij(" ",o.xi3(25,21,"catalog.price-in-channel",o.VKq(30,Kt,o.lcZ(26,24,o.lcZ(27,26,null==e.currentChannel?null:e.currentChannel.code))))," "),o.xp6(5),o.Q6J("ngIf",e.selectedChannel)("ngIfElse",t),o.xp6(4),o.Q6J("ngForOf",o.lcZ(34,28,e.variantsPreview$))}},directives:[a.q6K,B.G55,B.MgK,a.SGu,B.xRP,I.JJ,I.oH,a.y_K,I.qQ,I.Fd,I.wV,I.Fj,S.O5,S.sg,a.nPI],pipes:[E.X$,a.E6B,S.Ov,a.kgx],styles:["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}.channel-price-preview[_ngcontent-%COMP%]{margin-top:24px}.channel-price-preview[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]{margin-top:6px}"],changeDetection:0}),Qo.ctorParameters=()=>[{type:a.DoR},{type:a.gqp}];class Yo extends a.UT_{constructor(t,e,n,o,i,r,s,c,l,d){super(t,e,n,c),this.productDetailService=o,this.formBuilder=i,this.modalService=r,this.notificationService=s,this.dataService=c,this.location=l,this.changeDetector=d,this.filterInput=new I.NI(""),this.assetChanges={},this.variantAssetChanges={},this.variantFacetValueChanges={},this.currentPage$=new O.X(1),this.itemsPerPage$=new O.X(10),this.selectedVariantIds=[],this.variantDisplayMode="card",this.createVariantsConfig={groups:[],variants:[]},this.productVariantMap=new Map,this.updatePermissions=[a.y3$.UpdateCatalog,a.y3$.UpdateProduct],this.customFields=this.getCustomFieldConfig("Product"),this.customVariantFields=this.getCustomFieldConfig("ProductVariant"),this.customOptionGroupFields=this.getCustomFieldConfig("ProductOptionGroup"),this.customOptionFields=this.getCustomFieldConfig("ProductOption"),this.detailForm=this.formBuilder.group({product:this.formBuilder.group({enabled:!0,name:["",I.kI.required],autoUpdateVariantNames:!0,slug:["",(0,a.Foo)(/^[\p{Letter}0-9_-]+$/)],description:"",facetValueIds:[[]],customFields:this.formBuilder.group(this.customFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{}))}),variants:this.formBuilder.array([])})}ngOnInit(){this.init(),this.product$=this.entity$,this.totalItems$=this.product$.pipe((0,d.U)(t=>t.variantList.totalItems)),this.paginationConfig$=(0,q.aj)(this.totalItems$,this.itemsPerPage$,this.currentPage$).pipe((0,d.U)(([t,e,n])=>({totalItems:t,itemsPerPage:e,currentPage:n})));this.product$.pipe((0,d.U)(t=>t.variantList.items));const t=this.filterInput.valueChanges.pipe((0,A.O)(""),(0,u.b)(200),(0,Z.d)()),e=this.product$.pipe((0,d.U)(t=>t.variantList.items)),n=(0,q.aj)(t,this.currentPage$,this.itemsPerPage$).pipe((o=e,t=>t.lift(new c(o))),(0,y.T)(1),(0,m.w)(([t,e,n])=>this.dataService.product.getProductVariants(Object.assign(Object.assign({skip:(e-1)*n,take:n},t?{filter:{name:{contains:t},sku:{contains:t}}}:{}),{filterOperator:a.FnJ.OR}),this.id).mapStream(({productVariants:t})=>t.items)),(0,Z.d)({bufferSize:1,refCount:!0}));var o;this.variants$=(0,k.T)(e,n).pipe((0,C.b)(t=>{for(const e of t)this.productVariantMap.set(e.id,e)})),this.taxCategories$=this.productDetailService.getTaxCategories().pipe((0,p.R)(this.destroy$)),this.activeTab$=this.route.paramMap.pipe((0,d.U)(t=>t.get("tab"))),(0,q.aj)(n,this.languageCode$).pipe((0,p.R)(this.destroy$)).subscribe(([t,e])=>{this.buildVariantFormArray(t,e)}),this.facets$=this.productDetailService.getFacets();const i=this.product$.pipe((0,d.U)(t=>t.facetValues)),r=this.facets$.pipe((0,d.U)(a.k2u)),s=this.getProductFormGroup().valueChanges.pipe((0,d.U)(t=>t.facetValueIds),(0,x.x)()),l=(0,q.aj)(s,i,r).pipe((0,d.U)(([t,e,n])=>{const o=[...e,...n];return t.map(t=>o.find(e=>e.id===t)).filter(V.notNullOrUndefined)}));this.facetValues$=(0,k.T)(i,l),this.productChannels$=this.product$.pipe((0,d.U)(t=>t.channels)),this.channelPriceIncludesTax$=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(t=>t.activeChannel.pricesIncludeTax).pipe((0,Z.d)(1))}ngOnDestroy(){this.destroy()}navigateToTab(t){this.location.replaceState(this.router.createUrlTree(["./",Object.assign(Object.assign({},this.route.snapshot.params),{tab:t})],{queryParamsHandling:"merge",relativeTo:this.route}).toString())}isDefaultChannel(t){return t===D.z$}setPage(t){this.currentPage$.next(t)}setItemsPerPage(t){this.itemsPerPage$.next(+t),this.currentPage$.next(1)}assignToChannel(){this.productChannels$.pipe((0,f.q)(1),(0,m.w)(t=>this.modalService.fromComponent(Qo,{size:"lg",locals:{productIds:[this.id],currentChannelIds:t.map(t=>t.id)}}))).subscribe()}removeFromChannel(t){this.modalService.dialog({title:(0,r.J)("catalog.remove-product-from-channel"),buttons:[{type:"secondary",label:(0,r.J)("common.cancel")},{type:"danger",label:(0,r.J)("catalog.remove-from-channel"),returnValue:!0}]}).pipe((0,m.w)(e=>e?this.dataService.product.removeProductsFromChannel({channelId:t,productIds:[this.id]}):w.E)).subscribe(()=>{this.notificationService.success((0,r.J)("catalog.notify-remove-product-from-channel-success"))},t=>{this.notificationService.error((0,r.J)("catalog.notify-remove-product-from-channel-error"))})}assignVariantToChannel(t){return this.modalService.fromComponent(Qo,{size:"lg",locals:{productIds:[this.id],productVariantIds:[t.id],currentChannelIds:t.channels.map(t=>t.id)}}).subscribe()}removeVariantFromChannel({channelId:t,variant:e}){this.modalService.dialog({title:(0,r.J)("catalog.remove-product-variant-from-channel"),buttons:[{type:"secondary",label:(0,r.J)("common.cancel")},{type:"danger",label:(0,r.J)("catalog.remove-from-channel"),returnValue:!0}]}).pipe((0,m.w)(n=>n?this.dataService.product.removeVariantsFromChannel({channelId:t,productVariantIds:[e.id]}):w.E)).subscribe(()=>{this.notificationService.success((0,r.J)("catalog.notify-remove-variant-from-channel-success"))},t=>{this.notificationService.error((0,r.J)("catalog.notify-remove-variant-from-channel-error"))})}assetsChanged(){return!!Object.values(this.assetChanges).length}variantAssetsChanged(){return!!Object.keys(this.variantAssetChanges).length}variantAssetChange(t){this.variantAssetChanges[t.variantId]=t}updateSlug(t){(0,q.aj)(this.entity$,this.languageCode$).pipe((0,f.q)(1)).subscribe(([e,n])=>{const o=this.detailForm.get(["product","slug"]),i=(0,a.ZIM)(e,n),r=!i||!i.slug;o&&o.pristine&&r&&o.setValue((0,N.U)(`${t}`,"-"))})}selectProductFacetValue(){this.displayFacetValueModal().subscribe(t=>{if(t){const e=this.getProductFormGroup(),n=e.value.facetValueIds;e.patchValue({facetValueIds:(0,Q.T)([...n,...t])}),e.markAsDirty()}})}updateProductOption(t){(0,q.aj)(this.product$,this.languageCode$).pipe((0,f.q)(1),(0,v.zg)(([e,n])=>this.productDetailService.updateProductOption(t,e,n))).subscribe(()=>{this.notificationService.success((0,r.J)("common.notify-update-success"),{entity:"ProductOption"})},t=>{this.notificationService.error((0,r.J)("common.notify-update-error"),{entity:"ProductOption"})})}removeProductFacetValue(t){const e=this.getProductFormGroup(),n=e.value.facetValueIds;e.patchValue({facetValueIds:n.filter(e=>e!==t)}),e.markAsDirty()}selectVariantFacetValue(t){this.displayFacetValueModal().pipe((0,P.M)(this.variants$)).subscribe(([e,n])=>{if(e){for(const o of t){const t=n.findIndex(t=>t.id===o),i=n[t],a=i?i.facetValues.map(t=>t.id):[],r=this.detailForm.get("variants").controls.find(t=>t.value.id===o);if(r){const t=(0,Q.T)([...a,...e]);r.patchValue({facetValueIds:t}),r.markAsDirty(),this.variantFacetValueChanges[o]=t}}this.changeDetector.markForCheck()}})}variantsToCreateAreValid(){return 0<this.createVariantsConfig.variants.length&&this.createVariantsConfig.variants.every(t=>""!==t.sku)}displayFacetValueModal(){return this.productDetailService.getFacets().pipe((0,v.zg)(t=>this.modalService.fromComponent(Do,{size:"md",closable:!0,locals:{facets:t}})),(0,d.U)(t=>t&&t.map(t=>t.id)))}create(){const t=this.getProductFormGroup();!t.dirty||(0,q.aj)(this.product$,this.languageCode$).pipe((0,f.q)(1),(0,v.zg)(([e,n])=>{const o=this.getUpdatedProduct(e,t,n);return this.productDetailService.createProductWithVariants(o,this.createVariantsConfig,n)})).subscribe(({createProductVariants:t,productId:e})=>{this.notificationService.success((0,r.J)("common.notify-create-success"),{entity:"Product"}),this.assetChanges={},this.variantAssetChanges={},this.detailForm.markAsPristine(),this.router.navigate(["../",e],{relativeTo:this.route})},t=>{console.error(t),this.notificationService.error((0,r.J)("common.notify-create-error"),{entity:"Product"})})}save(){(0,q.aj)(this.product$,this.languageCode$,this.channelPriceIncludesTax$).pipe((0,f.q)(1),(0,v.zg)(([t,e,n])=>{var o,i;const a=this.getProductFormGroup();let r,s;(a.dirty||this.assetsChanged())&&(r=this.getUpdatedProduct(t,a,e));const c=this.detailForm.get("variants");return(c&&c.dirty||this.variantAssetsChanged())&&(s=this.getUpdatedProductVariants(t,c,e,n)),this.productDetailService.updateProduct({product:t,languageCode:e,autoUpdate:null!==(i=null===(o=this.detailForm.get(["product","autoUpdateVariantNames"]))||void 0===o?void 0:o.value)&&void 0!==i&&i,productInput:r,variantsInput:s})})).subscribe(t=>{this.updateSlugAfterSave(t),this.detailForm.markAsPristine(),this.assetChanges={},this.variantAssetChanges={},this.notificationService.success((0,r.J)("common.notify-update-success"),{entity:"Product"}),this.changeDetector.markForCheck()},t=>{this.notificationService.error((0,r.J)("common.notify-update-error"),{entity:"Product"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}setFormValues(t,e){const n=(0,a.ZIM)(t,e);this.detailForm.patchValue({product:{enabled:t.enabled,name:n?n.name:"",slug:n?n.slug:"",description:n?n.description:"",facetValueIds:t.facetValues.map(t=>t.id)}}),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["product","customFields"]),t,n),this.buildVariantFormArray(t.variantList.items,e)}buildVariantFormArray(t,e){const n=this.detailForm.get("variants");t.forEach((t,o)=>{const i=(0,a.ZIM)(t,e),r=this.variantFacetValueChanges[t.id]||t.facetValues.map(t=>t.id),s={id:t.id,enabled:t.enabled,sku:t.sku,name:i?i.name:"",price:t.price,priceWithTax:t.priceWithTax,taxCategoryId:t.taxCategory.id,stockOnHand:t.stockOnHand,useGlobalOutOfStockThreshold:t.useGlobalOutOfStockThreshold,outOfStockThreshold:t.outOfStockThreshold,trackInventory:t.trackInventory,facetValueIds:r};let c=n.controls.find(e=>e.value.id===t.id);if(c?c.pristine&&c.patchValue(s):(c=this.formBuilder.group(Object.assign(Object.assign({},s),{facetValueIds:this.formBuilder.control(r)})),n.insert(o,c)),this.customVariantFields.length){let e=c.get(["customFields"]);e||(e=this.formBuilder.group(this.customVariantFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{})),c.addControl("customFields",e)),this.setCustomFieldFormValues(this.customVariantFields,e,t,i)}})}getUpdatedProduct(t,e,n){var o,i;const r=(0,a.iSy)({translatable:t,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:t.name||"",slug:t.slug||"",description:t.description||""}});return Object.assign(Object.assign({},r),{assetIds:null===(o=this.assetChanges.assets)||void 0===o?void 0:o.map(t=>t.id),featuredAssetId:null===(i=this.assetChanges.featuredAsset)||void 0===i?void 0:i.id,facetValueIds:e.value.facetValueIds})}getUpdatedProductVariants(t,e,n,o){const i=e.controls.filter(t=>t.dirty),s=i.map(t=>this.productVariantMap.get(t.value.id)).filter(V.notNullOrUndefined),c=i.map(t=>t.value);if(s.length!==c.length)throw new Error((0,r.J)("error.product-variant-form-values-do-not-match"));return s.map((t,e)=>{var i,r;const s=c.find(e=>e.id===t.id),l=(0,a.iSy)({translatable:t,updatedFields:s,customFieldConfig:this.customVariantFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}});l.taxCategoryId=s.taxCategoryId,l.facetValueIds=s.facetValueIds,l.price=o?s.priceWithTax:s.price;const d=this.variantAssetChanges[t.id];return d&&(l.featuredAssetId=null===(i=d.featuredAsset)||void 0===i?void 0:i.id,l.assetIds=null===(r=d.assets)||void 0===r?void 0:r.map(t=>t.id)),l}).filter(V.notNullOrUndefined)}getProductFormGroup(){return this.detailForm.get("product")}updateSlugAfterSave(t){const e=t[0],n=this.detailForm.get(["product","slug"]);n&&e.hasOwnProperty("updateProduct")&&n.setValue(e.updateProduct.slug,{emitEvent:!1})}}Yo.\u0275fac=function(t){return new(t||Yo)(o.Y36(i.gz),o.Y36(i.F0),o.Y36(a.iHG),o.Y36(So),o.Y36(I.qu),o.Y36(a.Z7U),o.Y36(a.gqp),o.Y36(a.DoR),o.Y36(S.Ye),o.Y36(o.sBO))},Yo.\u0275cmp=o.Xpm({type:Yo,selectors:[["vdr-product-detail"]],features:[o.qOj],decls:18,vars:21,consts:[[1,"flex","clr-flex-row"],[3,"entity"],[4,"vdrIfPermissions"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["type","submit","hidden","","x-data","prevents enter key from triggering other buttons"],["clrTabLink","",3,"click"],[4,"clrIfActive"],[4,"ngIf"],[1,"clr-row"],[1,"clr-col"],["formGroupName","product",1,"form-block"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],[1,"auto-rename-wrapper"],["clrCheckbox","","type","checkbox","id","auto-update","formControlName","autoUpdateVariantNames"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],["locationId","product-detail",3,"entity$","detailForm"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","updatePermissions","change"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[4,"vdrIfMultichannel"],[3,"label",4,"vdrIfDefaultChannelActive"],[3,"label"],[1,"flex","channel-assignment"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"iconClick",4,"ngIf"],["icon","times-circle",3,"iconClick"],[3,"channelCode"],["formGroupName","customFields"],["entityName","Product",3,"customFields","customFieldsFormGroup","readonly"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],[3,"variantsChange"],[1,"form-block"],[1,"view-mode"],[1,"btn-group"],[1,"btn","btn-secondary-outline",3,"click"],["shape","list"],[1,"btn",3,"click"],["shape","table"],[1,"variant-filter"],[3,"formControl","placeholder"],[1,"icon-button",3,"click"],["shape","times"],[1,"flex-spacer"],["class","btn btn-secondary edit-variants-btn",3,"routerLink",4,"vdrIfPermissions"],["class","pagination-row mt4",4,"ngIf"],[3,"variants","paginationConfig","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges",4,"ngIf"],[3,"variants","paginationConfig","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick",4,"ngIf"],[1,"btn","btn-secondary","edit-variants-btn",3,"routerLink"],["shape","add-text"],[1,"pagination-row","mt4"],[3,"itemsPerPage","itemsPerPageChange"],[3,"id","currentPage","itemsPerPage","pageChange"],[3,"variants","paginationConfig","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges"],[3,"variants","paginationConfig","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick"]],template:function(t,e){if(1&t&&(o.TgZ(0,"vdr-action-bar"),o.TgZ(1,"vdr-ab-left"),o.TgZ(2,"div",0),o._UZ(3,"vdr-entity-info",1),o.ALo(4,"async"),o.YNc(5,se,5,5,"clr-toggle-wrapper",2),o.qZA(),o.TgZ(6,"vdr-language-selector",3),o.NdJ("languageCodeChange",function(t){return e.setLanguage(t)}),o.ALo(7,"async"),o.ALo(8,"async"),o.ALo(9,"async"),o.qZA(),o.qZA(),o.TgZ(10,"vdr-ab-right"),o._UZ(11,"vdr-action-bar-items",4),o.YNc(12,ce,3,4,"button",5),o.ALo(13,"async"),o.YNc(14,ue,1,2,"ng-template",null,6,o.W1O),o.qZA(),o.qZA(),o.YNc(16,ke,11,10,"form",7),o.ALo(17,"async")),2&t){const t=o.MAs(15);o.xp6(3),o.Q6J("entity",o.lcZ(4,8,e.entity$)),o.xp6(2),o.Q6J("vdrIfPermissions",o.DdM(20,de)),o.xp6(1),o.Q6J("disabled",o.lcZ(7,10,e.isNew$))("availableLanguageCodes",o.lcZ(8,12,e.availableLanguages$))("currentLanguageCode",o.lcZ(9,14,e.languageCode$)),o.xp6(6),o.Q6J("ngIf",o.lcZ(13,16,e.isNew$))("ngIfElse",t),o.xp6(4),o.Q6J("ngIf",o.lcZ(17,18,e.product$))}},directives:function(){return[a.KkL,a.BND,a.Vqt,a.HAh,a.SdP,a.mz,a.WWO,S.O5,B.PEh,a.y_K,I.Wl,B.KKC,I.JJ,I.oH,B.MgK,I._Y,I.JL,I.sg,B.gKI,B.dl,B.S4y,B.Iq$,B.Qs7,B.tam,B.UkA,I.x0,a.hgI,I.Fj,I.u,a.YI,a.CWh,vi,S.sg,a.uKX,a.Moo,a.Jpf,B.qvL,a.Ywx,a.nIZ,a.yc0,a.qt4,yi,i.yS,a.wAH,a.LSK,Oi,Ii]},pipes:function(){return[S.Ov,E.X$,a.j$k,a.E6B]},styles:["[_nghost-%COMP%]     trix-toolbar{top:24px}.facets[_ngcontent-%COMP%]{margin-top:12px;display:flex;flex-wrap:wrap;align-items:center}@media screen and (min-width: 768px){.facets[_ngcontent-%COMP%]{max-width:340px}}vdr-action-bar[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-top:12px}.variant-filter[_ngcontent-%COMP%]{flex:1;display:flex}.variant-filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;max-width:initial;border-radius:3px 0 0 3px!important}.variant-filter[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{border:1px solid var(--color-component-border-300);background-color:var(--color-component-bg-100);border-radius:0 3px 3px 0;border-left:none}.group-name[_ngcontent-%COMP%]{padding-right:6px}.view-mode[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.edit-variants-btn[_ngcontent-%COMP%]{margin-top:0}.channel-assignment[_ngcontent-%COMP%]{flex-wrap:wrap;max-height:144px;overflow-y:auto}.auto-rename-wrapper[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-left:9.5rem;margin-bottom:0;transition:max-height .2s,margin-bottom .2s}.auto-rename-wrapper.visible[_ngcontent-%COMP%]{max-height:24px;margin-bottom:12px}.pagination-row[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between}"],changeDetection:0}),Yo.ctorParameters=()=>[{type:i.gz},{type:i.F0},{type:a.iHG},{type:So},{type:I.qu},{type:a.Z7U},{type:a.gqp},{type:a.DoR},{type:S.Ye},{type:o.sBO}];class jo extends a.t7C{constructor(t,e,n,o,i,r,s){super(r,s),this.dataService=t,this.modalService=e,this.notificationService=n,this.jobQueueService=o,this.serverConfigService=i,this.searchTerm="",this.facetValueIds=[],this.groupByProduct=!0,this.pendingSearchIndexUpdates=0,this.route.queryParamMap.pipe((0,d.U)(t=>t.get("q")),(0,p.R)(this.destroy$)).subscribe(t=>{this.searchTerm=t||"",this.productSearchInput&&this.productSearchInput.setSearchTerm(t)}),this.selectedFacetValueIds$=this.route.queryParamMap.pipe((0,d.U)(t=>t.getAll("fvids"))),this.selectedFacetValueIds$.pipe((0,p.R)(this.destroy$)).subscribe(t=>{this.facetValueIds=t,this.productSearchInput&&this.productSearchInput.setFacetValues(t)}),super.setQueryFn((...t)=>this.dataService.product.searchProducts(this.searchTerm,...t).refetchOnChannelChange(),t=>t.search,(t,e)=>({input:{skip:t,take:e,term:this.searchTerm,facetValueIds:this.facetValueIds,facetValueOperator:a.FnJ.AND,groupByProduct:this.groupByProduct}}))}ngOnInit(){super.ngOnInit(),this.facetValues$=this.result$.pipe((0,d.U)(t=>t.search.facetValues)),this.facetValues$.pipe((0,f.q)(1),(0,T.g)(100),(0,P.M)(this.selectedFacetValueIds$)).subscribe(([t,e])=>{this.productSearchInput.setFacetValues(e)}),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(({uiState:t})=>t.contentLanguage).pipe((0,C.b)(()=>this.refresh())),this.dataService.product.getPendingSearchIndexUpdates().mapSingle(({pendingSearchIndexUpdates:t})=>t).subscribe(t=>this.pendingSearchIndexUpdates=t)}ngAfterViewInit(){this.productSearchInput&&this.searchTerm&&setTimeout(()=>this.productSearchInput.setSearchTerm(this.searchTerm))}setSearchTerm(t){this.searchTerm=t,this.setQueryParam({q:t||null,page:1}),this.refresh()}setFacetValueIds(t){this.facetValueIds=t,this.setQueryParam({fvids:t,page:1}),this.refresh()}rebuildSearchIndex(){this.dataService.product.reindex().subscribe(({reindex:t})=>{this.notificationService.info((0,r.J)("catalog.reindexing")),this.jobQueueService.addJob(t.id,t=>{if(t.state===a.Zyh.COMPLETED){const e=(new Intl.NumberFormat).format(t.duration||0);this.notificationService.success((0,r.J)("catalog.reindex-successful"),{count:t.result.indexedItemCount,time:e}),this.refresh()}else this.notificationService.error((0,r.J)("catalog.reindex-error"))})})}runPendingSearchIndexUpdates(){this.dataService.product.runPendingSearchIndexUpdates().subscribe(t=>{this.notificationService.info((0,r.J)("catalog.running-search-index-updates"),{count:this.pendingSearchIndexUpdates}),this.pendingSearchIndexUpdates=0})}deleteProduct(t){this.modalService.dialog({title:(0,r.J)("catalog.confirm-delete-product"),buttons:[{type:"secondary",label:(0,r.J)("common.cancel")},{type:"danger",label:(0,r.J)("common.delete"),returnValue:!0}]}).pipe((0,m.w)(e=>e?this.dataService.product.deleteProduct(t):w.E),(0,T.g)(500)).subscribe(()=>{this.notificationService.success((0,r.J)("common.notify-delete-success"),{entity:"Product"}),this.refresh()},t=>{this.notificationService.error((0,r.J)("common.notify-delete-error"),{entity:"Product"})})}setLanguage(t){this.dataService.client.setContentLanguage(t).subscribe()}}jo.\u0275fac=function(t){return new(t||jo)(o.Y36(a.DoR),o.Y36(a.Z7U),o.Y36(a.gqp),o.Y36(a.u8d),o.Y36(a.iHG),o.Y36(i.F0),o.Y36(i.gz))},jo.\u0275cmp=o.Xpm({type:jo,selectors:[["vdr-products-list"]],viewQuery:function(t,e){if(1&t&&o.Gf(Me,7),2&t){let t;o.iGM(t=o.CRH())&&(e.productSearchInput=t.first)}},features:[o.qOj],decls:38,vars:43,consts:[[3,"grow"],[1,"search-form"],[3,"facetValueResults","searchTermChange","facetValueChange"],["productSearchInputComponent",""],[1,"search-settings-menu","mr3"],["type","button","vdrDropdownTrigger","",1,"icon-button","search-index-button",3,"title"],["shape","cog"],["type","warning",4,"ngIf"],["vdrPosition","bottom-right"],[1,"dropdown-header"],[4,"ngIf"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"flex","wrap"],[1,"mt2"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],["type","warning"],["type","button","vdrDropdownItem","",1,"run-updates-button",3,"disabled","click"],[1,"dropdown-divider"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"full-label"],[1,"left","align-middle","image-col"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[1,"left","align-middle"],[1,"align-middle"],[1,"right","align-middle"],["iconShape","edit",1,"edit-button",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"src"],[1,"placeholder"],["shape","image","size","48"]],template:function(t,e){1&t&&(o.TgZ(0,"vdr-action-bar"),o.TgZ(1,"vdr-ab-left",0),o.TgZ(2,"div",1),o.TgZ(3,"vdr-product-search-input",2,3),o.NdJ("searchTermChange",function(t){return e.setSearchTerm(t)})("facetValueChange",function(t){return e.setFacetValueIds(t)}),o.ALo(5,"async"),o.qZA(),o.TgZ(6,"vdr-dropdown",4),o.TgZ(7,"button",5),o.ALo(8,"translate"),o._UZ(9,"clr-icon",6),o.YNc(10,Le,1,0,"vdr-status-badge",7),o.qZA(),o.TgZ(11,"vdr-dropdown-menu",8),o.TgZ(12,"h4",9),o._uU(13),o.ALo(14,"translate"),o.qZA(),o.YNc(15,Je,7,10,"ng-container",10),o.TgZ(16,"button",11),o.NdJ("click",function(){return e.rebuildSearchIndex()}),o.ALo(17,"hasPermission"),o._uU(18),o.ALo(19,"translate"),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.TgZ(20,"div",12),o.TgZ(21,"clr-checkbox-wrapper",13),o.TgZ(22,"input",14),o.NdJ("ngModelChange",function(t){return e.groupByProduct=t})("ngModelChange",function(){return e.refresh()}),o.qZA(),o.TgZ(23,"label"),o._uU(24),o.ALo(25,"translate"),o.qZA(),o.qZA(),o.TgZ(26,"vdr-language-selector",15),o.NdJ("languageCodeChange",function(t){return e.setLanguage(t)}),o.ALo(27,"async"),o.ALo(28,"async"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(29,"vdr-ab-right"),o._UZ(30,"vdr-action-bar-items",16),o.YNc(31,Ue,5,5,"a",17),o.qZA(),o.qZA(),o.TgZ(32,"vdr-data-table",18),o.NdJ("pageChange",function(t){return e.setPageNumber(t)})("itemsPerPageChange",function(t){return e.setItemsPerPage(t)}),o.ALo(33,"async"),o.ALo(34,"async"),o.ALo(35,"async"),o.ALo(36,"async"),o.YNc(37,De,23,28,"ng-template"),o.qZA()),2&t&&(o.xp6(1),o.Q6J("grow",!0),o.xp6(2),o.Q6J("facetValueResults",o.lcZ(5,17,e.facetValues$)),o.xp6(4),o.Q6J("title",o.lcZ(8,19,e.pendingSearchIndexUpdates?"catalog.pending-search-index-updates":"catalog.search-index-controls")),o.xp6(3),o.Q6J("ngIf",e.pendingSearchIndexUpdates),o.xp6(3),o.Oqu(o.lcZ(14,21,"catalog.search-index-controls")),o.xp6(2),o.Q6J("ngIf",e.pendingSearchIndexUpdates),o.xp6(1),o.Q6J("disabled",!o.lcZ(17,23,o.DdM(41,de))),o.xp6(2),o.hij(" ",o.lcZ(19,25,"catalog.rebuild-search-index")," "),o.xp6(4),o.Q6J("ngModel",e.groupByProduct),o.xp6(2),o.Oqu(o.lcZ(25,27,"catalog.group-by-product")),o.xp6(2),o.Q6J("availableLanguageCodes",o.lcZ(27,29,e.availableLanguages$))("currentLanguageCode",o.lcZ(28,31,e.contentLanguage$)),o.xp6(5),o.Q6J("vdrIfPermissions",o.DdM(42,Qe)),o.xp6(1),o.Q6J("items",o.lcZ(33,33,e.items$))("itemsPerPage",o.lcZ(34,35,e.itemsPerPage$))("totalItems",o.lcZ(35,37,e.totalItems$))("currentPage",o.lcZ(36,39,e.currentPage$)))},directives:[a.KkL,a.BND,a.jSu,a.JOL,a.UaT,B.qvL,S.O5,a.N9E,a.HH4,B.PEh,a.y_K,I.Wl,B.KKC,I.JJ,I.On,B.MgK,a.SdP,a.mz,a.WWO,a.HAh,a.Qj_,a.eKY,i.yS,a.v_8,a.Ywx],pipes:[S.Ov,E.X$,a.j$k,a.Mgf],styles:[".image-col[_ngcontent-%COMP%]{width:70px}.image-placeholder[_ngcontent-%COMP%]{width:50px;height:50px;background-color:var(--color-component-bg-200)}.image-placeholder[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.search-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;margin-bottom:6px}.search-input[_ngcontent-%COMP%]{min-width:300px}@media screen and (max-width: 768px){.search-input[_ngcontent-%COMP%]{min-width:100px}}.search-settings-menu[_ngcontent-%COMP%]{margin:0 12px}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.search-index-button[_ngcontent-%COMP%]{position:relative}.search-index-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{right:0;top:0}.run-updates-button[_ngcontent-%COMP%]{position:relative}.run-updates-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{left:10px;top:10px}.edit-button[_ngcontent-%COMP%]{margin-right:24px}"]}),jo.ctorParameters=()=>[{type:a.DoR},{type:a.Z7U},{type:a.gqp},{type:a.u8d},{type:a.iHG},{type:i.F0},{type:i.gz}],jo.propDecorators={productSearchInput:[{type:o.i9L,args:["productSearchInputComponent",{static:!0}]}]};class Go extends a.UT_{constructor(t,e,n,o,i,r,s,c){super(t,e,n,o),this.route=t,this.router=e,this.serverConfigService=n,this.dataService=o,this.productDetailService=i,this.formBuilder=r,this.changeDetector=s,this.notificationService=c,this.autoUpdateVariantNames=!0,this.updatePermission=[a.y3$.UpdateCatalog,a.y3$.UpdateProduct],this.optionGroupCustomFields=this.getCustomFieldConfig("ProductOptionGroup"),this.optionCustomFields=this.getCustomFieldConfig("ProductOption")}ngOnInit(){this.optionGroups$=this.route.snapshot.data.entity.pipe((0,d.U)(t=>t.optionGroups)),this.detailForm=new I.cw({optionGroups:new I.Oe([])}),super.init()}getOptionGroups(){return this.detailForm.get("optionGroups").controls}getOptions(t){return t.get("options").controls}save(){if(this.detailForm.invalid||this.detailForm.pristine)return;const t=this.dataService.product.getProduct(this.id).mapSingle(t=>t.product);(0,q.aj)(this.entity$,this.languageCode$,t).pipe((0,f.q)(1),(0,v.zg)(([{optionGroups:t},e,n])=>{var o,i,a,r,s;const c=[];for(const l of this.getOptionGroups()){if((null===(o=l.get("name"))||void 0===o?void 0:o.dirty)||(null===(i=l.get("code"))||void 0===i?void 0:i.dirty)){const n=t.find(t=>t.id===l.value.id);if(n){const t=this.getUpdatedOptionGroup(n,l,e);c.push(this.dataService.product.updateProductOptionGroup(t))}}for(const o of this.getOptions(l))if((null===(a=o.get("name"))||void 0===a?void 0:a.dirty)||(null===(r=o.get("code"))||void 0===r?void 0:r.dirty)){const i=null===(s=t.find(t=>t.id===l.value.id))||void 0===s?void 0:s.options.find(t=>t.id===o.value.id);if(i){const t=this.getUpdatedOption(i,o,e);c.push(this.productDetailService.updateProductOption(Object.assign(Object.assign({},t),{autoUpdate:this.autoUpdateVariantNames}),n,e))}}}return(0,L.D)(c)})).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success((0,r.J)("common.notify-update-success"),{entity:"ProductOptionGroup"})},t=>{this.notificationService.error((0,r.J)("common.notify-update-error"),{entity:"ProductOptionGroup"})})}getUpdatedOptionGroup(t,e,n){return(0,a.iSy)({translatable:t,updatedFields:e.value,customFieldConfig:this.optionGroupCustomFields,languageCode:n,defaultTranslation:{languageCode:n,name:t.name||""}})}getUpdatedOption(t,e,n){return(0,a.iSy)({translatable:t,updatedFields:e.value,customFieldConfig:this.optionGroupCustomFields,languageCode:n,defaultTranslation:{languageCode:n,name:t.name||""}})}setFormValues(t,e){const n=new I.Oe([]);for(const o of t.optionGroups){const t=(0,a.ZIM)(o,e),i={id:o.id,createdAt:o.createdAt,updatedAt:o.updatedAt,code:o.code,name:t?t.name:""},r=new I.Oe([]);for(const n of o.options){const t=(0,a.ZIM)(n,e),o=this.formBuilder.group({id:n.id,createdAt:n.createdAt,updatedAt:n.updatedAt,code:n.code,name:t?t.name:""});r.push(o)}const s=this.formBuilder.group(i);s.addControl("options",r),n.push(s)}this.detailForm.setControl("optionGroups",n)}}Go.\u0275fac=function(t){return new(t||Go)(o.Y36(i.gz),o.Y36(i.F0),o.Y36(a.iHG),o.Y36(a.DoR),o.Y36(So),o.Y36(I.qu),o.Y36(o.sBO),o.Y36(a.gqp))},Go.\u0275cmp=o.Xpm({type:Go,selectors:[["vdr-product-options-editor"]],features:[o.qOj],decls:16,vars:14,consts:[[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],[1,"flex","center"],[1,"mr2"],["clrCheckbox","","type","checkbox","id","auto-update",3,"ngModel","ngModelChange"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"form",3,"formGroup"],["formGroupName","optionGroups",1,"clr-row"],["class","clr-col-12 clr-col-xl-6",4,"ngFor","ngForOf"],[1,"clr-col-12","clr-col-xl-6"],[1,"card",3,"formArrayName"],[1,"card-header","option-group-header"],[3,"entity"],[1,"ml2"],[1,"card-block"],["for","name",3,"label"],["type","text","formControlName","name",3,"id","readonly"],["for","code",3,"label"],["type","text","formControlName","code",3,"id","readonly"],["formGroupName","options",1,"facet-values-list","table","mt2","mb4"],["class","facet-value",3,"formGroupName",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroupName"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly"],["type","text","formControlName","code"]],template:function(t,e){1&t&&(o.TgZ(0,"vdr-action-bar"),o.TgZ(1,"vdr-ab-left"),o.TgZ(2,"vdr-language-selector",0),o.NdJ("languageCodeChange",function(t){return e.setLanguage(t)}),o.ALo(3,"async"),o.ALo(4,"async"),o.qZA(),o.qZA(),o.TgZ(5,"vdr-ab-right"),o.TgZ(6,"div",1),o.TgZ(7,"div",2),o.TgZ(8,"clr-checkbox-wrapper"),o.TgZ(9,"input",3),o.NdJ("ngModelChange",function(t){return e.autoUpdateVariantNames=t}),o.qZA(),o.TgZ(10,"label"),o._uU(11),o.ALo(12,"translate"),o.qZA(),o.qZA(),o.qZA(),o.YNc(13,Ye,3,4,"button",4),o.qZA(),o.qZA(),o.qZA(),o.YNc(14,Ee,3,2,"form",5),o.ALo(15,"async")),2&t&&(o.xp6(2),o.Q6J("availableLanguageCodes",o.lcZ(3,6,e.availableLanguages$))("currentLanguageCode",o.lcZ(4,8,e.languageCode$)),o.xp6(7),o.Q6J("ngModel",e.autoUpdateVariantNames),o.xp6(2),o.Oqu(o.lcZ(12,10,"catalog.auto-update-product-variant-name")),o.xp6(2),o.Q6J("vdrIfPermissions",e.updatePermission),o.xp6(1),o.Q6J("ngIf",o.lcZ(15,12,e.optionGroups$)))},directives:[a.KkL,a.BND,a.SdP,a.mz,B.PEh,a.y_K,I.Wl,B.KKC,I.JJ,I.On,B.MgK,a.HAh,S.O5,I._Y,I.JL,I.sg,I.x0,S.sg,I.CE,a.Vqt,a.hgI,I.Fj,I.u],pipes:[S.Ov,E.X$,a.j$k],styles:[".option-group-header[_ngcontent-%COMP%]{display:flex;align-items:baseline}"],changeDetection:0}),Go.ctorParameters=()=>[{type:i.gz},{type:i.F0},{type:a.iHG},{type:a.DoR},{type:So},{type:I.qu},{type:o.sBO},{type:a.gqp}];class Eo{constructor(){this.variants=[]}confirm(){this.resolveWith(!0)}cancel(){this.resolveWith()}}Eo.\u0275fac=function(t){return new(t||Eo)},Eo.\u0275cmp=o.Xpm({type:Eo,selectors:[["vdr-confirm-variant-deletion-dialog"]],decls:6,vars:4,consts:[["vdrDialogTitle",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(t,e){1&t&&(o.YNc(0,He,2,3,"ng-template",0),o._uU(1),o.ALo(2,"translate"),o.TgZ(3,"ul"),o.YNc(4,Be,2,2,"li",1),o.qZA(),o.YNc(5,Re,6,6,"ng-template",2)),2&t&&(o.xp6(1),o.hij("\n",o.lcZ(2,2,"catalog.confirm-deletion-of-unused-variants-body"),"\n"),o.xp6(3),o.Q6J("ngForOf",e.variants))},directives:[a.q6K,S.sg,a.nPI],pipes:[E.X$],styles:[""],changeDetection:0});class Ho{constructor(t){for(const e of Object.keys(t))this[e]=t[e]}}class Bo{constructor(t,e,n,o,i){this.route=t,this.dataService=e,this.productDetailService=n,this.notificationService=o,this.modalService=i,this.formValueChanged=!1,this.generatedVariants=[]}ngOnInit(){this.initOptionsAndVariants(),this.languageCode=this.route.snapshot.paramMap.get("lang")||(0,a.kAh)(),this.dataService.settings.getActiveChannel().single$.subscribe(t=>{this.currencyCode=t.activeChannel.currencyCode})}onFormChanged(t){this.formValueChanged=!0,t.enabled=!0}canDeactivate(){return!this.formValueChanged}getVariantsToAdd(){return this.generatedVariants.filter(t=>!t.existing&&t.enabled)}getVariantName(t){return 0===t.options.length?(0,r.J)("catalog.default-variant"):t.options.map(t=>t.name).join(" ")}addOption(){this.optionGroups.push({isNew:!0,name:"",values:[]})}removeOption(t){this.optionGroups=this.optionGroups.filter(e=>e!==t),this.generateVariants()}generateVariants(){const t=this.optionGroups.map(t=>t.values),e=this.generatedVariants,n=(t,n,o,i)=>{var a,r,s,c,l,d;const u=this.getVariantPrototype(n,e);return new Ho({enabled:!0,existing:!!o,productVariantId:null==o?void 0:o.id,isDefault:t,options:n,price:null!==(r=null!==(a=null==o?void 0:o.price)&&void 0!==a?a:null==i?void 0:i.price)&&void 0!==r?r:u.price,sku:null!==(c=null!==(s=null==o?void 0:o.sku)&&void 0!==s?s:null==i?void 0:i.sku)&&void 0!==c?c:u.sku,stock:null!==(d=null!==(l=null==o?void 0:o.stockOnHand)&&void 0!==l?l:null==i?void 0:i.stockOnHand)&&void 0!==d?d:u.stock})};this.generatedVariants=t.length?(0,V.generateAllCombinations)(t).map(t=>{const e=this.product.variants.find(e=>this.optionsAreEqual(e.options,t)),o=this.product.variants.find(e=>this.optionsAreSubset(e.options,t));return n(!1,t,e,o)}):[n(!0,[],this.product.variants[0])]}getVariantPrototype(t,e){return e.filter(e=>t.map(t=>t.name).filter(t=>e.options.map(t=>t.name).includes(t))).length?(0,j.e)(e[0],["sku","price","stock"]):{sku:"",price:0,stock:0}}deleteVariant(t){this.modalService.dialog({title:(0,r.J)("catalog.confirm-delete-product-variant"),buttons:[{type:"secondary",label:(0,r.J)("common.cancel")},{type:"danger",label:(0,r.J)("common.delete"),returnValue:!0}]}).pipe((0,m.w)(e=>e?this.productDetailService.deleteProductVariant(t,this.product.id):w.E),(0,m.w)(()=>this.reFetchProduct(null))).subscribe(()=>{this.notificationService.success((0,r.J)("common.notify-delete-success"),{entity:"ProductVariant"}),this.initOptionsAndVariants()},t=>{this.notificationService.error((0,r.J)("common.notify-delete-error"),{entity:"ProductVariant"})})}save(){this.optionGroups=this.optionGroups.filter(t=>t.values.length);const t=this.optionGroups.filter(t=>t.isNew).map(t=>({name:t.name,values:[]}));this.checkUniqueSkus().pipe((0,v.zg)(()=>this.confirmDeletionOfObsoleteVariants()),(0,v.zg)(()=>this.productDetailService.createProductOptionGroups(t,this.languageCode)),(0,v.zg)(t=>this.addOptionGroupsToProduct(t)),(0,v.zg)(t=>this.addNewOptionsToGroups(t)),(0,v.zg)(t=>this.fetchOptionGroups(t)),(0,v.zg)(t=>this.createNewProductVariants(t)),(0,v.zg)(t=>this.deleteObsoleteVariants(t.createProductVariants)),(0,v.zg)(t=>this.reFetchProduct(t))).subscribe({next:t=>{this.formValueChanged=!1,this.notificationService.success((0,r.J)("catalog.created-new-variants-success"),{count:t.length}),this.initOptionsAndVariants()}})}checkUniqueSkus(){const t=this.generatedVariants.filter((t,e)=>this.generatedVariants.find(e=>e.sku.trim()===t.sku.trim()&&e!==t));return t.length?this.modalService.dialog({title:(0,r.J)("catalog.duplicate-sku-warning"),body:(0,Q.T)(t.map(t=>`${t.sku}`)).join(", "),buttons:[{label:(0,r.J)("common.close"),returnValue:!1,type:"primary"}]}).pipe((0,v.zg)(t=>w.E)):(0,M.of)(!0)}confirmDeletionOfObsoleteVariants(){const t=this.getObsoleteVariants();return t.length?this.modalService.fromComponent(Eo,{locals:{variants:t}}).pipe((0,v.zg)(t=>!0===t?(0,M.of)(!0):w.E)):(0,M.of)(!0)}getObsoleteVariants(){return this.product.variants.filter(t=>!this.generatedVariants.find(e=>e.productVariantId===t.id))}hasOnlyDefaultVariant(t){return 1===t.variants.length&&0===t.optionGroups.length}addOptionGroupsToProduct(t){return t.length?(0,L.D)(t.map(t=>this.dataService.product.addOptionGroupToProduct({productId:this.product.id,optionGroupId:t.id}))).pipe((0,d.U)(()=>t)):(0,M.of)([])}addNewOptionsToGroups(t){const e=this.optionGroups.map(e=>{const n=t.find(t=>t.name===e.name),o=n?n.id:e.id;if(!o)throw new Error("Could not get a productOptionGroupId");return e.values.filter(t=>!t.locked).map(t=>({productOptionGroupId:o,code:(0,N.U)(t.name,"-"),translations:[{name:t.name,languageCode:this.languageCode}]}))}).reduce((t,e)=>[...t,...e],[]),n=[...t.map(t=>t.id),...this.optionGroups.map(t=>t.id).filter(V.notNullOrUndefined)];return e.length?(0,L.D)(e.map(t=>this.dataService.product.addOptionToGroup(t))).pipe((0,d.U)(()=>n)):(0,M.of)(n)}fetchOptionGroups(t){return(0,L.D)(t.map(t=>this.dataService.product.getProductOptionGroup(t).mapSingle(t=>t.productOptionGroup).pipe((0,h.h)(V.notNullOrUndefined))))}createNewProductVariants(t){const e=t.filter(V.notNullOrUndefined).map(t=>t.options).reduce((t,e)=>[...t,...e],[]),n=this.generatedVariants.filter(t=>t.enabled&&!t.existing).map(t=>({price:t.price,sku:t.sku,stock:t.stock,optionIds:t.options.map(t=>e.find(e=>e.name===t.name)).filter(V.notNullOrUndefined).map(t=>t.id)}));return this.productDetailService.createProductVariants(this.product,n,e,this.languageCode)}deleteObsoleteVariants(t){const e=this.getObsoleteVariants();if(e.length){const n=e.map(e=>this.dataService.product.deleteProductVariant(e.id).pipe((0,d.U)(()=>t)));return(0,L.D)(...n)}return(0,M.of)(t)}reFetchProduct(t){const e=this.route.snapshot.paramMap.get("id");return e?this.dataService.product.getProduct(e).single$.pipe((0,d.U)(()=>t)):(0,M.of)(t)}initOptionsAndVariants(){this.dataService.product.getProductVariantsOptions(this.route.snapshot.paramMap.get("id")).mapSingle(({product:t})=>t).subscribe(t=>{this.product=t,this.optionGroups=t.optionGroups.map(t=>({id:t.id,isNew:!1,name:t.name,values:t.options.map(t=>({id:t.id,name:t.name,locked:!0}))})),this.generateVariants()})}optionsAreEqual(t,e){return this.toOptionString(t)===this.toOptionString(e)}optionsAreSubset(t,e){return this.toOptionString(e).includes(this.toOptionString(t))}toOptionString(t){return t.map(t=>t.name).sort().join("|")}}Bo.\u0275fac=function(t){return new(t||Bo)(o.Y36(i.gz),o.Y36(a.DoR),o.Y36(So),o.Y36(a.gqp),o.Y36(a.Z7U))},Bo.\u0275cmp=o.Xpm({type:Bo,selectors:[["vdr-product-variants-editor"]],decls:31,vars:27,consts:[[1,"btn","btn-primary",3,"disabled","click"],["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[3,"disabled",4,"ngFor","ngForOf"],[1,"option-groups"],[1,"name"],["clrInput","","name","name",3,"ngModel","readonly","ngModelChange"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],["class","btn btn-icon btn-danger-outline mt5",3,"click",4,"ngIf"],[1,"btn","btn-icon","btn-danger-outline","mt5",3,"click"],["shape","trash"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange",4,"ngIf"],[4,"ngIf"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange"],["clrInput","","type","text","name","sku","required","",3,"ngModel","placeholder","ngModelChange"],["clrInput","","name","price",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","name","stock","min","0","step","1",3,"ngModel","ngModelChange"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"]],template:function(t,e){1&t&&(o.TgZ(0,"vdr-action-bar"),o.TgZ(1,"vdr-ab-right"),o.TgZ(2,"button",0),o.NdJ("click",function(){return e.save()}),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.qZA(),o.qZA(),o.YNc(5,ze,14,12,"div",1),o.TgZ(6,"button",2),o.NdJ("click",function(){return e.addOption()}),o._UZ(7,"clr-icon",3),o._uU(8),o.ALo(9,"translate"),o.qZA(),o.TgZ(10,"div",4),o.TgZ(11,"table",5),o.TgZ(12,"thead"),o.TgZ(13,"tr"),o.TgZ(14,"th"),o._uU(15),o.ALo(16,"translate"),o.qZA(),o.TgZ(17,"th"),o._uU(18),o.ALo(19,"translate"),o.qZA(),o.TgZ(20,"th"),o._uU(21),o.ALo(22,"translate"),o.qZA(),o.TgZ(23,"th"),o._uU(24),o.ALo(25,"translate"),o.qZA(),o.TgZ(26,"th"),o._uU(27),o.ALo(28,"translate"),o.qZA(),o._UZ(29,"th"),o.qZA(),o.qZA(),o.YNc(30,sn,17,13,"tr",6),o.qZA(),o.qZA()),2&t&&(o.xp6(2),o.Q6J("disabled",!e.formValueChanged||0===e.getVariantsToAdd().length),o.xp6(1),o.hij(" ",o.xi3(4,10,"common.add-new-variants",o.VKq(25,dt,e.getVariantsToAdd().length))," "),o.xp6(2),o.Q6J("ngForOf",e.optionGroups),o.xp6(3),o.hij(" ",o.lcZ(9,13,"catalog.add-option"),"\n"),o.xp6(7),o.Oqu(o.lcZ(16,15,"common.create")),o.xp6(3),o.Oqu(o.lcZ(19,17,"catalog.variant")),o.xp6(3),o.Oqu(o.lcZ(22,19,"catalog.sku")),o.xp6(3),o.Oqu(o.lcZ(25,21,"catalog.price")),o.xp6(3),o.Oqu(o.lcZ(28,23,"catalog.stock-on-hand")),o.xp6(3),o.Q6J("ngForOf",e.generatedVariants))},directives:function(){return[a.KkL,a.mz,S.sg,B.qvL,B.MgK,a.y_K,I.Fj,B.xRP,I.JJ,I.On,Ti,S.O5,I.Wl,B.KKC,B.G55,I.Q7,a.KQz,I.qQ,I.wV,a.JOL,a.UaT,a.N9E,a.HH4]},pipes:function(){return[E.X$,a.kgx]},styles:[".option-groups[_ngcontent-%COMP%]{display:flex}.option-groups[_ngcontent-%COMP%]:first-of-type{margin-top:24px}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]}),Bo.ctorParameters=()=>[{type:i.gz},{type:a.DoR},{type:So},{type:a.gqp},{type:a.Z7U}];class Ro extends a.p_9{constructor(t,e){super(t,{__typename:"Asset",id:"",createdAt:"",updatedAt:"",name:"",type:a.h3s.IMAGE,fileSize:0,mimeType:"",width:0,height:0,source:"",preview:"",focalPoint:null},t=>e.product.getAsset(t).mapStream(t=>t.asset))}}Ro.\u0275fac=function(t){return new(t||Ro)(o.LFG(i.F0),o.LFG(a.DoR))},Ro.\u0275prov=o.Yz7({factory:function(){return new Ro(o.LFG(i.F0),o.LFG(a.DoR))},token:Ro,providedIn:"root"}),Ro.ctorParameters=()=>[{type:i.F0},{type:a.DoR}];class Ko extends a.p_9{constructor(t,e){super(t,{__typename:"Collection",id:"",createdAt:"",updatedAt:"",languageCode:(0,a.kAh)(),name:"",slug:"",isPrivate:!1,description:"",featuredAsset:null,assets:[],translations:[],filters:[],parent:{},children:null},t=>e.collection.getCollection(t).mapStream(t=>t.collection))}}Ko.\u0275fac=function(t){return new(t||Ko)(o.LFG(i.F0),o.LFG(a.DoR))},Ko.\u0275prov=o.Yz7({factory:function(){return new Ko(o.LFG(i.F0),o.LFG(a.DoR))},token:Ko,providedIn:"root"}),Ko.ctorParameters=()=>[{type:i.F0},{type:a.DoR}];class zo extends a.p_9{constructor(t,e){super(t,{__typename:"Facet",id:"",createdAt:"",updatedAt:"",isPrivate:!1,languageCode:(0,a.kAh)(),name:"",code:"",translations:[],values:[]},t=>e.facet.getFacet(t).mapStream(t=>t.facet))}}zo.\u0275fac=function(t){return new(t||zo)(o.LFG(i.F0),o.LFG(a.DoR))},zo.\u0275prov=o.Yz7({factory:function(){return new zo(o.LFG(i.F0),o.LFG(a.DoR))},token:zo,providedIn:"root"}),zo.ctorParameters=()=>[{type:i.F0},{type:a.DoR}];class Wo extends a.p_9{constructor(t,e){super(e,{__typename:"Product",id:"",createdAt:"",updatedAt:"",enabled:!0,languageCode:(0,a.kAh)(),name:"",slug:"",featuredAsset:null,assets:[],description:"",translations:[],optionGroups:[],facetValues:[],variantList:{items:[],totalItems:0},channels:[]},e=>t.product.getProduct(e,{take:10}).refetchOnChannelChange().mapStream(t=>t.product))}}Wo.\u0275fac=function(t){return new(t||Wo)(o.LFG(a.DoR),o.LFG(i.F0))},Wo.\u0275prov=o.Yz7({factory:function(){return new Wo(o.LFG(a.DoR),o.LFG(i.F0))},token:Wo,providedIn:"root"}),Wo.ctorParameters=()=>[{type:a.DoR},{type:i.F0}];class Xo extends a.p_9{constructor(t,e){super(t,{__typename:"Product",id:"",createdAt:"",updatedAt:"",name:"",optionGroups:[],variants:[]},t=>e.product.getProductVariantsOptions(t).mapStream(t=>t.product))}}Xo.\u0275fac=function(t){return new(t||Xo)(o.LFG(i.F0),o.LFG(a.DoR))},Xo.\u0275prov=o.Yz7({factory:function(){return new Xo(o.LFG(i.F0),o.LFG(a.DoR))},token:Xo,providedIn:"root"}),Xo.ctorParameters=()=>[{type:i.F0},{type:a.DoR}];const ti={breadcrumb:(0,r.J)("breadcrumb.products")},ei={breadcrumb:ui},ni={breadcrumb:pi},oi={breadcrumb:gi},ii={breadcrumb:(0,r.J)("breadcrumb.facets")},ai={breadcrumb:mi},ri={breadcrumb:(0,r.J)("breadcrumb.collections")},si={breadcrumb:hi},ci={breadcrumb:(0,r.J)("breadcrumb.assets")},li={breadcrumb:fi},di=[{path:"products",component:jo,data:ti},{path:"products/:id",component:Yo,resolve:(0,a.Po4)(Wo),canDeactivate:[a.TSp],data:ei},{path:"products/:id/manage-variants",component:Bo,resolve:(0,a.Po4)(Xo),canDeactivate:[a.TSp],data:ni},{path:"products/:id/options",component:Go,resolve:(0,a.Po4)(Xo),canDeactivate:[a.TSp],data:oi},{path:"facets",component:Vo,data:ii},{path:"facets/:id",component:No,resolve:(0,a.Po4)(zo),canDeactivate:[a.TSp],data:ai},{path:"collections",component:Uo,data:ri},{path:"collections/:id",component:Jo,resolve:(0,a.Po4)(Ko),canDeactivate:[a.TSp],data:si},{path:"assets",component:Lo,data:ci},{path:"assets/:id",component:Mo,resolve:(0,a.Po4)(Ro),data:li}];function ui(t,e){return(0,a.YWC)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.products",getName:t=>t.name,route:"products"})}function pi(t,e){return t.entity.pipe((0,d.U)(t=>[{label:(0,r.J)("breadcrumb.products"),link:["../","products"]},{label:`${t.name}`,link:["../","products",e.id,{tab:"variants"}]},{label:(0,r.J)("breadcrumb.manage-variants"),link:["manage-variants"]}]))}function gi(t,e){return t.entity.pipe((0,d.U)(t=>[{label:(0,r.J)("breadcrumb.products"),link:["../","products"]},{label:`${t.name}`,link:["../","products",e.id,{tab:"variants"}]},{label:(0,r.J)("breadcrumb.product-options"),link:["options"]}]))}function mi(t,e){return(0,a.YWC)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.facets",getName:t=>t.name,route:"facets"})}function hi(t,e){return(0,a.YWC)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.collections",getName:t=>t.name,route:"collections"})}function fi(t,e){return(0,a.YWC)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.assets",getName:t=>t.name,route:"assets"})}class vi{constructor(t,e){this.modalService=t,this.changeDetector=e,this.compact=!1,this.change=new o.vpe,this.assets=[]}set assetsSetter(t){this.assets=(t||[]).slice()}selectAssets(){this.modalService.fromComponent(a.V61,{size:"xl"}).subscribe(t=>{t&&t.length&&(this.assets=(0,Q.T)(this.assets.concat(t),"id"),this.featuredAsset||(this.featuredAsset=t[0]),this.emitChangeEvent(this.assets,this.featuredAsset),this.changeDetector.markForCheck())})}setAsFeatured(t){this.featuredAsset=t,this.emitChangeEvent(this.assets,t)}isFeatured(t){return!!this.featuredAsset&&this.featuredAsset.id===t.id}previewAsset(t){this.modalService.fromComponent(a.IW,{size:"xl",closable:!0,locals:{asset:t}}).subscribe()}removeAsset(t){this.assets=this.assets.filter(e=>e.id!==t.id),this.featuredAsset&&this.featuredAsset.id===t.id&&(this.featuredAsset=this.assets.length>0?this.assets[0]:void 0),this.emitChangeEvent(this.assets,this.featuredAsset)}emitChangeEvent(t,e){this.change.emit({assets:t,featuredAsset:e})}dropListDropped(t){(0,G.bA)(this.assets,t.previousContainer.data,t.container.data),this.emitChangeEvent(this.assets,this.featuredAsset)}}vi.\u0275fac=function(t){return new(t||vi)(o.Y36(a.Z7U),o.Y36(o.sBO))},vi.\u0275cmp=o.Xpm({type:vi,selectors:[["vdr-assets"]],hostVars:2,hostBindings:function(t,e){2&t&&o.ekj("compact",e.compact)},inputs:{compact:"compact",assetsSetter:["assets","assetsSetter"],featuredAsset:"featuredAsset",updatePermissions:"updatePermissions"},outputs:{change:"change"},decls:5,vars:2,consts:[["class","card",4,"ngIf","ngIfElse"],["compactView",""],["assetList",""],[1,"card"],[1,"card-img"],[1,"featured-asset"],[3,"src","click",4,"ngIf"],["class","placeholder",3,"click",4,"ngIf"],[1,"card-block"],[4,"ngTemplateOutlet"],["class","card-footer",4,"vdrIfPermissions"],[3,"src","click"],[1,"placeholder",3,"click"],["shape","image","size","128"],[1,"card-footer"],[1,"btn",3,"click"],["shape","attachment"],[1,"featured-asset","compact"],["class","compact-select btn btn-icon btn-sm btn-block",3,"title","click",4,"vdrIfPermissions"],["shape","image","size","150"],[1,"compact-select","btn","btn-icon","btn-sm","btn-block",3,"title","click"],["cdkDropListGroup","",1,"all-assets"],["class","drop-list","cdkDropList","","cdkDropListOrientation","horizontal",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped",4,"ngFor","ngForOf"],["cdkDropList","","cdkDropListOrientation","horizontal",1,"drop-list",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["cdkDrag",""],["vdrDropdownTrigger","","tabindex","0",1,"asset-thumb",3,"title"],[3,"src"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"remove-asset",3,"disabled","click"]],template:function(t,e){if(1&t&&(o.YNc(0,pn,8,4,"div",0),o.YNc(1,vn,5,4,"ng-template",null,1,o.W1O),o.YNc(3,xn,2,3,"ng-template",null,2,o.W1O)),2&t){const t=o.MAs(2);o.Q6J("ngIf",!e.compact)("ngIfElse",t)}},directives:[S.O5,S.tP,a.HAh,B.qvL,G.Fd,S.sg,G.Wj,a.JOL,G.Zt,a.UaT,a.N9E,a.HH4],pipes:[a.Mgf,E.X$,a.j$k],styles:["[_nghost-%COMP%]{width:340px;display:block}.compact[_nghost-%COMP%]{width:162px}.placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer;border-radius:var(--border-radius-img)}.featured-asset[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}.all-assets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.all-assets[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:60px}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:3px;padding:0;border:2px solid var(--color-component-border-100);border-radius:var(--border-radius-img);cursor:pointer}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:var(--border-radius-img)}.all-assets[_ngcontent-%COMP%]   .asset-thumb.featured[_ngcontent-%COMP%]{border-color:var(--color-primary-500);border-radius:calc(var(--border-radius-img) + 2px)}.all-assets[_ngcontent-%COMP%]   .remove-asset[_ngcontent-%COMP%]{color:var(--color-warning-500)}.all-assets.compact[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:54px}.all-assets.compact[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:1px;border-width:1px}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{width:50px}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{width:50px}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.all-assets.cdk-drop-list-dragging[_ngcontent-%COMP%]   vdr-dropdown[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){display:none}"],changeDetection:0}),vi.ctorParameters=()=>[{type:a.Z7U},{type:o.sBO}],vi.propDecorators={assetsSetter:[{type:o.IIB,args:["assets"]}],featuredAsset:[{type:o.IIB}],compact:[{type:o.pfw,args:["class.compact"]},{type:o.IIB}],change:[{type:o.r_U}],updatePermissions:[{type:o.IIB}]};class Zi{constructor(t,e,n){this.route=t,this.router=e,this.dataService=n,this.previewUpdatedFilters=!1,this.filterTermControl=new I.NI(""),this.isLoading=!1,this.collectionIdChange$=new O.X(""),this.parentIdChange$=new O.X(""),this.filterChanges$=new O.X([]),this.refresh$=new O.X(!0),this.destroy$=new _.xQ}ngOnInit(){this.contentsCurrentPage$=this.route.queryParamMap.pipe((0,d.U)(t=>t.get("contentsPage")),(0,d.U)(t=>t?+t:1),(0,A.O)(1),(0,x.x)()),this.contentsItemsPerPage$=this.route.queryParamMap.pipe((0,d.U)(t=>t.get("contentsPerPage")),(0,d.U)(t=>t?+t:10),(0,A.O)(10),(0,x.x)());const t=this.filterTermControl.valueChanges.pipe((0,u.b)(250),(0,C.b)(()=>this.setContentsPageNumber(1)),(0,A.O)("")),e=this.filterChanges$.asObservable().pipe((0,h.h)(()=>this.previewUpdatedFilters),(0,C.b)(()=>this.setContentsPageNumber(1)),(0,A.O)([])),n=(0,q.aj)(this.collectionIdChange$,this.parentIdChange$,this.contentsCurrentPage$,this.contentsItemsPerPage$,t,e,this.refresh$).pipe((0,p.R)(this.destroy$),(0,C.b)(()=>this.isLoading=!0),(0,u.b)(50),(0,m.w)(([t,e,n,o,i,a])=>{const r=o,s=(n-1)*o;if(a.length&&this.previewUpdatedFilters){const t=i?{name:{contains:i}}:void 0;return this.dataService.collection.previewCollectionVariants({parentId:e,filters:a},{take:r,skip:s,filter:t}).mapSingle(t=>t.previewCollectionVariants).pipe((0,F.K)(()=>(0,M.of)({items:[],totalItems:0})))}return t?this.dataService.collection.getCollectionContents(t,r,s,i).mapSingle(t=>{var e;return null===(e=t.collection)||void 0===e?void 0:e.productVariants}):(0,M.of)(null)}),(0,C.b)(()=>this.isLoading=!1),(0,g.x)(()=>this.isLoading=!1));this.contents$=n.pipe((0,d.U)(t=>t?t.items:[])),this.contentsTotalItems$=n.pipe((0,d.U)(t=>t?t.totalItems:0))}ngOnChanges(t){"collectionId"in t&&this.collectionIdChange$.next(t.collectionId.currentValue),"parentId"in t&&this.parentIdChange$.next(t.parentId.currentValue),"updatedFilters"in t&&this.updatedFilters&&this.filterChanges$.next(this.updatedFilters)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setContentsPageNumber(t){this.setParam("contentsPage",t)}setContentsItemsPerPage(t){this.setParam("contentsPerPage",t)}refresh(){this.refresh$.next(!0)}setParam(t,e){this.router.navigate(["./"],{relativeTo:this.route,queryParams:{[t]:e},queryParamsHandling:"merge",replaceUrl:!0})}}function xi(t,e,n=[]){var o,i;const a=[],r={},s=function(t){const e=new Map;function n(t){e.set(t.id,t),t.children.forEach(n)}return t&&n(t),e}(e);for(const c of t)r[c.id]=Object.assign(Object.assign({},c),{children:[]});for(const c of t.map(t=>t.id))if(r.hasOwnProperty(c)){const t=r[c];t.expanded=null!==(i=null===(o=s.get(c))||void 0===o?void 0:o.expanded)&&void 0!==i?i:n.includes(c);const e=t.parent;if(!e)continue;r[e.id]?r[e.id]?r[e.id].children.push(t):r[e.id]={children:[t]}:a.push(t)}return{id:a.length?a[0].parent.id:void 0,children:a}}Zi.\u0275fac=function(t){return new(t||Zi)(o.Y36(i.gz),o.Y36(i.F0),o.Y36(a.DoR))},Zi.\u0275cmp=o.Xpm({type:Zi,selectors:[["vdr-collection-contents"]],contentQueries:function(t,e,n){if(1&t&&o.Suo(n,o.Rgc,7),2&t){let t;o.iGM(t=o.CRH())&&(e.headerTemplate=t.first)}},inputs:{previewUpdatedFilters:"previewUpdatedFilters",collectionId:"collectionId",parentId:"parentId",updatedFilters:"updatedFilters"},features:[o.TTD],decls:14,vars:26,consts:[[1,"contents-header"],[1,"header-title-row"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["type","text",3,"placeholder","formControl"],[1,"table-wrapper"],[1,"progress","loop"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"left","align-middle"],[1,"sku"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.YNc(2,Cn,1,0,"ng-container",2),o.ALo(3,"async"),o.qZA(),o._UZ(4,"input",3),o.ALo(5,"translate"),o.qZA(),o.TgZ(6,"div",4),o._UZ(7,"div",5),o.TgZ(8,"vdr-data-table",6),o.NdJ("pageChange",function(t){return e.setContentsPageNumber(t)})("itemsPerPageChange",function(t){return e.setContentsItemsPerPage(t)}),o.ALo(9,"async"),o.ALo(10,"async"),o.ALo(11,"async"),o.ALo(12,"async"),o.YNc(13,yn,8,10,"ng-template"),o.qZA(),o.qZA()),2&t&&(o.xp6(2),o.Q6J("ngTemplateOutlet",e.headerTemplate)("ngTemplateOutletContext",o.VKq(24,Pn,o.lcZ(3,12,e.contentsTotalItems$))),o.xp6(2),o.Q6J("placeholder",o.lcZ(5,14,"catalog.filter-by-name"))("formControl",e.filterTermControl),o.xp6(3),o.ekj("visible",e.isLoading),o.xp6(1),o.ekj("loading",e.isLoading),o.Q6J("items",o.lcZ(9,16,e.contents$))("itemsPerPage",o.lcZ(10,18,e.contentsItemsPerPage$))("totalItems",o.lcZ(11,20,e.contentsTotalItems$))("currentPage",o.lcZ(12,22,e.contentsCurrentPage$)))},directives:[S.tP,a.y_K,I.Fj,I.JJ,I.oH,a.Qj_,a.v_8],pipes:[S.Ov,E.X$],styles:[".contents-header[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);position:sticky;top:0;padding:6px;z-index:1;border-bottom:1px solid var(--color-component-border-200)}.contents-header[_ngcontent-%COMP%]   .header-title-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.contents-header[_ngcontent-%COMP%]   .clr-input[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     table{margin-top:-1px}vdr-data-table[_ngcontent-%COMP%]{opacity:1;transition:opacity .3s}vdr-data-table.loading[_ngcontent-%COMP%]{opacity:.5}.table-wrapper[_ngcontent-%COMP%]{position:relative}.progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;overflow:hidden;height:6px;opacity:0;transition:opacity .1s}.progress.visible[_ngcontent-%COMP%]{opacity:1}.sku[_ngcontent-%COMP%]{color:var(--color-text-200)}"],changeDetection:0}),Zi.ctorParameters=()=>[{type:i.gz},{type:i.F0},{type:a.DoR}],Zi.propDecorators={collectionId:[{type:o.IIB}],parentId:[{type:o.IIB}],updatedFilters:[{type:o.IIB}],previewUpdatedFilters:[{type:o.IIB}],headerTemplate:[{type:o.aQ5,args:[o.Rgc,{static:!0}]}]};class Ci{constructor(){this.expandAll=!1,this.expandedIds=[],this.rearrange=new o.vpe,this.deleteCollection=new o.vpe,this.allMoveListItems=[]}ngOnChanges(t){"collections"in t&&this.collections&&(this.collectionTree=xi(this.collections,this.collectionTree,this.expandedIds),this.allMoveListItems=[])}onDrop(t){const e=t.item.data,n=t.container.data.id;if(null==n)throw new Error("Could not determine the ID of the root Collection");this.rearrange.emit({collectionId:e.id,parentId:n,index:t.currentIndex})}onMove(t){this.rearrange.emit(t)}onDelete(t){this.deleteCollection.emit(t)}getMoveListItems(t){return 0===this.allMoveListItems.length&&(this.allMoveListItems=this.calculateAllMoveListItems()),this.allMoveListItems.filter(e=>{var n;return e.id!==t.id&&!e.ancestorIdPath.has(t.id)&&e.id!==(null===(n=t.parent)||void 0===n?void 0:n.id)})}calculateAllMoveListItems(){const t=(e,n,o,i)=>{const a=n.concat(e.name);return i.push({path:a.slice(1).join(" / ")||"root",id:e.id,ancestorIdPath:o}),e.children.forEach(n=>t(n,a,new Set([...o,e.id]),i)),i};return t(this.collectionTree,[],new Set,[])}isRootNode(t){return!t.hasOwnProperty("parent")}}Ci.\u0275fac=function(t){return new(t||Ci)},Ci.\u0275cmp=o.Xpm({type:Ci,selectors:[["vdr-collection-tree"]],inputs:{expandAll:"expandAll",expandedIds:"expandedIds",collections:"collections",activeCollectionId:"activeCollectionId"},outputs:{rearrange:"rearrange",deleteCollection:"deleteCollection"},features:[o.TTD],decls:1,vars:1,consts:[["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId"]],template:function(t,e){1&t&&o.YNc(0,Tn,1,3,"vdr-collection-tree-node",0),2&t&&o.Q6J("ngIf",e.collectionTree)},directives:function(){return[S.O5,bi,G.Fd]},styles:[""],changeDetection:0}),Ci.propDecorators={collections:[{type:o.IIB}],activeCollectionId:[{type:o.IIB}],expandAll:[{type:o.IIB}],expandedIds:[{type:o.IIB}],rearrange:[{type:o.r_U}],deleteCollection:[{type:o.r_U}]};class bi{constructor(t,e,n,o,i){this.parent=t,this.root=e,this.dataService=n,this.router=o,this.route=i,this.depth=0,this.expandAll=!1,this.moveListItems=[],t&&(this.depth=t.depth+1)}ngOnInit(){this.parentName=this.collectionTree.name||"<root>";const t=this.dataService.client.userStatus().mapStream(t=>t.userStatus.permissions).pipe((0,Z.d)(1));this.hasUpdatePermission$=t.pipe((0,d.U)(t=>t.includes(a.y3$.UpdateCatalog)||t.includes(a.y3$.UpdateCollection))),this.hasDeletePermission$=t.pipe((0,d.U)(t=>t.includes(a.y3$.DeleteCatalog)||t.includes(a.y3$.DeleteCollection)))}ngOnChanges(t){const e=t.expandAll;e&&!0===e.previousValue&&!1===e.currentValue&&this.collectionTree.children.forEach(t=>t.expanded=!1)}trackByFn(t,e){return e.id}toggleExpanded(t){var e,n;t.expanded=!t.expanded;let o=null!==(n=null===(e=this.route.snapshot.queryParamMap.get("expanded"))||void 0===e?void 0:e.split(","))&&void 0!==n?n:[];t.expanded?o.push(t.id):o=o.filter(e=>e!==t.id),this.router.navigate(["./"],{queryParams:{expanded:o.filter(t=>!!t).join(",")},queryParamsHandling:"merge",relativeTo:this.route})}getMoveListItems(t){this.moveListItems=this.root.getMoveListItems(t)}move(t,e){this.root.onMove({index:0,parentId:e,collectionId:t.id})}moveUp(t,e){!t.parent||this.root.onMove({index:e-1,parentId:t.parent.id,collectionId:t.id})}moveDown(t,e){!t.parent||this.root.onMove({index:e+1,parentId:t.parent.id,collectionId:t.id})}drop(t){(0,G.bA)(this.collectionTree.children,t.previousIndex,t.currentIndex),this.root.onDrop(t)}delete(t){this.root.onDelete(t)}}bi.\u0275fac=function(t){return new(t||bi)(o.Y36(bi,12),o.Y36(Ci),o.Y36(a.DoR),o.Y36(i.F0),o.Y36(i.gz))},bi.\u0275cmp=o.Xpm({type:bi,selectors:[["vdr-collection-tree-node"]],inputs:{expandAll:"expandAll",collectionTree:"collectionTree",activeCollectionId:"activeCollectionId"},features:[o.TTD],decls:4,vars:6,consts:[["cdkDropList","",1,"tree-node",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["dropList",""],["class","collection","cdkDrag","",3,"private","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"collection",3,"cdkDragData"],[1,"collection-detail",3,"ngClass"],[1,"name"],["class","icon-button folder-button",3,"disabled","click",4,"ngIf","ngIfElse"],["folderSpacer",""],[1,"flex-spacer"],[4,"ngIf"],["queryParamsHandling","preserve",1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","view-list"],[1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","edit"],["class","drag-handle","cdkDragHandle","",4,"vdrIfPermissions"],["vdrDropdownTrigger","",1,"icon-button",3,"click"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["class","dropdown-item",3,"routerLink",4,"vdrIfPermissions"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"disabled","click"],["shape","caret up"],["shape","caret down"],[1,"dropdown-header"],["type","button","vdrDropdownItem","",3,"disabled","click",4,"ngFor","ngForOf"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],[1,"icon-button","folder-button",3,"disabled","click"],["shape","folder",4,"ngIf"],["shape","folder-open",4,"ngIf"],["shape","folder"],["shape","folder-open"],[1,"folder-button-spacer"],["cdkDragHandle","",1,"drag-handle"],["shape","drag-handle","size","24"],[1,"dropdown-item",3,"routerLink"],["shape","plus"],[1,"move-to-item"],[1,"move-icon"],["shape","child-arrow"],[1,"path"],[3,"expandAll","collectionTree","activeCollectionId"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0,1),o.NdJ("cdkDropListDropped",function(t){return e.drop(t)}),o.ALo(2,"async"),o.YNc(3,Sn,45,51,"div",2),o.qZA()),2&t&&(o.Q6J("cdkDropListData",e.collectionTree)("cdkDropListDisabled",!o.lcZ(2,4,e.hasUpdatePermission$)),o.xp6(3),o.Q6J("ngForOf",e.collectionTree.children)("ngForTrackBy",e.trackByFn))},directives:[G.Wj,S.sg,B.q0d,G.Zt,S.mk,S.O5,i.yS,B.qvL,a.HAh,a.JOL,a.UaT,a.N9E,a.HH4,a.Ywx,G.Bh,bi],pipes:[S.Ov,E.X$],styles:["[_nghost-%COMP%]{display:block}.collection[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);font-size:.65rem;transition:transform .25s cubic-bezier(0,0,.2,1);margin-bottom:2px;border-left:2px solid transparent;transition:border-left-color .2s}.collection.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--color-component-border-100)}.collection[_ngcontent-%COMP%]   .collection-detail.active[_ngcontent-%COMP%]{background-color:var(--clr-global-selection-color)}.collection[_ngcontent-%COMP%]   .collection-detail.depth-1[_ngcontent-%COMP%]{padding-left:36px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-2[_ngcontent-%COMP%]{padding-left:60px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-3[_ngcontent-%COMP%]{padding-left:84px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-4[_ngcontent-%COMP%]{padding-left:108px}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]   .folder-button-spacer[_ngcontent-%COMP%]{display:inline-block;width:28px}.tree-node[_ngcontent-%COMP%]{display:block;background:var(--color-component-bg-100);overflow:hidden}.tree-node.cdk-drop-list-dragging[_ngcontent-%COMP%] > .collection[_ngcontent-%COMP%]{border-left-color:var(--color-primary-300)}.drag-placeholder[_ngcontent-%COMP%]{min-height:120px;background-color:var(--color-component-bg-300);transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .tree-node[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.move-to-item[_ngcontent-%COMP%]{display:flex;white-space:normal;align-items:baseline}.move-to-item[_ngcontent-%COMP%]   .move-icon[_ngcontent-%COMP%]{flex:none;margin-right:3px}.move-to-item[_ngcontent-%COMP%]   .path[_ngcontent-%COMP%]{line-height:18px}"],changeDetection:0}),bi.ctorParameters=()=>[{type:bi,decorators:[{type:o.tp0},{type:o.FiY}]},{type:Ci},{type:a.DoR},{type:i.F0},{type:i.gz}],bi.propDecorators={collectionTree:[{type:o.IIB}],activeCollectionId:[{type:o.IIB}],expandAll:[{type:o.IIB}]};const Ai="__DEFAULT_VARIANT__";class yi{constructor(t){this.dataService=t,this.variantsChange=new o.vpe,this.optionGroups=[],this.variantFormValues={}}ngOnInit(){this.dataService.settings.getActiveChannel().single$.subscribe(t=>{this.currencyCode=t.activeChannel.currencyCode}),this.generateVariants()}addOption(){this.optionGroups.push({name:"",values:[]})}removeOption(t){this.optionGroups=this.optionGroups.filter(e=>e.name!==t),this.generateVariants()}generateVariants(){const t=this.optionGroups.reduce((t,e)=>t+e.values.length,0)?this.optionGroups.map(t=>t.values.map(t=>t.name)):[[Ai]];this.variants=(0,V.generateAllCombinations)(t).map(t=>({id:t.join("|"),values:t})),this.variants.forEach(t=>{this.variantFormValues[t.id]||(this.variantFormValues[t.id]={optionValues:t.values,enabled:!0,price:this.copyFromDefault(t.id,"price",0),sku:this.copyFromDefault(t.id,"sku",""),stock:this.copyFromDefault(t.id,"stock",0)})}),this.onFormChange()}trackByFn(t,e){return e.values.join("|")}handleEnter(t,e){t.preventDefault(),t.stopPropagation(),e.focus()}onFormChange(){const t=this.variants.map(t=>this.variantFormValues[t.id]).filter(t=>t.enabled);this.variantsChange.emit({groups:this.optionGroups.map(t=>({name:t.name,values:t.values.map(t=>t.name)})),variants:t})}copyFromDefault(t,e,n){return t!==Ai?this.variantFormValues[Ai][e]:n}}yi.\u0275fac=function(t){return new(t||yi)(o.Y36(a.DoR))},yi.\u0275cmp=o.Xpm({type:yi,selectors:[["vdr-generate-product-variants"]],outputs:{variantsChange:"variantsChange"},decls:21,vars:17,consts:[["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[4,"ngIf"],[3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"option-groups"],[1,"name"],["placeholder","e.g. Size","clrInput","","name","name","required","",3,"ngModel","ngModelChange","keydown.enter"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],[1,"remove-group"],[1,"btn","btn-icon","btn-warning-outline",3,"title","click"],["shape","trash"],["clrInput","","type","text",3,"ngModel","placeholder","change","ngModelChange"],["clrInput","",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","min","0","step","1",3,"ngModel","ngModelChange","change"],["type","checkbox","clrCheckbox","",3,"ngModel","change","ngModelChange"]],template:function(t,e){1&t&&(o.YNc(0,Dn,16,13,"div",0),o.TgZ(1,"button",1),o.NdJ("click",function(){return e.addOption()}),o._UZ(2,"clr-icon",2),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.TgZ(5,"div",3),o.TgZ(6,"table",4),o.TgZ(7,"thead"),o.TgZ(8,"tr"),o.YNc(9,Qn,3,3,"th",5),o.YNc(10,Yn,3,3,"th",5),o.TgZ(11,"th"),o._uU(12),o.ALo(13,"translate"),o.qZA(),o.TgZ(14,"th"),o._uU(15),o.ALo(16,"translate"),o.qZA(),o.TgZ(17,"th"),o._uU(18),o.ALo(19,"translate"),o.qZA(),o.qZA(),o.qZA(),o.YNc(20,En,13,11,"tr",6),o.qZA(),o.qZA()),2&t&&(o.Q6J("ngForOf",e.optionGroups),o.xp6(3),o.hij(" ",o.lcZ(4,9,"catalog.add-option"),"\n"),o.xp6(6),o.Q6J("ngIf",1<e.variants.length),o.xp6(1),o.Q6J("ngIf",1<e.variants.length),o.xp6(2),o.Oqu(o.lcZ(13,11,"catalog.sku")),o.xp6(3),o.Oqu(o.lcZ(16,13,"catalog.price")),o.xp6(3),o.Oqu(o.lcZ(19,15,"catalog.stock-on-hand")),o.xp6(2),o.Q6J("ngForOf",e.variants)("ngForTrackBy",e.trackByFn))},directives:function(){return[S.sg,B.qvL,S.O5,B.q0d,B.MgK,a.y_K,I.Fj,B.xRP,I.Q7,I.JJ,I.On,Ti,B.G55,a.KQz,I.qQ,I.wV,I.Wl,B.KKC]},pipes:function(){return[E.X$]},styles:["[_nghost-%COMP%]{display:block;margin-bottom:120px}.option-groups[_ngcontent-%COMP%]{display:flex}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.remove-group[_ngcontent-%COMP%]{padding-top:18px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]}),yi.ctorParameters=()=>[{type:a.DoR}],yi.propDecorators={variantsChange:[{type:o.r_U}]};const Pi={provide:I.JU,useExisting:(0,o.Gpc)(()=>Ti),multi:!0};class Ti{constructor(t){this.changeDetector=t,this.groupName="",this.disabled=!1,this.input="",this.isFocussed=!1,this.lastSelected=!1}registerOnChange(t){this.onChangeFn=t}registerOnTouched(t){this.onTouchFn=t}setDisabledState(t){this.disabled=t,this.changeDetector.markForCheck()}writeValue(t){this.options=t||[]}focus(){this.textArea.nativeElement.focus()}removeOption(t){t.locked||(this.options=this.options.filter(e=>e.name!==t.name),this.onChangeFn(this.options))}handleKey(t){switch(t.key){case",":case"Enter":this.addOptionValue(),t.preventDefault();break;case"Backspace":this.lastSelected?(this.removeLastOption(),this.lastSelected=!1):""===this.input&&(this.lastSelected=!0);break;default:this.lastSelected=!1}}handleBlur(){this.isFocussed=!1,this.addOptionValue()}addOptionValue(){this.options=(0,Q.T)([...this.options,...this.parseInputIntoOptions(this.input)]),this.input="",this.onChangeFn(this.options)}parseInputIntoOptions(t){return t.split(/[,\n]/).map(t=>t.trim()).filter(t=>""!==t).map(t=>({name:t,locked:!1}))}removeLastOption(){this.options[this.options.length-1].locked||(this.options=this.options.slice(0,this.options.length-1))}}Ti.\u0275fac=function(t){return new(t||Ti)(o.Y36(o.sBO))},Ti.\u0275cmp=o.Xpm({type:Ti,selectors:[["vdr-option-value-input"]],viewQuery:function(t,e){if(1&t&&o.Gf(Hn,7),2&t){let t;o.iGM(t=o.CRH())&&(e.textArea=t.first)}},inputs:{groupName:"groupName"},features:[o._Bn([Pi])],decls:4,vars:5,consts:[[1,"input-wrapper",3,"click"],["class","chips",4,"ngIf"],[3,"ngModel","disabled","keyup","focus","blur","ngModelChange"],["textArea",""],[1,"chips"],[3,"icon","selected","locked","colorFrom","iconClick",4,"ngFor","ngForOf"],[3,"icon","colorFrom","iconClick"]],template:function(t,e){if(1&t){const t=o.EpF();o.TgZ(0,"div",0),o.NdJ("click",function(){return o.CHM(t),o.MAs(3).focus()}),o.YNc(1,Rn,2,1,"div",1),o.TgZ(2,"textarea",2,3),o.NdJ("keyup",function(t){return e.handleKey(t)})("focus",function(){return e.isFocussed=!0})("blur",function(){return e.handleBlur()})("ngModelChange",function(t){return e.input=t}),o.qZA(),o.qZA()}2&t&&(o.ekj("focus",e.isFocussed),o.xp6(1),o.Q6J("ngIf",0<e.options.length),o.xp6(1),o.Q6J("ngModel",e.input)("disabled",e.disabled))},directives:[S.O5,a.y_K,I.Fj,I.JJ,I.On,S.sg,a.Ywx],styles:[".input-wrapper[_ngcontent-%COMP%]{background-color:#fff;border-radius:3px!important;border:1px solid var(--color-grey-300)!important;cursor:text}.input-wrapper.focus[_ngcontent-%COMP%]{border-color:var(--color-primary-500)!important;box-shadow:0 0 1px 1px var(--color-primary-100)}.input-wrapper[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{padding:5px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{background-color:var(--color-component-bg-100)}vdr-chip[_ngcontent-%COMP%]     .wrapper{margin:0 3px}vdr-chip.locked[_ngcontent-%COMP%]{opacity:.8}vdr-chip.selected[_ngcontent-%COMP%]     .wrapper{border-color:var(--color-warning-500)!important;box-shadow:0 0 1px 1px var(--color-warning-400);opacity:.6}"]}),Ti.ctorParameters=()=>[{type:o.sBO}],Ti.propDecorators={groupName:[{type:o.IIB}],textArea:[{type:o.i9L,args:["textArea",{static:!0}]}]};class Fi{constructor(){this.updateVariantName=!0,this.codeInputTouched=!1}ngOnInit(){var t;const e=this.productOption.translations.find(t=>t.languageCode===this.activeLanguage);if(this.name=null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"",this.code=this.productOption.code,this.customFieldsForm=new I.cw({}),this.customFields){const t=e&&e.customFields||{};for(const e of this.customFields){const n=e.name,o="localeString"===e.type?t[n]:this.productOption.customFields[n];this.customFieldsForm.addControl(e.name,new I.NI(o))}}}update(){const t=(0,a.iSy)({translatable:this.productOption,languageCode:this.activeLanguage,updatedFields:{code:this.code,name:this.name,customFields:this.customFieldsForm.value},customFieldConfig:this.customFields,defaultTranslation:{languageCode:this.activeLanguage,name:""}});this.resolveWith(Object.assign(Object.assign({},t),{autoUpdate:this.updateVariantName}))}cancel(){this.resolveWith()}updateCode(t){!this.codeInputTouched&&!this.productOption.code&&(this.code=(0,N.U)(t,"-"))}}Fi.\u0275fac=function(t){return new(t||Fi)},Fi.\u0275cmp=o.Xpm({type:Fi,selectors:[["vdr-update-product-option-dialog"]],decls:16,vars:13,consts:[["vdrDialogTitle",""],["for","name",3,"label"],["id","name","type","text","required","",3,"ngModel","ngModelChange","input"],["nameInput","ngModel"],["for","code",3,"label"],["id","code","type","text","required","","pattern","[a-z0-9_-]+",3,"ngModel","ngModelChange"],["codeInput","ngModel"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[4,"ngIf"],["vdrDialogButtons",""],["entityName","ProductOption",3,"customFields","customFieldsFormGroup","readonly"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(o.YNc(0,Kn,2,3,"ng-template",0),o.TgZ(1,"vdr-form-field",1),o.ALo(2,"translate"),o.TgZ(3,"input",2,3),o.NdJ("ngModelChange",function(t){return e.name=t})("input",function(t){return e.updateCode(t.target.value)}),o.qZA(),o.qZA(),o.TgZ(5,"vdr-form-field",4),o.ALo(6,"translate"),o.TgZ(7,"input",5,6),o.NdJ("ngModelChange",function(t){return e.code=t}),o.qZA(),o.qZA(),o.TgZ(9,"clr-checkbox-wrapper"),o.TgZ(10,"input",7),o.NdJ("ngModelChange",function(t){return e.updateVariantName=t}),o.qZA(),o.TgZ(11,"label"),o._uU(12),o.ALo(13,"translate"),o.qZA(),o.qZA(),o.YNc(14,zn,6,9,"section",8),o.YNc(15,Wn,6,7,"ng-template",9)),2&t&&(o.xp6(1),o.Q6J("label",o.lcZ(2,7,"catalog.option-name")),o.xp6(2),o.Q6J("ngModel",e.name),o.xp6(2),o.Q6J("label",o.lcZ(6,9,"common.code")),o.xp6(2),o.Q6J("ngModel",e.code),o.xp6(3),o.Q6J("ngModel",e.updateVariantName),o.xp6(2),o.Oqu(o.lcZ(13,11,"catalog.auto-update-option-variant-name")),o.xp6(2),o.Q6J("ngIf",e.customFields.length))},directives:[a.q6K,a.hgI,a.y_K,I.Fj,I.Q7,I.JJ,I.On,I.c5,B.PEh,I.Wl,B.KKC,B.MgK,S.O5,a.nPI,a.yc0],pipes:[E.X$,a.j$k],styles:[""],changeDetection:0});class Ii{constructor(t,e,n){this.changeDetector=t,this.modalService=e,this.dataService=n,this.assignToChannel=new o.vpe,this.removeFromChannel=new o.vpe,this.assetChange=new o.vpe,this.selectionChange=new o.vpe,this.selectFacetValueClick=new o.vpe,this.updateProductOption=new o.vpe,this.selectedVariantIds=[],this.formGroupMap=new Map,this.GlobalFlag=a.TvZ,this.updatePermission=[a.y3$.UpdateCatalog,a.y3$.UpdateProduct]}ngOnInit(){this.dataService.settings.getGlobalSettings("cache-first").single$.subscribe(({globalSettings:t})=>{this.globalTrackInventory=t.trackInventory,this.globalOutOfStockThreshold=t.outOfStockThreshold,this.changeDetector.markForCheck()}),this.subscription=this.formArray.valueChanges.subscribe(()=>this.changeDetector.markForCheck()),this.subscription.add(this.formArray.valueChanges.pipe((0,d.U)(t=>t.length),(0,u.b)(1),(0,x.x)()).subscribe(()=>{this.buildFormGroupMap()})),this.buildFormGroupMap()}ngOnChanges(t){"facets"in t&&t.facets.currentValue&&(this.facetValues=(0,a.k2u)(this.facets))}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}isDefaultChannel(t){return t===D.z$}trackById(t,e){return e.id}inventoryIsNotTracked(t){var e;const n=null===(e=t.get("trackInventory"))||void 0===e?void 0:e.value;return n===a.TvZ.FALSE||n===a.TvZ.INHERIT&&!1===this.globalTrackInventory}getTaxCategoryName(t){const e=t.get(["taxCategoryId"]);if(e&&this.taxCategories){const t=this.taxCategories.find(t=>t.id===e.value);return t?t.name:""}return""}getStockOnHandMinValue(t){var e,n;return(null===(e=t.get("useGlobalOutOfStockThreshold"))||void 0===e?void 0:e.value)?this.globalOutOfStockThreshold:null===(n=t.get("outOfStockThreshold"))||void 0===n?void 0:n.value}getSaleableStockLevel(t){const e=t.useGlobalOutOfStockThreshold?this.globalOutOfStockThreshold:t.outOfStockThreshold;return t.stockOnHand-t.stockAllocated-e}areAllSelected(){return!!this.variants&&this.selectedVariantIds.length===this.variants.length}onAssetChange(t,e){this.assetChange.emit(Object.assign({variantId:t},e));const n=this.variants.findIndex(e=>e.id===t);this.formArray.at(n).markAsDirty()}toggleSelectAll(){this.areAllSelected()?this.selectedVariantIds=[]:this.selectedVariantIds=this.variants.map(t=>t.id),this.selectionChange.emit(this.selectedVariantIds)}toggleSelectVariant(t){const e=this.selectedVariantIds.indexOf(t);-1<e?this.selectedVariantIds.splice(e,1):this.selectedVariantIds.push(t),this.selectionChange.emit(this.selectedVariantIds)}optionGroupName(t){var e;const n=this.optionGroups.find(e=>e.id===t);if(n)return(null!==(e=null==n?void 0:n.translations.find(t=>t.languageCode===this.activeLanguage))&&void 0!==e?e:n.translations[0]).name}optionName(t){var e;return(null!==(e=t.translations.find(t=>t.languageCode===this.activeLanguage))&&void 0!==e?e:t.translations[0]).name}pendingFacetValues(t){if(this.facets){const e=this.getFacetValueIds(t.id),n=t.facetValues.map(t=>t.id);return e.filter(t=>!n.includes(t)).map(t=>this.facetValues.find(e=>e.id===t)).filter(V.notNullOrUndefined)}return[]}existingFacetValues(t){return[...this.getFacetValueIds(t.id)].filter(e=>t.facetValues.map(t=>t.id).includes(e)).map(e=>t.facetValues.find(t=>t.id===e)).filter(V.notNullOrUndefined)}removeFacetValue(t,e){const n=this.formGroupMap.get(t.id);if(n){const t=n.value.facetValueIds.filter(t=>t!==e);n.patchValue({facetValueIds:t}),n.markAsDirty()}}isVariantSelected(t){return-1<this.selectedVariantIds.indexOf(t)}editOption(t){this.modalService.fromComponent(Fi,{size:"md",locals:{productOption:t,activeLanguage:this.activeLanguage,customFields:this.customOptionFields}}).subscribe(t=>{t&&this.updateProductOption.emit(t)})}buildFormGroupMap(){this.formGroupMap.clear();for(const t of this.formArray.controls)this.formGroupMap.set(t.value.id,t);this.changeDetector.markForCheck()}getFacetValueIds(t){var e;return(null===(e=this.formGroupMap.get(t))||void 0===e?void 0:e.value).facetValueIds}}Ii.\u0275fac=function(t){return new(t||Ii)(o.Y36(o.sBO),o.Y36(a.Z7U),o.Y36(a.DoR))},Ii.\u0275cmp=o.Xpm({type:Ii,selectors:[["vdr-product-variants-list"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",paginationConfig:"paginationConfig",channelPriceIncludesTax:"channelPriceIncludesTax",taxCategories:"taxCategories",facets:"facets",optionGroups:"optionGroups",customFields:"customFields",customOptionFields:"customOptionFields",activeLanguage:"activeLanguage",pendingAssetChanges:"pendingAssetChanges"},outputs:{assignToChannel:"assignToChannel",removeFromChannel:"removeFromChannel",assetChange:"assetChange",selectionChange:"selectionChange",selectFacetValueClick:"selectFacetValueClick",updateProductOption:"updateProductOption"},features:[o.TTD],decls:3,vars:6,consts:[[1,"variants-list"],["class","variant-container card",3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"variant-container","card"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"card-block","header-row"],[1,"details"],[1,"sku",3,"readonly"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"name",3,"readonly"],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],[1,"right-controls"],[4,"vdrIfPermissions"],[1,"card-block"],[1,"variant-body"],[1,"assets"],[3,"compact","assets","featuredAsset","updatePermissions","change"],[1,"variant-form-inputs"],[1,"standard-fields"],[1,"variant-form-input-row"],[1,"tax-category"],[4,"vdrIfPermissions","vdrIfPermissionsElse"],["taxCategoryLabel",""],[1,"price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[3,"price","currencyCode","priceIncludesTax","taxCategoryId"],[3,"content"],["clrInput","","type","number","step","1","formControlName","stockOnHand",3,"min","readonly","vdrDisabled"],[1,"clr-control-label"],[1,"value"],[1,"out-of-stock-threshold-wrapper"],[1,"flex"],["clrInput","","type","number",3,"formControl","readonly","vdrDisabled"],["type","checkbox","clrToggle","","name","useGlobalOutOfStockThreshold","formControlName","useGlobalOutOfStockThreshold",3,"vdrDisabled"],[1,"custom-fields"],["formGroupName","customFields",4,"ngIf"],[1,"options-facets"],[3,"entity"],[4,"ngIf"],[1,"flex-spacer"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[4,"vdrIfMultichannel"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled"],["clrSelect","","name","options","formControlName","taxCategoryId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"tax-category-label"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"],["clrSelect","","name","options","formControlName","trackInventory"],["formGroupName","customFields"],["entityName","ProductVariant",3,"customFields","compact","customFieldsFormGroup","readonly"],[1,"options"],[3,"colorFrom","invert","icon","iconClick",4,"ngFor","ngForOf"],[1,"btn","btn-link","btn-sm",3,"routerLink"],[3,"colorFrom","invert","icon","iconClick"],[1,"option-group-name"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],["class","card-block",4,"vdrIfDefaultChannelActive"],[1,"flex","channel-assignment"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"title","iconClick",4,"ngIf"],["icon","times-circle",3,"title","iconClick"],[3,"channelCode"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.YNc(1,xo,2,3,"div",1),o.ALo(2,"paginate"),o.qZA()),2&t&&(o.xp6(1),o.Q6J("ngForOf",o.xi3(2,2,e.variants,e.paginationConfig||o.DdM(5,Co)))("ngForTrackBy",e.trackById))},directives:function(){return[S.sg,B.q0d,S.O5,I.JL,I.sg,a.G3C,B.G55,a.y_K,I.Fj,B.xRP,I.JJ,I.u,a.HAh,vi,B.MgK,qi,a.opf,I.wV,I.qQ,a.x3T,I.oH,B.PEh,I.Wl,B.KKC,a.Vqt,a.uKX,B.dTv,I.EJ,B.otW,I.YN,I.Kr,a.KQz,I.x0,a.yc0,i.yS,a.Ywx,a.qt4,B.qvL,a.Moo,a.nIZ]},pipes:function(){return[H._s,a.j$k,E.X$,a.UwE,a.E6B]},styles:[".with-selected[_ngcontent-%COMP%]{display:flex;min-height:52px;align-items:center;border:1px solid var(--color-component-border-100);border-radius:3px;padding:6px 18px}.with-selected[_ngcontent-%COMP%]   vdr-select-toggle[_ngcontent-%COMP%]{margin-right:12px}.with-selected[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]{transition:background-color .2s;min-height:330px}.variant-container.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.variant-container[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;margin-right:12px}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex-direction:row;height:36px}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container{width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container input.clr-input{min-width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .sku[_ngcontent-%COMP%]{width:160px;margin-right:20px;flex:0}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]     .name input{min-width:300px}.variant-container[_ngcontent-%COMP%]   .right-controls[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .tax-category-label[_ngcontent-%COMP%]{margin-top:3px}.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{margin:0 6px 8px 24px}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:24px;margin-bottom:24px}.variant-container[_ngcontent-%COMP%]   .track-inventory-toggle[_ngcontent-%COMP%]{margin-top:22px}.variant-container[_ngcontent-%COMP%]   .clr-form-control[_ngcontent-%COMP%]{margin-top:0}.variant-container[_ngcontent-%COMP%]   .facets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]   .option-group-name[_ngcontent-%COMP%]{color:var(--color-text-200);text-transform:uppercase;font-size:10px;margin-right:3px;height:11px}.variant-container[_ngcontent-%COMP%]   .options-facets[_ngcontent-%COMP%]{display:flex;color:var(--color-grey-400)}.variant-container[_ngcontent-%COMP%]     .clr-control-container{width:100%}.channel-assignment[_ngcontent-%COMP%]{justify-content:flex-end;flex-wrap:wrap;max-height:110px;overflow-y:auto}.channel-assignment[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:6px 12px 6px 0}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-left:24px}.inventory-untracked[_ngcontent-%COMP%]{opacity:.5}"],changeDetection:0}),Ii.ctorParameters=()=>[{type:o.sBO},{type:a.Z7U},{type:a.DoR}],Ii.propDecorators={formArray:[{type:o.IIB,args:["productVariantsFormArray"]}],variants:[{type:o.IIB}],paginationConfig:[{type:o.IIB}],channelPriceIncludesTax:[{type:o.IIB}],taxCategories:[{type:o.IIB}],facets:[{type:o.IIB}],optionGroups:[{type:o.IIB}],customFields:[{type:o.IIB}],customOptionFields:[{type:o.IIB}],activeLanguage:[{type:o.IIB}],pendingAssetChanges:[{type:o.IIB}],assignToChannel:[{type:o.r_U}],removeFromChannel:[{type:o.r_U}],assetChange:[{type:o.r_U}],selectionChange:[{type:o.r_U}],selectFacetValueClick:[{type:o.r_U}],updateProductOption:[{type:o.r_U}]};class Oi{constructor(t){this.changeDetector=t,this.formGroupMap=new Map,this.updatePermission=[a.y3$.UpdateCatalog,a.y3$.UpdateProduct]}ngOnInit(){this.subscription=this.formArray.valueChanges.pipe((0,d.U)(t=>t.length),(0,u.b)(1),(0,x.x)()).subscribe(()=>{this.buildFormGroupMap()}),this.buildFormGroupMap()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}trackByFn(t,e){return null!=e.id?e.id:t}getFeaturedAsset(t){var e;return(null===(e=this.pendingAssetChanges[t.id])||void 0===e?void 0:e.featuredAsset)||t.featuredAsset}optionGroupName(t){const e=this.optionGroups.find(e=>e.id===t);return e&&e.name}buildFormGroupMap(){this.formGroupMap.clear();for(const t of this.formArray.controls)this.formGroupMap.set(t.value.id,t);this.changeDetector.markForCheck()}}Oi.\u0275fac=function(t){return new(t||Oi)(o.Y36(o.sBO))},Oi.\u0275cmp=o.Xpm({type:Oi,selectors:[["vdr-product-variants-table"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",paginationConfig:"paginationConfig",channelPriceIncludesTax:"channelPriceIncludesTax",optionGroups:"optionGroups",pendingAssetChanges:"pendingAssetChanges"},decls:24,vars:24,consts:[[1,"table"],[4,"ngFor","ngForOf"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"left","align-middle"],[1,"card-img"],[1,"featured-asset"],[3,"src",4,"ngIf","ngIfElse"],["placeholder",""],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"left","align-middle","price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[1,"left","align-middle","stock"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled",3,"vdrDisabled"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"]],template:function(t,e){1&t&&(o.TgZ(0,"table",0),o.TgZ(1,"thead"),o.TgZ(2,"tr"),o._UZ(3,"th"),o.TgZ(4,"th"),o._uU(5),o.ALo(6,"translate"),o.qZA(),o.TgZ(7,"th"),o._uU(8),o.ALo(9,"translate"),o.qZA(),o.YNc(10,bo,3,1,"ng-container",1),o.ALo(11,"sort"),o.TgZ(12,"th"),o._uU(13),o.ALo(14,"translate"),o.qZA(),o.TgZ(15,"th"),o._uU(16),o.ALo(17,"translate"),o.qZA(),o.TgZ(18,"th"),o._uU(19),o.ALo(20,"translate"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(21,"tbody"),o.YNc(22,Oo,2,1,"tr",2),o.ALo(23,"paginate"),o.qZA(),o.qZA()),2&t&&(o.xp6(5),o.Oqu(o.lcZ(6,8,"common.name")),o.xp6(3),o.Oqu(o.lcZ(9,10,"catalog.sku")),o.xp6(2),o.Q6J("ngForOf",o.xi3(11,12,e.optionGroups,"id")),o.xp6(3),o.Oqu(o.lcZ(14,15,"catalog.price")),o.xp6(3),o.Oqu(o.lcZ(17,17,"catalog.stock-on-hand")),o.xp6(3),o.Oqu(o.lcZ(20,19,"common.enabled")),o.xp6(3),o.Q6J("ngForOf",o.xi3(23,21,e.variants,e.paginationConfig))("ngForTrackBy",e.trackByFn))},directives:[S.sg,B.q0d,S.O5,I.JL,I.sg,B.G55,a.y_K,I.Fj,B.xRP,I.JJ,I.u,I.qQ,I.wV,B.PEh,I.Wl,B.KKC,a.x3T,B.qvL,a.KQz],pipes:[E.X$,a.UwE,H._s,a.j$k,a.Mgf,a.si9],styles:[".placeholder[_ngcontent-%COMP%]{color:var(--color-grey-300)}.stock[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .price[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:96px}td[_ngcontent-%COMP%]{transition:background-color .2s}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"],changeDetection:0}),Oi.ctorParameters=()=>[{type:o.sBO}],Oi.propDecorators={formArray:[{type:o.IIB,args:["productVariantsFormArray"]}],variants:[{type:o.IIB}],paginationConfig:[{type:o.IIB}],channelPriceIncludesTax:[{type:o.IIB}],optionGroups:[{type:o.IIB}],pendingAssetChanges:[{type:o.IIB}]};class qi{constructor(t){this.dataService=t,this.priceChange$=new O.X(0),this.taxCategoryIdChange$=new O.X("")}ngOnInit(){const t=this.dataService.settings.getTaxRatesSimple(999,0,"cache-first").mapStream(t=>t.taxRates.items),e=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(t=>t.activeChannel);this.taxRate$=(0,q.aj)(e,t,this.taxCategoryIdChange$).pipe((0,d.U)(([t,e,n])=>{const o=t.defaultTaxZone;if(!o)return 0;const i=e.find(t=>t.zone.id===o.id&&t.category.id===n);return i?i.value:0})),this.grossPrice$=(0,q.aj)(this.taxRate$,this.priceChange$).pipe((0,d.U)(([t,e])=>Math.round(e*((100+t)/100))))}ngOnChanges(t){"price"in t&&this.priceChange$.next(t.price.currentValue),"taxCategoryId"in t&&this.taxCategoryIdChange$.next(t.taxCategoryId.currentValue)}}qi.\u0275fac=function(t){return new(t||qi)(o.Y36(a.DoR))},qi.\u0275cmp=o.Xpm({type:qi,selectors:[["vdr-variant-price-detail"]],inputs:{priceIncludesTax:"priceIncludesTax",price:"price",currencyCode:"currencyCode",taxCategoryId:"taxCategoryId"},features:[o.TTD],decls:5,vars:5,consts:[[1,"clr-control-label"],["class","value",4,"ngIf"],[1,"value"]],template:function(t,e){1&t&&(o.TgZ(0,"label",0),o._uU(1),o.ALo(2,"translate"),o.qZA(),o.YNc(3,wo,4,8,"div",1),o.YNc(4,ko,6,14,"div",1)),2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,3,"catalog.taxes")),o.xp6(2),o.Q6J("ngIf",e.priceIncludesTax),o.xp6(1),o.Q6J("ngIf",!e.priceIncludesTax))},directives:[B.MgK,S.O5],pipes:[E.X$,S.Ov,a.kgx],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.value[_ngcontent-%COMP%]{margin-top:3px}"],changeDetection:0}),qi.ctorParameters=()=>[{type:a.DoR}],qi.propDecorators={priceIncludesTax:[{type:o.IIB}],price:[{type:o.IIB}],currencyCode:[{type:o.IIB}],taxCategoryId:[{type:o.IIB}]};class wi{}wi.\u0275fac=function(t){return new(t||wi)},wi.\u0275mod=o.oAB({type:wi}),wi.\u0275inj=o.cJS({imports:[[a.m81,i.Bz.forChild(di)]]})}}]);
//# sourceMappingURL=122-es2015.b3ed4dfa90fcce2a4679.js.map