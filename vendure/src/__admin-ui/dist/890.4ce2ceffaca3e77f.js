"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[890],{5890:(x,m,a)=>{a.r(m),a.d(m,{OrderExportModule:()=>c});var f=a(4285),i=a(1767),p=a(6642),v=a(9248),t=a(6108),n=a(5086),d=a(2977),g=a(8046),b=a(1317);function Z(h,r){if(1&h&&(t.TgZ(0,"option",8),t._uU(1),t.qZA()),2&h){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}class l{constructor(r,e,o,s,u){this.formBuilder=r,this.dataService=e,this.changeDetector=o,this.notificationService=s,this.localStorageService=u,this.strategies=[],this.form=this.formBuilder.group({startsAt:null,endsAt:null,strategy:null}),this.serverPath=(0,i.VC)()}ngOnInit(){this.dataService.query(v.ZP`
          query availableOrderExportStrategies {
            availableOrderExportStrategies
          }
        `).single$.subscribe(r=>{this.strategies=r.availableOrderExportStrategies,this.form.controls.strategy.setValue(this.strategies?.[0])})}download(){var r=this;return(0,p.Z)(function*(){try{const e=yield fetch(`${r.serverPath}/export-orders/export/${r.form.value.strategy}?startDate=${r.form.value.startsAt}&endDate=${r.form.value.endsAt}`,{headers:r.getHeaders()});if(!e.ok){const A=yield e.json();throw Error(A?.message)}const u=e.headers.get("Content-Disposition").split(";")[1].split("=")[1],y=yield e.blob();yield r.downloadBlob(y,u)}catch(e){console.error(e),r.notificationService.error(e.message)}})()}getHeaders(){const r={},e=this.localStorageService.get("activeChannelToken");e&&(r["vendure-token"]=e);const o=this.localStorageService.get("authToken");return o&&(r.authorization=`Bearer ${o}`),r}downloadBlob(r,e){return(0,p.Z)(function*(){const o=window.URL.createObjectURL(r),s=document.createElement("a");document.body.appendChild(s),s.setAttribute("hidden","true"),s.href=o,s.download=e,s.setAttribute("target","_blank"),s.click()})()}static#t=this.\u0275fac=function(e){return new(e||l)(t.Y36(n.qu),t.Y36(i.DoR),t.Y36(t.sBO),t.Y36(i.gqp),t.Y36(i.n2A))};static#e=this.\u0275cmp=t.Xpm({type:l,selectors:[["order-export-component"]],decls:24,vars:9,consts:[["id","export-form",1,"form",3,"formGroup"],[1,"form-block"],[1,"flex"],["required","","timeGranularityInterval","60","formControlName","startsAt"],["required","","timeGranularityInterval","60","formControlName","endsAt"],["clrSelect","","name","options","formControlName","strategy","required",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"disabled","click"],[3,"value"]],template:function(e,o){1&e&&(t.TgZ(0,"h1"),t._uU(1,"Export orders"),t.qZA(),t.TgZ(2,"form",0)(3,"section",1)(4,"div",2)(5,"div")(6,"label"),t._uU(7),t.ALo(8,"translate"),t.qZA(),t._UZ(9,"vdr-datetime-picker",3),t.qZA(),t.TgZ(10,"div")(11,"label"),t._uU(12),t.ALo(13,"translate"),t.qZA(),t._UZ(14,"vdr-datetime-picker",4),t.qZA()(),t._UZ(15,"br"),t.TgZ(16,"clr-select-container")(17,"label"),t._uU(18,"Export as"),t.qZA(),t.TgZ(19,"select",5),t.YNc(20,Z,2,2,"option",6),t.qZA()(),t._UZ(21,"br"),t.TgZ(22,"button",7),t.NdJ("click",function(){return o.download()}),t._uU(23," Export "),t.qZA()()()),2&e&&(t.xp6(2),t.Q6J("formGroup",o.form),t.xp6(5),t.Oqu(t.lcZ(8,5,"order.placed-at-start")),t.xp6(5),t.Oqu(t.lcZ(13,7,"order.placed-at-end")),t.xp6(8),t.Q6J("ngForOf",o.strategies),t.xp6(2),t.Q6J("disabled",o.form.invalid||o.form.pristine))},dependencies:[d.MgK,d.otW,d.dTv,g.sg,n._Y,n.YN,n.Kr,n.EJ,n.JJ,n.JL,n.Q7,n.sg,n.u,i.y_K,i.IPv,b.X$],encapsulation:2})}class c{static#t=this.\u0275fac=function(e){return new(e||c)};static#e=this.\u0275mod=t.oAB({type:c});static#r=this.\u0275inj=t.cJS({imports:[i.m81,f.Bz.forChild([{path:"",pathMatch:"full",component:l,data:{breadcrumb:"Export orders"}}])]})}}}]);
//# sourceMappingURL=890.4ce2ceffaca3e77f.js.map