!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var c,a,i=[],r=!0,o=!1;try{for(n=n.call(e);!(r=(c=n.next()).done)&&(i.push(c.value),!t||i.length!==t);r=!0);}catch(s){o=!0,a=s}finally{try{r||null==n.return||n.return()}finally{if(o)throw a}}return i}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,n,c){return(t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var c=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(c){var a=Object.getOwnPropertyDescriptor(c,t);return a.get?a.get.call(n):a.value}})(e,n,c||e)}function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var c=0,a=function(){};return{s:a,n:function(){return c>=e.length?{done:!0}:{done:!1,value:e[c++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,c=new Array(t);n<t;n++)c[n]=e[n];return c}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,c=p(e);if(t){var a=p(this).constructor;n=Reflect.construct(c,arguments,a)}else n=c.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?d(e):t}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var c=t[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function m(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{FGij:function(i,r,s){"use strict";s.r(r),s.d(r,"ApplyFacetDialogComponent",function(){return sa}),s.d(r,"AssetDetailComponent",function(){return Kc}),s.d(r,"AssetListComponent",function(){return ea}),s.d(r,"AssetResolver",function(){return ba}),s.d(r,"AssignProductsToChannelDialogComponent",function(){return la}),s.d(r,"CatalogModule",function(){return Ja}),s.d(r,"CollectionContentsComponent",function(){return ta}),s.d(r,"CollectionDetailComponent",function(){return na}),s.d(r,"CollectionListComponent",function(){return ca}),s.d(r,"CollectionResolver",function(){return ha}),s.d(r,"CollectionTreeComponent",function(){return La}),s.d(r,"CollectionTreeNodeComponent",function(){return Ea}),s.d(r,"ConfirmVariantDeletionDialogComponent",function(){return ga}),s.d(r,"FacetDetailComponent",function(){return aa}),s.d(r,"FacetListComponent",function(){return ia}),s.d(r,"FacetResolver",function(){return ya}),s.d(r,"GenerateProductVariantsComponent",function(){return qa}),s.d(r,"GeneratedVariant",function(){return ma}),s.d(r,"OPTION_VALUE_INPUT_VALUE_ACCESSOR",function(){return Na}),s.d(r,"OptionValueInputComponent",function(){return Ga}),s.d(r,"ProductAssetsComponent",function(){return Wa}),s.d(r,"ProductDetailComponent",function(){return ua}),s.d(r,"ProductDetailService",function(){return oa}),s.d(r,"ProductListComponent",function(){return fa}),s.d(r,"ProductResolver",function(){return Ca}),s.d(r,"ProductSearchInputComponent",function(){return pa}),s.d(r,"ProductVariantsEditorComponent",function(){return va}),s.d(r,"ProductVariantsListComponent",function(){return Ba}),s.d(r,"ProductVariantsResolver",function(){return Oa}),s.d(r,"ProductVariantsTableComponent",function(){return Ra}),s.d(r,"UpdateProductOptionDialogComponent",function(){return Ua}),s.d(r,"VariantPriceDetailComponent",function(){return Ha}),s.d(r,"arrayToTree",function(){return _a}),s.d(r,"assetBreadcrumb",function(){return $a}),s.d(r,"catalogRoutes",function(){return Ta}),s.d(r,"collectionBreadcrumb",function(){return Aa}),s.d(r,"facetBreadcrumb",function(){return Da}),s.d(r,"productBreadcrumb",function(){return wa}),s.d(r,"productVariantEditorBreadcrumb",function(){return za}),s.d(r,"replaceLast",function(){return ra}),s.d(r,"\u02750",function(){return ja}),s.d(r,"\u02751",function(){return ka}),s.d(r,"\u02752",function(){return Pa}),s.d(r,"\u02753",function(){return Sa}),s.d(r,"\u02754",function(){return Ia}),s.d(r,"\u02755",function(){return Fa}),s.d(r,"\u02756",function(){return Va}),s.d(r,"\u02757",function(){return xa}),s.d(r,"\u02758",function(){return Ma});var u=s("EM62"),g=s("sEIs"),v=s("ixhn"),b=s("OxKu"),h=s("YtkY"),y=s("mWib"),C=s("kuMc"),O=s("ruxD"),j=s("TLy2"),k=s("jIqt"),P=s("Ohay"),S=s("8j5Y"),I=s("J+dc"),F=s("cJ9h"),V=s("wqq/"),x=s("7SLS"),M=s("pBDD"),T=s("mW0F");function w(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var n;"function"==typeof t[t.length-1]&&(n=t.pop());var c=t;return e.lift(new z(c,n))}}var z=function(){function e(t,n){f(this,e),this.observables=t,this.project=n}return m(e,[{key:"call",value:function(e,t){return t.subscribe(new D(e,this.observables,this.project))}}]),e}(),D=function(e){o(n,e);var t=l(n);function n(e,c,a){var i;f(this,n),(i=t.call(this,e)).observables=c,i.project=a,i.toRespond=[];var r=c.length;i.values=new Array(r);for(var o=0;o<r;o++)i.toRespond.push(o);for(var s=0;s<r;s++){var l=c[s];i.add(Object(T.a)(d(i),l,void 0,s))}return i}return m(n,[{key:"notifyNext",value:function(e,t,n){this.values[n]=t;var c=this.toRespond;if(c.length>0){var a=c.indexOf(n);-1!==a&&c.splice(a,1)}}},{key:"notifyComplete",value:function(){}},{key:"_next",value:function(e){if(0===this.toRespond.length){var t=[e].concat(a(this.values));this.project?this._tryProject(t):this.destination.next(t)}}},{key:"_tryProject",value:function(e){var t;try{t=this.project.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(M.a),A=s("BwBJ"),$=s("xVbo"),_=s("nIj0"),L=s("C05f"),E=s("HM3f"),q=s("6Oco"),N=s("ZTXN"),G=s("ROBh"),W=s("P4Xx"),X=s("47ST"),U=s("GoAz"),B=s("g6G6"),R=s("hbhS"),H=s("hG4v"),J=s("2kYt"),Q=s("Ui7s"),Z=s("qzMg"),Y=s("D57K"),K=s("jY47"),ee=s("GZLE"),te=s("oqI+"),ne=s("qvOF"),ce=s("s2Ay"),ae=s("iNDR"),ie=s("Kej3");function re(e,t){if(1&e){var n=u.kc();u.jc(0,"button",4),u.qc("click",function(){return u.Mc(n),u.sc().save()}),u.Vc(1),u.tc(2,"translate"),u.ic()}if(2&e){var c=u.sc();u.zc("disabled",c.detailForm.invalid||c.detailForm.pristine),u.Sb(1),u.Xc(" ",u.uc(2,2,"common.update")," ")}}var oe=function(){return["UpdateCatalog","UpdateAsset"]},se=function(){return{}},le=function(){return["DeleteCatalog","DeleteAsset"]};function ue(e,t){1&e&&u.fc(0)}var de=function(){return{tab:"variants"}},pe=function(e,t){return["/catalog/products",e,t]};function fe(e,t){if(1&e&&(u.jc(0,"td",5),u.Vc(1),u.ic(),u.jc(2,"td",6),u.ec(3,"vdr-table-row-action",7),u.tc(4,"translate"),u.ic()),2&e){var n=t.item;u.Sb(1),u.Wc(n.name),u.Sb(2),u.zc("label",u.uc(4,3,"common.edit"))("linkTo",u.Ec(6,pe,n.productId,u.Cc(5,de)))}}var ge=function(e){return{$implicit:e}},me=["collectionContents"];function ve(e,t){if(1&e){var n=u.kc();u.jc(0,"button",6),u.qc("click",function(){return u.Mc(n),u.sc().create()}),u.Vc(1),u.tc(2,"translate"),u.ic()}if(2&e){var c=u.sc();u.zc("disabled",c.detailForm.invalid||c.detailForm.pristine),u.Sb(1),u.Xc(" ",u.uc(2,2,"common.create")," ")}}function be(e,t){if(1&e){var n=u.kc();u.jc(0,"button",6),u.qc("click",function(){return u.Mc(n),u.sc(2).save()}),u.Vc(1),u.tc(2,"translate"),u.ic()}if(2&e){var c=u.sc(2);u.zc("disabled",(c.detailForm.invalid||c.detailForm.pristine)&&!c.assetsChanged()),u.Sb(1),u.Xc(" ",u.uc(2,2,"common.update")," ")}}function he(e,t){if(1&e&&u.Tc(0,be,3,4,"button",7),2&e){var n=u.sc();u.zc("vdrIfPermissions",n.updatePermission)}}function ye(e,t){1&e&&(u.hc(0),u.Vc(1),u.tc(2,"translate"),u.gc()),2&e&&(u.Sb(1),u.Wc(u.uc(2,1,"catalog.public")))}function Ce(e,t){1&e&&(u.Vc(0),u.tc(1,"translate")),2&e&&u.Wc(u.uc(1,1,"catalog.private"))}var Oe=function(){return["customFields"]};function je(e,t){if(1&e&&u.ec(0,"vdr-custom-field-control",31),2&e){var n=u.sc().$implicit,c=u.sc(3);u.zc("customFieldsFormGroup",c.detailForm.get(u.Cc(2,Oe)))("customField",n)}}function ke(e,t){if(1&e&&(u.hc(0),u.Tc(1,je,1,3,"vdr-custom-field-control",30),u.gc()),2&e){var n=t.$implicit,c=u.sc(3);u.Sb(1),u.zc("ngIf",c.customFieldIsSet(n.name))}}function Pe(e,t){if(1&e&&(u.jc(0,"section",29),u.jc(1,"label"),u.Vc(2),u.tc(3,"translate"),u.ic(),u.Tc(4,ke,2,1,"ng-container",25),u.ic()),2&e){var n=u.sc(2);u.Sb(2),u.Wc(u.uc(3,2,"common.custom-fields")),u.Sb(2),u.zc("ngForOf",n.customFields)}}function Se(e,t){if(1&e){var n=u.kc();u.hc(0),u.jc(1,"vdr-configurable-input",32),u.qc("remove",function(e){return u.Mc(n),u.sc(2).removeFilter(e)}),u.tc(2,"hasPermission"),u.ic(),u.gc()}if(2&e){var c=t.$implicit,a=t.index,i=u.sc(2);u.Sb(1),u.zc("operation",c)("operationDefinition",i.getFilterDefinition(c))("formControlName",a)("readonly",!u.uc(2,4,i.updatePermission))}}function Ie(e,t){if(1&e){var n=u.kc();u.jc(0,"button",37),u.qc("click",function(){u.Mc(n);var e=t.$implicit;return u.sc(3).addFilter(e)}),u.Vc(1),u.ic()}if(2&e){var c=t.$implicit;u.Sb(1),u.Xc(" ",c.description," ")}}function Fe(e,t){if(1&e&&(u.jc(0,"div"),u.jc(1,"vdr-dropdown"),u.jc(2,"button",33),u.ec(3,"clr-icon",34),u.Vc(4),u.tc(5,"translate"),u.ic(),u.jc(6,"vdr-dropdown-menu",35),u.Tc(7,Ie,2,1,"button",36),u.ic(),u.ic(),u.ic()),2&e){var n=u.sc(2);u.Sb(4),u.Xc(" ",u.uc(5,2,"marketing.add-condition")," "),u.Sb(3),u.zc("ngForOf",n.allFilters)}}var Ve=function(e){return{count:e}};function xe(e,t){if(1&e&&(u.jc(0,"div",38),u.Vc(1),u.tc(2,"translate"),u.tc(3,"translate"),u.ic()),2&e){var n=t.$implicit;u.Sb(1),u.Yc(" ",u.uc(2,2,"catalog.collection-contents")," (",u.vc(3,4,"common.results-count",u.Dc(7,Ve,n)),") ")}}var Me=function(e){return{pattern:e}};function Te(e,t){if(1&e){var n=u.kc();u.jc(0,"form",8),u.jc(1,"div",9),u.jc(2,"div",10),u.jc(3,"vdr-form-field",11),u.tc(4,"translate"),u.jc(5,"clr-toggle-wrapper"),u.ec(6,"input",12),u.tc(7,"hasPermission"),u.jc(8,"label",13),u.Tc(9,ye,3,3,"ng-container",14),u.Tc(10,Ce,2,3,"ng-template",null,15,u.Uc),u.ic(),u.ic(),u.ic(),u.jc(12,"vdr-form-field",16),u.tc(13,"translate"),u.jc(14,"input",17),u.qc("input",function(e){return u.Mc(n),u.sc().updateSlug(e.target.value)}),u.tc(15,"hasPermission"),u.ic(),u.ic(),u.jc(16,"vdr-form-field",18),u.tc(17,"translate"),u.tc(18,"translate"),u.ec(19,"input",19),u.tc(20,"hasPermission"),u.ic(),u.ec(21,"vdr-rich-text-editor",20),u.tc(22,"hasPermission"),u.tc(23,"translate"),u.Tc(24,Pe,5,4,"section",21),u.ic(),u.jc(25,"div",22),u.jc(26,"vdr-product-assets",23),u.qc("change",function(e){return u.Mc(n),u.sc().assetChanges=e}),u.ic(),u.ic(),u.ic(),u.jc(27,"div",24),u.jc(28,"div",10),u.jc(29,"label"),u.Vc(30),u.tc(31,"translate"),u.ic(),u.Tc(32,Se,3,6,"ng-container",25),u.Tc(33,Fe,8,4,"div",26),u.ic(),u.jc(34,"div",10),u.jc(35,"vdr-collection-contents",27,28),u.Tc(37,xe,4,9,"ng-template"),u.ic(),u.ic(),u.ic(),u.ic()}if(2&e){var c=t.ngIf,a=u.Jc(11),i=u.sc();u.zc("formGroup",i.detailForm),u.Sb(3),u.zc("label",u.uc(4,19,"catalog.visibility")),u.Sb(3),u.zc("vdrDisabled",!u.uc(7,21,i.updatePermission)),u.Sb(3),u.zc("ngIf",i.detailForm.value.visible)("ngIfElse",a),u.Sb(3),u.zc("label",u.uc(13,23,"common.name")),u.Sb(2),u.zc("readonly",!u.uc(15,25,i.updatePermission)),u.Sb(2),u.zc("label",u.uc(17,27,"catalog.slug"))("errors",u.Dc(39,Me,u.uc(18,29,"catalog.slug-pattern-error"))),u.Sb(3),u.zc("readonly",!u.uc(20,31,i.updatePermission)),u.Sb(2),u.zc("readonly",!u.uc(22,33,i.updatePermission))("label",u.uc(23,35,"common.description")),u.Sb(3),u.zc("ngIf",i.customFields.length),u.Sb(2),u.zc("assets",c.assets)("featuredAsset",c.featuredAsset),u.Sb(4),u.Wc(u.uc(31,37,"catalog.filters")),u.Sb(2),u.zc("ngForOf",i.filters),u.Sb(1),u.zc("vdrIfPermissions",i.updatePermission),u.Sb(2),u.zc("collectionId",i.id)}}var we=function(){return["./create"]};function ze(e,t){1&e&&(u.jc(0,"a",10),u.ec(1,"clr-icon",11),u.Vc(2),u.tc(3,"translate"),u.ic()),2&e&&(u.zc("routerLink",u.Cc(4,we)),u.Sb(2),u.Xc(" ",u.uc(3,2,"catalog.create-new-collection")," "))}function De(e,t){if(1&e){var n=u.kc();u.jc(0,"div",12),u.Vc(1),u.tc(2,"async"),u.tc(3,"translate"),u.ic(),u.jc(4,"button",13),u.qc("click",function(){return u.Mc(n),u.sc().closeContents()}),u.ec(5,"clr-icon",14),u.ic()}if(2&e){var c=t.$implicit,a=u.sc();u.Sb(1),u.Yc(" ",u.uc(2,2,a.activeCollectionTitle$)," (",u.vc(3,4,"common.results-count",u.Dc(7,Ve,c)),") ")}}var Ae=function(){return["CreateCatalog","CreateCollection"]};function $e(e,t){if(1&e){var n=u.kc();u.jc(0,"button",6),u.qc("click",function(){return u.Mc(n),u.sc().create()}),u.Vc(1),u.tc(2,"translate"),u.ic()}if(2&e){var c=u.sc();u.zc("disabled",c.detailForm.invalid||c.detailForm.pristine),u.Sb(1),u.Xc(" ",u.uc(2,2,"common.create")," ")}}function _e(e,t){if(1&e){var n=u.kc();u.jc(0,"button",6),u.qc("click",function(){return u.Mc(n),u.sc(2).save()}),u.Vc(1),u.tc(2,"translate"),u.ic()}if(2&e){var c=u.sc(2);u.zc("disabled",c.detailForm.invalid||c.detailForm.pristine),u.Sb(1),u.Xc(" ",u.uc(2,2,"common.update")," ")}}function Le(e,t){if(1&e&&u.Tc(0,_e,3,4,"button",7),2&e){var n=u.sc();u.zc("vdrIfPermissions",n.updatePermission)}}function Ee(e,t){1&e&&(u.hc(0),u.Vc(1),u.tc(2,"translate"),u.gc()),2&e&&(u.Sb(1),u.Wc(u.uc(2,1,"catalog.public")))}function qe(e,t){1&e&&(u.Vc(0),u.tc(1,"translate")),2&e&&u.Wc(u.uc(1,1,"catalog.private"))}var Ne=function(){return["facet","customFields"]};function Ge(e,t){if(1&e&&u.ec(0,"vdr-custom-field-control",24),2&e){var n=u.sc().$implicit,c=u.sc(3);u.zc("customFieldsFormGroup",c.detailForm.get(u.Cc(2,Ne)))("customField",n)}}function We(e,t){if(1&e&&(u.hc(0),u.Tc(1,Ge,1,3,"vdr-custom-field-control",23),u.gc()),2&e){var n=t.$implicit,c=u.sc(3);u.Sb(1),u.zc("ngIf",c.customFieldIsSet(n.name))}}function Xe(e,t){if(1&e&&(u.jc(0,"section",21),u.jc(1,"label"),u.Vc(2),u.tc(3,"translate"),u.ic(),u.Tc(4,We,2,1,"ng-container",22),u.ic()),2&e){var n=u.sc(2);u.Sb(2),u.Wc(u.uc(3,2,"common.custom-fields")),u.Sb(2),u.zc("ngForOf",n.customFields)}}function Ue(e,t){if(1&e&&(u.hc(0),u.jc(1,"th"),u.Vc(2),u.ic(),u.gc()),2&e){var n=t.$implicit;u.Sb(2),u.Wc(n.name)}}var Be=function(e){return["values",e,"customFields"]};function Re(e,t){if(1&e&&u.ec(0,"vdr-custom-field-control",40),2&e){var n=u.sc().$implicit,c=u.sc().index,a=u.sc(4);u.zc("showLabel",!1)("customFieldsFormGroup",a.detailForm.get(u.Dc(3,Be,c)))("customField",n)}}function He(e,t){if(1&e&&(u.hc(0),u.jc(1,"td",31),u.Tc(2,Re,1,5,"vdr-custom-field-control",39),u.ic(),u.gc()),2&e){var n=t.$implicit,c=u.sc().index,a=u.sc(4);u.Sb(2),u.zc("ngIf",a.customValueFieldIsSet(c,n.name))}}function Je(e,t){if(1&e){var n=u.kc();u.jc(0,"tr",30),u.jc(1,"td",31),u.ec(2,"vdr-entity-info",0),u.ic(),u.jc(3,"td",31),u.jc(4,"input",32),u.qc("input",function(e){u.Mc(n);var c=t.index,a=u.sc(3).ngIf;return u.sc().updateValueCode(null==a.values[c]?null:a.values[c].code,e.target.value,c)}),u.tc(5,"hasPermission"),u.ic(),u.ic(),u.jc(6,"td",31),u.ec(7,"input",33),u.ic(),u.Tc(8,He,3,1,"ng-container",22),u.jc(9,"td",31),u.jc(10,"vdr-dropdown"),u.jc(11,"button",34),u.Vc(12),u.tc(13,"translate"),u.ec(14,"clr-icon",35),u.ic(),u.jc(15,"vdr-dropdown-menu",36),u.jc(16,"button",37),u.qc("click",function(){u.Mc(n);var e=t.index,c=u.sc(3).ngIf;return u.sc().deleteFacetValue(null==c.values[e]?null:c.values[e].id,e)}),u.tc(17,"hasPermission"),u.ec(18,"clr-icon",38),u.Vc(19),u.tc(20,"translate"),u.ic(),u.ic(),u.ic(),u.ic(),u.ic()}if(2&e){var c=t.$implicit,a=t.index,i=u.sc(4);u.zc("formGroupName",a),u.Sb(2),u.zc("entity",c),u.Sb(2),u.zc("readonly",!u.uc(5,7,i.updatePermission)),u.Sb(4),u.zc("ngForOf",i.customValueFields),u.Sb(4),u.Xc(" ",u.uc(13,9,"common.actions")," "),u.Sb(4),u.zc("disabled",!u.uc(17,11,i.updatePermission)),u.Sb(3),u.Xc(" ",u.uc(20,13,"common.delete")," ")}}function Qe(e,t){if(1&e&&(u.jc(0,"table",28),u.jc(1,"thead"),u.jc(2,"tr"),u.ec(3,"th"),u.jc(4,"th"),u.Vc(5),u.tc(6,"translate"),u.ic(),u.jc(7,"th"),u.Vc(8),u.tc(9,"translate"),u.ic(),u.Tc(10,Ue,3,1,"ng-container",22),u.ec(11,"th"),u.ic(),u.ic(),u.jc(12,"tbody"),u.Tc(13,Je,21,15,"tr",29),u.ic(),u.ic()),2&e){var n=u.sc(3);u.Sb(5),u.Wc(u.uc(6,4,"common.name")),u.Sb(3),u.Wc(u.uc(9,6,"common.code")),u.Sb(2),u.zc("ngForOf",n.customValueFields),u.Sb(3),u.zc("ngForOf",n.values)}}function Ze(e,t){if(1&e){var n=u.kc();u.jc(0,"button",41),u.qc("click",function(){return u.Mc(n),u.sc(3).addFacetValue()}),u.ec(1,"clr-icon",42),u.Vc(2),u.tc(3,"translate"),u.ic()}2&e&&(u.Sb(2),u.Xc(" ",u.uc(3,1,"catalog.add-facet-value")," "))}var Ye=function(){return["CreateCatalog","CreateFacet"]};function Ke(e,t){if(1&e&&(u.jc(0,"section",25),u.jc(1,"label"),u.Vc(2),u.tc(3,"translate"),u.ic(),u.Tc(4,Qe,14,8,"table",26),u.jc(5,"div"),u.Tc(6,Ze,4,3,"button",27),u.ic(),u.ic()),2&e){var n=u.sc(2);u.Sb(2),u.Wc(u.uc(3,3,"catalog.facet-values")),u.Sb(2),u.zc("ngIf",0<n.getValuesFormArray().length),u.Sb(2),u.zc("vdrIfPermissions",u.Cc(5,Ye))}}function et(e,t){if(1&e){var n=u.kc();u.jc(0,"form",8),u.jc(1,"section",9),u.jc(2,"vdr-form-field",10),u.tc(3,"translate"),u.jc(4,"clr-toggle-wrapper"),u.ec(5,"input",11),u.tc(6,"hasPermission"),u.jc(7,"label",12),u.Tc(8,Ee,3,3,"ng-container",13),u.Tc(9,qe,2,3,"ng-template",null,14,u.Uc),u.ic(),u.ic(),u.ic(),u.jc(11,"vdr-form-field",15),u.tc(12,"translate"),u.jc(13,"input",16),u.qc("input",function(e){u.Mc(n);var c=t.ngIf;return u.sc().updateCode(c.code,e.target.value)}),u.tc(14,"hasPermission"),u.ic(),u.ic(),u.jc(15,"vdr-form-field",17),u.tc(16,"translate"),u.tc(17,"hasPermission"),u.ec(18,"input",18),u.tc(19,"hasPermission"),u.ic(),u.Tc(20,Xe,5,4,"section",19),u.ic(),u.Tc(21,Ke,7,6,"section",20),u.tc(22,"async"),u.ic()}if(2&e){var c=u.Jc(10),a=u.sc();u.zc("formGroup",a.detailForm),u.Sb(2),u.zc("label",u.uc(3,12,"catalog.visibility")),u.Sb(3),u.zc("vdrDisabled",!u.uc(6,14,a.updatePermission)),u.Sb(3),u.zc("ngIf",a.detailForm.value.facet.visible)("ngIfElse",c),u.Sb(3),u.zc("label",u.uc(12,16,"common.name")),u.Sb(2),u.zc("readonly",!u.uc(14,18,a.updatePermission)),u.Sb(2),u.zc("label",u.uc(16,20,"common.code"))("readOnlyToggle",u.uc(17,22,a.updatePermission)),u.Sb(3),u.zc("readonly",!u.uc(19,24,a.updatePermission)),u.Sb(2),u.zc("ngIf",a.customFields.length),u.Sb(1),u.zc("ngIf",!u.uc(22,26,a.isNew$))}}var tt=".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}";function nt(e,t){1&e&&(u.jc(0,"a",5),u.ec(1,"clr-icon",6),u.Vc(2),u.tc(3,"translate"),u.ic()),2&e&&(u.zc("routerLink",u.Cc(4,we)),u.Sb(2),u.Xc(" ",u.uc(3,2,"catalog.create-new-facet")," "))}function ct(e,t){if(1&e&&u.ec(0,"vdr-facet-value-chip",19),2&e){var n=t.$implicit;u.zc("facetValue",n)("removable",!1)("displayFacetName",!1)}}function at(e,t){if(1&e&&(u.hc(0),u.ec(1,"clr-icon",6),u.Vc(2),u.gc()),2&e){var n=u.sc(2).item,c=u.sc();u.Sb(2),u.Xc(" ",n.values.length-c.initialLimit," ")}}function it(e,t){1&e&&u.ec(0,"clr-icon",22)}function rt(e,t){if(1&e){var n=u.kc();u.jc(0,"button",20),u.qc("click",function(){u.Mc(n);var e=u.sc().item;return u.sc().toggleDisplayLimit(e)}),u.Tc(1,at,3,1,"ng-container",10),u.Tc(2,it,1,0,"ng-template",null,21,u.Uc),u.ic()}if(2&e){var c=u.Jc(3),a=u.sc().item,i=u.sc();u.Sb(1),u.zc("ngIf",(i.displayLimit[a.id]||0)<a.values.length)("ngIfElse",c)}}function ot(e,t){1&e&&(u.hc(0),u.Vc(1),u.tc(2,"translate"),u.gc()),2&e&&(u.Sb(1),u.Wc(u.uc(2,1,"catalog.public")))}function st(e,t){1&e&&(u.Vc(0),u.tc(1,"translate")),2&e&&u.Wc(u.uc(1,1,"catalog.private"))}var lt=function(e){return["./",e]},ut=function(){return["DeleteCatalog","DeleteFacet"]};function dt(e,t){if(1&e){var n=u.kc();u.jc(0,"td",7),u.Vc(1),u.ic(),u.jc(2,"td",7),u.Vc(3),u.ic(),u.jc(4,"td",7),u.Tc(5,ct,1,3,"vdr-facet-value-chip",8),u.tc(6,"slice"),u.Tc(7,rt,4,2,"button",9),u.ic(),u.jc(8,"td",7),u.jc(9,"vdr-chip"),u.Tc(10,ot,3,3,"ng-container",10),u.Tc(11,st,2,3,"ng-template",null,11,u.Uc),u.ic(),u.ic(),u.jc(13,"td",12),u.ec(14,"vdr-table-row-action",13),u.tc(15,"translate"),u.ic(),u.jc(16,"td",12),u.jc(17,"vdr-dropdown"),u.jc(18,"button",14),u.Vc(19),u.tc(20,"translate"),u.ec(21,"clr-icon",15),u.ic(),u.jc(22,"vdr-dropdown-menu",16),u.jc(23,"button",17),u.qc("click",function(){u.Mc(n);var e=t.item;return u.sc().deleteFacet(e.id)}),u.tc(24,"hasPermission"),u.ec(25,"clr-icon",18),u.Vc(26),u.tc(27,"translate"),u.ic(),u.ic(),u.ic(),u.ic()}if(2&e){var c=t.item,a=u.Jc(12),i=u.sc();u.Vb("private",c.isPrivate),u.Sb(1),u.Wc(c.code),u.Sb(1),u.Vb("private",c.isPrivate),u.Sb(1),u.Wc(c.name),u.Sb(1),u.Vb("private",c.isPrivate),u.Sb(1),u.zc("ngForOf",u.wc(6,23,c.values,0,i.displayLimit[c.id]||3)),u.Sb(2),u.zc("ngIf",c.values.length>i.initialLimit),u.Sb(1),u.Vb("private",c.isPrivate),u.Sb(2),u.zc("ngIf",!c.isPrivate)("ngIfElse",a),u.Sb(3),u.Vb("private",c.isPrivate),u.Sb(1),u.zc("label",u.uc(15,27,"common.edit"))("linkTo",u.Dc(35,lt,c.id)),u.Sb(2),u.Vb("private",c.isPrivate),u.Sb(3),u.Xc(" ",u.uc(20,29,"common.actions")," "),u.Sb(4),u.zc("disabled",!u.uc(24,31,u.Cc(37,ut))),u.Sb(3),u.Xc(" ",u.uc(27,33,"common.delete")," ")}}function pt(e,t){1&e&&(u.Vc(0),u.tc(1,"translate")),2&e&&u.Wc(u.uc(1,1,"catalog.add-facets"))}function ft(e,t){if(1&e){var n=u.kc();u.jc(0,"button",3),u.qc("click",function(){return u.Mc(n),u.sc().cancel()}),u.Vc(1),u.tc(2,"translate"),u.ic(),u.jc(3,"button",4),u.qc("click",function(){return u.Mc(n),u.sc().selectValues()}),u.Vc(4),u.tc(5,"translate"),u.ic()}if(2&e){var c=u.sc();u.Sb(1),u.Wc(u.uc(2,3,"common.cancel")),u.Sb(2),u.zc("disabled",0===c.selectedValues.length),u.Sb(1),u.Xc(" ",u.uc(5,5,"catalog.add-facets")," ")}}function gt(e,t){1&e&&(u.hc(0),u.Vc(1),u.tc(2,"translate"),u.gc()),2&e&&(u.Sb(1),u.Wc(u.uc(2,1,"catalog.assign-variants-to-channel")))}function mt(e,t){1&e&&(u.Vc(0),u.tc(1,"translate")),2&e&&u.Wc(u.uc(1,1,"catalog.assign-products-to-channel"))}function vt(e,t){if(1&e&&(u.Tc(0,gt,3,3,"ng-container",12),u.Tc(1,mt,2,3,"ng-template",null,13,u.Uc)),2&e){var n=u.Jc(2),c=u.sc();u.zc("ngIf",c.isProductVariantMode)("ngIfElse",n)}}var bt=function(e){return{channel:e}};function ht(e,t){if(1&e&&(u.Vc(0),u.tc(1,"translate")),2&e){var n=u.sc();u.Xc(" ",u.vc(1,1,"catalog.price-in-channel",u.Dc(4,bt,null==n.selectedChannel?null:n.selectedChannel.code))," ")}}function yt(e,t){1&e&&(u.Vc(0),u.tc(1,"translate")),2&e&&u.Xc(" ",u.uc(1,1,"catalog.no-channel-selected")," ")}function Ct(e,t){if(1&e&&(u.Vc(0),u.tc(1,"localeCurrency")),2&e){var n=u.sc().$implicit,c=u.sc();u.Xc(" ",u.vc(1,1,n.pricePreview,null==c.selectedChannel?null:c.selectedChannel.currencyCode)," ")}}function Ot(e,t){1&e&&u.Vc(0," - ")}function jt(e,t){if(1&e&&(u.jc(0,"tr"),u.jc(1,"td"),u.Vc(2),u.ic(),u.jc(3,"td"),u.Vc(4),u.tc(5,"localeCurrency"),u.ic(),u.jc(6,"td"),u.Tc(7,Ct,2,4,"ng-template",8),u.Tc(8,Ot,1,0,"ng-template",null,14,u.Uc),u.ic(),u.ic()),2&e){var n=t.$implicit,c=u.Jc(9),a=u.sc();u.Sb(2),u.Wc(n.name),u.Sb(2),u.Wc(u.vc(5,4,n.price,null==a.currentChannel?null:a.currentChannel.currencyCode)),u.Sb(3),u.zc("ngIf",a.selectedChannel)("ngIfElse",c)}}var kt=function(e){return{channelCode:e}};function Pt(e,t){if(1&e&&(u.Vc(0),u.tc(1,"translate")),2&e){var n=u.sc(2);u.Xc(" ",u.vc(1,1,"catalog.assign-to-named-channel",u.Dc(4,kt,null==n.selectedChannel?null:n.selectedChannel.code))," ")}}function St(e,t){1&e&&(u.Vc(0),u.tc(1,"translate")),2&e&&u.Xc(" ",u.uc(1,1,"catalog.no-channel-selected")," ")}function It(e,t){if(1&e){var n=u.kc();u.jc(0,"button",15),u.qc("click",function(){return u.Mc(n),u.sc().cancel()}),u.Vc(1),u.tc(2,"translate"),u.ic(),u.jc(3,"button",16),u.qc("click",function(){return u.Mc(n),u.sc().assign()}),u.Tc(4,Pt,2,6,"ng-template",8),u.Tc(5,St,2,3,"ng-template",null,9,u.Uc),u.ic()}if(2&e){var c=u.Jc(6),a=u.sc();u.Sb(1),u.Wc(u.uc(2,4,"common.cancel")),u.Sb(2),u.zc("disabled",!a.selectedChannel),u.Sb(1),u.zc("ngIf",a.selectedChannel)("ngIfElse",c)}}var Ft=function(){return["product","enabled"]};function Vt(e,t){if(1&e&&(u.jc(0,"clr-toggle-wrapper"),u.ec(1,"input",8),u.jc(2,"label"),u.Vc(3),u.tc(4,"translate"),u.ic(),u.ic()),2&e){var n=u.sc();u.Sb(1),u.zc("formControl",n.detailForm.get(u.Cc(4,Ft))),u.Sb(2),u.Wc(u.uc(4,2,"common.enabled"))}}function xt(e,t){if(1&e){var n=u.kc();u.jc(0,"button",9),u.qc("click",function(){return u.Mc(n),u.sc().create()}),u.Vc(1),u.tc(2,"translate"),u.ic()}if(2&e){var c=u.sc();u.zc("disabled",c.detailForm.invalid||c.detailForm.pristine||!c.variantsToCreateAreValid()),u.Sb(1),u.Xc(" ",u.uc(2,2,"common.create")," ")}}function Mt(e,t){if(1&e){var n=u.kc();u.jc(0,"button",9),u.qc("click",function(){return u.Mc(n),u.sc(2).save()}),u.Vc(1),u.tc(2,"translate"),u.ic()}if(2&e){var c=u.sc(2);u.zc("disabled",(c.detailForm.invalid||c.detailForm.pristine)&&!c.assetsChanged()&&!c.variantAssetsChanged()),u.Sb(1),u.Xc(" ",u.uc(2,2,"common.update")," ")}}var Tt=function(){return["UpdateCatalog","UpdateProduct"]};function wt(e,t){1&e&&u.Tc(0,Mt,3,4,"button",10),2&e&&u.zc("vdrIfPermissions",u.Cc(1,Tt))}function zt(e,t){if(1&e){var n=u.kc();u.jc(0,"vdr-chip",40),u.qc("iconClick",function(){u.Mc(n);var e=u.sc().$implicit;return u.sc(5).removeFromChannel(e.id)}),u.ec(1,"vdr-channel-badge",41),u.Vc(2),u.tc(3,"channelCodeToLabel"),u.ic()}if(2&e){var c=u.sc().$implicit;u.Sb(1),u.zc("channelCode",c.code),u.Sb(1),u.Xc(" ",u.uc(3,2,c.code)," ")}}function Dt(e,t){if(1&e&&(u.hc(0),u.Tc(1,zt,4,4,"vdr-chip",39),u.gc()),2&e){var n=t.$implicit,c=u.sc(5);u.Sb(1),u.zc("ngIf",!c.isDefaultChannel(n.code))}}function At(e,t){if(1&e){var n=u.kc();u.jc(0,"vdr-form-item",34),u.tc(1,"translate"),u.jc(2,"div",35),u.Tc(3,Dt,2,1,"ng-container",36),u.tc(4,"async"),u.jc(5,"button",37),u.qc("click",function(){return u.Mc(n),u.sc(4).assignToChannel()}),u.ec(6,"clr-icon",38),u.Vc(7),u.tc(8,"translate"),u.ic(),u.ic(),u.ic()}if(2&e){var c=u.sc(4);u.zc("label",u.uc(1,3,"common.channels")),u.Sb(3),u.zc("ngForOf",u.uc(4,5,c.productChannels$)),u.Sb(4),u.Xc(" ",u.uc(8,7,"catalog.assign-to-channel")," ")}}function $t(e,t){1&e&&(u.hc(0),u.Tc(1,At,9,9,"vdr-form-item",33),u.gc())}var _t=function(){return["product","customFields"]};function Lt(e,t){if(1&e&&(u.ec(0,"vdr-custom-field-control",44),u.tc(1,"hasPermission")),2&e){var n=u.sc().$implicit,c=u.sc(4);u.zc("customFieldsFormGroup",c.detailForm.get(u.Cc(5,_t)))("customField",n)("readonly",!u.uc(1,3,u.Cc(6,Tt)))}}function Et(e,t){if(1&e&&(u.hc(0),u.Tc(1,Lt,2,7,"vdr-custom-field-control",43),u.gc()),2&e){var n=t.$implicit,c=u.sc(4);u.Sb(1),u.zc("ngIf",c.customFieldIsSet(n.name))}}function qt(e,t){if(1&e&&(u.jc(0,"section",42),u.jc(1,"label"),u.Vc(2),u.tc(3,"translate"),u.ic(),u.Tc(4,Et,2,1,"ng-container",36),u.ic()),2&e){var n=u.sc(3);u.Sb(2),u.Wc(u.uc(3,2,"common.custom-fields")),u.Sb(2),u.zc("ngForOf",n.customFields)}}function Nt(e,t){if(1&e){var n=u.kc();u.jc(0,"vdr-facet-value-chip",45),u.qc("remove",function(){u.Mc(n);var e=t.$implicit;return u.sc(3).removeProductFacetValue(e.id)}),u.tc(1,"hasPermission"),u.ic()}if(2&e){var c=t.$implicit;u.zc("facetValue",c)("removable",u.uc(1,2,u.Cc(4,Tt)))}}function Gt(e,t){if(1&e){var n=u.kc();u.jc(0,"button",46),u.qc("click",function(){return u.Mc(n),u.sc(3).selectProductFacetValue()}),u.ec(1,"clr-icon",47),u.Vc(2),u.tc(3,"translate"),u.ic()}2&e&&(u.Sb(2),u.Xc(" ",u.uc(3,1,"catalog.add-facets")," "))}function Wt(e,t){if(1&e){var n=u.kc();u.jc(0,"div"),u.jc(1,"h4"),u.Vc(2),u.tc(3,"translate"),u.ic(),u.jc(4,"vdr-generate-product-variants",48),u.qc("variantsChange",function(e){return u.Mc(n),u.sc(3).createVariantsConfig=e}),u.ic(),u.ic()}2&e&&(u.Sb(2),u.Wc(u.uc(3,1,"catalog.product-variants")))}var Xt=function(){return["product","name"]};function Ut(e,t){if(1&e){var n=u.kc();u.jc(0,"clr-tab-content"),u.jc(1,"div",16),u.jc(2,"div",17),u.jc(3,"section",18),u.Tc(4,$t,2,0,"ng-container",19),u.jc(5,"vdr-form-field",20),u.tc(6,"translate"),u.jc(7,"input",21),u.qc("input",function(e){return u.Mc(n),u.sc(2).updateSlug(e.target.value)}),u.tc(8,"hasPermission"),u.ic(),u.ic(),u.jc(9,"div",22),u.tc(10,"async"),u.jc(11,"clr-checkbox-wrapper"),u.ec(12,"input",23),u.jc(13,"label"),u.Vc(14),u.tc(15,"translate"),u.ic(),u.ic(),u.ic(),u.jc(16,"vdr-form-field",24),u.tc(17,"translate"),u.tc(18,"translate"),u.ec(19,"input",25),u.tc(20,"hasPermission"),u.ic(),u.ec(21,"vdr-rich-text-editor",26),u.tc(22,"hasPermission"),u.tc(23,"translate"),u.Tc(24,qt,5,4,"section",27),u.jc(25,"div",28),u.Tc(26,Nt,2,5,"vdr-facet-value-chip",29),u.tc(27,"async"),u.Tc(28,Gt,4,3,"button",30),u.ic(),u.ic(),u.ic(),u.jc(29,"div",31),u.jc(30,"vdr-product-assets",32),u.qc("change",function(e){return u.Mc(n),u.sc(2).assetChanges=e}),u.ic(),u.ic(),u.ic(),u.Tc(31,Wt,5,3,"div",15),u.tc(32,"async"),u.ic()}if(2&e){var c=u.sc().ngIf,a=u.sc(),i=null;u.Sb(5),u.zc("label",u.uc(6,16,"catalog.product-name")),u.Sb(2),u.zc("readonly",!u.uc(8,18,u.Cc(38,Tt))),u.Sb(2),u.Vb("visible",!1===u.uc(10,20,a.isNew$)&&(null==(i=a.detailForm.get(u.Cc(39,Xt)))?null:i.dirty)),u.Sb(5),u.Wc(u.uc(15,22,"catalog.auto-update-product-variant-name")),u.Sb(2),u.zc("label",u.uc(17,24,"catalog.slug"))("errors",u.Dc(40,Me,u.uc(18,26,"catalog.slug-pattern-error"))),u.Sb(3),u.zc("readonly",!u.uc(20,28,u.Cc(42,Tt))),u.Sb(2),u.zc("readonly",!u.uc(22,30,u.Cc(43,Tt)))("label",u.uc(23,32,"common.description")),u.Sb(3),u.zc("ngIf",a.customFields.length),u.Sb(2),u.zc("ngForOf",u.uc(27,34,a.facetValues$)),u.Sb(2),u.zc("vdrIfPermissions",u.Cc(44,Tt)),u.Sb(2),u.zc("assets",a.assetChanges.assets||c.assets)("featuredAsset",a.assetChanges.featuredAsset||c.featuredAsset),u.Sb(1),u.zc("ngIf",u.uc(32,36,a.isNew$))}}var Bt=function(){return["./","manage-variants"]};function Rt(e,t){1&e&&(u.jc(0,"a",64),u.ec(1,"clr-icon",65),u.Vc(2),u.tc(3,"translate"),u.ic()),2&e&&(u.zc("routerLink",u.Cc(4,Bt)),u.Sb(2),u.Xc(" ",u.uc(3,2,"catalog.manage-variants")," "))}function Ht(e,t){if(1&e&&(u.ec(0,"vdr-product-variants-table",66),u.tc(1,"async"),u.tc(2,"async")),2&e){var n=u.sc(3).ngIf,c=u.sc();u.zc("variants",u.uc(1,5,c.variants$))("optionGroups",n.optionGroups)("channelPriceIncludesTax",u.uc(2,7,c.channelPriceIncludesTax$))("productVariantsFormArray",c.detailForm.get("variants"))("pendingAssetChanges",c.variantAssetChanges)}}function Jt(e,t){if(1&e){var n=u.kc();u.jc(0,"vdr-product-variants-list",67),u.qc("assignToChannel",function(e){return u.Mc(n),u.sc(4).assignVariantToChannel(e)})("removeFromChannel",function(e){return u.Mc(n),u.sc(4).removeVariantFromChannel(e)})("assetChange",function(e){return u.Mc(n),u.sc(4).variantAssetChange(e)})("updateProductOption",function(e){return u.Mc(n),u.sc(4).updateProductOption(e)})("selectionChange",function(e){return u.Mc(n),u.sc(4).selectedVariantIds=e})("selectFacetValueClick",function(e){return u.Mc(n),u.sc(4).selectVariantFacetValue(e)}),u.tc(1,"async"),u.tc(2,"async"),u.tc(3,"async"),u.tc(4,"async"),u.tc(5,"async"),u.ic()}if(2&e){var c=u.sc(3).ngIf,a=u.sc();u.zc("variants",u.uc(1,10,a.variants$))("channelPriceIncludesTax",u.uc(2,12,a.channelPriceIncludesTax$))("facets",u.uc(3,14,a.facets$))("optionGroups",c.optionGroups)("productVariantsFormArray",a.detailForm.get("variants"))("taxCategories",u.uc(4,16,a.taxCategories$))("customFields",a.customVariantFields)("customOptionFields",a.customOptionFields)("activeLanguage",u.uc(5,18,a.languageCode$))("pendingAssetChanges",a.variantAssetChanges)}}function Qt(e,t){if(1&e){var n=u.kc();u.jc(0,"clr-tab-content"),u.jc(1,"section",49),u.jc(2,"div",50),u.jc(3,"div",51),u.jc(4,"button",52),u.qc("click",function(){return u.Mc(n),u.sc(3).variantDisplayMode="card"}),u.ec(5,"clr-icon",53),u.Vc(6),u.tc(7,"translate"),u.ic(),u.jc(8,"button",54),u.qc("click",function(){return u.Mc(n),u.sc(3).variantDisplayMode="table"}),u.ec(9,"clr-icon",55),u.Vc(10),u.tc(11,"translate"),u.ic(),u.ic(),u.jc(12,"div",56),u.ec(13,"input",57),u.tc(14,"translate"),u.jc(15,"button",58),u.qc("click",function(){return u.Mc(n),u.sc(3).filterInput.setValue("")}),u.ec(16,"clr-icon",59),u.ic(),u.ic(),u.ec(17,"div",60),u.Tc(18,Rt,4,5,"a",61),u.ic(),u.Tc(19,Ht,3,9,"vdr-product-variants-table",62),u.Tc(20,Jt,6,20,"vdr-product-variants-list",63),u.ic(),u.ic()}if(2&e){var c=u.sc(3);u.Sb(4),u.Vb("btn-primary","card"===c.variantDisplayMode),u.Sb(2),u.Xc(" ",u.uc(7,11,"catalog.display-variant-cards")," "),u.Sb(2),u.Vb("btn-primary","table"===c.variantDisplayMode),u.Sb(2),u.Xc(" ",u.uc(11,13,"catalog.display-variant-table")," "),u.Sb(3),u.zc("formControl",c.filterInput)("placeholder",u.uc(14,15,"catalog.filter-by-name-or-sku")),u.Sb(5),u.zc("vdrIfPermissions",u.Cc(17,Tt)),u.Sb(1),u.zc("ngIf","table"===c.variantDisplayMode),u.Sb(1),u.zc("ngIf","card"===c.variantDisplayMode)}}function Zt(e,t){if(1&e){var n=u.kc();u.jc(0,"clr-tab"),u.jc(1,"button",13),u.qc("click",function(){return u.Mc(n),u.sc(2).navigateToTab("variants")}),u.Vc(2),u.tc(3,"translate"),u.ic(),u.Tc(4,Qt,21,18,"clr-tab-content",14),u.tc(5,"async"),u.ic()}if(2&e){var c=u.sc(2);u.Sb(2),u.Xc(" ",u.uc(3,2,"catalog.product-variants")," "),u.Sb(2),u.zc("clrIfActive","variants"===u.uc(5,4,c.activeTab$))}}function Yt(e,t){if(1&e){var n=u.kc();u.jc(0,"form",11),u.ec(1,"button",12),u.jc(2,"clr-tabs"),u.jc(3,"clr-tab"),u.jc(4,"button",13),u.qc("click",function(){return u.Mc(n),u.sc().navigateToTab("details")}),u.Vc(5),u.tc(6,"translate"),u.ic(),u.Tc(7,Ut,33,45,"clr-tab-content",14),u.tc(8,"async"),u.ic(),u.Tc(9,Zt,6,6,"clr-tab",15),u.tc(10,"async"),u.ic(),u.ic()}if(2&e){var c=u.sc();u.zc("formGroup",c.detailForm),u.Sb(5),u.Xc(" ",u.uc(6,4,"catalog.product-details")," "),u.Sb(2),u.zc("clrIfActive","details"===u.uc(8,6,c.activeTab$)),u.Sb(2),u.zc("ngIf",!u.uc(10,8,c.isNew$))}}var Kt=["selectComponent"];function en(e,t){if(1&e){var n=u.kc();u.jc(0,"div",6),u.qc("click",function(){return u.Mc(n),u.sc(2),u.Jc(1).selectTag()}),u.Vc(1),u.tc(2,"translate"),u.ic()}if(2&e){var c=u.sc(2),a=u.Jc(1);u.Vb("selected",c.isSearchHeaderSelected()),u.Sb(1),u.Yc(" ",u.uc(2,4,"catalog.search-for-term"),": ",a.searchTerm," ")}}function tn(e,t){if(1&e&&u.Tc(0,en,3,6,"div",5),2&e){u.sc();var n=u.Jc(1);u.zc("ngIf",n.searchTerm)}}function nn(e,t){if(1&e){var n=u.kc();u.hc(0),u.jc(1,"vdr-facet-value-chip",8),u.qc("remove",function(){u.Mc(n);var e=u.sc(),t=e.item;return(0,e.clear)(t)}),u.ic(),u.gc()}if(2&e){var c=u.sc().item;u.Sb(1),u.zc("facetValue",c.facetValue)("removable",!0)}}function cn(e,t){if(1&e){var n=u.kc();u.hc(0),u.jc(1,"vdr-chip",9),u.qc("iconClick",function(){u.Mc(n);var e=u.sc(),t=e.item;return(0,e.clear)(t)}),u.Vc(2),u.ic(),u.gc()}if(2&e){var c=u.sc().item;u.Sb(1),u.zc("icon","times"),u.Sb(1),u.Xc('"',c.label,'"')}}function an(e,t){if(1&e&&(u.Tc(0,nn,2,2,"ng-container",7),u.Tc(1,cn,3,2,"ng-container",7)),2&e){var n=t.item;u.zc("ngIf",n.facetValue),u.Sb(1),u.zc("ngIf",!n.facetValue)}}function rn(e,t){if(1&e&&(u.hc(0),u.ec(1,"vdr-facet-value-chip",10),u.gc()),2&e){var n=u.sc().item;u.Sb(1),u.zc("facetValue",n.facetValue)("removable",!1)}}function on(e,t){if(1&e&&u.Tc(0,rn,2,2,"ng-container",7),2&e){var n=t.item;u.zc("ngIf",n.facetValue)}}var sn=["productSearchInputComponent"];function ln(e,t){1&e&&(u.jc(0,"a",16),u.ec(1,"clr-icon",17),u.jc(2,"span",18),u.Vc(3),u.tc(4,"translate"),u.ic(),u.ic()),2&e&&(u.zc("routerLink",u.Cc(4,we)),u.Sb(3),u.Wc(u.uc(4,2,"catalog.create-new-product")))}function un(e,t){if(1&e&&(u.ec(0,"img",31),u.tc(1,"assetPreview")),2&e){var n=t.ngIf;u.zc("src",u.vc(1,1,n,"tiny"),u.Oc)}}function dn(e,t){1&e&&(u.jc(0,"div",32),u.ec(1,"clr-icon",33),u.ic())}function pn(e,t){1&e&&(u.jc(0,"vdr-chip"),u.Vc(1),u.tc(2,"translate"),u.ic()),2&e&&(u.Sb(1),u.Wc(u.uc(2,1,"common.disabled")))}var fn=function(){return["DeleteCatalog","DeleteProduct"]};function gn(e,t){if(1&e){var n=u.kc();u.jc(0,"td",19),u.jc(1,"div",20),u.Tc(2,un,2,4,"img",21),u.Tc(3,dn,2,0,"ng-template",null,22,u.Uc),u.ic(),u.ic(),u.jc(5,"td",19),u.Vc(6),u.ic(),u.jc(7,"td",23),u.Tc(8,pn,3,3,"vdr-chip",24),u.ic(),u.jc(9,"td",25),u.ec(10,"vdr-table-row-action",26),u.tc(11,"translate"),u.ic(),u.jc(12,"td",25),u.jc(13,"vdr-dropdown"),u.jc(14,"button",27),u.Vc(15),u.tc(16,"translate"),u.ec(17,"clr-icon",28),u.ic(),u.jc(18,"vdr-dropdown-menu",7),u.jc(19,"button",29),u.qc("click",function(){u.Mc(n);var e=t.item;return u.sc().deleteProduct(e.productId)}),u.tc(20,"hasPermission"),u.ec(21,"clr-icon",30),u.Vc(22),u.tc(23,"translate"),u.ic(),u.ic(),u.ic(),u.ic()}if(2&e){var c=t.item,a=u.Jc(4),i=u.sc();u.Vb("disabled",!c.enabled),u.Sb(2),u.zc("ngIf",i.groupByProduct?c.productAsset:c.productVariantAsset||c.productAsset)("ngIfElse",a),u.Sb(3),u.Vb("disabled",!c.enabled),u.Sb(1),u.Xc(" ",i.groupByProduct?c.productName:c.productVariantName," "),u.Sb(1),u.Vb("disabled",!c.enabled),u.Sb(1),u.zc("ngIf",!c.enabled),u.Sb(1),u.Vb("disabled",!c.enabled),u.Sb(1),u.zc("label",u.uc(11,19,"common.edit"))("linkTo",u.Dc(27,lt,c.productId)),u.Sb(2),u.Vb("disabled",!c.enabled),u.Sb(3),u.Xc(" ",u.uc(16,21,"common.actions")," "),u.Sb(4),u.zc("disabled",!u.uc(20,23,u.Cc(29,fn))),u.Sb(3),u.Xc(" ",u.uc(23,25,"common.delete")," ")}}var mn=function(){return["CreateCatalog","CreateProduct"]};function vn(e,t){1&e&&(u.Vc(0),u.tc(1,"translate")),2&e&&u.Xc(" ",u.uc(1,1,"catalog.confirm-deletion-of-unused-variants-title"),"\n")}function bn(e,t){if(1&e&&(u.jc(0,"li"),u.Vc(1),u.ic()),2&e){var n=t.$implicit;u.Sb(1),u.Yc("",n.name," (",n.sku,")")}}function hn(e,t){if(1&e){var n=u.kc();u.jc(0,"button",3),u.qc("click",function(){return u.Mc(n),u.sc().cancel()}),u.Vc(1),u.tc(2,"translate"),u.ic(),u.jc(3,"button",4),u.qc("click",function(){return u.Mc(n),u.sc().confirm()}),u.Vc(4),u.tc(5,"translate"),u.ic()}2&e&&(u.Sb(1),u.Wc(u.uc(2,2,"common.cancel")),u.Sb(3),u.Xc(" ",u.uc(5,4,"common.confirm")," "))}function yn(e,t){if(1&e){var n=u.kc();u.jc(0,"div",7),u.jc(1,"div",8),u.jc(2,"label"),u.Vc(3),u.tc(4,"translate"),u.ic(),u.jc(5,"input",9),u.qc("ngModelChange",function(e){return t.$implicit.name=e}),u.ic(),u.ic(),u.jc(6,"div",10),u.jc(7,"label"),u.Vc(8),u.tc(9,"translate"),u.ic(),u.jc(10,"vdr-option-value-input",11,12),u.qc("ngModelChange",function(e){return t.$implicit.values=e})("ngModelChange",function(){return u.Mc(n),u.sc().generateVariants()}),u.ic(),u.ic(),u.ic()}if(2&e){var c=t.$implicit;u.Sb(3),u.Wc(u.uc(4,7,"catalog.option")),u.Sb(2),u.zc("ngModel",c.name)("readonly",!c.isNew),u.Sb(3),u.Wc(u.uc(9,9,"catalog.option-values")),u.Sb(2),u.zc("ngModel",c.values)("groupName",c.name)("disabled",""===c.name)}}function Cn(e,t){if(1&e){var n=u.kc();u.jc(0,"input",15),u.qc("ngModelChange",function(e){return u.Mc(n),u.sc().$implicit.enabled=e})("ngModelChange",function(){return u.Mc(n),u.sc(2).formValueChanged=!0}),u.ic()}if(2&e){var c=u.sc().$implicit;u.zc("ngModel",c.enabled)}}function On(e,t){if(1&e){var n=u.kc();u.jc(0,"clr-input-container"),u.jc(1,"input",16),u.qc("ngModelChange",function(e){return u.Mc(n),u.sc().$implicit.sku=e})("ngModelChange",function(){u.Mc(n);var e=u.sc().$implicit;return u.sc().onFormChanged(e)}),u.tc(2,"translate"),u.ic(),u.ic()}if(2&e){var c=u.sc().$implicit;u.Sb(1),u.zc("ngModel",c.sku)("placeholder",u.uc(2,2,"catalog.sku"))}}function jn(e,t){if(1&e&&(u.jc(0,"span"),u.Vc(1),u.ic()),2&e){var n=u.sc().$implicit;u.Sb(1),u.Wc(n.sku)}}function kn(e,t){if(1&e){var n=u.kc();u.jc(0,"clr-input-container"),u.jc(1,"vdr-currency-input",17),u.qc("ngModelChange",function(e){return u.Mc(n),u.sc().$implicit.price=e})("ngModelChange",function(){u.Mc(n);var e=u.sc().$implicit;return u.sc().onFormChanged(e)}),u.ic(),u.ic()}if(2&e){var c=u.sc().$implicit,a=u.sc();u.Sb(1),u.zc("ngModel",c.price)("currencyCode",a.currencyCode)}}function Pn(e,t){if(1&e&&(u.jc(0,"span"),u.Vc(1),u.tc(2,"localeCurrency"),u.ic()),2&e){var n=u.sc().$implicit,c=u.sc();u.Sb(1),u.Wc(u.vc(2,1,n.price,c.currencyCode))}}function Sn(e,t){if(1&e){var n=u.kc();u.jc(0,"clr-input-container"),u.jc(1,"input",18),u.qc("ngModelChange",function(e){return u.Mc(n),u.sc().$implicit.stock=e})("ngModelChange",function(){u.Mc(n);var e=u.sc().$implicit;return u.sc().onFormChanged(e)}),u.ic(),u.ic()}if(2&e){var c=u.sc().$implicit;u.Sb(1),u.zc("ngModel",c.stock)}}function In(e,t){if(1&e&&(u.jc(0,"span"),u.Vc(1),u.ic()),2&e){var n=u.sc().$implicit;u.Sb(1),u.Wc(n.stock)}}function Fn(e,t){if(1&e){var n=u.kc();u.jc(0,"vdr-dropdown"),u.jc(1,"button",19),u.ec(2,"clr-icon",20),u.ic(),u.jc(3,"vdr-dropdown-menu",21),u.jc(4,"button",22),u.qc("click",function(){u.Mc(n);var e=t.ngIf;return u.sc(2).deleteVariant(e)}),u.ec(5,"clr-icon",23),u.Vc(6),u.tc(7,"translate"),u.ic(),u.ic(),u.ic()}2&e&&(u.Sb(6),u.Xc(" ",u.uc(7,1,"common.delete")," "))}function Vn(e,t){if(1&e&&(u.jc(0,"tr"),u.jc(1,"td"),u.Tc(2,Cn,1,1,"input",13),u.ic(),u.jc(3,"td"),u.Vc(4),u.tc(5,"translate"),u.ic(),u.jc(6,"td"),u.Tc(7,On,3,4,"clr-input-container",14),u.Tc(8,jn,2,1,"span",14),u.ic(),u.jc(9,"td"),u.Tc(10,kn,2,2,"clr-input-container",14),u.Tc(11,Pn,3,4,"span",14),u.ic(),u.jc(12,"td"),u.Tc(13,Sn,2,1,"clr-input-container",14),u.Tc(14,In,2,1,"span",14),u.ic(),u.jc(15,"td"),u.Tc(16,Fn,8,3,"vdr-dropdown",14),u.ic(),u.ic()),2&e){var n=t.$implicit,c=u.sc();u.Vb("disabled",!n.enabled||n.existing),u.Sb(2),u.zc("ngIf",!n.existing),u.Sb(2),u.Xc(" ",u.uc(5,11,c.getVariantName(n))," "),u.Sb(3),u.zc("ngIf",!n.existing),u.Sb(1),u.zc("ngIf",n.existing),u.Sb(2),u.zc("ngIf",!n.existing),u.Sb(1),u.zc("ngIf",n.existing),u.Sb(2),u.zc("ngIf",!n.existing),u.Sb(1),u.zc("ngIf",n.existing),u.Sb(2),u.zc("ngIf",n.productVariantId)}}function xn(e,t){if(1&e&&u.ec(0,"vdr-collection-tree-node",1),2&e){var n=u.sc();u.zc("expandAll",n.expandAll)("collectionTree",n.collectionTree)("activeCollectionId",n.activeCollectionId)}}function Mn(e,t){1&e&&u.ec(0,"clr-icon",31)}function Tn(e,t){1&e&&u.ec(0,"clr-icon",32)}function wn(e,t){if(1&e){var n=u.kc();u.jc(0,"button",28),u.qc("click",function(){u.Mc(n);var e=u.sc().$implicit;return e.expanded=!e.expanded}),u.Tc(1,Mn,1,0,"clr-icon",29),u.Tc(2,Tn,1,0,"clr-icon",30),u.ic()}if(2&e){var c=u.sc().$implicit,a=u.sc();u.zc("disabled",a.expandAll),u.Sb(1),u.zc("ngIf",!c.expanded&&!a.expandAll),u.Sb(1),u.zc("ngIf",c.expanded||a.expandAll)}}function zn(e,t){1&e&&u.ec(0,"div",33)}function Dn(e,t){1&e&&(u.jc(0,"vdr-chip"),u.Vc(1),u.tc(2,"translate"),u.ic()),2&e&&(u.Sb(1),u.Wc(u.uc(2,1,"catalog.private")))}function An(e,t){1&e&&(u.jc(0,"div",34),u.ec(1,"clr-icon",35),u.ic())}var $n=function(e){return{parentId:e}},_n=function(e){return["./","create",e]};function Ln(e,t){if(1&e&&(u.jc(0,"a",36),u.ec(1,"clr-icon",37),u.Vc(2),u.tc(3,"translate"),u.ic()),2&e){var n=u.sc().$implicit;u.zc("routerLink",u.Dc(6,_n,u.Dc(4,$n,n.id))),u.Sb(2),u.Xc(" ",u.uc(3,2,"catalog.create-new-collection")," ")}}function En(e,t){if(1&e){var n=u.kc();u.jc(0,"button",20),u.qc("click",function(){u.Mc(n);var e=t.$implicit,c=u.sc().$implicit;return u.sc().move(c,e.id)}),u.tc(1,"async"),u.ec(2,"clr-icon",38),u.Vc(3),u.ic()}if(2&e){var c=t.$implicit,a=u.sc(2);u.zc("disabled",!u.uc(1,2,a.hasUpdatePermission$)),u.Sb(3),u.Xc(" ",c.path," ")}}function qn(e,t){if(1&e&&u.ec(0,"vdr-collection-tree-node",39),2&e){var n=u.sc().$implicit,c=u.sc();u.zc("expandAll",c.expandAll)("collectionTree",n)("activeCollectionId",c.activeCollectionId)}}var Nn=function(e){return{contents:e}},Gn=function(e){return["/catalog/collections/",e]},Wn=function(){return["UpdateCatalog","UpdateCollection"]};function Xn(e,t){if(1&e){var n=u.kc();u.jc(0,"div",3),u.jc(1,"div",4),u.jc(2,"div",5),u.Tc(3,wn,3,3,"button",6),u.Tc(4,zn,1,0,"ng-template",null,7,u.Uc),u.Vc(6),u.ic(),u.ec(7,"div",8),u.Tc(8,Dn,3,3,"vdr-chip",9),u.jc(9,"a",10),u.ec(10,"clr-icon",11),u.Vc(11),u.tc(12,"translate"),u.ic(),u.jc(13,"a",12),u.ec(14,"clr-icon",13),u.Vc(15),u.tc(16,"translate"),u.ic(),u.Tc(17,An,2,0,"div",14),u.jc(18,"vdr-dropdown"),u.jc(19,"button",15),u.ec(20,"clr-icon",16),u.ic(),u.jc(21,"vdr-dropdown-menu",17),u.Tc(22,Ln,4,8,"a",18),u.ec(23,"div",19),u.jc(24,"button",20),u.qc("click",function(){u.Mc(n);var e=t.$implicit,c=t.index;return u.sc().moveUp(e,c)}),u.tc(25,"async"),u.ec(26,"clr-icon",21),u.Vc(27),u.tc(28,"translate"),u.ic(),u.jc(29,"button",20),u.qc("click",function(){u.Mc(n);var e=t.$implicit,c=t.index;return u.sc().moveDown(e,c)}),u.tc(30,"async"),u.ec(31,"clr-icon",22),u.Vc(32),u.tc(33,"translate"),u.ic(),u.jc(34,"h4",23),u.Vc(35),u.tc(36,"translate"),u.ic(),u.Tc(37,En,4,4,"button",24),u.ec(38,"div",19),u.jc(39,"button",25),u.qc("click",function(){u.Mc(n);var e=t.$implicit;return u.sc().delete(e.id)}),u.tc(40,"async"),u.ec(41,"clr-icon",26),u.Vc(42),u.tc(43,"translate"),u.ic(),u.ic(),u.ic(),u.ic(),u.Tc(44,qn,1,3,"vdr-collection-tree-node",27),u.ic()}if(2&e){var c=t.$implicit,a=t.index,i=u.Jc(5),r=u.sc();u.Vb("private",c.isPrivate),u.zc("cdkDragData",c),u.Sb(1),u.Vb("active",c.id===r.activeCollectionId),u.zc("ngClass","depth-"+r.depth),u.Sb(2),u.zc("ngIf",null==c.children?null:c.children.length)("ngIfElse",i),u.Sb(3),u.Xc(" ",c.name," "),u.Sb(2),u.zc("ngIf",c.isPrivate),u.Sb(1),u.zc("routerLink",u.Dc(45,lt,u.Dc(43,Nn,c.id))),u.Sb(2),u.Xc(" ",u.uc(12,25,"catalog.view-contents")," "),u.Sb(2),u.zc("routerLink",u.Dc(47,Gn,c.id)),u.Sb(2),u.Xc(" ",u.uc(16,27,"common.edit")," "),u.Sb(2),u.zc("vdrIfPermissions",u.Cc(49,Wn)),u.Sb(5),u.zc("vdrIfPermissions",u.Cc(50,Ae)),u.Sb(2),u.zc("disabled",0===a||!u.uc(25,29,r.hasUpdatePermission$)),u.Sb(3),u.Xc(" ",u.uc(28,31,"catalog.move-up")," "),u.Sb(2),u.zc("disabled",a===r.collectionTree.children.length-1||!u.uc(30,33,r.hasUpdatePermission$)),u.Sb(3),u.Xc(" ",u.uc(33,35,"catalog.move-down")," "),u.Sb(3),u.Wc(u.uc(36,37,"catalog.move-to")),u.Sb(2),u.zc("ngForOf",r.getMoveListItems(c)),u.Sb(2),u.zc("disabled",!u.uc(40,39,r.hasDeletePermission$)),u.Sb(3),u.Xc(" ",u.uc(43,41,"common.delete")," "),u.Sb(2),u.zc("ngIf",c.expanded||r.expandAll)}}function Un(e,t){if(1&e){var n=u.kc();u.jc(0,"div",7),u.jc(1,"div",8),u.jc(2,"label"),u.Vc(3),u.tc(4,"translate"),u.ic(),u.jc(5,"input",9),u.qc("ngModelChange",function(e){return t.$implicit.name=e})("keydown.enter",function(e){u.Mc(n);var t=u.Jc(11);return u.sc().handleEnter(e,t)}),u.ic(),u.ic(),u.jc(6,"div",10),u.jc(7,"label"),u.Vc(8),u.tc(9,"translate"),u.ic(),u.jc(10,"vdr-option-value-input",11,12),u.qc("ngModelChange",function(e){return t.$implicit.values=e})("ngModelChange",function(){return u.Mc(n),u.sc().generateVariants()}),u.ic(),u.ic(),u.jc(12,"div",13),u.jc(13,"button",14),u.qc("click",function(){u.Mc(n);var e=t.$implicit;return u.sc().removeOption(e.name)}),u.tc(14,"translate"),u.ec(15,"clr-icon",15),u.ic(),u.ic(),u.ic()}if(2&e){var c=t.$implicit;u.Sb(3),u.Wc(u.uc(4,7,"catalog.option")),u.Sb(2),u.zc("ngModel",c.name),u.Sb(3),u.Wc(u.uc(9,9,"catalog.option-values")),u.Sb(2),u.zc("ngModel",c.values)("groupName",c.name)("disabled",""===c.name),u.Sb(3),u.zc("title",u.uc(14,11,"catalog.remove-option"))}}function Bn(e,t){1&e&&(u.jc(0,"th"),u.Vc(1),u.tc(2,"translate"),u.ic()),2&e&&(u.Sb(1),u.Wc(u.uc(2,1,"common.create")))}function Rn(e,t){1&e&&(u.jc(0,"th"),u.Vc(1),u.tc(2,"translate"),u.ic()),2&e&&(u.Sb(1),u.Wc(u.uc(2,1,"catalog.variant")))}function Hn(e,t){if(1&e){var n=u.kc();u.jc(0,"td"),u.jc(1,"input",19),u.qc("change",function(){return u.Mc(n),u.sc(2).onFormChange()})("ngModelChange",function(e){u.Mc(n);var t=u.sc().$implicit;return u.sc().variantFormValues[t.id].enabled=e}),u.ic(),u.ic()}if(2&e){var c=u.sc().$implicit,a=u.sc();u.Sb(1),u.zc("ngModel",a.variantFormValues[c.id].enabled)}}function Jn(e,t){if(1&e&&(u.jc(0,"td"),u.Vc(1),u.ic()),2&e){var n=u.sc().$implicit;u.Sb(1),u.Xc(" ",n.values.join(" ")," ")}}function Qn(e,t){if(1&e){var n=u.kc();u.jc(0,"tr"),u.Tc(1,Hn,2,1,"td",5),u.Tc(2,Jn,2,1,"td",5),u.jc(3,"td"),u.jc(4,"clr-input-container"),u.jc(5,"input",16),u.qc("change",function(){return u.Mc(n),u.sc().onFormChange()})("ngModelChange",function(e){u.Mc(n);var c=t.$implicit;return u.sc().variantFormValues[c.id].sku=e}),u.tc(6,"translate"),u.ic(),u.ic(),u.ic(),u.jc(7,"td"),u.jc(8,"clr-input-container"),u.jc(9,"vdr-currency-input",17),u.qc("ngModelChange",function(e){u.Mc(n);var c=t.$implicit;return u.sc().variantFormValues[c.id].price=e})("ngModelChange",function(){return u.Mc(n),u.sc().onFormChange()}),u.ic(),u.ic(),u.ic(),u.jc(10,"td"),u.jc(11,"clr-input-container"),u.jc(12,"input",18),u.qc("ngModelChange",function(e){u.Mc(n);var c=t.$implicit;return u.sc().variantFormValues[c.id].stock=e})("change",function(){return u.Mc(n),u.sc().onFormChange()}),u.ic(),u.ic(),u.ic(),u.ic()}if(2&e){var c=t.$implicit,a=u.sc();u.Vb("disabled",!a.variantFormValues[c.id].enabled),u.Sb(1),u.zc("ngIf",1<a.variants.length),u.Sb(1),u.zc("ngIf",1<a.variants.length),u.Sb(3),u.zc("ngModel",a.variantFormValues[c.id].sku)("placeholder",u.uc(6,9,"catalog.sku")),u.Sb(4),u.zc("ngModel",a.variantFormValues[c.id].price)("currencyCode",a.currencyCode),u.Sb(3),u.zc("ngModel",a.variantFormValues[c.id].stock)}}var Zn=["textArea"];function Yn(e,t){if(1&e){var n=u.kc();u.jc(0,"vdr-chip",6),u.qc("iconClick",function(){u.Mc(n);var e=t.$implicit;return u.sc(2).removeOption(e)}),u.Vc(1),u.ic()}if(2&e){var c=t.$implicit,a=t.last,i=u.sc(2);u.Vb("selected",a&&i.lastSelected)("locked",c.locked),u.zc("icon",c.locked?"lock":"times")("colorFrom",i.groupName),u.Sb(1),u.Xc(" ",c.name," ")}}function Kn(e,t){if(1&e&&(u.jc(0,"div",4),u.Tc(1,Yn,2,7,"vdr-chip",5),u.ic()),2&e){var n=u.sc();u.Sb(1),u.zc("ngForOf",n.options)}}var ec=["dlg"],tc=["dl"];function nc(e,t){if(1&e){var n=u.kc();u.jc(0,"img",11),u.qc("click",function(){u.Mc(n);var e=u.sc(2);return e.previewAsset(e.featuredAsset)}),u.tc(1,"assetPreview"),u.ic()}if(2&e){var c=u.sc(2);u.zc("src",u.vc(1,1,c.featuredAsset,"small"),u.Oc)}}function cc(e,t){if(1&e){var n=u.kc();u.jc(0,"div",12),u.qc("click",function(){return u.Mc(n),u.sc(2).selectAssets()}),u.ec(1,"clr-icon",13),u.jc(2,"div"),u.Vc(3),u.tc(4,"translate"),u.ic(),u.ic()}2&e&&(u.Sb(3),u.Wc(u.uc(4,1,"catalog.no-featured-asset")))}function ac(e,t){1&e&&u.fc(0)}function ic(e,t){if(1&e){var n=u.kc();u.jc(0,"div",14),u.jc(1,"button",15),u.qc("click",function(){return u.Mc(n),u.sc(2).selectAssets()}),u.ec(2,"clr-icon",16),u.Vc(3),u.tc(4,"translate"),u.ic(),u.ic()}2&e&&(u.Sb(3),u.Xc(" ",u.uc(4,1,"asset.add-asset")," "))}function rc(e,t){if(1&e&&(u.jc(0,"div",3),u.jc(1,"div",4),u.jc(2,"div",5),u.Tc(3,nc,2,4,"img",6),u.Tc(4,cc,5,3,"div",7),u.ic(),u.ic(),u.jc(5,"div",8),u.Tc(6,ac,1,0,"ng-container",9),u.ic(),u.Tc(7,ic,5,3,"div",10),u.ic()),2&e){var n=u.sc(),c=u.Jc(4);u.Sb(3),u.zc("ngIf",n.featuredAsset),u.Sb(1),u.zc("ngIf",!n.featuredAsset),u.Sb(2),u.zc("ngTemplateOutlet",c),u.Sb(1),u.zc("vdrIfPermissions",n.updatePermissions)}}function oc(e,t){if(1&e){var n=u.kc();u.jc(0,"img",11),u.qc("click",function(){u.Mc(n);var e=u.sc(2);return e.previewAsset(e.featuredAsset)}),u.tc(1,"assetPreview"),u.ic()}if(2&e){var c=u.sc(2);u.zc("src",u.vc(1,1,c.featuredAsset,"thumb"),u.Oc)}}function sc(e,t){if(1&e){var n=u.kc();u.jc(0,"div",12),u.qc("click",function(){return u.Mc(n),u.sc(2).selectAssets()}),u.ec(1,"clr-icon",19),u.ic()}}function lc(e,t){1&e&&u.fc(0)}function uc(e,t){if(1&e){var n=u.kc();u.jc(0,"button",20),u.qc("click",function(){return u.Mc(n),u.sc(2).selectAssets()}),u.tc(1,"translate"),u.ec(2,"clr-icon",16),u.Vc(3),u.tc(4,"translate"),u.ic()}2&e&&(u.zc("title",u.uc(1,2,"asset.add-asset")),u.Sb(3),u.Xc(" ",u.uc(4,4,"asset.add-asset")," "))}function dc(e,t){if(1&e&&(u.jc(0,"div",17),u.Tc(1,oc,2,4,"img",6),u.Tc(2,sc,2,0,"div",7),u.ic(),u.Tc(3,lc,1,0,"ng-container",9),u.Tc(4,uc,5,6,"button",18)),2&e){var n=u.sc(),c=u.Jc(4);u.Sb(1),u.zc("ngIf",n.featuredAsset),u.Sb(1),u.zc("ngIf",!n.featuredAsset),u.Sb(1),u.zc("ngTemplateOutlet",c),u.Sb(1),u.zc("vdrIfPermissions",n.updatePermissions)}}function pc(e,t){if(1&e){var n=u.kc();u.jc(0,"div",23),u.qc("cdkDropListDropped",function(){return u.Mc(n),u.sc(2).dropListDropped()}),u.tc(1,"hasPermission"),u.jc(2,"vdr-dropdown",26),u.qc("cdkDragMoved",function(e){return u.Mc(n),u.sc(2).dragMoved(e)}),u.jc(3,"div",27),u.ec(4,"img",28),u.tc(5,"assetPreview"),u.ic(),u.jc(6,"vdr-dropdown-menu",29),u.jc(7,"button",30),u.qc("click",function(){u.Mc(n);var e=t.$implicit;return u.sc(2).previewAsset(e)}),u.Vc(8),u.tc(9,"translate"),u.ic(),u.jc(10,"button",31),u.qc("click",function(){u.Mc(n);var e=t.$implicit;return u.sc(2).setAsFeatured(e)}),u.tc(11,"hasPermission"),u.Vc(12),u.tc(13,"translate"),u.ic(),u.ec(14,"div",32),u.jc(15,"button",33),u.qc("click",function(){u.Mc(n);var e=t.$implicit;return u.sc(2).removeAsset(e)}),u.tc(16,"hasPermission"),u.Vc(17),u.tc(18,"translate"),u.ic(),u.ic(),u.ic(),u.ic()}if(2&e){var c=t.$implicit,a=u.sc(2);u.zc("cdkDropListDisabled",!u.uc(1,10,a.updatePermissions))("cdkDropListEnterPredicate",a.dropListEnterPredicate),u.Sb(3),u.Vb("featured",a.isFeatured(c)),u.Sb(1),u.zc("src",u.vc(5,12,c,"tiny"),u.Oc),u.Sb(4),u.Xc(" ",u.uc(9,15,"asset.preview")," "),u.Sb(2),u.zc("disabled",a.isFeatured(c)||!u.uc(11,17,a.updatePermissions)),u.Sb(2),u.Xc(" ",u.uc(13,19,"asset.set-as-featured-asset")," "),u.Sb(3),u.zc("disabled",!u.uc(16,21,a.updatePermissions)),u.Sb(2),u.Xc(" ",u.uc(18,23,"asset.remove-asset")," ")}}function fc(e,t){if(1&e){var n=u.kc();u.jc(0,"div",21,22),u.jc(2,"div",23,24),u.qc("cdkDropListDropped",function(){return u.Mc(n),u.sc().dropListDropped()}),u.tc(4,"hasPermission"),u.ic(),u.Tc(5,pc,19,25,"div",25),u.ic()}if(2&e){var c=u.sc();u.Vb("compact",c.compact),u.Sb(2),u.zc("cdkDropListDisabled",!u.uc(4,5,c.updatePermissions))("cdkDropListEnterPredicate",c.dropListEnterPredicate),u.Sb(3),u.zc("ngForOf",c.assets)}}function gc(e,t){1&e&&(u.Vc(0),u.tc(1,"translate")),2&e&&u.Wc(u.uc(1,1,"catalog.update-product-option"))}function mc(e,t){if(1&e&&(u.ec(0,"vdr-custom-field-control",12),u.tc(1,"hasPermission")),2&e){var n=u.sc().$implicit,c=u.sc(2);u.zc("customFieldsFormGroup",c.customFieldsForm)("customField",n)("readonly",!u.uc(1,3,u.Cc(5,Tt)))}}function vc(e,t){if(1&e&&(u.hc(0),u.Tc(1,mc,2,6,"vdr-custom-field-control",11),u.gc()),2&e){var n=t.$implicit,c=u.sc(2);u.Sb(1),u.zc("ngIf",c.customFieldsForm.get(n.name))}}function bc(e,t){if(1&e&&(u.jc(0,"section"),u.jc(1,"label"),u.Vc(2),u.tc(3,"translate"),u.ic(),u.Tc(4,vc,2,1,"ng-container",10),u.ic()),2&e){var n=u.sc();u.Sb(2),u.Wc(u.uc(3,2,"common.custom-fields")),u.Sb(2),u.zc("ngForOf",n.customFields)}}function hc(e,t){if(1&e){var n=u.kc();u.jc(0,"button",13),u.qc("click",function(){return u.Mc(n),u.sc().cancel()}),u.Vc(1),u.tc(2,"translate"),u.ic(),u.jc(3,"button",14),u.qc("click",function(){return u.Mc(n),u.sc().update()}),u.Vc(4),u.tc(5,"translate"),u.ic()}if(2&e){var c=u.sc(),a=u.Jc(4),i=u.Jc(8);u.Sb(1),u.Wc(u.uc(2,3,"common.cancel")),u.Sb(2),u.zc("disabled",a.invalid||i.invalid||a.pristine&&i.pristine&&c.customFieldsForm.pristine),u.Sb(1),u.Xc(" ",u.uc(5,5,"catalog.update-product-option")," ")}}function yc(e,t){1&e&&(u.jc(0,"clr-toggle-wrapper"),u.ec(1,"input",48),u.jc(2,"label"),u.Vc(3),u.tc(4,"translate"),u.ic(),u.ic()),2&e&&(u.Sb(3),u.Wc(u.uc(4,1,"common.enabled")))}function Cc(e,t){if(1&e&&(u.jc(0,"option",51),u.Vc(1),u.ic()),2&e){var n=t.$implicit;u.zc("value",n.id),u.Sb(1),u.Xc(" ",n.name," ")}}function Oc(e,t){if(1&e&&(u.jc(0,"clr-select-container"),u.jc(1,"label"),u.Vc(2),u.tc(3,"translate"),u.ic(),u.jc(4,"select",49),u.Tc(5,Cc,2,2,"option",50),u.ic(),u.ic()),2&e){var n=u.sc(3);u.Sb(2),u.Wc(u.uc(3,2,"catalog.tax-category")),u.Sb(3),u.zc("ngForOf",n.taxCategories)}}function jc(e,t){if(1&e&&(u.jc(0,"label",32),u.Vc(1),u.tc(2,"translate"),u.ic(),u.jc(3,"div",52),u.Vc(4),u.ic()),2&e){var n=u.sc().ngIf,c=u.sc(2);u.Sb(1),u.Wc(u.uc(2,2,"catalog.tax-category")),u.Sb(3),u.Xc(" ",c.getTaxCategoryName(n)," ")}}function kc(e,t){if(1&e&&(u.ec(0,"vdr-currency-input",53),u.tc(1,"hasPermission")),2&e){var n=u.sc(2).$implicit,c=u.sc();u.zc("currencyCode",n.currencyCode)("readonly",!u.uc(1,2,c.updatePermission))}}function Pc(e,t){if(1&e&&(u.ec(0,"vdr-currency-input",54),u.tc(1,"hasPermission")),2&e){var n=u.sc(2).$implicit,c=u.sc();u.zc("currencyCode",n.currencyCode)("readonly",!u.uc(1,2,c.updatePermission))}}function Sc(e,t){if(1&e&&(u.jc(0,"clr-select-container"),u.jc(1,"label"),u.Vc(2),u.tc(3,"translate"),u.ec(4,"vdr-help-tooltip",30),u.tc(5,"translate"),u.ic(),u.jc(6,"select",55),u.jc(7,"option",51),u.Vc(8),u.tc(9,"translate"),u.ic(),u.jc(10,"option",51),u.Vc(11),u.tc(12,"translate"),u.ic(),u.jc(13,"option",51),u.Vc(14),u.tc(15,"translate"),u.ic(),u.ic(),u.ic()),2&e){var n=u.sc(3);u.Sb(2),u.Xc("",u.uc(3,8,"catalog.track-inventory")," "),u.Sb(2),u.zc("content",u.uc(5,10,"catalog.track-inventory-tooltip")),u.Sb(3),u.zc("value",n.GlobalFlag.TRUE),u.Sb(1),u.Xc(" ",u.uc(9,12,"catalog.track-inventory-true")," "),u.Sb(2),u.zc("value",n.GlobalFlag.FALSE),u.Sb(1),u.Xc(" ",u.uc(12,14,"catalog.track-inventory-false")," "),u.Sb(2),u.zc("value",n.GlobalFlag.INHERIT),u.Sb(1),u.Xc(" ",u.uc(15,16,"catalog.track-inventory-inherit")," ")}}function Ic(e,t){if(1&e&&(u.ec(0,"vdr-custom-field-control",59),u.tc(1,"hasPermission")),2&e){var n=u.sc().$implicit,c=u.sc(2).ngIf,a=u.sc(2);u.zc("compact",!0)("customFieldsFormGroup",c.get("customFields"))("readonly",!u.uc(1,4,a.updatePermission))("customField",n)}}var Fc=function(e){return["customFields",e]};function Vc(e,t){if(1&e&&(u.hc(0),u.Tc(1,Ic,2,6,"vdr-custom-field-control",58),u.gc()),2&e){var n=t.$implicit,c=u.sc(2).ngIf;u.Sb(1),u.zc("ngIf",c.get(u.Dc(1,Fc,n.name)))}}function xc(e,t){if(1&e&&(u.jc(0,"section",56),u.Tc(1,Vc,2,3,"ng-container",57),u.ic()),2&e){var n=u.sc(3);u.Sb(1),u.zc("ngForOf",n.customFields)}}function Mc(e,t){if(1&e){var n=u.kc();u.jc(0,"vdr-chip",62),u.qc("iconClick",function(){u.Mc(n);var e=t.$implicit;return u.sc(4).editOption(e)}),u.tc(1,"hasPermission"),u.jc(2,"span",63),u.Vc(3),u.ic(),u.Vc(4),u.ic()}if(2&e){var c=t.$implicit,a=u.sc(4);u.zc("colorFrom",a.optionGroupName(c.groupId))("invert",!0)("icon",u.uc(1,5,a.updatePermission)&&"pencil"),u.Sb(3),u.Wc(a.optionGroupName(c.groupId)),u.Sb(1),u.Xc(" ",a.optionName(c)," ")}}function Tc(e,t){if(1&e&&(u.jc(0,"div"),u.jc(1,"div",60),u.Tc(2,Mc,5,7,"vdr-chip",61),u.tc(3,"sort"),u.ic(),u.ic()),2&e){var n=u.sc(2).$implicit;u.Sb(2),u.zc("ngForOf",u.vc(3,1,n.options,"groupId"))}}function wc(e,t){if(1&e){var n=u.kc();u.jc(0,"vdr-facet-value-chip",64),u.qc("remove",function(){u.Mc(n);var e=t.$implicit,c=u.sc(2).$implicit;return u.sc().removeFacetValue(c,e.id)}),u.tc(1,"hasPermission"),u.ic()}if(2&e){var c=t.$implicit,a=u.sc(3);u.zc("facetValue",c)("removable",u.uc(1,2,a.updatePermission))}}function zc(e,t){if(1&e){var n=u.kc();u.jc(0,"vdr-facet-value-chip",64),u.qc("remove",function(){u.Mc(n);var e=t.$implicit,c=u.sc(2).$implicit;return u.sc().removeFacetValue(c,e.id)}),u.tc(1,"hasPermission"),u.ic()}if(2&e){var c=t.$implicit,a=u.sc(3);u.zc("facetValue",c)("removable",u.uc(1,2,a.updatePermission))}}function Dc(e,t){if(1&e){var n=u.kc();u.jc(0,"button",65),u.qc("click",function(){u.Mc(n);var e=u.sc(2).$implicit;return u.sc().selectFacetValueClick.emit([e.id])}),u.ec(1,"clr-icon",66),u.Vc(2),u.tc(3,"translate"),u.ic()}2&e&&(u.Sb(2),u.Xc(" ",u.uc(3,1,"catalog.add-facets")," "))}function Ac(e,t){if(1&e){var n=u.kc();u.jc(0,"vdr-chip",72),u.qc("iconClick",function(){u.Mc(n);var e=u.sc().$implicit,t=u.sc(4).$implicit;return u.sc().removeFromChannel.emit({channelId:e.id,variant:t})}),u.tc(1,"translate"),u.ec(2,"vdr-channel-badge",73),u.Vc(3),u.tc(4,"channelCodeToLabel"),u.ic()}if(2&e){var c=u.sc().$implicit;u.zc("title",u.uc(1,3,"catalog.remove-from-channel")),u.Sb(2),u.zc("channelCode",c.code),u.Sb(1),u.Xc(" ",u.uc(4,5,c.code)," ")}}function $c(e,t){if(1&e&&(u.hc(0),u.Tc(1,Ac,5,7,"vdr-chip",71),u.gc()),2&e){var n=t.$implicit,c=u.sc(5);u.Sb(1),u.zc("ngIf",!c.isDefaultChannel(n.code))}}function _c(e,t){if(1&e){var n=u.kc();u.jc(0,"div",16),u.jc(1,"div",68),u.Tc(2,$c,2,1,"ng-container",57),u.jc(3,"button",69),u.qc("click",function(){u.Mc(n);var e=u.sc(3).$implicit;return u.sc().assignToChannel.emit(e)}),u.ec(4,"clr-icon",70),u.Vc(5),u.tc(6,"translate"),u.ic(),u.ic(),u.ic()}if(2&e){var c=u.sc(3).$implicit;u.Sb(2),u.zc("ngForOf",c.channels),u.Sb(3),u.Xc(" ",u.uc(6,2,"catalog.assign-to-channel")," ")}}function Lc(e,t){1&e&&(u.hc(0),u.Tc(1,_c,7,4,"div",67),u.gc())}function Ec(e,t){if(1&e){var n=u.kc();u.hc(0,7),u.jc(1,"div",8),u.jc(2,"div",9),u.jc(3,"vdr-title-input",10),u.tc(4,"hasPermission"),u.jc(5,"clr-input-container"),u.ec(6,"input",11),u.tc(7,"hasPermission"),u.tc(8,"translate"),u.ic(),u.ic(),u.jc(9,"vdr-title-input",12),u.tc(10,"hasPermission"),u.jc(11,"clr-input-container"),u.ec(12,"input",13),u.tc(13,"hasPermission"),u.tc(14,"translate"),u.ic(),u.ic(),u.ic(),u.jc(15,"div",14),u.Tc(16,yc,5,3,"clr-toggle-wrapper",15),u.ic(),u.ic(),u.jc(17,"div",16),u.jc(18,"div",17),u.jc(19,"div",18),u.jc(20,"vdr-product-assets",19),u.qc("change",function(e){u.Mc(n);var t=u.sc().$implicit;return u.sc().onAssetChange(t.id,e)}),u.ic(),u.ic(),u.jc(21,"div",20),u.jc(22,"div",21),u.jc(23,"div",22),u.jc(24,"div",23),u.Tc(25,Oc,6,4,"clr-select-container",24),u.Tc(26,jc,5,4,"ng-template",null,25,u.Uc),u.ic(),u.jc(28,"div",26),u.jc(29,"clr-input-container"),u.jc(30,"label"),u.Vc(31),u.tc(32,"translate"),u.ic(),u.Tc(33,kc,2,4,"vdr-currency-input",27),u.Tc(34,Pc,2,4,"vdr-currency-input",28),u.ic(),u.ic(),u.ec(35,"vdr-variant-price-detail",29),u.ic(),u.jc(36,"div",22),u.Tc(37,Sc,16,18,"clr-select-container",15),u.jc(38,"clr-input-container"),u.jc(39,"label"),u.Vc(40),u.tc(41,"translate"),u.ec(42,"vdr-help-tooltip",30),u.tc(43,"translate"),u.ic(),u.ec(44,"input",31),u.tc(45,"hasPermission"),u.ic(),u.jc(46,"div"),u.jc(47,"label",32),u.Vc(48),u.tc(49,"translate"),u.ec(50,"vdr-help-tooltip",30),u.tc(51,"translate"),u.ic(),u.jc(52,"div",33),u.Vc(53),u.ic(),u.ic(),u.jc(54,"div"),u.jc(55,"label",32),u.Vc(56),u.tc(57,"translate"),u.ec(58,"vdr-help-tooltip",30),u.tc(59,"translate"),u.ic(),u.jc(60,"div",33),u.Vc(61),u.ic(),u.ic(),u.ic(),u.jc(62,"div",22),u.jc(63,"div",34),u.jc(64,"label",32),u.Vc(65),u.tc(66,"translate"),u.ec(67,"vdr-help-tooltip",30),u.tc(68,"translate"),u.ic(),u.jc(69,"div",35),u.jc(70,"clr-input-container"),u.ec(71,"input",36),u.tc(72,"hasPermission"),u.ic(),u.jc(73,"clr-toggle-wrapper"),u.ec(74,"input",37),u.tc(75,"hasPermission"),u.jc(76,"label"),u.Vc(77),u.tc(78,"translate"),u.ic(),u.ic(),u.ic(),u.ic(),u.ic(),u.ic(),u.jc(79,"div",38),u.jc(80,"div",22),u.Tc(81,xc,2,1,"section",39),u.ic(),u.ic(),u.ic(),u.ic(),u.ic(),u.jc(82,"div",16),u.jc(83,"div",40),u.ec(84,"vdr-entity-info",41),u.Tc(85,Tc,4,4,"div",42),u.ec(86,"div",43),u.jc(87,"div",44),u.Tc(88,wc,2,4,"vdr-facet-value-chip",45),u.Tc(89,zc,2,4,"vdr-facet-value-chip",45),u.Tc(90,Dc,4,3,"button",46),u.ic(),u.ic(),u.ic(),u.Tc(91,Lc,2,0,"ng-container",47),u.gc()}if(2&e){var c,a=t.ngIf,i=u.Jc(27),r=u.sc().$implicit,o=u.sc();u.zc("formGroup",a),u.Sb(3),u.zc("readonly",!u.uc(4,53,o.updatePermission)),u.Sb(3),u.zc("readonly",!u.uc(7,55,o.updatePermission))("placeholder",u.uc(8,57,"catalog.sku")),u.Sb(3),u.zc("readonly",!u.uc(10,59,o.updatePermission)),u.Sb(3),u.zc("readonly",!u.uc(13,61,o.updatePermission))("placeholder",u.uc(14,63,"common.name")),u.Sb(4),u.zc("vdrIfPermissions",o.updatePermission),u.Sb(4),u.zc("compact",!0)("assets",(null==o.pendingAssetChanges[r.id]?null:o.pendingAssetChanges[r.id].assets)||r.assets)("featuredAsset",(null==o.pendingAssetChanges[r.id]?null:o.pendingAssetChanges[r.id].featuredAsset)||r.featuredAsset),u.Sb(5),u.zc("vdrIfPermissions",o.updatePermission)("vdrIfPermissionsElse",i),u.Sb(6),u.Wc(u.uc(32,65,"catalog.price")),u.Sb(2),u.zc("ngIf",!o.channelPriceIncludesTax),u.Sb(1),u.zc("ngIf",o.channelPriceIncludesTax),u.Sb(1),u.zc("price",a.get("price").value)("currencyCode",r.currencyCode)("priceIncludesTax",o.channelPriceIncludesTax)("taxCategoryId",a.get("taxCategoryId").value),u.Sb(2),u.zc("vdrIfPermissions",o.updatePermission),u.Sb(3),u.Xc("",u.uc(41,67,"catalog.stock-on-hand")," "),u.Sb(2),u.zc("content",u.uc(43,69,"catalog.stock-on-hand-tooltip")),u.Sb(2),u.Vb("inventory-untracked",o.inventoryIsNotTracked(a)),u.zc("readonly",!u.uc(45,71,o.updatePermission))("vdrDisabled",o.inventoryIsNotTracked(a)),u.Sb(2),u.Vb("inventory-untracked",o.inventoryIsNotTracked(a)),u.Sb(2),u.Xc("",u.uc(49,73,"catalog.stock-allocated")," "),u.Sb(2),u.zc("content",u.uc(51,75,"catalog.stock-allocated-tooltip")),u.Sb(3),u.Xc(" ",r.stockAllocated," "),u.Sb(1),u.Vb("inventory-untracked",o.inventoryIsNotTracked(a)),u.Sb(2),u.Xc("",u.uc(57,77,"catalog.stock-saleable")," "),u.Sb(2),u.zc("content",u.uc(59,79,"catalog.stock-saleable-tooltip")),u.Sb(3),u.Xc(" ",o.getSaleableStockLevel(r)," "),u.Sb(2),u.Vb("inventory-untracked",o.inventoryIsNotTracked(a)),u.Sb(2),u.Wc(u.uc(66,81,"catalog.out-of-stock-threshold")),u.Sb(2),u.zc("content",u.uc(68,83,"catalog.out-of-stock-threshold-tooltip")),u.Sb(4),u.zc("formControl",a.get("outOfStockThreshold"))("readonly",!u.uc(72,85,o.updatePermission))("vdrDisabled",!1!==(null==(c=a.get("useGlobalOutOfStockThreshold"))?null:c.value)||o.inventoryIsNotTracked(a)),u.Sb(3),u.zc("vdrDisabled",!u.uc(75,87,o.updatePermission)||o.inventoryIsNotTracked(a)),u.Sb(3),u.Yc("",u.uc(78,89,"catalog.use-global-value")," (",o.globalOutOfStockThreshold,")"),u.Sb(4),u.zc("ngIf",o.customFields.length),u.Sb(3),u.zc("entity",r),u.Sb(1),u.zc("ngIf",r.options.length),u.Sb(3),u.zc("ngForOf",o.existingFacetValues(r)),u.Sb(1),u.zc("ngForOf",o.pendingFacetValues(r)),u.Sb(1),u.zc("vdrIfPermissions",o.updatePermission)}}function qc(e,t){if(1&e&&(u.jc(0,"div",5),u.Tc(1,Ec,92,91,"ng-container",6),u.ic()),2&e){var n=t.$implicit,c=u.sc(),a=null,i=null;u.Vb("disabled",!(null!=(a=c.formGroupMap.get(n.id))&&null!=(i=a.get("enabled"))&&i.value)),u.Sb(1),u.zc("ngIf",c.formGroupMap.get(n.id))}}function Nc(e,t){if(1&e&&(u.hc(0),u.jc(1,"vdr-dt-column"),u.Vc(2),u.ic(),u.gc()),2&e){var n=t.$implicit;u.Sb(2),u.Wc(n.name)}}function Gc(e,t){if(1&e&&(u.ec(0,"img",17),u.tc(1,"assetPreview")),2&e){var n=t.ngIf;u.zc("src",u.vc(1,1,n,"tiny"),u.Oc)}}function Wc(e,t){1&e&&(u.jc(0,"div",18),u.ec(1,"clr-icon",19),u.ic())}function Xc(e,t){if(1&e&&(u.hc(0),u.jc(1,"td",4),u.tc(2,"stringToColor"),u.Vc(3),u.ic(),u.gc()),2&e){var n=t.$implicit,c=u.sc().ngIf,a=u.sc(2);u.Sb(1),u.Qc("color",u.uc(2,5,a.optionGroupName(n.groupId))),u.Vb("disabled",!c.get("enabled").value),u.Sb(2),u.Xc(" ",n.name," ")}}function Uc(e,t){if(1&e&&(u.ec(0,"vdr-currency-input",20),u.tc(1,"hasPermission")),2&e){var n=u.sc(2).item,c=u.sc();u.zc("currencyCode",n.currencyCode)("readonly",!u.uc(1,2,c.updatePermission))}}function Bc(e,t){if(1&e&&(u.ec(0,"vdr-currency-input",21),u.tc(1,"hasPermission")),2&e){var n=u.sc(2).item,c=u.sc();u.zc("currencyCode",n.currencyCode)("readonly",!u.uc(1,2,c.updatePermission))}}function Rc(e,t){if(1&e&&(u.hc(0,3),u.jc(1,"td",4),u.jc(2,"div",5),u.jc(3,"div",6),u.Tc(4,Gc,2,4,"img",7),u.Tc(5,Wc,2,0,"ng-template",null,8,u.Uc),u.ic(),u.ic(),u.ic(),u.jc(7,"td",4),u.jc(8,"clr-input-container"),u.ec(9,"input",9),u.tc(10,"hasPermission"),u.tc(11,"translate"),u.ic(),u.ic(),u.jc(12,"td",4),u.jc(13,"clr-input-container"),u.ec(14,"input",10),u.tc(15,"hasPermission"),u.tc(16,"translate"),u.ic(),u.ic(),u.Tc(17,Xc,4,7,"ng-container",1),u.tc(18,"sort"),u.jc(19,"td",11),u.jc(20,"clr-input-container"),u.Tc(21,Uc,2,4,"vdr-currency-input",12),u.Tc(22,Bc,2,4,"vdr-currency-input",13),u.ic(),u.ic(),u.jc(23,"td",14),u.jc(24,"clr-input-container"),u.ec(25,"input",15),u.tc(26,"hasPermission"),u.ic(),u.ic(),u.jc(27,"td",14),u.jc(28,"clr-toggle-wrapper"),u.ec(29,"input",16),u.tc(30,"hasPermission"),u.ic(),u.ic(),u.gc()),2&e){var n=t.ngIf,c=u.Jc(6),a=u.sc().item,i=u.sc();u.zc("formGroup",n),u.Sb(1),u.Vb("disabled",!n.get("enabled").value),u.Sb(3),u.zc("ngIf",i.getFeaturedAsset(a))("ngIfElse",c),u.Sb(3),u.Vb("disabled",!n.get("enabled").value),u.Sb(2),u.zc("readonly",!u.uc(10,24,i.updatePermission))("placeholder",u.uc(11,26,"common.name")),u.Sb(3),u.Vb("disabled",!n.get("enabled").value),u.Sb(2),u.zc("readonly",!u.uc(15,28,i.updatePermission))("placeholder",u.uc(16,30,"catalog.sku")),u.Sb(3),u.zc("ngForOf",u.vc(18,32,a.options,"groupId")),u.Sb(2),u.Vb("disabled",!n.get("enabled").value),u.Sb(2),u.zc("ngIf",!i.channelPriceIncludesTax),u.Sb(1),u.zc("ngIf",i.channelPriceIncludesTax),u.Sb(1),u.Vb("disabled",!n.get("enabled").value),u.Sb(2),u.zc("readonly",!u.uc(26,35,i.updatePermission)),u.Sb(2),u.Vb("disabled",!n.get("enabled").value),u.Sb(2),u.zc("vdrDisabled",!u.uc(30,37,i.updatePermission))}}function Hc(e,t){if(1&e&&u.Tc(0,Rc,31,39,"ng-container",2),2&e){var n=t.item,c=u.sc();u.zc("ngIf",c.formGroupMap.get(n.id))}}var Jc=function(e){return{rate:e}};function Qc(e,t){if(1&e&&(u.jc(0,"div",2),u.Vc(1),u.tc(2,"translate"),u.tc(3,"async"),u.ic()),2&e){var n=u.sc();u.Sb(1),u.Xc(" ",u.vc(2,1,"catalog.price-includes-tax-at",u.Dc(6,Jc,u.uc(3,4,n.taxRate$))),"\n")}}var Zc=function(e,t){return{price:e,rate:t}};function Yc(e,t){if(1&e&&(u.jc(0,"div",2),u.Vc(1),u.tc(2,"translate"),u.tc(3,"localeCurrency"),u.tc(4,"async"),u.tc(5,"async"),u.ic()),2&e){var n=u.sc();u.Sb(1),u.Xc(" ",u.vc(2,1,"catalog.price-with-tax-in-default-zone",u.Ec(11,Zc,u.vc(3,4,u.uc(4,7,n.grossPrice$),n.currencyCode),u.uc(5,9,n.taxRate$))),"\n")}}var Kc=function(e){o(a,e);var t=l(a);function a(e,n,c,i,r,o){var s;return f(this,a),(s=t.call(this,n,e,c,r)).notificationService=i,s.dataService=r,s.formBuilder=o,s.detailForm=new _.i({}),s.customFields=s.getCustomFieldConfig("Asset"),s}return m(a,[{key:"ngOnInit",value:function(){this.detailForm=new _.i({name:new _.f(""),tags:new _.f([]),customFields:this.formBuilder.group(this.customFields.reduce(function(e,t){return Object.assign(Object.assign({},e),c({},t.name,""))},{}))}),this.init()}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"onAssetChange",value:function(e){var t,n;null===(t=this.detailForm.get("name"))||void 0===t||t.setValue(e.name),null===(n=this.detailForm.get("tags"))||void 0===n||n.setValue(e.tags),this.detailForm.markAsDirty()}},{key:"save",value:function(){var e=this;this.dataService.product.updateAsset({id:this.id,name:this.detailForm.value.name,tags:this.detailForm.value.tags,customFields:this.detailForm.value.customFields}).subscribe(function(){e.notificationService.success(Object(b.a)("common.notify-update-success"),{entity:"Asset"})},function(t){e.notificationService.error(Object(b.a)("common.notify-update-error"),{entity:"Asset"})})}},{key:"setFormValues",value:function(e,t){var c,a;if(null===(c=this.detailForm.get("name"))||void 0===c||c.setValue(e.name),null===(a=this.detailForm.get("tags"))||void 0===a||a.setValue(e.tags),this.customFields.length){var i,r=this.detailForm.get("customFields"),o=n(this.customFields);try{for(o.s();!(i=o.n()).done;){var s=i.value.name,l=e.customFields[s],u=r.get(s);u&&u.patchValue(l)}}catch(d){o.e(d)}finally{o.f()}}}}]),a}(v.w);Kc.\u0275fac=function(e){return new(e||Kc)(u.dc(g.e),u.dc(g.a),u.dc(v.Lb),u.dc(v.Db),u.dc(v.L),u.dc(_.e))},Kc.\u0275cmp=u.Xb({type:Kc,selectors:[["vdr-asset-detail"]],features:[u.Pb],decls:9,vars:11,consts:[[3,"entity"],["locationId","asset-detail"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"asset","editable","customFields","customFieldsForm","assetChange"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(u.jc(0,"vdr-action-bar"),u.jc(1,"vdr-ab-left"),u.ec(2,"vdr-entity-info",0),u.tc(3,"async"),u.ic(),u.jc(4,"vdr-ab-right"),u.ec(5,"vdr-action-bar-items",1),u.Tc(6,re,3,4,"button",2),u.ic(),u.ic(),u.jc(7,"vdr-asset-preview",3),u.qc("assetChange",function(e){return t.onAssetChange(e)}),u.tc(8,"async"),u.ic()),2&e&&(u.Sb(2),u.zc("entity",u.uc(3,6,t.entity$)),u.Sb(4),u.zc("vdrIfPermissions",u.Cc(10,oe)),u.Sb(1),u.zc("asset",u.uc(8,8,t.entity$))("editable",!0)("customFields",t.customFields)("customFieldsForm",t.detailForm.get("customFields")))},directives:[v.c,v.e,v.ab,v.f,v.d,v.qb,v.p],pipes:[J.b,ce.d],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"],changeDetection:0}),Kc.ctorParameters=function(){return[{type:g.e},{type:g.a},{type:v.Lb},{type:v.Db},{type:v.L},{type:_.e}]};var ea=function(c){o(i,c);var a=l(i);function i(e,n,c,r,o){var s,l;return f(this,i),(l=a.call(this,r,o)).notificationService=e,l.modalService=n,l.dataService=c,l.searchTerm$=new L.a(void 0),l.filterByTags$=new L.a(void 0),l.uploading=!1,t((s=d(l),p(i.prototype)),"setQueryFn",s).call(s,function(){var e;return(e=l.dataService.product).getAssetList.apply(e,arguments)},function(e){return e.assets},function(e,t){var n,c=l.searchTerm$.value,a=null===(n=l.filterByTags$.value)||void 0===n?void 0:n.map(function(e){return e.value});return{options:Object.assign(Object.assign({skip:e,take:t},c?{filter:{name:{contains:c}}}:{}),{sort:{createdAt:v.Ob.DESC},tags:a,tagsOperator:v.Bb.AND})}},{take:25,skip:0}),l}return m(i,[{key:"ngOnInit",value:function(){var n=this;t(p(i.prototype),"ngOnInit",this).call(this),this.paginationConfig$=Object(E.a)(this.itemsPerPage$,this.currentPage$,this.totalItems$).pipe(Object(h.a)(function(t){var n=e(t,3);return{itemsPerPage:n[0],currentPage:n[1],totalItems:n[2]}})),this.searchTerm$.pipe(Object(y.a)(250),Object(C.a)(this.destroy$)).subscribe(function(){return n.refresh()}),this.filterByTags$.pipe(Object(C.a)(this.destroy$)).subscribe(function(){return n.refresh()}),this.allTags$=this.dataService.product.getTagList().mapStream(function(e){return e.tags.items})}},{key:"filesSelected",value:function(e){var c=this;e.length&&(this.uploading=!0,this.dataService.product.createAssets(e).pipe(Object(O.a)(function(){return c.uploading=!1})).subscribe(function(e){var a,r=0,o=n(e.createAssets);try{for(o.s();!(a=o.n()).done;){var s=a.value;switch(s.__typename){case"Asset":r++;break;case"MimeTypeError":c.notificationService.error(s.message)}}}catch(l){o.e(l)}finally{o.f()}0<r&&(t(p(i.prototype),"refresh",c).call(c),c.notificationService.success(Object(b.a)("asset.notify-create-assets-success"),{count:r}))}))}},{key:"deleteAssets",value:function(e){var t=this;this.showModalAndDelete(e.map(function(e){return e.id})).pipe(Object(j.a)(function(n){return n.result===v.P.DELETED?[!0]:t.showModalAndDelete(e.map(function(e){return e.id}),n.message||"").pipe(Object(h.a)(function(e){return e.result===v.P.DELETED}))})).subscribe(function(){t.notificationService.success(Object(b.a)("common.notify-delete-success"),{entity:"Assets"}),t.refresh()},function(e){t.notificationService.error(Object(b.a)("common.notify-delete-error"),{entity:"Assets"})})}},{key:"showModalAndDelete",value:function(e,t){var n=this;return this.modalService.dialog({title:Object(b.a)("catalog.confirm-delete-assets"),translationVars:{count:e.length},body:t,buttons:[{type:"secondary",label:Object(b.a)("common.cancel")},{type:"danger",label:Object(b.a)("common.delete"),returnValue:!0}]}).pipe(Object(j.a)(function(c){return c?n.dataService.product.deleteAssets(e,!!t):q.a}),Object(h.a)(function(e){return e.deleteAssets}))}}]),i}(v.y);ea.\u0275fac=function(e){return new(e||ea)(u.dc(v.Db),u.dc(v.Cb),u.dc(v.L),u.dc(g.e),u.dc(g.a))},ea.\u0275cmp=u.Xb({type:ea,selectors:[["vdr-asset-list"]],features:[u.Pb],decls:19,vars:31,consts:[[3,"grow"],[1,"pr4","mt1",3,"tags","searchTermChange","tagsChange"],["locationId","asset-list"],["dropZoneTarget",".content-area",3,"uploading","selectFiles"],[3,"assets","multiSelect","canDelete","deleteAssets"],[1,"paging-controls"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","totalItems","pageChange"]],template:function(e,t){1&e&&(u.jc(0,"vdr-action-bar"),u.jc(1,"vdr-ab-left",0),u.jc(2,"vdr-asset-search-input",1),u.qc("searchTermChange",function(e){return t.searchTerm$.next(e)})("tagsChange",function(e){return t.filterByTags$.next(e)}),u.tc(3,"async"),u.ic(),u.ic(),u.jc(4,"vdr-ab-right"),u.ec(5,"vdr-action-bar-items",2),u.jc(6,"vdr-asset-file-input",3),u.qc("selectFiles",function(e){return t.filesSelected(e)}),u.ic(),u.ic(),u.ic(),u.jc(7,"vdr-asset-gallery",4),u.qc("deleteAssets",function(e){return t.deleteAssets(e)}),u.tc(8,"paginate"),u.tc(9,"async"),u.tc(10,"async"),u.tc(11,"hasPermission"),u.ic(),u.jc(12,"div",5),u.jc(13,"vdr-items-per-page-controls",6),u.qc("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),u.tc(14,"async"),u.ic(),u.jc(15,"vdr-pagination-controls",7),u.qc("pageChange",function(e){return t.setPageNumber(e)}),u.tc(16,"async"),u.tc(17,"async"),u.tc(18,"async"),u.ic(),u.ic()),2&e&&(u.Sb(1),u.zc("grow",!0),u.Sb(1),u.zc("tags",u.uc(3,10,t.allTags$)),u.Sb(4),u.zc("uploading",t.uploading),u.Sb(1),u.zc("assets",u.vc(8,12,u.uc(9,15,t.items$),u.uc(10,17,t.paginationConfig$)||u.Cc(29,se)))("multiSelect",!0)("canDelete",u.uc(11,19,u.Cc(30,le))),u.Sb(6),u.zc("itemsPerPage",u.uc(14,21,t.itemsPerPage$)),u.Sb(2),u.zc("currentPage",u.uc(16,23,t.currentPage$))("itemsPerPage",u.uc(17,25,t.itemsPerPage$))("totalItems",u.uc(18,27,t.totalItems$)))},directives:[v.c,v.e,v.s,v.f,v.d,v.m,v.n,v.rb,v.Gb],pipes:[J.b,ae.b,v.ib],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}vdr-asset-gallery[_ngcontent-%COMP%]{flex:1}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]}),ea.ctorParameters=function(){return[{type:v.Db},{type:v.Cb},{type:v.L},{type:g.e},{type:g.a}]};var ta=function(){function t(e,n,c){f(this,t),this.route=e,this.router=n,this.dataService=c,this.filterTermControl=new _.f(""),this.collectionIdChange$=new L.a(""),this.refresh$=new L.a(!0),this.destroy$=new N.a}return m(t,[{key:"ngOnInit",value:function(){var t=this;this.contentsCurrentPage$=this.route.paramMap.pipe(Object(h.a)(function(e){return e.get("contentsPage")}),Object(h.a)(function(e){return e?+e:1}),Object(k.a)(1),Object(P.a)()),this.contentsItemsPerPage$=this.route.paramMap.pipe(Object(h.a)(function(e){return e.get("contentsPerPage")}),Object(h.a)(function(e){return e?+e:10}),Object(k.a)(10),Object(P.a)());var n=this.filterTermControl.valueChanges.pipe(Object(y.a)(250),Object(S.a)(function(){return t.setContentsPageNumber(1)}),Object(k.a)("")),c=Object(E.a)(this.collectionIdChange$,this.contentsCurrentPage$,this.contentsItemsPerPage$,n,this.refresh$).pipe(Object(C.a)(this.destroy$),Object(j.a)(function(n){var c=e(n,4),a=c[0],i=c[1],r=c[2],o=c[3],s=r,l=(i-1)*r;return a?t.dataService.collection.getCollectionContents(a,s,l,o).mapSingle(function(e){return e.collection}):Object(G.a)(null)}));this.contents$=c.pipe(Object(h.a)(function(e){return e?e.productVariants.items:[]})),this.contentsTotalItems$=c.pipe(Object(h.a)(function(e){return e?e.productVariants.totalItems:0}))}},{key:"ngOnChanges",value:function(e){"collectionId"in e&&this.collectionIdChange$.next(e.collectionId.currentValue)}},{key:"ngOnDestroy",value:function(){this.destroy$.next(),this.destroy$.complete()}},{key:"setContentsPageNumber",value:function(e){this.setParam("contentsPage",e)}},{key:"setContentsItemsPerPage",value:function(e){this.setParam("contentsPerPage",e)}},{key:"refresh",value:function(){this.refresh$.next(!0)}},{key:"setParam",value:function(e,t){this.router.navigate(["./",Object.assign(Object.assign({},this.route.snapshot.params),c({},e,t))],{relativeTo:this.route,queryParamsHandling:"merge"})}}]),t}();ta.\u0275fac=function(e){return new(e||ta)(u.dc(g.a),u.dc(g.e),u.dc(v.L))},ta.\u0275cmp=u.Xb({type:ta,selectors:[["vdr-collection-contents"]],contentQueries:function(e,t,n){var c;(1&e&&u.Wb(n,u.bb,3),2&e)&&(u.Ic(c=u.rc())&&(t.headerTemplate=c.first))},inputs:{collectionId:"collectionId"},features:[u.Qb],decls:12,vars:22,consts:[[1,"contents-header"],[1,"header-title-row"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["type","text",3,"placeholder","formControl"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"left","align-middle"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"]],template:function(e,t){1&e&&(u.jc(0,"div",0),u.jc(1,"div",1),u.Tc(2,ue,1,0,"ng-container",2),u.tc(3,"async"),u.ic(),u.ec(4,"input",3),u.tc(5,"translate"),u.ic(),u.jc(6,"vdr-data-table",4),u.qc("pageChange",function(e){return t.setContentsPageNumber(e)})("itemsPerPageChange",function(e){return t.setContentsItemsPerPage(e)}),u.tc(7,"async"),u.tc(8,"async"),u.tc(9,"async"),u.tc(10,"async"),u.Tc(11,fe,5,9,"ng-template"),u.ic()),2&e&&(u.Sb(2),u.zc("ngTemplateOutlet",t.headerTemplate)("ngTemplateOutletContext",u.Dc(20,ge,u.uc(3,8,t.contentsTotalItems$))),u.Sb(2),u.zc("placeholder",u.uc(5,10,"catalog.filter-by-name"))("formControl",t.filterTermControl),u.Sb(2),u.zc("items",u.uc(7,12,t.contents$))("itemsPerPage",u.uc(8,14,t.contentsItemsPerPage$))("totalItems",u.uc(9,16,t.contentsTotalItems$))("currentPage",u.uc(10,18,t.contentsCurrentPage$)))},directives:[J.t,v.eb,_.b,_.p,_.g,v.N,v.Sb],pipes:[J.b,ce.d],styles:[".contents-header[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);position:sticky;top:0;padding:6px;z-index:1;border-bottom:1px solid var(--color-component-border-200)}.contents-header[_ngcontent-%COMP%]   .header-title-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.contents-header[_ngcontent-%COMP%]   .clr-input[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]     table{margin-top:-1px}"],changeDetection:0}),ta.ctorParameters=function(){return[{type:g.a},{type:g.e},{type:v.L}]},ta.propDecorators={collectionId:[{type:u.E}],headerTemplate:[{type:u.o,args:[u.bb,{static:!0}]}]};var na=function(a){o(r,a);var i=l(r);function r(e,t,n,a,o,s,l,u){var d;return f(this,r),(d=i.call(this,t,e,n,o)).changeDetector=a,d.dataService=o,d.formBuilder=s,d.notificationService=l,d.modalService=u,d.assetChanges={},d.filters=[],d.allFilters=[],d.updatePermission=[v.Hb.UpdateCatalog,v.Hb.UpdateCollection],d.customFields=d.getCustomFieldConfig("Collection"),d.detailForm=d.formBuilder.group({name:["",_.C.required],slug:"",description:"",visible:!1,filters:d.formBuilder.array([]),customFields:d.formBuilder.group(d.customFields.reduce(function(e,t){return Object.assign(Object.assign({},e),c({},t.name,""))},{}))}),d}return m(r,[{key:"ngOnInit",value:function(){var e=this;this.init(),this.dataService.collection.getCollectionFilters().single$.subscribe(function(t){e.allFilters=t.collectionFilters})}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"getFilterDefinition",value:function(e){return this.allFilters.find(function(t){return t.code===e.code})}},{key:"customFieldIsSet",value:function(e){return!!this.detailForm.get(["customFields",e])}},{key:"assetsChanged",value:function(){return!!Object.values(this.assetChanges).length}},{key:"updateSlug",value:function(t){var n=this;Object(E.a)(this.entity$,this.languageCode$).pipe(Object(I.a)(1)).subscribe(function(c){var a=e(c,2),i=a[0],r=a[1],o=n.detailForm.get(["slug"]),s=Object(v.dc)(i,r),l=!s||!s.slug;o&&o.pristine&&l&&o.setValue(Object(R.normalizeString)("".concat(t),"-"))})}},{key:"addFilter",value:function(e){var t=this.detailForm.get("filters");if(-1===t.value.findIndex(function(t){return t.code===e.code})){var n=e.args.reduce(function(e,t){return Object.assign(Object.assign({},e),c({},t.name,Object(v.gc)(t.value)))},{});t.push(this.formBuilder.control({code:e.code,args:n})),this.filters.push({code:e.code,args:e.args.map(function(e){return{name:e.name,value:Object(v.gc)(e.value)}})})}}},{key:"removeFilter",value:function(e){var t=this.detailForm.get("filters"),n=t.value.findIndex(function(t){return t.code===e.code});-1!==n&&(t.removeAt(n),this.filters.splice(n,1))}},{key:"create",value:function(){var t=this;this.detailForm.dirty&&Object(E.a)(this.entity$,this.languageCode$).pipe(Object(I.a)(1),Object(F.a)(function(n){var c=e(n,2),a=c[0],i=c[1],r=t.getUpdatedCollection(a,t.detailForm,i),o=t.route.snapshot.paramMap.get("parentId");return o&&(r.parentId=o),t.dataService.collection.createCollection(r)})).subscribe(function(e){t.notificationService.success(Object(b.a)("common.notify-create-success"),{entity:"Collection"}),t.assetChanges={},t.detailForm.markAsPristine(),t.changeDetector.markForCheck(),t.router.navigate(["../",e.createCollection.id],{relativeTo:t.route})},function(e){t.notificationService.error(Object(b.a)("common.notify-create-error"),{entity:"Collection"})})}},{key:"save",value:function(){var t=this;Object(E.a)(this.entity$,this.languageCode$).pipe(Object(I.a)(1),Object(F.a)(function(n){var c=e(n,2),a=c[0],i=c[1],r=t.getUpdatedCollection(a,t.detailForm,i);return t.dataService.collection.updateCollection(r)})).subscribe(function(){t.assetChanges={},t.detailForm.markAsPristine(),t.changeDetector.markForCheck(),t.notificationService.success(Object(b.a)("common.notify-update-success"),{entity:"Collection"}),t.contentsComponent.refresh()},function(e){t.notificationService.error(Object(b.a)("common.notify-update-error"),{entity:"Collection"})})}},{key:"canDeactivate",value:function(){return t(p(r.prototype),"canDeactivate",this).call(this)&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}},{key:"setFormValues",value:function(e,t){var c=this,a=Object(v.dc)(e,t);if(this.detailForm.patchValue({name:a?a.name:"",slug:a?a.slug:"",description:a?a.description:"",visible:!e.isPrivate}),e.filters.forEach(function(e){return c.addFilter(e)}),this.customFields.length){var i,r=this.detailForm.get(["customFields"]),o=n(this.customFields);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=s.name,u="localeString"===s.type?a.customFields[l]:e.customFields[l],d=r.get(l);d&&d.patchValue(u)}}catch(p){o.e(p)}finally{o.f()}}}},{key:"getUpdatedCollection",value:function(e,t,n){var c,a,i=Object(v.ac)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign({},i),{assetIds:null===(c=this.assetChanges.assets)||void 0===c?void 0:c.map(function(e){return e.id}),featuredAssetId:null===(a=this.assetChanges.featuredAsset)||void 0===a?void 0:a.id,isPrivate:!t.value.visible,filters:this.mapOperationsToInputs(this.filters,this.detailForm.value.filters)})}},{key:"mapOperationsToInputs",value:function(e,t){return e.map(function(e,n){return{code:e.code,arguments:Object.values(t[n].args).map(function(t,n){return{name:e.args[n].name,value:Object(v.cc)(t)}})}})}}]),r}(v.w);na.\u0275fac=function(e){return new(e||na)(u.dc(g.e),u.dc(g.a),u.dc(v.Lb),u.dc(u.k),u.dc(v.L),u.dc(_.e),u.dc(v.Db),u.dc(v.Cb))},na.\u0275cmp=u.Xb({type:na,selectors:[["vdr-collection-detail"]],viewQuery:function(e,t){var n;(1&e&&u.ad(me,1),2&e)&&(u.Ic(n=u.rc())&&(t.contentsComponent=n.first))},features:[u.Pb],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],[1,"clr-row"],[1,"clr-col"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug","pattern","[a-z0-9_-]+",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","change"],["formArrayName","filters",1,"clr-row"],[4,"ngFor","ngForOf"],[4,"vdrIfPermissions"],[3,"collectionId"],["collectionContents",""],["formGroupName","customFields"],["entityName","Collection",3,"customFieldsFormGroup","customField",4,"ngIf"],["entityName","Collection",3,"customFieldsFormGroup","customField"],[3,"operation","operationDefinition","formControlName","readonly","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[1,"contents-title"]],template:function(e,t){if(1&e&&(u.jc(0,"vdr-action-bar"),u.jc(1,"vdr-ab-left"),u.ec(2,"vdr-entity-info",0),u.tc(3,"async"),u.jc(4,"vdr-language-selector",1),u.qc("languageCodeChange",function(e){return t.setLanguage(e)}),u.tc(5,"async"),u.tc(6,"async"),u.tc(7,"async"),u.ic(),u.ic(),u.jc(8,"vdr-ab-right"),u.ec(9,"vdr-action-bar-items",2),u.Tc(10,ve,3,4,"button",3),u.tc(11,"async"),u.Tc(12,he,1,1,"ng-template",null,4,u.Uc),u.ic(),u.ic(),u.Tc(14,Te,38,41,"form",5),u.tc(15,"async")),2&e){var n=u.Jc(13);u.Sb(2),u.zc("entity",u.uc(3,7,t.entity$)),u.Sb(2),u.zc("disabled",u.uc(5,9,t.isNew$))("availableLanguageCodes",u.uc(6,11,t.availableLanguages$))("currentLanguageCode",u.uc(7,13,t.languageCode$)),u.Sb(6),u.zc("ngIf",u.uc(11,15,t.isNew$))("ngIfElse",n),u.Sb(4),u.zc("ngIf",u.uc(15,17,t.entity$))}},directives:function(){return[v.c,v.e,v.ab,v.wb,v.f,v.d,J.o,v.qb,_.E,_.q,_.j,v.db,ie.k,v.eb,_.a,ie.i,_.p,_.h,v.S,ie.u,_.b,_.w,v.Jb,Wa,_.d,J.n,ta,_.k,v.I,v.E,v.T,v.W,ie.o,v.V,v.U]},pipes:function(){return[J.b,ce.d,v.ib]},styles:[tt],changeDetection:0}),na.ctorParameters=function(){return[{type:g.e},{type:g.a},{type:v.Lb},{type:u.k},{type:v.L},{type:_.e},{type:v.Db},{type:v.Cb}]},na.propDecorators={contentsComponent:[{type:u.fb,args:["collectionContents"]}]};var ca=function(){function t(e,n,c,a,i,r){f(this,t),this.dataService=e,this.notificationService=n,this.modalService=c,this.router=a,this.route=i,this.serverConfigService=r,this.expandAll=!1}return m(t,[{key:"ngOnInit",value:function(){var t=this;this.queryResult=this.dataService.collection.getCollections(1e3,0).refetchOnChannelChange(),this.items$=this.queryResult.mapStream(function(e){return e.collections.items}).pipe(Object(V.a)(1)),this.activeCollectionId$=this.route.paramMap.pipe(Object(h.a)(function(e){return e.get("contents")}),Object(P.a)()),this.activeCollectionTitle$=Object(E.a)(this.activeCollectionId$,this.items$).pipe(Object(h.a)(function(t){var n=e(t,2),c=n[0],a=n[1];if(c){var i=a.find(function(e){return e.id===c});return i?i.name:""}return""})),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(function(e){return e.uiState.contentLanguage}).pipe(Object(S.a)(function(){return t.refresh()}))}},{key:"ngOnDestroy",value:function(){this.queryResult.completed$.next()}},{key:"onRearrange",value:function(e){var t=this;this.dataService.collection.moveCollection([e]).subscribe({next:function(){t.notificationService.success(Object(b.a)("common.notify-saved-changes")),t.refresh()},error:function(e){t.notificationService.error(Object(b.a)("common.notify-save-changes-error"))}})}},{key:"deleteCollection",value:function(e){var t=this;this.items$.pipe(Object(I.a)(1),Object(h.a)(function(t){return-1<t.findIndex(function(t){return t.parent&&t.parent.id===e})}),Object(j.a)(function(e){return t.modalService.dialog({title:Object(b.a)("catalog.confirm-delete-collection"),body:e?Object(b.a)("catalog.confirm-delete-collection-and-children-body"):void 0,buttons:[{type:"secondary",label:Object(b.a)("common.cancel")},{type:"danger",label:Object(b.a)("common.delete"),returnValue:!0}]})}),Object(j.a)(function(n){return n?t.dataService.collection.deleteCollection(e):q.a})).subscribe(function(){t.notificationService.success(Object(b.a)("common.notify-delete-success"),{entity:"Collection"}),t.refresh()},function(e){t.notificationService.error(Object(b.a)("common.notify-delete-error"),{entity:"Collection"})})}},{key:"closeContents",value:function(){var e=Object.assign({},this.route.snapshot.params);delete e.contents,this.router.navigate(["./",e],{relativeTo:this.route,queryParamsHandling:"preserve"})}},{key:"setLanguage",value:function(e){this.dataService.client.setContentLanguage(e).subscribe()}},{key:"refresh",value:function(){this.queryResult.ref.refetch()}}]),t}();ca.\u0275fac=function(e){return new(e||ca)(u.dc(v.L),u.dc(v.Db),u.dc(v.Cb),u.dc(g.e),u.dc(g.a),u.dc(v.Lb))},ca.\u0275cmp=u.Xb({type:ca,selectors:[["vdr-collection-list"]],decls:24,vars:29,consts:[[1,"flex","center","wrap"],[1,"mt2",3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],[1,"expand-all-toggle","ml3",3,"ngClass"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["locationId","collection-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[1,"collection-wrapper"],[3,"collections","activeCollectionId","expandAll","rearrange","deleteCollection"],[1,"collection-contents"],[3,"collectionId"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"collection-title"],["type","button",1,"close-button",3,"click"],["shape","close"]],template:function(e,t){if(1&e&&(u.jc(0,"vdr-action-bar"),u.jc(1,"vdr-ab-left"),u.jc(2,"div",0),u.jc(3,"vdr-language-selector",1),u.qc("languageCodeChange",function(e){return t.setLanguage(e)}),u.tc(4,"async"),u.tc(5,"async"),u.ic(),u.jc(6,"clr-checkbox-wrapper",2),u.tc(7,"async"),u.jc(8,"input",3),u.qc("ngModelChange",function(e){return t.expandAll=e}),u.ic(),u.jc(9,"label"),u.Vc(10),u.tc(11,"translate"),u.ic(),u.ic(),u.ic(),u.ic(),u.jc(12,"vdr-ab-right"),u.ec(13,"vdr-action-bar-items",4),u.Tc(14,ze,4,5,"a",5),u.ic(),u.ic(),u.jc(15,"div",6),u.jc(16,"vdr-collection-tree",7),u.qc("rearrange",function(e){return t.onRearrange(e)})("deleteCollection",function(e){return t.deleteCollection(e)}),u.tc(17,"async"),u.tc(18,"async"),u.ic(),u.jc(19,"div",8),u.tc(20,"async"),u.jc(21,"vdr-collection-contents",9),u.tc(22,"async"),u.Tc(23,De,6,9,"ng-template"),u.ic(),u.ic(),u.ic()),2&e){var n;u.Sb(3),u.zc("availableLanguageCodes",u.uc(4,12,t.availableLanguages$))("currentLanguageCode",u.uc(5,14,t.contentLanguage$)),u.Sb(3),u.zc("ngClass",1===(null==(n=u.uc(7,16,t.availableLanguages$))?null:n.length)?"mt3":"mt1"),u.Sb(2),u.zc("ngModel",t.expandAll),u.Sb(2),u.Wc(u.uc(11,18,"catalog.expand-all-collections")),u.Sb(4),u.zc("vdrIfPermissions",u.Cc(28,Ae)),u.Sb(2),u.zc("collections",u.uc(17,20,t.items$))("activeCollectionId",u.uc(18,22,t.activeCollectionId$))("expandAll",t.expandAll),u.Sb(3),u.Vb("expanded",u.uc(20,24,t.activeCollectionId$)),u.Sb(2),u.zc("collectionId",u.uc(22,26,t.activeCollectionId$))}},directives:function(){return[v.c,v.e,v.wb,ie.k,J.m,v.eb,_.a,ie.i,_.p,_.s,ie.u,v.f,v.d,v.qb,La,ta,g.h,ie.o]},pipes:function(){return[J.b,ce.d]},styles:["[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column}.expand-all-toggle[_ngcontent-%COMP%]{display:block}.collection-wrapper[_ngcontent-%COMP%]{display:flex;height:calc(100% - 50px)}.collection-wrapper[_ngcontent-%COMP%]   vdr-collection-tree[_ngcontent-%COMP%]{flex:1;height:100%;overflow:auto}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility 0s .3s}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents.expanded[_ngcontent-%COMP%]{width:30vw;visibility:visible;opacity:1;padding-left:12px}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:0;background:none;border:none;cursor:pointer}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}"],changeDetection:0}),ca.ctorParameters=function(){return[{type:v.L},{type:v.Db},{type:v.Cb},{type:g.e},{type:g.a},{type:v.Lb}]};var aa=function(t){o(r,t);var i=l(r);function r(e,t,n,a,o,s,l,u){var d;return f(this,r),(d=i.call(this,t,e,n,o)).changeDetector=a,d.dataService=o,d.formBuilder=s,d.notificationService=l,d.modalService=u,d.updatePermission=[v.Hb.UpdateCatalog,v.Hb.UpdateFacet],d.customFields=d.getCustomFieldConfig("Facet"),d.customValueFields=d.getCustomFieldConfig("FacetValue"),d.detailForm=d.formBuilder.group({facet:d.formBuilder.group({code:["",_.C.required],name:"",visible:!0,customFields:d.formBuilder.group(d.customFields.reduce(function(e,t){return Object.assign(Object.assign({},e),c({},t.name,""))},{}))}),values:d.formBuilder.array([])}),d}return m(r,[{key:"ngOnInit",value:function(){this.init()}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"updateCode",value:function(e,t){if(!e){var n=this.detailForm.get(["facet","code"]);n&&n.pristine&&n.setValue(Object(R.normalizeString)(t,"-"))}}},{key:"updateValueCode",value:function(e,t,n){if(!e){var c=this.detailForm.get(["values",n,"code"]);c&&c.pristine&&c.setValue(Object(R.normalizeString)(t,"-"))}}},{key:"customFieldIsSet",value:function(e){return!!this.detailForm.get(["facet","customFields",e])}},{key:"customValueFieldIsSet",value:function(e,t){return!!this.detailForm.get(["values",e,"customFields",t])}},{key:"getValuesFormArray",value:function(){return this.detailForm.get("values")}},{key:"addFacetValue",value:function(){var e=this.detailForm.get("values");e&&(e.insert(e.length,this.formBuilder.group({id:"",name:["",_.C.required],code:""})),this.values.push({name:"",code:""}))}},{key:"create",value:function(){var t=this,n=this.detailForm.get("facet");n&&n.dirty&&Object(E.a)(this.entity$,this.languageCode$).pipe(Object(I.a)(1),Object(F.a)(function(c){var a=e(c,2),i=a[0],r=a[1],o=t.getUpdatedFacet(i,n,r);return t.dataService.facet.createFacet(o)}),Object(j.a)(function(e){return t.dataService.facet.getAllFacets().single$.pipe(Object(x.a)(e))})).subscribe(function(e){t.notificationService.success(Object(b.a)("common.notify-create-success"),{entity:"Facet"}),t.detailForm.markAsPristine(),t.changeDetector.markForCheck(),t.router.navigate(["../",e.createFacet.id],{relativeTo:t.route})},function(e){t.notificationService.error(Object(b.a)("common.notify-create-error"),{entity:"Facet"})})}},{key:"save",value:function(){var t=this;Object(E.a)(this.entity$,this.languageCode$).pipe(Object(I.a)(1),Object(F.a)(function(n){var c=e(n,2),a=c[0],i=c[1],r=t.detailForm.get("facet"),o=[];if(r&&r.dirty){var s=t.getUpdatedFacet(a,r,i);s&&o.push(t.dataService.facet.updateFacet(s))}var l=t.detailForm.get("values");if(l&&l.dirty){var u=l.controls.filter(function(e){return!e.value.id}).map(function(e){return{facetId:a.id,code:e.value.code,translations:[{name:e.value.name,languageCode:i}]}});u.length&&o.push(t.dataService.facet.createFacetValues(u).pipe(Object(j.a)(function(){return t.dataService.facet.getFacet(t.id).single$})));var d=t.getUpdatedFacetValues(a,l,i);d.length&&o.push(t.dataService.facet.updateFacetValues(d))}return Object(W.a)(o)}),Object(j.a)(function(){return t.dataService.facet.getAllFacets().single$})).subscribe(function(){t.detailForm.markAsPristine(),t.changeDetector.markForCheck(),t.notificationService.success(Object(b.a)("common.notify-update-success"),{entity:"Facet"})},function(e){t.notificationService.error(Object(b.a)("common.notify-update-error"),{entity:"Facet"})})}},{key:"deleteFacetValue",value:function(e,t){var n=this;if(!e){var c=this.detailForm.get("values");return c&&c.removeAt(t),void this.values.splice(t,1)}this.showModalAndDelete(e).pipe(Object(j.a)(function(t){return t.result===v.P.DELETED?[!0]:n.showModalAndDelete(e,t.message||"").pipe(Object(h.a)(function(e){return e.result===v.P.DELETED}))}),Object(j.a)(function(e){return e?n.dataService.facet.getFacet(n.id).single$:[]})).subscribe(function(){n.notificationService.success(Object(b.a)("common.notify-delete-success"),{entity:"FacetValue"})},function(e){n.notificationService.error(Object(b.a)("common.notify-delete-error"),{entity:"FacetValue"})})}},{key:"showModalAndDelete",value:function(e,t){var n=this;return this.modalService.dialog({title:Object(b.a)("catalog.confirm-delete-facet-value"),body:t,buttons:[{type:"secondary",label:Object(b.a)("common.cancel")},{type:"danger",label:Object(b.a)("common.delete"),returnValue:!0}]}).pipe(Object(j.a)(function(c){return c?n.dataService.facet.deleteFacetValues([e],!!t):q.a}),Object(h.a)(function(e){return e.deleteFacetValues[0]}))}},{key:"setFormValues",value:function(e,t){var c,i=this,r=Object(v.dc)(e,t);if(this.detailForm.patchValue({facet:{code:e.code,visible:!e.isPrivate,name:null!==(c=null==r?void 0:r.name)&&void 0!==c?c:""}}),this.customFields.length){var o,s=this.detailForm.get(["facet","customFields"]),l=n(this.customFields);try{for(l.s();!(o=l.n()).done;){var u=o.value,d=u.name,p="localeString"===u.type?r.customFields[d]:e.customFields[d],f=s.get(d);f&&f.patchValue(p)}}catch(m){l.e(m)}finally{l.f()}}var g=this.detailForm.get("values");this.values=a(e.values),e.values.forEach(function(e,c){var a=Object(v.dc)(e,t),r={id:e.id,code:e.code,name:a?a.name:""},o=g.at(c);if(o?o.setValue(r):g.insert(c,i.formBuilder.group(r)),i.customValueFields.length){var s=i.detailForm.get(["values",c,"customFields"]);if(s||(s=new _.i({}),i.detailForm.get(["values",c]).addControl("customFields",s)),s){var l,u=n(i.customValueFields);try{for(u.s();!(l=u.n()).done;){var d=l.value,p=d.name,f="localeString"===d.type?a.customFields[p]:e.customFields[p],b=s.get(p);b?b.setValue(f):s.addControl(p,new _.f(f))}}catch(m){u.e(m)}finally{u.f()}}}})}},{key:"getUpdatedFacet",value:function(e,t,n){var c=Object(v.ac)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||""}});return c.isPrivate=!t.value.visible,c}},{key:"getUpdatedFacetValues",value:function(e,t,n){var c=this,a=e.values.filter(function(e,n){var c=t.get(n.toString());return c&&c.dirty&&c.value.id}),i=t.controls.filter(function(e){return e.dirty&&e.value.id}).map(function(e){return e.value});if(a.length!==i.length)throw new Error(Object(b.a)("error.facet-value-form-values-do-not-match"));return a.map(function(e,t){return Object(v.ac)({translatable:e,updatedFields:i[t],customFieldConfig:c.customValueFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}})}).filter(H.notNullOrUndefined)}}]),r}(v.w);aa.\u0275fac=function(e){return new(e||aa)(u.dc(g.e),u.dc(g.a),u.dc(v.Lb),u.dc(u.k),u.dc(v.L),u.dc(_.e),u.dc(v.Db),u.dc(v.Cb))},aa.\u0275cmp=u.Xb({type:aa,selectors:[["vdr-facet-detail"]],features:[u.Pb],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["formGroupName","facet",1,"form-block"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","code",3,"label","readOnlyToggle"],["id","code","type","text","formControlName","code",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["class","form-block",4,"ngIf"],["formGroupName","customFields"],[4,"ngFor","ngForOf"],["entityName","Facet",3,"customFieldsFormGroup","customField",4,"ngIf"],["entityName","Facet",3,"customFieldsFormGroup","customField"],[1,"form-block"],["class","facet-values-list table","formArrayName","values",4,"ngIf"],["type","button","class","btn btn-secondary",3,"click",4,"vdrIfPermissions"],["formArrayName","values",1,"facet-values-list","table"],["class","facet-value",3,"formGroupName",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroupName"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly","input"],["type","text","formControlName","code","readonly",""],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],["entityName","FacetValue",3,"showLabel","customFieldsFormGroup","customField",4,"ngIf"],["entityName","FacetValue",3,"showLabel","customFieldsFormGroup","customField"],["type","button",1,"btn","btn-secondary",3,"click"],["shape","add"]],template:function(e,t){if(1&e&&(u.jc(0,"vdr-action-bar"),u.jc(1,"vdr-ab-left"),u.ec(2,"vdr-entity-info",0),u.tc(3,"async"),u.jc(4,"vdr-language-selector",1),u.qc("languageCodeChange",function(e){return t.setLanguage(e)}),u.tc(5,"async"),u.tc(6,"async"),u.tc(7,"async"),u.ic(),u.ic(),u.jc(8,"vdr-ab-right"),u.ec(9,"vdr-action-bar-items",2),u.Tc(10,$e,3,4,"button",3),u.tc(11,"async"),u.Tc(12,Le,1,1,"ng-template",null,4,u.Uc),u.ic(),u.ic(),u.Tc(14,et,23,28,"form",5),u.tc(15,"async")),2&e){var n=u.Jc(13);u.Sb(2),u.zc("entity",u.uc(3,7,t.entity$)),u.Sb(2),u.zc("disabled",u.uc(5,9,t.isNew$))("availableLanguageCodes",u.uc(6,11,t.availableLanguages$))("currentLanguageCode",u.uc(7,13,t.languageCode$)),u.Sb(6),u.zc("ngIf",u.uc(11,15,t.isNew$))("ngIfElse",n),u.Sb(4),u.zc("ngIf",u.uc(15,17,t.entity$))}},directives:[v.c,v.e,v.ab,v.wb,v.f,v.d,J.o,v.qb,_.E,_.q,_.j,_.k,v.db,ie.k,v.eb,_.a,ie.i,_.p,_.h,v.S,ie.u,_.b,J.n,v.I,_.d,v.T,v.W,ie.o,v.V,v.U],pipes:[J.b,ce.d,v.ib],styles:[tt],changeDetection:0}),aa.ctorParameters=function(){return[{type:g.e},{type:g.a},{type:v.Lb},{type:u.k},{type:v.L},{type:_.e},{type:v.Db},{type:v.Cb}]};var ia=function(e){o(c,e);var n=l(c);function c(e,a,i,r,o,s){var l,u;return f(this,c),(u=n.call(this,o,s)).dataService=e,u.modalService=a,u.notificationService=i,u.serverConfigService=r,u.initialLimit=3,u.displayLimit={},t((l=d(u),p(c.prototype)),"setQueryFn",l).call(l,function(){var e;return(e=u.dataService.facet).getFacets.apply(e,arguments).refetchOnChannelChange()},function(e){return e.facets}),u}return m(c,[{key:"ngOnInit",value:function(){var e=this;t(p(c.prototype),"ngOnInit",this).call(this),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(function(e){return e.uiState.contentLanguage}).pipe(Object(S.a)(function(){return e.refresh()}))}},{key:"toggleDisplayLimit",value:function(e){this.displayLimit[e.id]===e.values.length?this.displayLimit[e.id]=this.initialLimit:this.displayLimit[e.id]=e.values.length}},{key:"deleteFacet",value:function(e){var t=this;this.showModalAndDelete(e).pipe(Object(j.a)(function(n){return n.result===v.P.DELETED?[!0]:t.showModalAndDelete(e,n.message||"").pipe(Object(h.a)(function(e){return e.result===v.P.DELETED}))}),Object(j.a)(function(){return t.dataService.facet.getAllFacets().single$})).subscribe(function(){t.notificationService.success(Object(b.a)("common.notify-delete-success"),{entity:"FacetValue"}),t.refresh()},function(e){t.notificationService.error(Object(b.a)("common.notify-delete-error"),{entity:"FacetValue"})})}},{key:"setLanguage",value:function(e){this.dataService.client.setContentLanguage(e).subscribe()}},{key:"showModalAndDelete",value:function(e,t){var n=this;return this.modalService.dialog({title:Object(b.a)("catalog.confirm-delete-facet"),body:t,buttons:[{type:"secondary",label:Object(b.a)("common.cancel")},{type:"danger",label:Object(b.a)("common.delete"),returnValue:!0}]}).pipe(Object(j.a)(function(c){return c?n.dataService.facet.deleteFacet(e,!!t):q.a}),Object(h.a)(function(e){return e.deleteFacet}))}}]),c}(v.y);function ra(e,t,n){if(!e)return"";var c=e.lastIndexOf(t);return-1===c?e:e.substr(0,c)+e.substr(c).replace(t,n)}ia.\u0275fac=function(e){return new(e||ia)(u.dc(v.L),u.dc(v.Cb),u.dc(v.Db),u.dc(v.Lb),u.dc(g.e),u.dc(g.a))},ia.\u0275cmp=u.Xb({type:ia,selectors:[["vdr-facet-list"]],features:[u.Pb],decls:28,vars:33,consts:[[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"expand"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[3,"facetValue","removable","displayFacetName",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary btn-icon",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["private",""],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"facetValue","removable","displayFacetName"],[1,"btn","btn-sm","btn-secondary","btn-icon",3,"click"],["collapse",""],["shape","minus"]],template:function(e,t){1&e&&(u.jc(0,"vdr-action-bar"),u.jc(1,"vdr-ab-left"),u.jc(2,"vdr-language-selector",0),u.qc("languageCodeChange",function(e){return t.setLanguage(e)}),u.tc(3,"async"),u.tc(4,"async"),u.ic(),u.ic(),u.jc(5,"vdr-ab-right"),u.ec(6,"vdr-action-bar-items",1),u.Tc(7,nt,4,5,"a",2),u.ic(),u.ic(),u.jc(8,"vdr-data-table",3),u.qc("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),u.tc(9,"async"),u.tc(10,"async"),u.tc(11,"async"),u.tc(12,"async"),u.jc(13,"vdr-dt-column"),u.Vc(14),u.tc(15,"translate"),u.ic(),u.jc(16,"vdr-dt-column"),u.Vc(17),u.tc(18,"translate"),u.ic(),u.jc(19,"vdr-dt-column",4),u.Vc(20),u.tc(21,"translate"),u.ic(),u.jc(22,"vdr-dt-column"),u.Vc(23),u.tc(24,"translate"),u.ic(),u.ec(25,"vdr-dt-column"),u.ec(26,"vdr-dt-column"),u.Tc(27,dt,28,38,"ng-template"),u.ic()),2&e&&(u.Sb(2),u.zc("availableLanguageCodes",u.uc(3,12,t.availableLanguages$))("currentLanguageCode",u.uc(4,14,t.contentLanguage$)),u.Sb(5),u.zc("vdrIfPermissions",u.Cc(32,Ye)),u.Sb(1),u.zc("items",u.uc(9,16,t.items$))("itemsPerPage",u.uc(10,18,t.itemsPerPage$))("totalItems",u.uc(11,20,t.totalItems$))("currentPage",u.uc(12,22,t.currentPage$)),u.Sb(6),u.Wc(u.uc(15,24,"common.code")),u.Sb(3),u.Wc(u.uc(18,26,"common.name")),u.Sb(2),u.zc("expand",!0),u.Sb(1),u.Wc(u.uc(21,28,"catalog.values")),u.Sb(3),u.Wc(u.uc(24,30,"catalog.visibility")))},directives:[v.c,v.e,v.wb,v.f,v.d,v.qb,v.N,v.M,g.h,ie.o,J.n,J.o,v.D,v.Sb,v.T,v.W,v.V,v.U,v.bb],pipes:[J.b,ce.d,J.x,v.ib],styles:["td.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"]}),ia.ctorParameters=function(){return[{type:v.L},{type:v.Cb},{type:v.Db},{type:v.Lb},{type:g.e},{type:g.a}]};var oa=function(){function t(e){f(this,t),this.dataService=e}return m(t,[{key:"getFacets",value:function(){return this.dataService.facet.getAllFacets().mapSingle(function(e){return e.facets.items})}},{key:"getTaxCategories",value:function(){return this.dataService.settings.getTaxCategories().mapSingle(function(e){return e.taxCategories}).pipe(Object(V.a)(1))}},{key:"createProductWithVariants",value:function(t,n,c){var i=this,r=this.dataService.product.createProduct(t),o=n.groups.filter(function(e){return 0<e.values.length}),s=this.createProductOptionGroups(o,c);return Object(W.a)(r,s).pipe(Object(F.a)(function(t){var n=e(t,2),c=n[0].createProduct,a=n[1];return(a.length?Object(W.a)(a.map(function(e){return i.dataService.product.addOptionGroupToProduct({productId:c.id,optionGroupId:e.id})})):Object(G.a)([])).pipe(Object(h.a)(function(){return{createProduct:c,optionGroups:a}}))}),Object(F.a)(function(e){var t=e.createProduct,r=e.optionGroups,o=n.variants.map(function(e){var t=r.length?e.optionValues.map(function(e,t){var n=r[t].options.find(function(t){return t.name===e});if(!n)throw new Error('Could not find a matching ProductOption "'.concat(e,'" when creating variant'));return n.id}):[];return Object.assign(Object.assign({},e),{optionIds:t})}),s=r.map(function(e){return e.options}).reduce(function(e,t){return[].concat(a(e),a(t))},[]);return i.createProductVariants(t,o,s,c)}))}},{key:"createProductOptionGroups",value:function(e,t){var n=this;return e.length?Object(W.a)(e.map(function(e){return n.dataService.product.createProductOptionGroups({code:Object(R.normalizeString)(e.name,"-"),translations:[{languageCode:t,name:e.name}],options:e.values.map(function(e){return{code:Object(R.normalizeString)(e,"-"),translations:[{languageCode:t,name:e}]}})}).pipe(Object(h.a)(function(e){return e.createProductOptionGroup}))})):Object(G.a)([])}},{key:"createProductVariants",value:function(e,t,n,c){var a=t.map(function(t){var a=n.length?"".concat(e.name," ").concat(t.optionIds.map(function(e){return n.find(function(t){return t.id===e})}).filter(H.notNullOrUndefined).map(function(e){return e.name}).join(" ")):e.name;return{productId:e.id,price:t.price,sku:t.sku,stockOnHand:t.stock,translations:[{languageCode:c,name:a}],optionIds:t.optionIds}});return this.dataService.product.createProductVariants(a).pipe(Object(h.a)(function(t){return{createProductVariants:t.createProductVariants,productId:e.id}}))}},{key:"updateProduct",value:function(e){var t,c,a,i=e.product,r=e.languageCode,o=e.autoUpdate,s=e.productInput,l=[],u=e.variantsInput||[];if(s){l.push(this.dataService.product.updateProduct(s));var d=null===(t=Object(v.dc)(i,r))||void 0===t?void 0:t.name,p=null===(c=Object(v.dc)(s,r))||void 0===c?void 0:c.name;if(d&&p&&o){var f,g=n(i.variants);try{var m=function(){var e=f.value,t=(null===(a=Object(v.dc)(e,r))||void 0===a?void 0:a.name)||"",n=void 0,c=u.find(function(t){return t.id===e.id});c?n=c:(n={id:e.id,translations:[{languageCode:r,name:t}]},u.push(n));var i=Object(v.dc)(n,r);i&&(i.name=ra(i.name,d,p))};for(g.s();!(f=g.n()).done;)m()}catch(b){g.e(b)}finally{g.f()}}}return u.length&&l.push(this.dataService.product.updateProductVariants(u)),Object(W.a)(l)}},{key:"updateProductOption",value:function(e,t,c){var a,i,r,o=Object(G.a)([]);if(e.autoUpdate){var s,l=null===(a=Object(v.dc)(e,c))||void 0===a?void 0:a.name;l||(o=Object(G.a)([]));var u,d=[],p=n(t.variants);try{for(p.s();!(u=p.n()).done;){var f=u.value;if(f.options.map(function(e){return e.id}).includes(e.id)){s||(s=null===(i=Object(v.dc)(f.options.find(function(t){return t.id===e.id}),c))||void 0===i?void 0:i.name);var g=(null===(r=Object(v.dc)(f,c))||void 0===r?void 0:r.name)||"";s&&l&&g.includes(s)&&d.push({id:f.id,translations:[{languageCode:c,name:ra(g,s,l)}]})}}}catch(m){p.e(m)}finally{p.f()}d.length&&(o=this.dataService.product.updateProductVariants(d))}return this.dataService.product.updateProductOption(e).pipe(Object(F.a)(function(){return o}))}},{key:"deleteProductVariant",value:function(e,t){var n=this;return this.dataService.product.deleteProductVariant(e).pipe(Object(j.a)(function(e){return e.deleteProductVariant.result===v.P.DELETED?n.dataService.product.getProduct(t).single$:Object(X.a)(e.deleteProductVariant.message)}))}}]),t}();oa.\u0275fac=function(e){return new(e||oa)(u.nc(v.L))},oa.\u0275prov=Object(u.Zb)({factory:function(){return new oa(Object(u.nc)(v.L))},token:oa,providedIn:"root"}),oa.ctorParameters=function(){return[{type:v.L}]};var sa=function(){function e(t){f(this,e),this.changeDetector=t,this.selectedValues=[]}return m(e,[{key:"ngAfterViewInit",value:function(){var e=this;setTimeout(function(){return e.selector.focus()},0)}},{key:"selectValues",value:function(){this.resolveWith(this.selectedValues)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();sa.\u0275fac=function(e){return new(e||sa)(u.dc(u.k))},sa.\u0275cmp=u.Xb({type:sa,selectors:[["vdr-apply-facet-dialog"]],viewQuery:function(e,t){var n;(1&e&&u.ad(v.cb,1),2&e)&&(u.Ic(n=u.rc())&&(t.selector=n.first))},decls:3,vars:1,consts:[["vdrDialogTitle",""],[3,"facets","selectedValuesChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(u.Tc(0,pt,2,3,"ng-template",0),u.jc(1,"vdr-facet-value-selector",1),u.qc("selectedValuesChange",function(e){return t.selectedValues=e}),u.ic(),u.Tc(2,ft,6,7,"ng-template",2)),2&e&&(u.Sb(1),u.zc("facets",t.facets))},directives:[v.R,v.cb,v.Q],pipes:[ce.d],styles:[""],changeDetection:0}),sa.ctorParameters=function(){return[{type:u.k}]},sa.propDecorators={selector:[{type:u.fb,args:[v.cb]}]};var la=function(){function t(e,n){f(this,t),this.dataService=e,this.notificationService=n,this.priceFactorControl=new _.f(1),this.selectedChannelIdControl=new _.f}return m(t,[{key:"isProductVariantMode",get:function(){return null!=this.productVariantIds}},{key:"ngOnInit",value:function(){var t=this,n=this.dataService.client.userStatus().mapSingle(function(e){return e.userStatus.activeChannelId}),c=this.dataService.settings.getChannels().mapSingle(function(e){return e.channels});Object(E.a)(n,c).subscribe(function(n){var c=e(n,2),a=c[0],i=c[1];t.currentChannel=i.find(function(e){return e.id===a}),t.availableChannels=i}),this.selectedChannelIdControl.valueChanges.subscribe(function(e){t.selectChannel(e)}),this.variantsPreview$=Object(E.a)(Object(U.a)(this.getTopVariants(10)),this.priceFactorControl.valueChanges.pipe(Object(k.a)(1))).pipe(Object(h.a)(function(t){var n=e(t,2),c=n[0],a=n[1];return c.map(function(e){return{id:e.id,name:e.name,price:e.price,pricePreview:e.price*+a}})}))}},{key:"selectChannel",value:function(e){this.selectedChannel=this.availableChannels.find(function(t){return t.id===e[0]})}},{key:"assign",value:function(){var e=this,t=this.selectedChannel;t&&(this.isProductVariantMode?this.productVariantIds&&this.dataService.product.assignVariantsToChannel({channelId:t.id,productVariantIds:this.productVariantIds,priceFactor:+this.priceFactorControl.value}).subscribe(function(){e.notificationService.success(Object(b.a)("catalog.assign-variant-to-channel-success"),{channel:t.code}),e.resolveWith(!0)}):this.dataService.product.assignProductsToChannel({channelId:t.id,productIds:this.productIds,priceFactor:+this.priceFactorControl.value}).subscribe(function(){e.notificationService.success(Object(b.a)("catalog.assign-product-to-channel-success"),{channel:t.code}),e.resolveWith(!0)}))}},{key:"cancel",value:function(){this.resolveWith()}},{key:"getTopVariants",value:function(e){return Object(Y.b)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,c,i,r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=[],c=0;case 2:if(!(c<this.productIds.length&&n.length<e)){t.next=10;break}return t.next=5,this.dataService.product.getProduct(this.productIds[c]).mapSingle(function(e){var t=e.product;return(t?t.variants:[]).filter(function(e){var t;return!r.isProductVariantMode||(null===(t=r.productVariantIds)||void 0===t?void 0:t.includes(e.id))})}).toPromise();case 5:i=t.sent,n.push.apply(n,a(i||[]));case 7:c++,t.next=2;break;case 10:return t.abrupt("return",n.slice(0,e));case 11:case"end":return t.stop()}},t,this)}))}}]),t}();la.\u0275fac=function(e){return new(e||la)(u.dc(v.L),u.dc(v.Db))},la.\u0275cmp=u.Xb({type:la,selectors:[["vdr-assign-products-to-channel-dialog"]],decls:36,vars:32,consts:[["vdrDialogTitle",""],[1,"flex"],["clrInput","",3,"multiple","includeDefaultChannel","disableChannelIds","formControl"],[1,"flex-spacer"],["clrInput","","type","number","min","0","max","99999",3,"formControl"],[1,"channel-price-preview"],[1,"clr-control-label"],[1,"table"],[3,"ngIf","ngIfElse"],["noSelection",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],[4,"ngIf","ngIfElse"],["productModeTitle",""],["noChannelSelected",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){if(1&e&&(u.Tc(0,vt,3,2,"ng-template",0),u.jc(1,"div",1),u.jc(2,"clr-input-container"),u.jc(3,"label"),u.Vc(4),u.tc(5,"translate"),u.ic(),u.ec(6,"vdr-channel-assignment-control",2),u.ic(),u.ec(7,"div",3),u.jc(8,"clr-input-container"),u.jc(9,"label"),u.Vc(10),u.tc(11,"translate"),u.ic(),u.ec(12,"input",4),u.ic(),u.ic(),u.jc(13,"div",5),u.jc(14,"label",6),u.Vc(15),u.tc(16,"translate"),u.ic(),u.jc(17,"table",7),u.jc(18,"thead"),u.jc(19,"tr"),u.jc(20,"th"),u.Vc(21),u.tc(22,"translate"),u.ic(),u.jc(23,"th"),u.Vc(24),u.tc(25,"translate"),u.tc(26,"translate"),u.tc(27,"channelCodeToLabel"),u.ic(),u.jc(28,"th"),u.Tc(29,ht,2,6,"ng-template",8),u.Tc(30,yt,2,3,"ng-template",null,9,u.Uc),u.ic(),u.ic(),u.ic(),u.jc(32,"tbody"),u.Tc(33,jt,10,7,"tr",10),u.tc(34,"async"),u.ic(),u.ic(),u.ic(),u.Tc(35,It,7,6,"ng-template",11)),2&e){var n=u.Jc(31);u.Sb(4),u.Wc(u.uc(5,13,"common.channel")),u.Sb(2),u.zc("multiple",!1)("includeDefaultChannel",!1)("disableChannelIds",t.currentChannelIds)("formControl",t.selectedChannelIdControl),u.Sb(4),u.Wc(u.uc(11,15,"catalog.price-conversion-factor")),u.Sb(2),u.zc("formControl",t.priceFactorControl),u.Sb(3),u.Wc(u.uc(16,17,"catalog.channel-price-preview")),u.Sb(6),u.Wc(u.uc(22,19,"common.name")),u.Sb(3),u.Xc(" ",u.vc(25,21,"catalog.price-in-channel",u.Dc(30,bt,u.uc(26,24,u.uc(27,26,null==t.currentChannel?null:t.currentChannel.code))))," "),u.Sb(5),u.zc("ngIf",t.selectedChannel)("ngIfElse",n),u.Sb(4),u.zc("ngForOf",u.uc(34,28,t.variantsPreview$))}},directives:[v.R,ie.t,ie.u,v.A,ie.s,_.p,_.g,v.eb,_.v,_.b,J.o,J.n,v.Q],pipes:[ce.d,v.C,J.b,v.zb],styles:["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}.channel-price-preview[_ngcontent-%COMP%]{margin-top:24px}.channel-price-preview[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]{margin-top:6px}"],changeDetection:0}),la.ctorParameters=function(){return[{type:v.L},{type:v.Db}]};var ua=function(i){o(s,i);var r=l(s);function s(e,t,n,a,i,o,l,u,d,p){var g;return f(this,s),(g=r.call(this,e,t,n,u)).productDetailService=a,g.formBuilder=i,g.modalService=o,g.notificationService=l,g.dataService=u,g.location=d,g.changeDetector=p,g.filterInput=new _.f(""),g.assetChanges={},g.variantAssetChanges={},g.selectedVariantIds=[],g.variantDisplayMode="card",g.createVariantsConfig={groups:[],variants:[]},g.customFields=g.getCustomFieldConfig("Product"),g.customVariantFields=g.getCustomFieldConfig("ProductVariant"),g.customOptionGroupFields=g.getCustomFieldConfig("ProductOptionGroup"),g.customOptionFields=g.getCustomFieldConfig("ProductOption"),g.detailForm=g.formBuilder.group({product:g.formBuilder.group({enabled:!0,name:["",_.C.required],autoUpdateVariantNames:!0,slug:"",description:"",facetValueIds:[[]],customFields:g.formBuilder.group(g.customFields.reduce(function(e,t){return Object.assign(Object.assign({},e),c({},t.name,""))},{}))}),variants:g.formBuilder.array([])}),g}return m(s,[{key:"ngOnInit",value:function(){this.init(),this.product$=this.entity$;var t=this.product$.pipe(Object(h.a)(function(e){return e.variants})),n=this.filterInput.valueChanges.pipe(Object(k.a)(""),Object(y.a)(50),Object(V.a)());this.variants$=Object(E.a)(t,n).pipe(Object(h.a)(function(t){var n=e(t,2),c=n[0],a=n[1];return a?c.filter(function(e){return a.toLocaleLowerCase(),e.name.toLocaleLowerCase().includes(a)||e.sku.toLocaleLowerCase().includes(a)}):c})),this.taxCategories$=this.productDetailService.getTaxCategories().pipe(Object(C.a)(this.destroy$)),this.activeTab$=this.route.paramMap.pipe(Object(h.a)(function(e){return e.get("tab")})),this.facets$=this.productDetailService.getFacets();var c=this.product$.pipe(Object(h.a)(function(e){return e.facetValues})),i=this.facets$.pipe(Object(h.a)(v.ec)),r=this.getProductFormGroup().valueChanges.pipe(Object(h.a)(function(e){return e.facetValueIds}),Object(P.a)()),o=Object(E.a)(r,c,i).pipe(Object(h.a)(function(t){var n=e(t,3),c=n[0],i=n[1],r=n[2],o=[].concat(a(i),a(r));return c.map(function(e){return o.find(function(t){return t.id===e})}).filter(H.notNullOrUndefined)}));this.facetValues$=Object(B.a)(c,o),this.productChannels$=this.product$.pipe(Object(h.a)(function(e){return e.channels})),this.channelPriceIncludesTax$=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(function(e){return e.activeChannel.pricesIncludeTax}).pipe(Object(V.a)(1))}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"navigateToTab",value:function(e){this.location.replaceState(this.router.createUrlTree(["./",Object.assign(Object.assign({},this.route.snapshot.params),{tab:e})],{queryParamsHandling:"merge",relativeTo:this.route}).toString())}},{key:"isDefaultChannel",value:function(e){return e===Q.DEFAULT_CHANNEL_CODE}},{key:"assignToChannel",value:function(){var e=this;this.productChannels$.pipe(Object(I.a)(1),Object(j.a)(function(t){return e.modalService.fromComponent(la,{size:"lg",locals:{productIds:[e.id],currentChannelIds:t.map(function(e){return e.id})}})})).subscribe()}},{key:"removeFromChannel",value:function(e){var t=this;this.modalService.dialog({title:Object(b.a)("catalog.remove-product-from-channel"),buttons:[{type:"secondary",label:Object(b.a)("common.cancel")},{type:"danger",label:Object(b.a)("catalog.remove-from-channel"),returnValue:!0}]}).pipe(Object(j.a)(function(n){return n?t.dataService.product.removeProductsFromChannel({channelId:e,productIds:[t.id]}):q.a})).subscribe(function(){t.notificationService.success(Object(b.a)("catalog.notify-remove-product-from-channel-success"))},function(e){t.notificationService.error(Object(b.a)("catalog.notify-remove-product-from-channel-error"))})}},{key:"assignVariantToChannel",value:function(e){return this.modalService.fromComponent(la,{size:"lg",locals:{productIds:[this.id],productVariantIds:[e.id],currentChannelIds:e.channels.map(function(e){return e.id})}}).subscribe()}},{key:"removeVariantFromChannel",value:function(e){var t=this,n=e.channelId,c=e.variant;this.modalService.dialog({title:Object(b.a)("catalog.remove-product-variant-from-channel"),buttons:[{type:"secondary",label:Object(b.a)("common.cancel")},{type:"danger",label:Object(b.a)("catalog.remove-from-channel"),returnValue:!0}]}).pipe(Object(j.a)(function(e){return e?t.dataService.product.removeVariantsFromChannel({channelId:n,productVariantIds:[c.id]}):q.a})).subscribe(function(){t.notificationService.success(Object(b.a)("catalog.notify-remove-variant-from-channel-success"))},function(e){t.notificationService.error(Object(b.a)("catalog.notify-remove-variant-from-channel-error"))})}},{key:"customFieldIsSet",value:function(e){return!!this.detailForm.get(["product","customFields",e])}},{key:"assetsChanged",value:function(){return!!Object.values(this.assetChanges).length}},{key:"variantAssetsChanged",value:function(){return!!Object.keys(this.variantAssetChanges).length}},{key:"variantAssetChange",value:function(e){this.variantAssetChanges[e.variantId]=e}},{key:"updateSlug",value:function(t){var n=this;Object(E.a)(this.entity$,this.languageCode$).pipe(Object(I.a)(1)).subscribe(function(c){var a=e(c,2),i=a[0],r=a[1],o=n.detailForm.get(["product","slug"]),s=Object(v.dc)(i,r),l=!s||!s.slug;o&&o.pristine&&l&&o.setValue(Object(R.normalizeString)("".concat(t),"-"))})}},{key:"selectProductFacetValue",value:function(){var e=this;this.displayFacetValueModal().subscribe(function(t){if(t){var n=e.getProductFormGroup(),c=n.value.facetValueIds;n.patchValue({facetValueIds:Object(Z.unique)([].concat(a(c),a(t)))}),n.markAsDirty()}})}},{key:"updateProductOption",value:function(t){var n=this;Object(E.a)(this.product$,this.languageCode$).pipe(Object(I.a)(1),Object(F.a)(function(c){var a=e(c,2),i=a[0],r=a[1];return n.productDetailService.updateProductOption(t,i,r)})).subscribe(function(){n.notificationService.success(Object(b.a)("common.notify-update-success"),{entity:"ProductOption"})},function(e){n.notificationService.error(Object(b.a)("common.notify-update-error"),{entity:"ProductOption"})})}},{key:"removeProductFacetValue",value:function(e){var t=this.getProductFormGroup(),n=t.value.facetValueIds;t.patchValue({facetValueIds:n.filter(function(t){return t!==e})}),t.markAsDirty()}},{key:"selectVariantFacetValue",value:function(t){var c=this;this.displayFacetValueModal().pipe(w(this.variants$)).subscribe(function(i){var r=e(i,2),o=r[0],s=r[1];if(o){var l,u=n(t);try{var d=function(){var e=l.value,t=s.findIndex(function(t){return t.id===e}),n=s[t],i=n?n.facetValues.map(function(e){return e.id}):[],r=c.detailForm.get(["variants",t]);r&&(r.patchValue({facetValueIds:Object(Z.unique)([].concat(a(i),a(o)))}),r.markAsDirty())};for(u.s();!(l=u.n()).done;)d()}catch(p){u.e(p)}finally{u.f()}c.changeDetector.markForCheck()}})}},{key:"variantsToCreateAreValid",value:function(){return 0<this.createVariantsConfig.variants.length&&this.createVariantsConfig.variants.every(function(e){return""!==e.sku})}},{key:"displayFacetValueModal",value:function(){var e=this;return this.productDetailService.getFacets().pipe(Object(F.a)(function(t){return e.modalService.fromComponent(sa,{size:"md",closable:!0,locals:{facets:t}})}),Object(h.a)(function(e){return e&&e.map(function(e){return e.id})}))}},{key:"create",value:function(){var t=this,n=this.getProductFormGroup();n.dirty&&Object(E.a)(this.product$,this.languageCode$).pipe(Object(I.a)(1),Object(F.a)(function(c){var a=e(c,2),i=a[0],r=a[1],o=t.getUpdatedProduct(i,n,r);return t.productDetailService.createProductWithVariants(o,t.createVariantsConfig,r)})).subscribe(function(e){e.createProductVariants;var n=e.productId;t.notificationService.success(Object(b.a)("common.notify-create-success"),{entity:"Product"}),t.assetChanges={},t.variantAssetChanges={},t.detailForm.markAsPristine(),t.router.navigate(["../",n],{relativeTo:t.route})},function(e){console.error(e),t.notificationService.error(Object(b.a)("common.notify-create-error"),{entity:"Product"})})}},{key:"save",value:function(){var t=this;Object(E.a)(this.product$,this.languageCode$,this.channelPriceIncludesTax$).pipe(Object(I.a)(1),Object(F.a)(function(n){var c,a,i,r,o=e(n,3),s=o[0],l=o[1],u=o[2],d=t.getProductFormGroup();(d.dirty||t.assetsChanged())&&(i=t.getUpdatedProduct(s,d,l));var p=t.detailForm.get("variants");return(p&&p.dirty||t.variantAssetsChanged())&&(r=t.getUpdatedProductVariants(s,p,l,u)),t.productDetailService.updateProduct({product:s,languageCode:l,autoUpdate:null!==(a=null===(c=t.detailForm.get(["product","autoUpdateVariantNames"]))||void 0===c?void 0:c.value)&&void 0!==a&&a,productInput:i,variantsInput:r})})).subscribe(function(e){t.updateSlugAfterSave(e),t.detailForm.markAsPristine(),t.assetChanges={},t.variantAssetChanges={},t.notificationService.success(Object(b.a)("common.notify-update-success"),{entity:"Product"}),t.changeDetector.markForCheck()},function(e){t.notificationService.error(Object(b.a)("common.notify-update-error"),{entity:"Product"})})}},{key:"canDeactivate",value:function(){return t(p(s.prototype),"canDeactivate",this).call(this)&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}},{key:"setFormValues",value:function(e,t){var a=this,i=Object(v.dc)(e,t);if(this.detailForm.patchValue({product:{enabled:e.enabled,name:i?i.name:"",slug:i?i.slug:"",description:i?i.description:"",facetValueIds:e.facetValues.map(function(e){return e.id})}}),this.customFields.length){var r,o=this.detailForm.get(["product","customFields"]),s=i&&i.customFields||{},l=e.customFields||{},u=n(this.customFields);try{for(u.s();!(r=u.n()).done;){var d=r.value,p=d.name,f="localeString"===d.type?s[p]:l[p],g=o.get(p);g&&g.patchValue(f)}}catch(b){u.e(b)}finally{u.f()}}var m=this.detailForm.get("variants");e.variants.forEach(function(e,i){var r=Object(v.dc)(e,t),o=e.facetValues.map(function(e){return e.id}),s={id:e.id,enabled:e.enabled,sku:e.sku,name:r?r.name:"",price:e.price,priceWithTax:e.priceWithTax,taxCategoryId:e.taxCategory.id,stockOnHand:e.stockOnHand,useGlobalOutOfStockThreshold:e.useGlobalOutOfStockThreshold,outOfStockThreshold:e.outOfStockThreshold,trackInventory:e.trackInventory,facetValueIds:o},l=m.at(i);if(l?l.patchValue(s):(l=a.formBuilder.group(Object.assign(Object.assign({},s),{facetValueIds:a.formBuilder.control(o)})),m.insert(i,l)),a.customVariantFields.length){var u=l.get(["customFields"]);u||(u=a.formBuilder.group(a.customVariantFields.reduce(function(e,t){return Object.assign(Object.assign({},e),c({},t.name,""))},{})),l.addControl("customFields",u));var d,p=n(a.customVariantFields);try{for(p.s();!(d=p.n()).done;){var f=d.value,g=f.name,h="localeString"===f.type?r.customFields[g]:e.customFields[g],y=u.get(g);y&&y.patchValue(h)}}catch(b){p.e(b)}finally{p.f()}}})}},{key:"getUpdatedProduct",value:function(e,t,n){var c,a,i=Object(v.ac)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign({},i),{assetIds:null===(c=this.assetChanges.assets)||void 0===c?void 0:c.map(function(e){return e.id}),featuredAssetId:null===(a=this.assetChanges.featuredAsset)||void 0===a?void 0:a.id,facetValueIds:t.value.facetValueIds})}},{key:"getUpdatedProductVariants",value:function(e,t,n,c){var a=this,i=e.variants.filter(function(e,n){var c=t.get(n.toString());return c&&c.dirty}),r=t.controls.filter(function(e){return e.dirty}).map(function(e){return e.value});if(i.length!==r.length)throw new Error(Object(b.a)("error.product-variant-form-values-do-not-match"));return i.map(function(e,t){var i,o,s=r[t],l=Object(v.ac)({translatable:e,updatedFields:s,customFieldConfig:a.customVariantFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}});l.taxCategoryId=s.taxCategoryId,l.facetValueIds=s.facetValueIds,l.price=c?s.priceWithTax:s.price;var u=a.variantAssetChanges[e.id];return u&&(l.featuredAssetId=null===(i=u.featuredAsset)||void 0===i?void 0:i.id,l.assetIds=null===(o=u.assets)||void 0===o?void 0:o.map(function(e){return e.id})),l}).filter(H.notNullOrUndefined)}},{key:"getProductFormGroup",value:function(){return this.detailForm.get("product")}},{key:"updateSlugAfterSave",value:function(e){var t=e[0],n=this.detailForm.get(["product","slug"]);n&&t.hasOwnProperty("updateProduct")&&n.setValue(t.updateProduct.slug,{emitEvent:!1})}}]),s}(v.w);ua.\u0275fac=function(e){return new(e||ua)(u.dc(g.a),u.dc(g.e),u.dc(v.Lb),u.dc(oa),u.dc(_.e),u.dc(v.Cb),u.dc(v.Db),u.dc(v.L),u.dc(J.k),u.dc(u.k))},ua.\u0275cmp=u.Xb({type:ua,selectors:[["vdr-product-detail"]],features:[u.Pb],decls:18,vars:21,consts:[[1,"flex","clr-flex-row"],[3,"entity"],[4,"vdrIfPermissions"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["type","submit","hidden","","x-data","prevents enter key from triggering other buttons"],["clrTabLink","",3,"click"],[4,"clrIfActive"],[4,"ngIf"],[1,"clr-row"],[1,"clr-col"],["formGroupName","product",1,"form-block"],[4,"vdrIfMultichannel"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],[1,"auto-rename-wrapper"],["clrCheckbox","","type","checkbox","id","auto-update","formControlName","autoUpdateVariantNames"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug","pattern","[a-z0-9_-]+",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","change"],[3,"label",4,"vdrIfDefaultChannelActive"],[3,"label"],[1,"flex","channel-assignment"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"iconClick",4,"ngIf"],["icon","times-circle",3,"iconClick"],[3,"channelCode"],["formGroupName","customFields"],["entityName","Product",3,"customFieldsFormGroup","customField","readonly",4,"ngIf"],["entityName","Product",3,"customFieldsFormGroup","customField","readonly"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],[3,"variantsChange"],[1,"form-block"],[1,"view-mode"],[1,"btn-group"],[1,"btn","btn-secondary-outline",3,"click"],["shape","list"],[1,"btn",3,"click"],["shape","table"],[1,"variant-filter"],[3,"formControl","placeholder"],[1,"icon-button",3,"click"],["shape","times"],[1,"flex-spacer"],["class","btn btn-secondary edit-variants-btn",3,"routerLink",4,"vdrIfPermissions"],[3,"variants","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges",4,"ngIf"],[3,"variants","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick",4,"ngIf"],[1,"btn","btn-secondary","edit-variants-btn",3,"routerLink"],["shape","add-text"],[3,"variants","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges"],[3,"variants","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick"]],template:function(e,t){if(1&e&&(u.jc(0,"vdr-action-bar"),u.jc(1,"vdr-ab-left"),u.jc(2,"div",0),u.ec(3,"vdr-entity-info",1),u.tc(4,"async"),u.Tc(5,Vt,5,5,"clr-toggle-wrapper",2),u.ic(),u.jc(6,"vdr-language-selector",3),u.qc("languageCodeChange",function(e){return t.setLanguage(e)}),u.tc(7,"async"),u.tc(8,"async"),u.tc(9,"async"),u.ic(),u.ic(),u.jc(10,"vdr-ab-right"),u.ec(11,"vdr-action-bar-items",4),u.Tc(12,xt,3,4,"button",5),u.tc(13,"async"),u.Tc(14,wt,1,2,"ng-template",null,6,u.Uc),u.ic(),u.ic(),u.Tc(16,Yt,11,10,"form",7),u.tc(17,"async")),2&e){var n=u.Jc(15);u.Sb(3),u.zc("entity",u.uc(4,8,t.entity$)),u.Sb(2),u.zc("vdrIfPermissions",u.Cc(20,Tt)),u.Sb(1),u.zc("disabled",u.uc(7,10,t.isNew$))("availableLanguageCodes",u.uc(8,12,t.availableLanguages$))("currentLanguageCode",u.uc(9,14,t.languageCode$)),u.Sb(6),u.zc("ngIf",u.uc(13,16,t.isNew$))("ngIfElse",n),u.Sb(4),u.zc("ngIf",u.uc(17,18,t.product$))}},directives:function(){return[v.c,v.e,v.ab,v.qb,v.wb,v.f,v.d,J.o,ie.k,v.eb,_.a,ie.i,_.p,_.g,ie.u,_.E,_.q,_.j,ie.G,ie.R,ie.D,ie.F,ie.P,ie.p,ie.E,_.k,v.pb,v.db,_.b,_.h,_.w,v.Jb,J.n,Wa,v.ob,v.fb,ie.o,v.D,v.B,v.I,v.bb,qa,g.h,Ra,Ba]},pipes:function(){return[J.b,ce.d,v.ib,v.C]},styles:["[_nghost-%COMP%]     trix-toolbar{top:24px}vdr-action-bar[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-top:12px}.variant-filter[_ngcontent-%COMP%]{flex:1;display:flex}.variant-filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;max-width:none;border-radius:3px 0 0 3px!important}.variant-filter[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{border:1px solid var(--color-component-border-300);background-color:var(--color-component-bg-100);border-radius:0 3px 3px 0;border-left:none}.group-name[_ngcontent-%COMP%]{padding-right:6px}.view-mode[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.edit-variants-btn[_ngcontent-%COMP%]{margin-top:0}.channel-assignment[_ngcontent-%COMP%]{flex-wrap:wrap}.auto-rename-wrapper[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-left:9.5rem;margin-bottom:0;transition:max-height .2s,margin-bottom .2s}.auto-rename-wrapper.visible[_ngcontent-%COMP%]{max-height:24px;margin-bottom:12px}"],changeDetection:0}),ua.ctorParameters=function(){return[{type:g.a},{type:g.e},{type:v.Lb},{type:oa},{type:_.e},{type:v.Cb},{type:v.Db},{type:v.L},{type:J.k},{type:u.k}]};var da=v.Nb,pa=function(){function e(){var t=this;f(this,e),this.searchTermChange=new u.u,this.facetValueChange=new u.u,this.lastTerm="",this.lastFacetValueIds=[],this.filterFacetResults=function(e,n){return!!t.isFacetValueItem(n)&&(n.facetValue.name.toLowerCase().startsWith(e.toLowerCase())||n.facetValue.facet.name.toLowerCase().startsWith(e.toLowerCase()))},this.isFacetValueItem=function(e){return"object"==typeof e&&!!e&&e.hasOwnProperty("facetValue")}}return m(e,[{key:"setSearchTerm",value:function(e){var t=this;if(e)this.selectComponent.select({label:e,value:{label:e}});else{var n=this.selectComponent.selectedItems.find(function(e){return!t.isFacetValueItem(e.value)});n&&this.selectComponent.unselect(n)}}},{key:"setFacetValues",value:function(e){var t=this,n=this.selectComponent.items;this.selectComponent.selectedItems.forEach(function(n){t.isFacetValueItem(n.value)&&!e.includes(n.value.facetValue.id)&&t.selectComponent.unselect(n)}),e.map(function(e){return n.find(function(n){return t.isFacetValueItem(n)&&n.facetValue.id===e})}).filter(H.notNullOrUndefined).forEach(function(e){t.selectComponent.selectedItems.find(function(n){var c=n.value;return!!t.isFacetValueItem(c)&&c.facetValue.id===e.facetValue.id})||t.selectComponent.select({label:"",value:e})})}},{key:"onSelectChange",value:function(e){var t=this;Array.isArray(e)||(e=[e]);var n=e.find(function(e){return!t.isFacetValueItem(e)}),c=n?n.label:"",a=e.filter(this.isFacetValueItem).map(function(e){return e.facetValue.id});c!==this.lastTerm&&(this.searchTermChange.emit(c),this.lastTerm=c),this.lastFacetValueIds.join(",")!==a.join(",")&&(this.facetValueChange.emit(a),this.lastFacetValueIds=a)}},{key:"addTagFn",value:function(e){return{label:e}}},{key:"isSearchHeaderSelected",value:function(){return-1===this.selectComponent.itemsList.markedIndex}}]),e}();pa.\u0275fac=function(e){return new(e||pa)},pa.\u0275cmp=u.Xb({type:pa,selectors:[["vdr-product-search-input"]],viewQuery:function(e,t){var n;(1&e&&u.ad(Kt,3),2&e)&&(u.Ic(n=u.rc())&&(t.selectComponent=n.first))},inputs:{facetValueResults:"facetValueResults"},outputs:{searchTermChange:"searchTermChange",facetValueChange:"facetValueChange"},features:[u.Rb([{provide:K.c,useValue:da}])],decls:6,vars:9,consts:[[3,"addTag","placeholder","items","searchFn","hideSelected","multiple","markFirst","change"],["selectComponent",""],["ng-header-tmp",""],["ng-label-tmp",""],["ng-option-tmp",""],["class","search-header",3,"selected","click",4,"ngIf"],[1,"search-header",3,"click"],[4,"ngIf"],[3,"facetValue","removable","remove"],[3,"icon","iconClick"],[3,"facetValue","removable"]],template:function(e,t){1&e&&(u.jc(0,"ng-select",0,1),u.qc("change",function(e){return t.onSelectChange(e)}),u.tc(2,"translate"),u.Tc(3,tn,1,1,"ng-template",2),u.Tc(4,an,2,2,"ng-template",3),u.Tc(5,on,1,1,"ng-template",4),u.ic()),2&e&&u.zc("addTag",t.addTagFn)("placeholder",u.uc(2,7,"catalog.search-product-name-or-code"))("items",t.facetValueResults)("searchFn",t.filterFacetResults)("hideSelected",!0)("multiple",!0)("markFirst",!1)},directives:[K.a,K.f,K.e,K.d,J.o,v.bb,v.D],pipes:[ce.d],styles:["[_nghost-%COMP%]{margin-top:6px;display:block;width:100%}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{background:none;margin:0}[_nghost-%COMP%]     .ng-dropdown-panel-items div.ng-option:last-child{display:none}[_nghost-%COMP%]     .ng-dropdown-panel .ng-dropdown-header{border:none;padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container{padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{padding-left:8px}ng-select[_ngcontent-%COMP%]{width:100%;min-width:300px;margin-right:12px}.search-header[_ngcontent-%COMP%]{padding:8px 10px;border-bottom:1px solid var(--color-component-border-100);cursor:pointer}.search-header.selected[_ngcontent-%COMP%], .search-header[_ngcontent-%COMP%]:hover{background-color:var(--color-component-bg-200)}"],changeDetection:0}),pa.propDecorators={facetValueResults:[{type:u.E}],searchTermChange:[{type:u.P}],facetValueChange:[{type:u.P}],selectComponent:[{type:u.fb,args:["selectComponent",{static:!0}]}]};var fa=function(n){o(a,n);var c=l(a);function a(e,n,i,r,o,s,l){var u,g;return f(this,a),(g=c.call(this,s,l)).dataService=e,g.modalService=n,g.notificationService=i,g.jobQueueService=r,g.serverConfigService=o,g.searchTerm="",g.facetValueIds=[],g.groupByProduct=!0,t((u=d(g),p(a.prototype)),"setQueryFn",u).call(u,function(){for(var e,t=arguments.length,n=new Array(t),c=0;c<t;c++)n[c]=arguments[c];return(e=g.dataService.product).searchProducts.apply(e,[g.searchTerm].concat(n)).refetchOnChannelChange()},function(e){return e.search},function(e,t){return{input:{skip:e,take:t,term:g.searchTerm,facetValueIds:g.facetValueIds,facetValueOperator:v.Bb.AND,groupByProduct:g.groupByProduct}}}),g}return m(a,[{key:"ngOnInit",value:function(){var n=this;t(p(a.prototype),"ngOnInit",this).call(this),this.facetValues$=this.result$.pipe(Object(h.a)(function(e){return e.search.facetValues})),this.route.queryParamMap.pipe(Object(h.a)(function(e){return e.get("q")}),Object(C.a)(this.destroy$)).subscribe(function(e){n.productSearchInput.setSearchTerm(e)});var c=this.route.queryParamMap.pipe(Object(h.a)(function(e){return e.getAll("fvids")}));c.pipe(Object(C.a)(this.destroy$)).subscribe(function(e){n.productSearchInput.setFacetValues(e)}),this.facetValues$.pipe(Object(I.a)(1),Object(A.a)(100),w(c)).subscribe(function(t){var c=e(t,2),a=(c[0],c[1]);n.productSearchInput.setFacetValues(a)}),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(function(e){return e.uiState.contentLanguage}).pipe(Object(S.a)(function(){return n.refresh()}))}},{key:"setSearchTerm",value:function(e){this.searchTerm=e,this.setQueryParam({q:e||null,page:1}),this.refresh()}},{key:"setFacetValueIds",value:function(e){this.facetValueIds=e,this.setQueryParam({fvids:e,page:1}),this.refresh()}},{key:"rebuildSearchIndex",value:function(){var e=this;this.dataService.product.reindex().subscribe(function(t){var n=t.reindex;e.notificationService.info(Object(b.a)("catalog.reindexing")),e.jobQueueService.addJob(n.id,function(t){if(t.state===v.tb.COMPLETED){var n=(new Intl.NumberFormat).format(t.duration||0);e.notificationService.success(Object(b.a)("catalog.reindex-successful"),{count:t.result.indexedItemCount,time:n}),e.refresh()}else e.notificationService.error(Object(b.a)("catalog.reindex-error"))})})}},{key:"deleteProduct",value:function(e){var t=this;this.modalService.dialog({title:Object(b.a)("catalog.confirm-delete-product"),buttons:[{type:"secondary",label:Object(b.a)("common.cancel")},{type:"danger",label:Object(b.a)("common.delete"),returnValue:!0}]}).pipe(Object(j.a)(function(n){return n?t.dataService.product.deleteProduct(e):q.a}),Object(A.a)(500)).subscribe(function(){t.notificationService.success(Object(b.a)("common.notify-delete-success"),{entity:"Product"}),t.refresh()},function(e){t.notificationService.error(Object(b.a)("common.notify-delete-error"),{entity:"Product"})})}},{key:"setLanguage",value:function(e){this.dataService.client.setContentLanguage(e).subscribe()}}]),a}(v.y);fa.\u0275fac=function(e){return new(e||fa)(u.dc(v.L),u.dc(v.Cb),u.dc(v.Db),u.dc(v.sb),u.dc(v.Lb),u.dc(g.e),u.dc(g.a))},fa.\u0275cmp=u.Xb({type:fa,selectors:[["vdr-products-list"]],viewQuery:function(e,t){var n;(1&e&&u.ad(sn,3),2&e)&&(u.Ic(n=u.rc())&&(t.productSearchInput=n.first))},features:[u.Pb],decls:32,vars:35,consts:[[3,"grow"],[1,"search-form"],[3,"facetValueResults","searchTermChange","facetValueChange"],["productSearchInputComponent",""],[1,"search-settings-menu","mr3"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["shape","cog"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"flex","wrap"],[1,"mt2"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"full-label"],[1,"left","align-middle"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[1,"align-middle"],[4,"ngIf"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"src"],[1,"placeholder"],["shape","image","size","48"]],template:function(e,t){1&e&&(u.jc(0,"vdr-action-bar"),u.jc(1,"vdr-ab-left",0),u.jc(2,"div",1),u.jc(3,"vdr-product-search-input",2,3),u.qc("searchTermChange",function(e){return t.setSearchTerm(e)})("facetValueChange",function(e){return t.setFacetValueIds(e)}),u.tc(5,"async"),u.ic(),u.jc(6,"vdr-dropdown",4),u.jc(7,"button",5),u.ec(8,"clr-icon",6),u.ic(),u.jc(9,"vdr-dropdown-menu",7),u.jc(10,"button",8),u.qc("click",function(){return t.rebuildSearchIndex()}),u.tc(11,"hasPermission"),u.Vc(12),u.tc(13,"translate"),u.ic(),u.ic(),u.ic(),u.ic(),u.jc(14,"div",9),u.jc(15,"clr-checkbox-wrapper",10),u.jc(16,"input",11),u.qc("ngModelChange",function(e){return t.groupByProduct=e}),u.ic(),u.jc(17,"label"),u.Vc(18),u.tc(19,"translate"),u.ic(),u.ic(),u.jc(20,"vdr-language-selector",12),u.qc("languageCodeChange",function(e){return t.setLanguage(e)}),u.tc(21,"async"),u.tc(22,"async"),u.ic(),u.ic(),u.ic(),u.jc(23,"vdr-ab-right"),u.ec(24,"vdr-action-bar-items",13),u.Tc(25,ln,5,5,"a",14),u.ic(),u.ic(),u.jc(26,"vdr-data-table",15),u.qc("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),u.tc(27,"async"),u.tc(28,"async"),u.tc(29,"async"),u.tc(30,"async"),u.Tc(31,gn,24,30,"ng-template"),u.ic()),2&e&&(u.Sb(1),u.zc("grow",!0),u.Sb(2),u.zc("facetValueResults",u.uc(5,13,t.facetValues$)),u.Sb(7),u.zc("disabled",!u.uc(11,15,u.Cc(33,Tt))),u.Sb(2),u.Xc(" ",u.uc(13,17,"catalog.rebuild-search-index")," "),u.Sb(4),u.zc("ngModel",t.groupByProduct),u.Sb(2),u.Wc(u.uc(19,19,"catalog.group-by-product")),u.Sb(2),u.zc("availableLanguageCodes",u.uc(21,21,t.availableLanguages$))("currentLanguageCode",u.uc(22,23,t.contentLanguage$)),u.Sb(5),u.zc("vdrIfPermissions",u.Cc(34,mn)),u.Sb(1),u.zc("items",u.uc(27,25,t.items$))("itemsPerPage",u.uc(28,27,t.itemsPerPage$))("totalItems",u.uc(29,29,t.totalItems$))("currentPage",u.uc(30,31,t.currentPage$)))},directives:[v.c,v.e,pa,v.T,v.W,ie.o,v.V,v.U,ie.k,v.eb,_.a,ie.i,_.p,_.s,ie.u,v.wb,v.f,v.d,v.qb,v.N,g.h,J.o,v.Sb,v.D],pipes:[J.b,v.ib,ce.d,v.r],styles:[".image-placeholder[_ngcontent-%COMP%]{width:50px;height:50px;background-color:var(--color-component-bg-200)}.image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.search-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;margin-bottom:6px}.search-input[_ngcontent-%COMP%]{min-width:300px}@media screen and (max-width:768px){.search-input[_ngcontent-%COMP%]{min-width:100px}}.search-settings-menu[_ngcontent-%COMP%]{margin:0 12px}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"]}),fa.ctorParameters=function(){return[{type:v.L},{type:v.Cb},{type:v.Db},{type:v.sb},{type:v.Lb},{type:g.e},{type:g.a}]},fa.propDecorators={productSearchInput:[{type:u.fb,args:["productSearchInputComponent",{static:!0}]}]};var ga=function(){function e(){f(this,e),this.variants=[]}return m(e,[{key:"confirm",value:function(){this.resolveWith(!0)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();ga.\u0275fac=function(e){return new(e||ga)},ga.\u0275cmp=u.Xb({type:ga,selectors:[["vdr-confirm-variant-deletion-dialog"]],decls:6,vars:4,consts:[["vdrDialogTitle",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(u.Tc(0,vn,2,3,"ng-template",0),u.Vc(1),u.tc(2,"translate"),u.jc(3,"ul"),u.Tc(4,bn,2,2,"li",1),u.ic(),u.Tc(5,hn,6,6,"ng-template",2)),2&e&&(u.Sb(1),u.Xc("\n",u.uc(2,2,"catalog.confirm-deletion-of-unused-variants-body"),"\n"),u.Sb(3),u.zc("ngForOf",t.variants))},directives:[v.R,J.n,v.Q],pipes:[ce.d],styles:[""],changeDetection:0});var ma=function e(t){f(this,e);for(var n=0,c=Object.keys(t);n<c.length;n++){var a=c[n];this[a]=t[a]}},va=function(){function e(t,n,c,a,i){f(this,e),this.route=t,this.dataService=n,this.productDetailService=c,this.notificationService=a,this.modalService=i,this.formValueChanged=!1,this.generatedVariants=[]}return m(e,[{key:"ngOnInit",value:function(){var e=this;this.initOptionsAndVariants(),this.languageCode=this.route.snapshot.paramMap.get("lang")||Object(v.ic)(),this.dataService.settings.getActiveChannel().single$.subscribe(function(t){e.currencyCode=t.activeChannel.currencyCode})}},{key:"onFormChanged",value:function(e){this.formValueChanged=!0,e.enabled=!0}},{key:"canDeactivate",value:function(){return!this.formValueChanged}},{key:"getVariantsToAdd",value:function(){return this.generatedVariants.filter(function(e){return!e.existing&&e.enabled})}},{key:"getVariantName",value:function(e){return 0===e.options.length?Object(b.a)("catalog.default-variant"):e.options.map(function(e){return e.name}).join(" ")}},{key:"addOption",value:function(){this.optionGroups.push({isNew:!0,name:"",values:[]})}},{key:"generateVariants",value:function(){var e=this,t=this.optionGroups.map(function(e){return e.values}),n=this.generatedVariants,c=function(t,c,a,i){var r,o,s,l,u,d,p=e.getVariantPrototype(c,n);return new ma({enabled:!0,existing:!!a,productVariantId:null==a?void 0:a.id,isDefault:t,options:c,price:null!==(o=null!==(r=null==a?void 0:a.price)&&void 0!==r?r:null==i?void 0:i.price)&&void 0!==o?o:p.price,sku:null!==(l=null!==(s=null==a?void 0:a.sku)&&void 0!==s?s:null==i?void 0:i.sku)&&void 0!==l?l:p.sku,stock:null!==(d=null!==(u=null==a?void 0:a.stockOnHand)&&void 0!==u?u:null==i?void 0:i.stockOnHand)&&void 0!==d?d:p.stock})};this.generatedVariants=t.length?Object(H.generateAllCombinations)(t).map(function(t){var n=e.product.variants.find(function(n){return e.optionsAreEqual(n.options,t)}),a=e.product.variants.find(function(n){return e.optionsAreSubset(n.options,t)});return c(!1,t,n,a)}):[c(!0,[],this.product.variants[0])]}},{key:"getVariantPrototype",value:function(e,t){return t.filter(function(t){return e.map(function(e){return e.name}).filter(function(e){return t.options.map(function(e){return e.name}).includes(e)})}).length?Object(ee.pick)(t[0],["sku","price","stock"]):{sku:"",price:0,stock:0}}},{key:"deleteVariant",value:function(e){var t=this;this.modalService.dialog({title:Object(b.a)("catalog.confirm-delete-product-variant"),buttons:[{type:"secondary",label:Object(b.a)("common.cancel")},{type:"danger",label:Object(b.a)("common.delete"),returnValue:!0}]}).pipe(Object(j.a)(function(n){return n?t.productDetailService.deleteProductVariant(e,t.product.id):q.a}),Object(j.a)(function(){return t.reFetchProduct(null)})).subscribe(function(){t.notificationService.success(Object(b.a)("common.notify-delete-success"),{entity:"ProductVariant"}),t.initOptionsAndVariants()},function(e){t.notificationService.error(Object(b.a)("common.notify-delete-error"),{entity:"ProductVariant"})})}},{key:"save",value:function(){var e=this,t=this.optionGroups.filter(function(e){return e.isNew}).map(function(e){return{name:e.name,values:[]}});this.checkUniqueSkus().pipe(Object(F.a)(function(){return e.confirmDeletionOfObsoleteVariants()}),Object(F.a)(function(){return e.productDetailService.createProductOptionGroups(t,e.languageCode)}),Object(F.a)(function(t){return e.addOptionGroupsToProduct(t)}),Object(F.a)(function(t){return e.addNewOptionsToGroups(t)}),Object(F.a)(function(t){return e.fetchOptionGroups(t)}),Object(F.a)(function(t){return e.createNewProductVariants(t)}),Object(F.a)(function(t){return e.deleteObsoleteVariants(t.createProductVariants)}),Object(F.a)(function(t){return e.reFetchProduct(t)})).subscribe({next:function(t){e.formValueChanged=!1,e.notificationService.success(Object(b.a)("catalog.created-new-variants-success"),{count:t.length}),e.initOptionsAndVariants()}})}},{key:"checkUniqueSkus",value:function(){var e=this,t=this.generatedVariants.filter(function(t,n){return e.generatedVariants.find(function(e){return e.sku.trim()===t.sku.trim()&&e!==t})});return t.length?this.modalService.dialog({title:Object(b.a)("catalog.duplicate-sku-warning"),body:Object(Z.unique)(t.map(function(e){return"".concat(e.sku)})).join(", "),buttons:[{label:Object(b.a)("common.close"),returnValue:!1,type:"primary"}]}).pipe(Object(F.a)(function(e){return q.a})):Object(G.a)(!0)}},{key:"confirmDeletionOfObsoleteVariants",value:function(){var e=this.getObsoleteVariants();return e.length?this.modalService.fromComponent(ga,{locals:{variants:e}}).pipe(Object(F.a)(function(e){return!0===e?Object(G.a)(!0):q.a})):Object(G.a)(!0)}},{key:"getObsoleteVariants",value:function(){var e=this;return this.product.variants.filter(function(t){return!e.generatedVariants.find(function(e){return e.productVariantId===t.id})})}},{key:"hasOnlyDefaultVariant",value:function(e){return 1===e.variants.length&&0===e.optionGroups.length}},{key:"addOptionGroupsToProduct",value:function(e){var t=this;return e.length?Object(W.a)(e.map(function(e){return t.dataService.product.addOptionGroupToProduct({productId:t.product.id,optionGroupId:e.id})})).pipe(Object(h.a)(function(){return e})):Object(G.a)([])}},{key:"addNewOptionsToGroups",value:function(e){var t=this,n=this.optionGroups.map(function(n){var c=e.find(function(e){return e.name===n.name}),a=c?c.id:n.id;if(!a)throw new Error("Could not get a productOptionGroupId");return n.values.filter(function(e){return!e.locked}).map(function(e){return{productOptionGroupId:a,code:Object(R.normalizeString)(e.name,"-"),translations:[{name:e.name,languageCode:t.languageCode}]}})}).reduce(function(e,t){return[].concat(a(e),a(t))},[]),c=[].concat(a(e.map(function(e){return e.id})),a(this.optionGroups.map(function(e){return e.id}).filter(H.notNullOrUndefined)));return n.length?Object(W.a)(n.map(function(e){return t.dataService.product.addOptionToGroup(e)})).pipe(Object(h.a)(function(){return c})):Object(G.a)(c)}},{key:"fetchOptionGroups",value:function(e){var t=this;return Object(W.a)(e.map(function(e){return t.dataService.product.getProductOptionGroup(e).mapSingle(function(e){return e.productOptionGroup}).pipe(Object($.a)(H.notNullOrUndefined))}))}},{key:"createNewProductVariants",value:function(e){var t=e.filter(H.notNullOrUndefined).map(function(e){return e.options}).reduce(function(e,t){return[].concat(a(e),a(t))},[]),n=this.generatedVariants.filter(function(e){return e.enabled&&!e.existing}).map(function(e){return{price:e.price,sku:e.sku,stock:e.stock,optionIds:e.options.map(function(e){return t.find(function(t){return t.name===e.name})}).filter(H.notNullOrUndefined).map(function(e){return e.id})}});return this.productDetailService.createProductVariants(this.product,n,t,this.languageCode)}},{key:"deleteObsoleteVariants",value:function(e){var t=this,n=this.getObsoleteVariants();if(n.length){var c=n.map(function(n){return t.dataService.product.deleteProductVariant(n.id).pipe(Object(h.a)(function(){return e}))});return Object(W.a).apply(void 0,a(c))}return Object(G.a)(e)}},{key:"reFetchProduct",value:function(e){var t=this.route.snapshot.paramMap.get("id");return t?this.dataService.product.getProduct(t).single$.pipe(Object(h.a)(function(){return e})):Object(G.a)(e)}},{key:"initOptionsAndVariants",value:function(){var e=this;this.dataService.product.getProductVariantsOptions(this.route.snapshot.paramMap.get("id")).mapSingle(function(e){return e.product}).subscribe(function(t){e.product=t,e.optionGroups=t.optionGroups.map(function(e){return{id:e.id,isNew:!1,name:e.name,values:e.options.map(function(e){return{id:e.id,name:e.name,locked:!0}})}}),e.generateVariants()})}},{key:"optionsAreEqual",value:function(e,t){return this.toOptionString(e)===this.toOptionString(t)}},{key:"optionsAreSubset",value:function(e,t){return this.toOptionString(t).includes(this.toOptionString(e))}},{key:"toOptionString",value:function(e){return e.map(function(e){return e.name}).sort().join("|")}}]),e}();va.\u0275fac=function(e){return new(e||va)(u.dc(g.a),u.dc(v.L),u.dc(oa),u.dc(v.Db),u.dc(v.Cb))},va.\u0275cmp=u.Xb({type:va,selectors:[["vdr-product-variants-editor"]],decls:31,vars:27,consts:[[1,"btn","btn-primary",3,"disabled","click"],["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[3,"disabled",4,"ngFor","ngForOf"],[1,"option-groups"],[1,"name"],["clrInput","","name","name",3,"ngModel","readonly","ngModelChange"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange",4,"ngIf"],[4,"ngIf"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange"],["clrInput","","type","text","name","sku","required","",3,"ngModel","placeholder","ngModelChange"],["clrInput","","name","price",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","name","stock","min","0","step","1",3,"ngModel","ngModelChange"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"]],template:function(e,t){1&e&&(u.jc(0,"vdr-action-bar"),u.jc(1,"vdr-ab-right"),u.jc(2,"button",0),u.qc("click",function(){return t.save()}),u.Vc(3),u.tc(4,"translate"),u.ic(),u.ic(),u.ic(),u.Tc(5,yn,12,11,"div",1),u.jc(6,"button",2),u.qc("click",function(){return t.addOption()}),u.ec(7,"clr-icon",3),u.Vc(8),u.tc(9,"translate"),u.ic(),u.jc(10,"div",4),u.jc(11,"table",5),u.jc(12,"thead"),u.jc(13,"tr"),u.jc(14,"th"),u.Vc(15),u.tc(16,"translate"),u.ic(),u.jc(17,"th"),u.Vc(18),u.tc(19,"translate"),u.ic(),u.jc(20,"th"),u.Vc(21),u.tc(22,"translate"),u.ic(),u.jc(23,"th"),u.Vc(24),u.tc(25,"translate"),u.ic(),u.jc(26,"th"),u.Vc(27),u.tc(28,"translate"),u.ic(),u.ec(29,"th"),u.ic(),u.ic(),u.Tc(30,Vn,17,13,"tr",6),u.ic(),u.ic()),2&e&&(u.Sb(2),u.zc("disabled",!t.formValueChanged||0===t.getVariantsToAdd().length),u.Sb(1),u.Xc(" ",u.vc(4,10,"common.add-new-variants",u.Dc(25,Ve,t.getVariantsToAdd().length))," "),u.Sb(2),u.zc("ngForOf",t.optionGroups),u.Sb(3),u.Xc(" ",u.uc(9,13,"catalog.add-option"),"\n"),u.Sb(7),u.Wc(u.uc(16,15,"common.create")),u.Sb(3),u.Wc(u.uc(19,17,"catalog.variant")),u.Sb(3),u.Wc(u.uc(22,19,"catalog.sku")),u.Sb(3),u.Wc(u.uc(25,21,"catalog.price")),u.Sb(3),u.Wc(u.uc(28,23,"catalog.stock-on-hand")),u.Sb(3),u.zc("ngForOf",t.generatedVariants))},directives:function(){return[v.c,v.f,J.n,ie.o,ie.u,v.eb,_.b,ie.s,_.p,_.s,Ga,J.o,_.a,ie.i,ie.t,_.z,v.H,_.v,v.T,v.W,v.V,v.U]},pipes:function(){return[ce.d,v.zb]},styles:[".option-groups[_ngcontent-%COMP%]{display:flex}.option-groups[_ngcontent-%COMP%]:first-of-type{margin-top:24px}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]}),va.ctorParameters=function(){return[{type:g.a},{type:v.L},{type:oa},{type:v.Db},{type:v.Cb}]};var ba=function(e){o(n,e);var t=l(n);function n(e,c){return f(this,n),t.call(this,e,{__typename:"Asset",id:"",createdAt:"",updatedAt:"",name:"",type:v.t.IMAGE,fileSize:0,mimeType:"",width:0,height:0,source:"",preview:"",focalPoint:null},function(e){return c.product.getAsset(e).mapStream(function(e){return e.asset})})}return n}(v.x);ba.\u0275fac=function(e){return new(e||ba)(u.nc(g.e),u.nc(v.L))},ba.\u0275prov=Object(u.Zb)({factory:function(){return new ba(Object(u.nc)(g.e),Object(u.nc)(v.L))},token:ba,providedIn:"root"}),ba.ctorParameters=function(){return[{type:g.e},{type:v.L}]};var ha=function(e){o(n,e);var t=l(n);function n(e,c){return f(this,n),t.call(this,e,{__typename:"Collection",id:"",createdAt:"",updatedAt:"",languageCode:Object(v.ic)(),name:"",slug:"",isPrivate:!1,description:"",featuredAsset:null,assets:[],translations:[],filters:[],parent:{},children:null},function(e){return c.collection.getCollection(e).mapStream(function(e){return e.collection})})}return n}(v.x);ha.\u0275fac=function(e){return new(e||ha)(u.nc(g.e),u.nc(v.L))},ha.\u0275prov=Object(u.Zb)({factory:function(){return new ha(Object(u.nc)(g.e),Object(u.nc)(v.L))},token:ha,providedIn:"root"}),ha.ctorParameters=function(){return[{type:g.e},{type:v.L}]};var ya=function(e){o(n,e);var t=l(n);function n(e,c){return f(this,n),t.call(this,e,{__typename:"Facet",id:"",createdAt:"",updatedAt:"",isPrivate:!1,languageCode:Object(v.ic)(),name:"",code:"",translations:[],values:[]},function(e){return c.facet.getFacet(e).mapStream(function(e){return e.facet})})}return n}(v.x);ya.\u0275fac=function(e){return new(e||ya)(u.nc(g.e),u.nc(v.L))},ya.\u0275prov=Object(u.Zb)({factory:function(){return new ya(Object(u.nc)(g.e),Object(u.nc)(v.L))},token:ya,providedIn:"root"}),ya.ctorParameters=function(){return[{type:g.e},{type:v.L}]};var Ca=function(e){o(n,e);var t=l(n);function n(e,c){return f(this,n),t.call(this,c,{__typename:"Product",id:"",createdAt:"",updatedAt:"",enabled:!0,languageCode:Object(v.ic)(),name:"",slug:"",featuredAsset:null,assets:[],description:"",translations:[],optionGroups:[],facetValues:[],variants:[],channels:[]},function(t){return e.product.getProduct(t).refetchOnChannelChange().mapStream(function(e){return e.product})})}return n}(v.x);Ca.\u0275fac=function(e){return new(e||Ca)(u.nc(v.L),u.nc(g.e))},Ca.\u0275prov=Object(u.Zb)({factory:function(){return new Ca(Object(u.nc)(v.L),Object(u.nc)(g.e))},token:Ca,providedIn:"root"}),Ca.ctorParameters=function(){return[{type:v.L},{type:g.e}]};var Oa=function(e){o(n,e);var t=l(n);function n(e,c){return f(this,n),t.call(this,e,{__typename:"Product",id:"",createdAt:"",updatedAt:"",name:"",optionGroups:[],variants:[]},function(e){return c.product.getProductVariantsOptions(e).mapStream(function(e){return e.product})})}return n}(v.x);Oa.\u0275fac=function(e){return new(e||Oa)(u.nc(g.e),u.nc(v.L))},Oa.\u0275prov=Object(u.Zb)({factory:function(){return new Oa(Object(u.nc)(g.e),Object(u.nc)(v.L))},token:Oa,providedIn:"root"}),Oa.ctorParameters=function(){return[{type:g.e},{type:v.L}]};var ja={breadcrumb:Object(b.a)("breadcrumb.products")},ka={breadcrumb:wa},Pa={breadcrumb:za},Sa={breadcrumb:Object(b.a)("breadcrumb.facets")},Ia={breadcrumb:Da},Fa={breadcrumb:Object(b.a)("breadcrumb.collections")},Va={breadcrumb:Aa},xa={breadcrumb:Object(b.a)("breadcrumb.assets")},Ma={breadcrumb:$a},Ta=[{path:"products",component:fa,data:ja},{path:"products/:id",component:ua,resolve:Object(v.Zb)(Ca),canDeactivate:[v.z],data:ka},{path:"products/:id/manage-variants",component:va,resolve:Object(v.Zb)(Oa),canDeactivate:[v.z],data:Pa},{path:"facets",component:ia,data:Sa},{path:"facets/:id",component:aa,resolve:Object(v.Zb)(ya),canDeactivate:[v.z],data:Ia},{path:"collections",component:ca,data:Fa},{path:"collections/:id",component:na,resolve:Object(v.Zb)(ha),canDeactivate:[v.z],data:Va},{path:"assets",component:ea,data:xa},{path:"assets/:id",component:Kc,resolve:Object(v.Zb)(ba),data:Ma}];function wa(e,t){return Object(v.bc)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.products",getName:function(e){return e.name},route:"products"})}function za(e,t){return e.entity.pipe(Object(h.a)(function(e){return[{label:Object(b.a)("breadcrumb.products"),link:["../","products"]},{label:"".concat(e.name),link:["../","products",t.id,{tab:"variants"}]},{label:Object(b.a)("breadcrumb.manage-variants"),link:["manage-variants"]}]}))}function Da(e,t){return Object(v.bc)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.facets",getName:function(e){return e.name},route:"facets"})}function Aa(e,t){return Object(v.bc)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.collections",getName:function(e){return e.name},route:"collections"})}function $a(e,t){return Object(v.bc)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.assets",getName:function(e){return e.name},route:"assets"})}function _a(e,t){var c,a,i,r,o,s=[],l={},u=(i=t,r=new Map,i&&function e(t){r.set(t.id,t),t.children.forEach(e)}(i),r),d=n(e);try{for(d.s();!(o=d.n()).done;){var p=o.value;l[p.id]=Object.assign(Object.assign({},p),{children:[]})}}catch(h){d.e(h)}finally{d.f()}var f,g=n(e.map(function(e){return e.id}));try{for(g.s();!(f=g.n()).done;){var m=f.value;if(l.hasOwnProperty(m)){var v=l[m];v.expanded=null!==(a=null===(c=u.get(m))||void 0===c?void 0:c.expanded)&&void 0!==a&&a;var b=v.parent;if(!b)continue;l[b.id]?l[b.id]?l[b.id].children.push(v):l[b.id]={children:[v]}:s.push(v)}}}catch(h){g.e(h)}finally{g.f()}return{id:s.length?s[0].parent.id:void 0,children:s}}var La=function(){function e(){f(this,e),this.expandAll=!1,this.rearrange=new u.u,this.deleteCollection=new u.u}return m(e,[{key:"ngOnChanges",value:function(e){"collections"in e&&this.collections&&(this.collectionTree=_a(this.collections,this.collectionTree))}},{key:"onDrop",value:function(e){var t=e.item.data,n=e.container.data.id;if(null==n)throw new Error("Could not determine the ID of the root Collection");this.rearrange.emit({collectionId:t.id,parentId:n,index:e.currentIndex})}},{key:"onMove",value:function(e){this.rearrange.emit(e)}},{key:"onDelete",value:function(e){this.deleteCollection.emit(e)}},{key:"isRootNode",value:function(e){return!e.hasOwnProperty("parent")}}]),e}();La.\u0275fac=function(e){return new(e||La)},La.\u0275cmp=u.Xb({type:La,selectors:[["vdr-collection-tree"]],inputs:{expandAll:"expandAll",collections:"collections",activeCollectionId:"activeCollectionId"},outputs:{rearrange:"rearrange",deleteCollection:"deleteCollection"},features:[u.Qb],decls:1,vars:1,consts:[["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId"]],template:function(e,t){1&e&&u.Tc(0,xn,1,3,"vdr-collection-tree-node",0),2&e&&u.zc("ngIf",t.collectionTree)},directives:function(){return[J.o,Ea,te.d]},styles:[""],changeDetection:0}),La.propDecorators={collections:[{type:u.E}],activeCollectionId:[{type:u.E}],expandAll:[{type:u.E}],rearrange:[{type:u.P}],deleteCollection:[{type:u.P}]};var Ea=function(){function e(t,n,c){f(this,e),this.parent=t,this.root=n,this.dataService=c,this.depth=0,this.expandAll=!1,t&&(this.depth=t.depth+1)}return m(e,[{key:"ngOnInit",value:function(){this.parentName=this.collectionTree.name||"<root>";var e=this.dataService.client.userStatus().mapStream(function(e){return e.userStatus.permissions}).pipe(Object(V.a)(1));this.hasUpdatePermission$=e.pipe(Object(h.a)(function(e){return e.includes(v.Hb.UpdateCatalog)||e.includes(v.Hb.UpdateCollection)})),this.hasDeletePermission$=e.pipe(Object(h.a)(function(e){return e.includes(v.Hb.DeleteCatalog)||e.includes(v.Hb.DeleteCollection)}))}},{key:"ngOnChanges",value:function(e){var t=e.expandAll;t&&!0===t.previousValue&&!1===t.currentValue&&this.collectionTree.children.forEach(function(e){return e.expanded=!1})}},{key:"trackByFn",value:function(e,t){return t.id}},{key:"getMoveListItems",value:function(e){return function t(n,c,a){if(n.id!==e.id){var i=c.concat(n.name),r=e.parent&&e.parent.id;n.id!==r&&a.push({path:i.slice(1).join(" / ")||"root",id:n.id}),n.children.forEach(function(e){return t(e,i,a)})}return a}(this.root.collectionTree,[],[])}},{key:"move",value:function(e,t){this.root.onMove({index:0,parentId:t,collectionId:e.id})}},{key:"moveUp",value:function(e,t){e.parent&&this.root.onMove({index:t-1,parentId:e.parent.id,collectionId:e.id})}},{key:"moveDown",value:function(e,t){e.parent&&this.root.onMove({index:t+1,parentId:e.parent.id,collectionId:e.id})}},{key:"drop",value:function(e){Object(te.f)(this.collectionTree.children,e.previousIndex,e.currentIndex),this.root.onDrop(e)}},{key:"delete",value:function(e){this.root.onDelete(e)}}]),e}();Ea.\u0275fac=function(e){return new(e||Ea)(u.dc(Ea,12),u.dc(La),u.dc(v.L))},Ea.\u0275cmp=u.Xb({type:Ea,selectors:[["vdr-collection-tree-node"]],inputs:{expandAll:"expandAll",collectionTree:"collectionTree",activeCollectionId:"activeCollectionId"},features:[u.Qb],decls:4,vars:6,consts:[["cdkDropList","",1,"tree-node",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["dropList",""],["class","collection","cdkDrag","",3,"private","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"collection",3,"cdkDragData"],[1,"collection-detail",3,"ngClass"],[1,"name"],["class","icon-button folder-button",3,"disabled","click",4,"ngIf","ngIfElse"],["folderSpacer",""],[1,"flex-spacer"],[4,"ngIf"],["queryParamsHandling","preserve",1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","view-list"],[1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","edit"],["class","drag-handle","cdkDragHandle","",4,"vdrIfPermissions"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["class","dropdown-item",3,"routerLink",4,"vdrIfPermissions"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"disabled","click"],["shape","caret up"],["shape","caret down"],[1,"dropdown-header"],["type","button","vdrDropdownItem","",3,"disabled","click",4,"ngFor","ngForOf"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],[1,"icon-button","folder-button",3,"disabled","click"],["shape","folder",4,"ngIf"],["shape","folder-open",4,"ngIf"],["shape","folder"],["shape","folder-open"],[1,"folder-button-spacer"],["cdkDragHandle","",1,"drag-handle"],["shape","drag-handle","size","24"],[1,"dropdown-item",3,"routerLink"],["shape","plus"],["shape","child-arrow"],[3,"expandAll","collectionTree","activeCollectionId"]],template:function(e,t){1&e&&(u.jc(0,"div",0,1),u.qc("cdkDropListDropped",function(e){return t.drop(e)}),u.tc(2,"async"),u.Tc(3,Xn,45,51,"div",2),u.ic()),2&e&&(u.zc("cdkDropListData",t.collectionTree)("cdkDropListDisabled",!u.uc(2,4,t.hasUpdatePermission$)),u.Sb(3),u.zc("ngForOf",t.collectionTree.children)("ngForTrackBy",t.trackByFn))},directives:[te.c,J.n,ie.l,te.a,J.m,J.o,g.h,ie.o,v.qb,v.T,v.W,v.V,v.U,v.D,te.b,Ea],pipes:[J.b,ce.d],styles:["[_nghost-%COMP%]{display:block}.collection[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);font-size:.65rem;transition:transform .25s cubic-bezier(0,0,.2,1);margin-bottom:2px;border-left:2px solid transparent;transition:border-left-color .2s}.collection.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--color-component-border-100)}.collection[_ngcontent-%COMP%]   .collection-detail.active[_ngcontent-%COMP%]{background-color:var(--clr-global-selection-color)}.collection[_ngcontent-%COMP%]   .collection-detail.depth-1[_ngcontent-%COMP%]{padding-left:36px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-2[_ngcontent-%COMP%]{padding-left:60px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-3[_ngcontent-%COMP%]{padding-left:84px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-4[_ngcontent-%COMP%]{padding-left:108px}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]   .folder-button-spacer[_ngcontent-%COMP%]{display:inline-block;width:28px}.tree-node[_ngcontent-%COMP%]{display:block;background:var(--color-component-bg-100);overflow:hidden}.tree-node.cdk-drop-list-dragging[_ngcontent-%COMP%] > .collection[_ngcontent-%COMP%]{border-left-color:var(--color-primary-300)}.drag-placeholder[_ngcontent-%COMP%]{min-height:120px;background-color:var(--color-component-bg-300);transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%], .example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .tree-node[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0}),Ea.ctorParameters=function(){return[{type:Ea,decorators:[{type:u.Z},{type:u.O}]},{type:La},{type:v.L}]},Ea.propDecorators={collectionTree:[{type:u.E}],activeCollectionId:[{type:u.E}],expandAll:[{type:u.E}]};var qa=function(){function e(t){f(this,e),this.dataService=t,this.variantsChange=new u.u,this.optionGroups=[],this.variantFormValues={}}return m(e,[{key:"ngOnInit",value:function(){var e=this;this.dataService.settings.getActiveChannel().single$.subscribe(function(t){e.currencyCode=t.activeChannel.currencyCode}),this.generateVariants()}},{key:"addOption",value:function(){this.optionGroups.push({name:"",values:[]})}},{key:"removeOption",value:function(e){this.optionGroups=this.optionGroups.filter(function(t){return t.name!==e}),this.generateVariants()}},{key:"generateVariants",value:function(){var e=this,t=this.optionGroups.reduce(function(e,t){return e+t.values.length},0)?this.optionGroups.map(function(e){return e.values.map(function(e){return e.name})}):[["__DEFAULT_VARIANT__"]];this.variants=Object(H.generateAllCombinations)(t).map(function(e){return{id:e.join("|"),values:e}}),this.variants.forEach(function(t){e.variantFormValues[t.id]||(e.variantFormValues[t.id]={optionValues:t.values,enabled:!0,price:e.copyFromDefault(t.id,"price",0),sku:e.copyFromDefault(t.id,"sku",""),stock:e.copyFromDefault(t.id,"stock",0)})}),this.onFormChange()}},{key:"trackByFn",value:function(e,t){return t.values.join("|")}},{key:"handleEnter",value:function(e,t){e.preventDefault(),e.stopPropagation(),t.focus()}},{key:"onFormChange",value:function(){var e=this,t=this.variants.map(function(t){return e.variantFormValues[t.id]}).filter(function(e){return e.enabled});this.variantsChange.emit({groups:this.optionGroups.map(function(e){return{name:e.name,values:e.values.map(function(e){return e.name})}}),variants:t})}},{key:"copyFromDefault",value:function(e,t,n){return"__DEFAULT_VARIANT__"!==e?this.variantFormValues.__DEFAULT_VARIANT__[t]:n}}]),e}();qa.\u0275fac=function(e){return new(e||qa)(u.dc(v.L))},qa.\u0275cmp=u.Xb({type:qa,selectors:[["vdr-generate-product-variants"]],outputs:{variantsChange:"variantsChange"},decls:21,vars:17,consts:[["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[4,"ngIf"],[3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"option-groups"],[1,"name"],["placeholder","e.g. Size","clrInput","","name","name","required","",3,"ngModel","ngModelChange","keydown.enter"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],[1,"remove-group"],[1,"btn","btn-icon","btn-warning-outline",3,"title","click"],["shape","trash"],["clrInput","","type","text",3,"ngModel","placeholder","change","ngModelChange"],["clrInput","",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","min","0","step","1",3,"ngModel","ngModelChange","change"],["type","checkbox","clrCheckbox","",3,"ngModel","change","ngModelChange"]],template:function(e,t){1&e&&(u.Tc(0,Un,16,13,"div",0),u.jc(1,"button",1),u.qc("click",function(){return t.addOption()}),u.ec(2,"clr-icon",2),u.Vc(3),u.tc(4,"translate"),u.ic(),u.jc(5,"div",3),u.jc(6,"table",4),u.jc(7,"thead"),u.jc(8,"tr"),u.Tc(9,Bn,3,3,"th",5),u.Tc(10,Rn,3,3,"th",5),u.jc(11,"th"),u.Vc(12),u.tc(13,"translate"),u.ic(),u.jc(14,"th"),u.Vc(15),u.tc(16,"translate"),u.ic(),u.jc(17,"th"),u.Vc(18),u.tc(19,"translate"),u.ic(),u.ic(),u.ic(),u.Tc(20,Qn,13,11,"tr",6),u.ic(),u.ic()),2&e&&(u.zc("ngForOf",t.optionGroups),u.Sb(3),u.Xc(" ",u.uc(4,9,"catalog.add-option"),"\n"),u.Sb(6),u.zc("ngIf",1<t.variants.length),u.Sb(1),u.zc("ngIf",1<t.variants.length),u.Sb(2),u.Wc(u.uc(13,11,"catalog.sku")),u.Sb(3),u.Wc(u.uc(16,13,"catalog.price")),u.Sb(3),u.Wc(u.uc(19,15,"catalog.stock-on-hand")),u.Sb(2),u.zc("ngForOf",t.variants)("ngForTrackBy",t.trackByFn))},directives:function(){return[J.n,ie.o,J.o,ie.l,ie.u,v.eb,_.b,ie.s,_.z,_.p,_.s,Ga,ie.t,v.H,_.v,_.a,ie.i]},pipes:function(){return[ce.d]},styles:["[_nghost-%COMP%]{display:block;margin-bottom:120px}.option-groups[_ngcontent-%COMP%]{display:flex}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.remove-group[_ngcontent-%COMP%]{padding-top:18px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]}),qa.ctorParameters=function(){return[{type:v.L}]},qa.propDecorators={variantsChange:[{type:u.P}]};var Na={provide:_.n,useExisting:Object(u.lb)(function(){return Ga}),multi:!0},Ga=function(){function e(t){f(this,e),this.changeDetector=t,this.groupName="",this.disabled=!1,this.input="",this.isFocussed=!1,this.lastSelected=!1}return m(e,[{key:"registerOnChange",value:function(e){this.onChangeFn=e}},{key:"registerOnTouched",value:function(e){this.onTouchFn=e}},{key:"setDisabledState",value:function(e){this.disabled=e,this.changeDetector.markForCheck()}},{key:"writeValue",value:function(e){this.options=e||[]}},{key:"focus",value:function(){this.textArea.nativeElement.focus()}},{key:"removeOption",value:function(e){e.locked||(this.options=this.options.filter(function(t){return t.name!==e.name}),this.onChangeFn(this.options))}},{key:"handleKey",value:function(e){switch(e.key){case",":case"Enter":this.addOptionValue(),e.preventDefault();break;case"Backspace":this.lastSelected?(this.removeLastOption(),this.lastSelected=!1):""===this.input&&(this.lastSelected=!0);break;default:this.lastSelected=!1}}},{key:"handleBlur",value:function(){this.isFocussed=!1,this.addOptionValue()}},{key:"addOptionValue",value:function(){this.options=Object(Z.unique)([].concat(a(this.options),a(this.parseInputIntoOptions(this.input)))),this.input="",this.onChangeFn(this.options)}},{key:"parseInputIntoOptions",value:function(e){return e.split(/[,\n]/).map(function(e){return e.trim()}).filter(function(e){return""!==e}).map(function(e){return{name:e,locked:!1}})}},{key:"removeLastOption",value:function(){this.options[this.options.length-1].locked||(this.options=this.options.slice(0,this.options.length-1))}}]),e}();Ga.\u0275fac=function(e){return new(e||Ga)(u.dc(u.k))},Ga.\u0275cmp=u.Xb({type:Ga,selectors:[["vdr-option-value-input"]],viewQuery:function(e,t){var n;(1&e&&u.ad(Zn,3),2&e)&&(u.Ic(n=u.rc())&&(t.textArea=n.first))},inputs:{groupName:"groupName"},features:[u.Rb([Na])],decls:4,vars:5,consts:[[1,"input-wrapper",3,"click"],["class","chips",4,"ngIf"],[3,"ngModel","disabled","keyup","focus","blur","ngModelChange"],["textArea",""],[1,"chips"],[3,"icon","selected","locked","colorFrom","iconClick",4,"ngFor","ngForOf"],[3,"icon","colorFrom","iconClick"]],template:function(e,t){if(1&e){var n=u.kc();u.jc(0,"div",0),u.qc("click",function(){return u.Mc(n),u.Jc(3).focus()}),u.Tc(1,Kn,2,1,"div",1),u.jc(2,"textarea",2,3),u.qc("keyup",function(e){return t.handleKey(e)})("focus",function(){return t.isFocussed=!0})("blur",function(){return t.handleBlur()})("ngModelChange",function(e){return t.input=e}),u.ic(),u.ic()}2&e&&(u.Vb("focus",t.isFocussed),u.Sb(1),u.zc("ngIf",0<t.options.length),u.Sb(1),u.zc("ngModel",t.input)("disabled",t.disabled))},directives:[J.o,v.eb,_.b,_.p,_.s,J.n,v.D],styles:[".input-wrapper[_ngcontent-%COMP%]{background-color:#fff;border-radius:3px!important;border:1px solid var(--color-grey-300)!important;cursor:text}.input-wrapper.focus[_ngcontent-%COMP%]{border-color:var(--color-primary-500)!important;box-shadow:0 0 1px 1px var(--color-primary-100)}.input-wrapper[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{padding:5px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{background-color:var(--color-component-bg-100)}vdr-chip[_ngcontent-%COMP%]     .wrapper{margin:0 3px}vdr-chip.locked[_ngcontent-%COMP%]{opacity:.8}vdr-chip.selected[_ngcontent-%COMP%]     .wrapper{border-color:var(--color-warning-500)!important;box-shadow:0 0 1px 1px var(--color-warning-400);opacity:.6}"]}),Ga.ctorParameters=function(){return[{type:u.k}]},Ga.propDecorators={groupName:[{type:u.E}],textArea:[{type:u.fb,args:["textArea",{static:!0}]}]};var Wa=function(){function e(t,n,c,a){var i=this;f(this,e),this.modalService=t,this.changeDetector=n,this.viewportRuler=c,this.collectionDetailComponent=a,this.compact=!1,this.change=new u.u,this.assets=[],this.updateCollectionPermissions=[v.Hb.UpdateCatalog,v.Hb.UpdateCollection],this.updateProductPermissions=[v.Hb.UpdateCatalog,v.Hb.UpdateProduct],this.dropListEnterPredicate=function(e,t){if(t===i.placeholder)return!0;if(t!==i.activeContainer)return!1;var n=i.placeholder.element.nativeElement,c=e.dropContainer.element.nativeElement,a=t.element.nativeElement,r=a.parentElement&&a.parentElement.children,o=Xa(r,i.source?n:c),s=Xa(r,a);return i.source||(i.sourceIndex=o,i.source=e.dropContainer,n.style.width=c.clientWidth+"px",n.style.height=c.clientHeight+"px",c.parentElement&&c.parentElement.removeChild(c)),i.targetIndex=s,i.target=t,n.style.display="",a.parentElement&&a.parentElement.insertBefore(n,s>o?a.nextSibling:a),i.placeholder._dropListRef.enter(e._dragRef,e.element.nativeElement.offsetLeft,e.element.nativeElement.offsetTop),!1}}return m(e,[{key:"assetsSetter",set:function(e){this.assets=e.slice()}},{key:"updatePermissions",get:function(){return this.collectionDetailComponent?this.updateCollectionPermissions:this.updateProductPermissions}},{key:"ngAfterViewInit",value:function(){var e=this.placeholder.element.nativeElement;e.style.display="none",e.parentElement&&e.parentElement.removeChild(e)}},{key:"selectAssets",value:function(){var e=this;this.modalService.fromComponent(v.o,{size:"xl"}).subscribe(function(t){t&&t.length&&(e.assets=Object(Z.unique)(e.assets.concat(t),"id"),e.featuredAsset||(e.featuredAsset=t[0]),e.emitChangeEvent(e.assets,e.featuredAsset),e.changeDetector.markForCheck())})}},{key:"setAsFeatured",value:function(e){this.featuredAsset=e,this.emitChangeEvent(this.assets,e)}},{key:"isFeatured",value:function(e){return!!this.featuredAsset&&this.featuredAsset.id===e.id}},{key:"previewAsset",value:function(e){this.modalService.fromComponent(v.q,{size:"xl",closable:!0,locals:{asset:e}}).subscribe()}},{key:"removeAsset",value:function(e){this.assets=this.assets.filter(function(t){return t.id!==e.id}),this.featuredAsset&&this.featuredAsset.id===e.id&&(this.featuredAsset=this.assets.length>0?this.assets[0]:void 0),this.emitChangeEvent(this.assets,this.featuredAsset)}},{key:"emitChangeEvent",value:function(e,t){this.change.emit({assets:e,featuredAsset:t})}},{key:"dragMoved",value:function(e){var t=this,n=this.getPointerPositionOnPage(e.event);this.listGroup._items.forEach(function(e){(function(e,t,n){var c=e.element.nativeElement.getBoundingClientRect(),a=c.top,i=c.bottom,r=c.left,o=c.right;return n>=a&&n<=i&&t>=r&&t<=o})(e,n.x,n.y)&&(t.activeContainer=e)})}},{key:"dropListDropped",value:function(){if(this.target&&this.source){var e=this.placeholder.element.nativeElement,t=e.parentElement;e.style.display="none",t.removeChild(e),t.appendChild(e),t.insertBefore(this.source.element.nativeElement,t.children[this.sourceIndex]),this.target=null,this.source=null,this.sourceIndex!==this.targetIndex&&(Object(te.f)(this.assets,this.sourceIndex,this.targetIndex),this.emitChangeEvent(this.assets,this.featuredAsset))}}},{key:"getPointerPositionOnPage",value:function(e){var t=function(e){return e.type.startsWith("touch")}(e)?e.touches[0]||e.changedTouches[0]:e,n=this.viewportRuler.getViewportScrollPosition();return{x:t.pageX-n.left,y:t.pageY-n.top}}}]),e}();function Xa(e,t){return e?Array.prototype.indexOf.call(e,t):-1}Wa.\u0275fac=function(e){return new(e||Wa)(u.dc(v.Cb),u.dc(u.k),u.dc(ne.d),u.dc(na,8))},Wa.\u0275cmp=u.Xb({type:Wa,selectors:[["vdr-product-assets"]],viewQuery:function(e,t){var n;(1&e&&(u.ad(ec,1,te.d),u.ad(tc,1,te.c)),2&e)&&(u.Ic(n=u.rc())&&(t.listGroup=n.first),u.Ic(n=u.rc())&&(t.placeholder=n.first))},hostVars:2,hostBindings:function(e,t){2&e&&u.Vb("compact",t.compact)},inputs:{compact:"compact",assetsSetter:["assets","assetsSetter"],featuredAsset:"featuredAsset"},outputs:{change:"change"},decls:5,vars:2,consts:[["class","card",4,"ngIf","ngIfElse"],["compactView",""],["assetList",""],[1,"card"],[1,"card-img"],[1,"featured-asset"],[3,"src","click",4,"ngIf"],["class","placeholder",3,"click",4,"ngIf"],[1,"card-block"],[4,"ngTemplateOutlet"],["class","card-footer",4,"vdrIfPermissions"],[3,"src","click"],[1,"placeholder",3,"click"],["shape","image","size","128"],[1,"card-footer"],[1,"btn",3,"click"],["shape","attachment"],[1,"featured-asset","compact"],["class","compact-select btn btn-icon btn-sm btn-block",3,"title","click",4,"vdrIfPermissions"],["shape","image","size","150"],[1,"compact-select","btn","btn-icon","btn-sm","btn-block",3,"title","click"],["cdkDropListGroup","",1,"all-assets"],["dlg",""],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListEnterPredicate","cdkDropListDropped"],["dl",""],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListEnterPredicate","cdkDropListDropped",4,"ngFor","ngForOf"],["cdkDrag","",3,"cdkDragMoved"],["vdrDropdownTrigger","","tabindex","0",1,"asset-thumb",3,"title"],[3,"src"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"remove-asset",3,"disabled","click"]],template:function(e,t){if(1&e&&(u.Tc(0,rc,8,4,"div",0),u.Tc(1,dc,5,4,"ng-template",null,1,u.Uc),u.Tc(3,fc,6,7,"ng-template",null,2,u.Uc)),2&e){var n=u.Jc(2);u.zc("ngIf",!t.compact)("ngIfElse",n)}},directives:[J.o,J.t,v.qb,ie.o,te.d,te.c,J.n,v.T,te.a,v.W,v.V,v.U],pipes:[v.r,ce.d,v.ib],styles:["[_nghost-%COMP%]{width:340px;display:block}.compact[_nghost-%COMP%]{width:162px}.placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}.all-assets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:3px;padding:0;border:2px solid var(--color-component-border-100);cursor:pointer}.all-assets[_ngcontent-%COMP%]   .asset-thumb.featured[_ngcontent-%COMP%]{border-color:var(--color-primary-500)}.all-assets[_ngcontent-%COMP%]   .remove-asset[_ngcontent-%COMP%]{color:var(--color-warning-500)}.all-assets.compact[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:1px;border-width:1px}.cdk-drag-preview[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:50px;background-color:var(--color-component-bg-100);opacity:.9;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.8;width:60px;height:50px}.cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{background-color:var(--color-component-bg-300);height:100%;width:54px}.cdk-drag-placeholder[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:none}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%], .all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{width:50px}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.all-assets.cdk-drop-list-dragging[_ngcontent-%COMP%]   vdr-dropdown[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0}),Wa.ctorParameters=function(){return[{type:v.Cb},{type:u.k},{type:ne.d},{type:na,decorators:[{type:u.O}]}]},Wa.propDecorators={assetsSetter:[{type:u.E,args:["assets"]}],featuredAsset:[{type:u.E}],compact:[{type:u.w,args:["class.compact"]},{type:u.E}],change:[{type:u.P}],listGroup:[{type:u.fb,args:["dlg",{static:!1,read:te.d}]}],placeholder:[{type:u.fb,args:["dl",{static:!1,read:te.c}]}]};var Ua=function(){function e(){f(this,e),this.updateVariantName=!0,this.codeInputTouched=!1}return m(e,[{key:"ngOnInit",value:function(){var e,t=this,c=this.productOption.translations.find(function(e){return e.languageCode===t.activeLanguage});if(this.name=null!==(e=null==c?void 0:c.name)&&void 0!==e?e:"",this.code=this.productOption.code,this.customFieldsForm=new _.i({}),this.customFields){var a,i=c&&c.customFields||{},r=n(this.customFields);try{for(r.s();!(a=r.n()).done;){var o=a.value,s=o.name,l="localeString"===o.type?i[s]:this.productOption.customFields[s];this.customFieldsForm.addControl(o.name,new _.f(l))}}catch(u){r.e(u)}finally{r.f()}}}},{key:"update",value:function(){var e=Object(v.ac)({translatable:this.productOption,languageCode:this.activeLanguage,updatedFields:{code:this.code,name:this.name,customFields:this.customFieldsForm.value},customFieldConfig:this.customFields,defaultTranslation:{languageCode:this.activeLanguage,name:""}});this.resolveWith(Object.assign(Object.assign({},e),{autoUpdate:this.updateVariantName}))}},{key:"cancel",value:function(){this.resolveWith()}},{key:"updateCode",value:function(e){this.codeInputTouched||this.productOption.code||(this.code=Object(R.normalizeString)(e,"-"))}}]),e}();Ua.\u0275fac=function(e){return new(e||Ua)},Ua.\u0275cmp=u.Xb({type:Ua,selectors:[["vdr-update-product-option-dialog"]],decls:16,vars:13,consts:[["vdrDialogTitle",""],["for","name",3,"label"],["id","name","type","text","required","",3,"ngModel","ngModelChange","input"],["nameInput","ngModel"],["for","code",3,"label"],["id","code","type","text","required","","pattern","[a-z0-9_-]+",3,"ngModel","ngModelChange"],["codeInput","ngModel"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[4,"ngIf"],["vdrDialogButtons",""],[4,"ngFor","ngForOf"],["entityName","ProductOption",3,"customFieldsFormGroup","customField","readonly",4,"ngIf"],["entityName","ProductOption",3,"customFieldsFormGroup","customField","readonly"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(u.Tc(0,gc,2,3,"ng-template",0),u.jc(1,"vdr-form-field",1),u.tc(2,"translate"),u.jc(3,"input",2,3),u.qc("ngModelChange",function(e){return t.name=e})("input",function(e){return t.updateCode(e.target.value)}),u.ic(),u.ic(),u.jc(5,"vdr-form-field",4),u.tc(6,"translate"),u.jc(7,"input",5,6),u.qc("ngModelChange",function(e){return t.code=e}),u.ic(),u.ic(),u.jc(9,"clr-checkbox-wrapper"),u.jc(10,"input",7),u.qc("ngModelChange",function(e){return t.updateVariantName=e}),u.ic(),u.jc(11,"label"),u.Vc(12),u.tc(13,"translate"),u.ic(),u.ic(),u.Tc(14,bc,5,4,"section",8),u.Tc(15,hc,6,7,"ng-template",9)),2&e&&(u.Sb(1),u.zc("label",u.uc(2,7,"catalog.option-name")),u.Sb(2),u.zc("ngModel",t.name),u.Sb(2),u.zc("label",u.uc(6,9,"common.code")),u.Sb(2),u.zc("ngModel",t.code),u.Sb(3),u.zc("ngModel",t.updateVariantName),u.Sb(2),u.Wc(u.uc(13,11,"catalog.auto-update-option-variant-name")),u.Sb(2),u.zc("ngIf",t.customFields.length))},directives:[v.R,v.db,v.eb,_.b,_.z,_.p,_.s,_.w,ie.k,_.a,ie.i,ie.u,J.o,v.Q,J.n,v.I],pipes:[ce.d,v.ib],styles:[""],changeDetection:0});var Ba=function(){function e(t,n,c){f(this,e),this.changeDetector=t,this.modalService=n,this.dataService=c,this.assignToChannel=new u.u,this.removeFromChannel=new u.u,this.assetChange=new u.u,this.selectionChange=new u.u,this.selectFacetValueClick=new u.u,this.updateProductOption=new u.u,this.selectedVariantIds=[],this.pagination={currentPage:1,itemsPerPage:10},this.formGroupMap=new Map,this.GlobalFlag=v.hb,this.updatePermission=[v.Hb.UpdateCatalog,v.Hb.UpdateProduct]}return m(e,[{key:"ngOnInit",value:function(){var e=this;this.dataService.settings.getGlobalSettings("cache-first").single$.subscribe(function(t){var n=t.globalSettings;e.globalTrackInventory=n.trackInventory,e.globalOutOfStockThreshold=n.outOfStockThreshold,e.changeDetector.markForCheck()}),this.subscription=this.formArray.valueChanges.subscribe(function(){return e.changeDetector.markForCheck()}),this.subscription.add(this.formArray.valueChanges.pipe(Object(h.a)(function(e){return e.length}),Object(y.a)(1),Object(P.a)()).subscribe(function(){e.buildFormGroupMap()})),this.buildFormGroupMap()}},{key:"ngOnChanges",value:function(e){var t,n;"facets"in e&&e.facets.currentValue&&(this.facetValues=Object(v.ec)(this.facets)),"variants"in e&&(null===(t=e.variants.currentValue)||void 0===t?void 0:t.length)!==(null===(n=e.variants.previousValue)||void 0===n?void 0:n.length)&&(this.pagination.currentPage=1)}},{key:"ngOnDestroy",value:function(){this.subscription&&this.subscription.unsubscribe()}},{key:"isDefaultChannel",value:function(e){return e===Q.DEFAULT_CHANNEL_CODE}},{key:"trackById",value:function(e,t){return t.id}},{key:"inventoryIsNotTracked",value:function(e){var t,n=null===(t=e.get("trackInventory"))||void 0===t?void 0:t.value;return n===v.hb.FALSE||n===v.hb.INHERIT&&!1===this.globalTrackInventory}},{key:"getTaxCategoryName",value:function(e){var t=e.get(["taxCategoryId"]);if(t&&this.taxCategories){var n=this.taxCategories.find(function(e){return e.id===t.value});return n?n.name:""}return""}},{key:"getSaleableStockLevel",value:function(e){var t=e.useGlobalOutOfStockThreshold?this.globalOutOfStockThreshold:e.outOfStockThreshold;return e.stockOnHand-e.stockAllocated-t}},{key:"areAllSelected",value:function(){return!!this.variants&&this.selectedVariantIds.length===this.variants.length}},{key:"onAssetChange",value:function(e,t){this.assetChange.emit(Object.assign({variantId:e},t));var n=this.variants.findIndex(function(t){return t.id===e});this.formArray.at(n).markAsDirty()}},{key:"toggleSelectAll",value:function(){this.areAllSelected()?this.selectedVariantIds=[]:this.selectedVariantIds=this.variants.map(function(e){return e.id}),this.selectionChange.emit(this.selectedVariantIds)}},{key:"toggleSelectVariant",value:function(e){var t=this.selectedVariantIds.indexOf(e);-1<t?this.selectedVariantIds.splice(t,1):this.selectedVariantIds.push(e),this.selectionChange.emit(this.selectedVariantIds)}},{key:"optionGroupName",value:function(e){var t,n=this,c=this.optionGroups.find(function(t){return t.id===e});if(c)return(null!==(t=null==c?void 0:c.translations.find(function(e){return e.languageCode===n.activeLanguage}))&&void 0!==t?t:c.translations[0]).name}},{key:"optionName",value:function(e){var t,n=this;return(null!==(t=e.translations.find(function(e){return e.languageCode===n.activeLanguage}))&&void 0!==t?t:e.translations[0]).name}},{key:"pendingFacetValues",value:function(e){var t=this;if(this.facets){var n=this.getFacetValueIds(e.id),c=e.facetValues.map(function(e){return e.id});return n.filter(function(e){return!c.includes(e)}).map(function(e){return t.facetValues.find(function(t){return t.id===e})}).filter(H.notNullOrUndefined)}return[]}},{key:"existingFacetValues",value:function(e){return a(this.getFacetValueIds(e.id)).filter(function(t){return e.facetValues.map(function(e){return e.id}).includes(t)}).map(function(t){return e.facetValues.find(function(e){return e.id===t})}).filter(H.notNullOrUndefined)}},{key:"removeFacetValue",value:function(e,t){var n=this.formGroupMap.get(e.id);if(n){var c=n.value.facetValueIds.filter(function(e){return e!==t});n.patchValue({facetValueIds:c}),n.markAsDirty()}}},{key:"isVariantSelected",value:function(e){return-1<this.selectedVariantIds.indexOf(e)}},{key:"editOption",value:function(e){var t=this;this.modalService.fromComponent(Ua,{size:"md",locals:{productOption:e,activeLanguage:this.activeLanguage,customFields:this.customOptionFields}}).subscribe(function(e){e&&t.updateProductOption.emit(e)})}},{key:"buildFormGroupMap",value:function(){this.formGroupMap.clear();var e,t=n(this.formArray.controls);try{for(t.s();!(e=t.n()).done;){var c=e.value;this.formGroupMap.set(c.value.id,c)}}catch(a){t.e(a)}finally{t.f()}this.changeDetector.markForCheck()}},{key:"getFacetValueIds",value:function(e){var t;return(null===(t=this.formGroupMap.get(e))||void 0===t?void 0:t.value).facetValueIds}}]),e}();Ba.\u0275fac=function(e){return new(e||Ba)(u.dc(u.k),u.dc(v.Cb),u.dc(v.L))},Ba.\u0275cmp=u.Xb({type:Ba,selectors:[["vdr-product-variants-list"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",channelPriceIncludesTax:"channelPriceIncludesTax",taxCategories:"taxCategories",facets:"facets",optionGroups:"optionGroups",customFields:"customFields",customOptionFields:"customOptionFields",activeLanguage:"activeLanguage",pendingAssetChanges:"pendingAssetChanges"},outputs:{assignToChannel:"assignToChannel",removeFromChannel:"removeFromChannel",assetChange:"assetChange",selectionChange:"selectionChange",selectFacetValueClick:"selectFacetValueClick",updateProductOption:"updateProductOption"},features:[u.Qb],decls:6,vars:8,consts:[[1,"variants-list"],["class","variant-container card",3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"table-footer"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","pageChange"],[1,"variant-container","card"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"card-block","header-row"],[1,"details"],[1,"sku",3,"readonly"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"name",3,"readonly"],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],[1,"right-controls"],[4,"vdrIfPermissions"],[1,"card-block"],[1,"variant-body"],[1,"assets"],[3,"compact","assets","featuredAsset","change"],[1,"variant-form-inputs"],[1,"standard-fields"],[1,"variant-form-input-row"],[1,"tax-category"],[4,"vdrIfPermissions","vdrIfPermissionsElse"],["taxCategoryLabel",""],[1,"price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[3,"price","currencyCode","priceIncludesTax","taxCategoryId"],[3,"content"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly","vdrDisabled"],[1,"clr-control-label"],[1,"value"],[1,"out-of-stock-threshold-wrapper"],[1,"flex"],["clrInput","","type","number",3,"formControl","readonly","vdrDisabled"],["type","checkbox","clrToggle","","name","useGlobalOutOfStockThreshold","formControlName","useGlobalOutOfStockThreshold",3,"vdrDisabled"],[1,"custom-fields"],["formGroupName","customFields",4,"ngIf"],[1,"options-facets"],[3,"entity"],[4,"ngIf"],[1,"flex-spacer"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[4,"vdrIfMultichannel"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled"],["clrSelect","","name","options","formControlName","taxCategoryId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"tax-category-label"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"],["clrSelect","","name","options","formControlName","trackInventory"],["formGroupName","customFields"],[4,"ngFor","ngForOf"],["entityName","ProductVariant",3,"compact","customFieldsFormGroup","readonly","customField",4,"ngIf"],["entityName","ProductVariant",3,"compact","customFieldsFormGroup","readonly","customField"],[1,"options"],[3,"colorFrom","invert","icon","iconClick",4,"ngFor","ngForOf"],[3,"colorFrom","invert","icon","iconClick"],[1,"option-group-name"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],["class","card-block",4,"vdrIfDefaultChannelActive"],[1,"flex","channel-assignment"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"title","iconClick",4,"ngIf"],["icon","times-circle",3,"title","iconClick"],[3,"channelCode"]],template:function(e,t){1&e&&(u.jc(0,"div",0),u.Tc(1,qc,2,3,"div",1),u.tc(2,"paginate"),u.jc(3,"div",2),u.jc(4,"vdr-items-per-page-controls",3),u.qc("itemsPerPageChange",function(e){return t.pagination.itemsPerPage=e}),u.ic(),u.jc(5,"vdr-pagination-controls",4),u.qc("pageChange",function(e){return t.pagination.currentPage=e}),u.ic(),u.ic(),u.ic()),2&e&&(u.Sb(1),u.zc("ngForOf",u.vc(2,5,t.variants,t.pagination))("ngForTrackBy",t.trackById),u.Sb(3),u.zc("itemsPerPage",t.pagination.itemsPerPage),u.Sb(1),u.zc("currentPage",t.pagination.currentPage)("itemsPerPage",t.pagination.itemsPerPage))},directives:function(){return[J.n,ie.l,v.rb,v.Gb,J.o,_.q,_.j,v.Vb,ie.t,v.eb,_.b,ie.s,_.p,_.h,v.qb,Wa,ie.u,Ha,v.kb,_.v,v.S,_.g,ie.k,_.a,ie.i,v.ab,v.pb,ie.B,_.A,ie.A,_.u,_.D,v.H,_.k,v.I,v.D,v.bb,ie.o,v.ob,v.B]},pipes:function(){return[ae.b,v.ib,ce.d,v.Pb,v.C]},styles:[".with-selected[_ngcontent-%COMP%]{display:flex;min-height:52px;align-items:center;border:1px solid var(--color-component-border-100);border-radius:3px;padding:6px 18px}.with-selected[_ngcontent-%COMP%] > label[_ngcontent-%COMP%], .with-selected[_ngcontent-%COMP%]   vdr-select-toggle[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]{transition:background-color .2s;min-height:330px}.variant-container.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.variant-container[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;margin-right:12px}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex-direction:row;height:36px}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container{width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container input.clr-input{min-width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .sku[_ngcontent-%COMP%]{width:160px;margin-right:20px;flex:0}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]     .name input{min-width:300px}.variant-container[_ngcontent-%COMP%]   .right-controls[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .tax-category-label[_ngcontent-%COMP%]{margin-top:3px}.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{margin:0 6px 8px 24px}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:24px;margin-bottom:24px}.variant-container[_ngcontent-%COMP%]   .track-inventory-toggle[_ngcontent-%COMP%]{margin-top:22px}.variant-container[_ngcontent-%COMP%]   .clr-form-control[_ngcontent-%COMP%]{margin-top:0}.variant-container[_ngcontent-%COMP%]   .facets[_ngcontent-%COMP%]{display:flex;align-items:center}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]   .option-group-name[_ngcontent-%COMP%]{color:var(--color-text-200);text-transform:uppercase;font-size:10px;margin-right:3px;height:11px}.variant-container[_ngcontent-%COMP%]   .options-facets[_ngcontent-%COMP%]{display:flex;color:var(--color-grey-400)}.channel-assignment[_ngcontent-%COMP%]{justify-content:flex-end}.channel-assignment[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:6px 12px 6px 0}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-left:24px}.inventory-untracked[_ngcontent-%COMP%]{opacity:.5}.table-footer[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between;margin-top:6px}"],changeDetection:0}),Ba.ctorParameters=function(){return[{type:u.k},{type:v.Cb},{type:v.L}]},Ba.propDecorators={formArray:[{type:u.E,args:["productVariantsFormArray"]}],variants:[{type:u.E}],channelPriceIncludesTax:[{type:u.E}],taxCategories:[{type:u.E}],facets:[{type:u.E}],optionGroups:[{type:u.E}],customFields:[{type:u.E}],customOptionFields:[{type:u.E}],activeLanguage:[{type:u.E}],pendingAssetChanges:[{type:u.E}],assignToChannel:[{type:u.P}],removeFromChannel:[{type:u.P}],assetChange:[{type:u.P}],selectionChange:[{type:u.P}],selectFacetValueClick:[{type:u.P}],updateProductOption:[{type:u.P}]};var Ra=function(){function e(t){f(this,e),this.changeDetector=t,this.formGroupMap=new Map,this.updatePermission=[v.Hb.UpdateCatalog,v.Hb.UpdateProduct]}return m(e,[{key:"ngOnInit",value:function(){var e=this;this.subscription=this.formArray.valueChanges.pipe(Object(h.a)(function(e){return e.length}),Object(y.a)(1),Object(P.a)()).subscribe(function(){e.buildFormGroupMap()}),this.buildFormGroupMap()}},{key:"ngOnDestroy",value:function(){this.subscription&&this.subscription.unsubscribe()}},{key:"getFeaturedAsset",value:function(e){var t;return(null===(t=this.pendingAssetChanges[e.id])||void 0===t?void 0:t.featuredAsset)||e.featuredAsset}},{key:"optionGroupName",value:function(e){var t=this.optionGroups.find(function(t){return t.id===e});return t&&t.name}},{key:"buildFormGroupMap",value:function(){this.formGroupMap.clear();var e,t=n(this.formArray.controls);try{for(t.s();!(e=t.n()).done;){var c=e.value;this.formGroupMap.set(c.value.id,c)}}catch(a){t.e(a)}finally{t.f()}this.changeDetector.markForCheck()}}]),e}();Ra.\u0275fac=function(e){return new(e||Ra)(u.dc(u.k))},Ra.\u0275cmp=u.Xb({type:Ra,selectors:[["vdr-product-variants-table"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",channelPriceIncludesTax:"channelPriceIncludesTax",optionGroups:"optionGroups",pendingAssetChanges:"pendingAssetChanges"},decls:20,vars:20,consts:[[3,"items"],[4,"ngFor","ngForOf"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"left","align-middle"],[1,"card-img"],[1,"featured-asset"],[3,"src",4,"ngIf","ngIfElse"],["placeholder",""],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"left","align-middle","price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[1,"left","align-middle","stock"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled",3,"vdrDisabled"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"]],template:function(e,t){1&e&&(u.jc(0,"vdr-data-table",0),u.ec(1,"vdr-dt-column"),u.jc(2,"vdr-dt-column"),u.Vc(3),u.tc(4,"translate"),u.ic(),u.jc(5,"vdr-dt-column"),u.Vc(6),u.tc(7,"translate"),u.ic(),u.Tc(8,Nc,3,1,"ng-container",1),u.tc(9,"sort"),u.jc(10,"vdr-dt-column"),u.Vc(11),u.tc(12,"translate"),u.ic(),u.jc(13,"vdr-dt-column"),u.Vc(14),u.tc(15,"translate"),u.ic(),u.jc(16,"vdr-dt-column"),u.Vc(17),u.tc(18,"translate"),u.ic(),u.Tc(19,Hc,1,1,"ng-template"),u.ic()),2&e&&(u.zc("items",t.variants),u.Sb(3),u.Wc(u.uc(4,7,"common.name")),u.Sb(3),u.Wc(u.uc(7,9,"catalog.sku")),u.Sb(2),u.zc("ngForOf",u.vc(9,11,t.optionGroups,"id")),u.Sb(3),u.Wc(u.uc(12,14,"catalog.price")),u.Sb(3),u.Wc(u.uc(15,16,"catalog.stock-on-hand")),u.Sb(3),u.Wc(u.uc(18,18,"common.enabled")))},directives:[v.N,v.M,J.n,J.o,_.q,_.j,ie.t,v.eb,_.b,ie.s,_.p,_.h,_.v,ie.k,_.a,ie.i,v.S,ie.o,v.H],pipes:[ce.d,v.Pb,v.ib,v.r,v.Rb],styles:[".placeholder[_ngcontent-%COMP%]{color:var(--color-grey-300)}.price[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .stock[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:96px}td[_ngcontent-%COMP%]{transition:background-color .2s}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"],changeDetection:0}),Ra.ctorParameters=function(){return[{type:u.k}]},Ra.propDecorators={formArray:[{type:u.E,args:["productVariantsFormArray"]}],variants:[{type:u.E}],channelPriceIncludesTax:[{type:u.E}],optionGroups:[{type:u.E}],pendingAssetChanges:[{type:u.E}]};var Ha=function(){function t(e){f(this,t),this.dataService=e,this.priceChange$=new L.a(0),this.taxCategoryIdChange$=new L.a("")}return m(t,[{key:"ngOnInit",value:function(){var t=this.dataService.settings.getTaxRates(999,0,"cache-first").mapStream(function(e){return e.taxRates.items}),n=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(function(e){return e.activeChannel});this.taxRate$=Object(E.a)(n,t,this.taxCategoryIdChange$).pipe(Object(h.a)(function(t){var n=e(t,3),c=n[0],a=n[1],i=n[2],r=c.defaultTaxZone;if(!r)return 0;var o=a.find(function(e){return e.zone.id===r.id&&e.category.id===i});return o?o.value:0})),this.grossPrice$=Object(E.a)(this.taxRate$,this.priceChange$).pipe(Object(h.a)(function(t){var n=e(t,2),c=n[0],a=n[1];return Math.round(a*((100+c)/100))}))}},{key:"ngOnChanges",value:function(e){"price"in e&&this.priceChange$.next(e.price.currentValue),"taxCategoryId"in e&&this.taxCategoryIdChange$.next(e.taxCategoryId.currentValue)}}]),t}();Ha.\u0275fac=function(e){return new(e||Ha)(u.dc(v.L))},Ha.\u0275cmp=u.Xb({type:Ha,selectors:[["vdr-variant-price-detail"]],inputs:{priceIncludesTax:"priceIncludesTax",price:"price",currencyCode:"currencyCode",taxCategoryId:"taxCategoryId"},features:[u.Qb],decls:5,vars:5,consts:[[1,"clr-control-label"],["class","value",4,"ngIf"],[1,"value"]],template:function(e,t){1&e&&(u.jc(0,"label",0),u.Vc(1),u.tc(2,"translate"),u.ic(),u.Tc(3,Qc,4,8,"div",1),u.Tc(4,Yc,6,14,"div",1)),2&e&&(u.Sb(1),u.Wc(u.uc(2,3,"catalog.taxes")),u.Sb(2),u.zc("ngIf",t.priceIncludesTax),u.Sb(1),u.zc("ngIf",!t.priceIncludesTax))},directives:[ie.u,J.o],pipes:[ce.d,J.b,v.zb],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.value[_ngcontent-%COMP%]{margin-top:3px}"],changeDetection:0}),Ha.ctorParameters=function(){return[{type:v.L}]},Ha.propDecorators={priceIncludesTax:[{type:u.E}],price:[{type:u.E}],currencyCode:[{type:u.E}],taxCategoryId:[{type:u.E}]};var Ja=function e(){f(this,e)};Ja.\u0275fac=function(e){return new(e||Ja)},Ja.\u0275mod=u.bc({type:Ja}),Ja.\u0275inj=u.ac({imports:[[v.Mb,g.i.forChild(Ta)]]})}}])}();
//# sourceMappingURL=7-es5.b7cf748c8a42a154335b.js.map