"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[281],{7281:(te,f,s)=>{s.r(f),s.d(f,{HealthCheckComponent:()=>m,JobListComponent:()=>u,JobStateLabelComponent:()=>p,SystemModule:()=>h,systemRoutes:()=>C});var e=s(6108),a=s(1661),d=s(2977),c=s(8046),y=s(4611),_=s(5086),T=s(9006),A=s(8163),E=s(2727),j=s(3044),b=s(4285),v=s(4992),Z=s(186);function L(n,r){1&n&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"system.health-all-systems-up")," "))}function P(n,r){1&n&&(e._uU(0),e.ALo(1,"translate")),2&n&&e.hij(" ",e.lcZ(1,1,"system.health-error")," ")}const D=function(n,r){return{"is-success":n,"is-danger":r}};function x(n,r){if(1&n&&(e.TgZ(0,"div",7)(1,"div",8),e._UZ(2,"clr-icon",9),e.qZA(),e.TgZ(3,"div",10),e.YNc(4,L,3,3,"ng-container",11),e.YNc(5,P,2,3,"ng-template",null,12,e.W1O),e.TgZ(7,"div",13),e._uU(8),e.ALo(9,"translate"),e.ALo(10,"localeDate"),e.ALo(11,"async"),e.qZA()()()),2&n){const t=r.ngIf,o=e.MAs(6),l=e.oxw();e.xp6(2),e.Q6J("ngClass",e.WLB(13,D,"ok"===t,"ok"!==t)),e.uIk("shape","ok"===t?"check-circle":"exclamation-circle"),e.xp6(2),e.Q6J("ngIf","ok"===t)("ngIfElse",o),e.xp6(4),e.AsE(" ",e.lcZ(9,6,"system.health-last-checked"),": ",e.xi3(10,8,e.lcZ(11,11,l.healthCheckService.lastCheck$),"mediumTime")," ")}}function I(n,r){1&n&&(e.ynx(0),e._UZ(1,"clr-icon",17),e._uU(2),e.ALo(3,"translate"),e.BQk()),2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"system.health-status-up")," "))}function O(n,r){1&n&&(e._UZ(0,"clr-icon",18),e._uU(1),e.ALo(2,"translate")),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"system.health-status-down")," "))}function M(n,r){if(1&n&&(e.TgZ(0,"tr")(1,"td",14),e._uU(2),e.qZA(),e.TgZ(3,"td",14)(4,"vdr-chip",15),e.YNc(5,I,4,3,"ng-container",11),e.YNc(6,O,3,3,"ng-template",null,16,e.W1O),e.qZA()(),e.TgZ(8,"td",14),e._uU(9),e.qZA()()),2&n){const t=r.$implicit,o=e.MAs(7);e.xp6(2),e.Oqu(t.key),e.xp6(2),e.Q6J("colorType","up"===t.result.status?"success":"error"),e.xp6(1),e.Q6J("ngIf","up"===t.result.status)("ngIfElse",o),e.xp6(4),e.Oqu(t.result.message)}}function U(n,r){if(1&n&&(e.TgZ(0,"span",3),e._uU(1),e.ALo(2,"percent"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,1,t.job.progress/100)," ")}}function k(n,r){1&n&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"system.all-job-queues")," "))}function w(n,r){if(1&n&&(e.TgZ(0,"vdr-chip",11),e._uU(1),e.qZA()),2&n){const t=e.oxw().item;e.Q6J("colorFrom",t.name),e.xp6(1),e.Oqu(t.name)}}function J(n,r){if(1&n&&(e.YNc(0,k,3,3,"ng-container",9),e.YNc(1,w,2,2,"ng-template",null,10,e.W1O)),2&n){const t=r.item,o=e.MAs(2);e.Q6J("ngIf","all"===t.name)("ngIfElse",o)}}function N(n,r){if(1&n&&e._uU(0),2&n){const t=r.item;e.hij(" ",t.id," ")}}function q(n,r){if(1&n&&(e._uU(0),e.ALo(1,"timeAgo")),2&n){const t=r.item;e.hij(" ",e.lcZ(1,1,t.createdAt)," ")}}function R(n,r){if(1&n&&(e.TgZ(0,"vdr-chip",11),e._uU(1),e.qZA()),2&n){const t=r.item;e.Q6J("colorFrom",t.queueName),e.xp6(1),e.Oqu(t.queueName)}}function S(n,r){if(1&n&&(e.TgZ(0,"vdr-dropdown")(1,"button",13),e.ALo(2,"translate"),e._UZ(3,"clr-icon",14),e.qZA(),e.TgZ(4,"vdr-dropdown-menu")(5,"div",15),e._UZ(6,"vdr-object-tree",16),e.qZA()()()),2&n){const t=e.oxw().item;e.xp6(1),e.Q6J("title",e.lcZ(2,2,"system.job-data")),e.xp6(5),e.Q6J("value",t.data)}}function B(n,r){if(1&n&&e.YNc(0,S,7,4,"vdr-dropdown",12),2&n){const t=r.item;e.Q6J("ngIf",t.data)}}function W(n,r){if(1&n&&(e.TgZ(0,"div",19),e._uU(1),e.qZA()),2&n){const t=e.oxw().item;e.xp6(1),e.hij("after ",t.attempts," attempts")}}function K(n,r){if(1&n&&(e.TgZ(0,"div",19),e._uU(1),e.qZA()),2&n){const t=e.oxw().item;e.xp6(1),e.AsE(" attempting ",t.attempts+1," of ",t.retries," ")}}function Q(n,r){if(1&n&&(e._UZ(0,"vdr-job-state-label",17),e.YNc(1,W,2,1,"div",18),e.YNc(2,K,2,2,"div",18)),2&n){const t=r.item;e.Q6J("job",t),e.xp6(1),e.Q6J("ngIf","FAILED"===t.state),e.xp6(1),e.Q6J("ngIf","RUNNING"===t.state||"RETRYING"===t.state)}}function Y(n,r){if(1&n&&(e._uU(0),e.ALo(1,"duration")),2&n){const t=r.item;e.hij(" ",e.lcZ(1,1,t.duration)," ")}}function F(n,r){if(1&n&&(e.TgZ(0,"vdr-dropdown")(1,"button",20),e._UZ(2,"clr-icon",14),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"vdr-dropdown-menu")(6,"div",15),e._UZ(7,"vdr-object-tree",16),e.qZA()()()),2&n){const t=e.oxw().item;e.xp6(3),e.hij(" ",e.lcZ(4,2,"system.job-result")," "),e.xp6(4),e.Q6J("value",t.result)}}function $(n,r){if(1&n&&(e.TgZ(0,"vdr-dropdown")(1,"button",20),e._UZ(2,"clr-icon",21),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"vdr-dropdown-menu")(6,"div",15),e._uU(7),e.qZA()()()),2&n){const t=e.oxw().item;e.xp6(3),e.hij(" ",e.lcZ(4,2,"system.job-error")," "),e.xp6(4),e.hij(" ",t.error," ")}}const H=function(){return["DeleteSettings","DeleteSystem"]};function G(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"vdr-dropdown")(1,"button",22),e._UZ(2,"clr-icon",23),e.qZA(),e.TgZ(3,"vdr-dropdown-menu",24)(4,"button",25),e.NdJ("click",function(){e.CHM(t);const l=e.oxw().item,i=e.oxw();return e.KtG(i.cancelJob(l.id))}),e.ALo(5,"hasPermission"),e._UZ(6,"clr-icon",26),e._uU(7),e.ALo(8,"translate"),e.qZA()()()}2&n&&(e.xp6(4),e.Q6J("disabled",!e.lcZ(5,2,e.DdM(6,H))),e.xp6(3),e.hij(" ",e.lcZ(8,4,"common.cancel")," "))}function z(n,r){if(1&n&&(e.YNc(0,F,8,4,"vdr-dropdown",12),e.YNc(1,$,8,4,"vdr-dropdown",12),e.YNc(2,G,9,7,"vdr-dropdown",12)),2&n){const t=r.item,o=e.oxw();e.Q6J("ngIf",o.hasResult(t)),e.xp6(1),e.Q6J("ngIf",t.error),e.xp6(1),e.Q6J("ngIf",!t.isSettled&&"FAILED"!==t.state)}}class m{constructor(r){this.healthCheckService=r}static#e=this.\u0275fac=function(t){return new(t||m)(e.Y36(a.Gpz))};static#t=this.\u0275cmp=e.Xpm({type:m,selectors:[["vdr-health-check"]],decls:30,vars:18,consts:[["class","system-status-header",4,"ngIf"],["locationId","system-status"],[1,"btn","btn-secondary",3,"click"],["shape","refresh"],[1,"table"],[1,"left"],[4,"ngFor","ngForOf"],[1,"system-status-header"],[1,"status-icon"],["size","48",3,"ngClass"],[1,"status-detail"],[4,"ngIf","ngIfElse"],["error",""],[1,"last-checked"],[1,"align-middle","left"],[3,"colorType"],["down",""],["shape","check-circle"],["shape","exclamation-circle"]],template:function(t,o){1&t&&(e.TgZ(0,"vdr-page-header"),e._UZ(1,"vdr-page-title"),e.qZA(),e.TgZ(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left"),e.YNc(6,x,12,16,"div",0),e.ALo(7,"async"),e.qZA(),e.TgZ(8,"vdr-ab-right"),e._UZ(9,"vdr-action-bar-items",1),e.TgZ(10,"button",2),e.NdJ("click",function(){return o.healthCheckService.refresh()}),e._UZ(11,"clr-icon",3),e._uU(12),e.ALo(13,"translate"),e.qZA()()()(),e.TgZ(14,"vdr-page-block")(15,"table",4)(16,"thead")(17,"tr")(18,"th",5),e._uU(19),e.ALo(20,"translate"),e.qZA(),e.TgZ(21,"th",5),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"th",5),e._uU(25),e.ALo(26,"translate"),e.qZA()()(),e.TgZ(27,"tbody"),e.YNc(28,M,10,5,"tr",6),e.ALo(29,"async"),e.qZA()()()()),2&t&&(e.xp6(6),e.Q6J("ngIf",e.lcZ(7,6,o.healthCheckService.status$)),e.xp6(6),e.hij(" ",e.lcZ(13,8,"system.health-refresh")," "),e.xp6(7),e.hij(" ",e.lcZ(20,10,"common.name")," "),e.xp6(3),e.hij(" ",e.lcZ(23,12,"system.health-status")," "),e.xp6(3),e.hij(" ",e.lcZ(26,14,"system.health-message")," "),e.xp6(3),e.Q6J("ngForOf",e.lcZ(29,16,o.healthCheckService.details$)))},dependencies:[d.qvL,c.mk,c.sg,c.O5,a.KkL,a.BND,a.mz,a.Ywx,a.WWO,a.qA0,a.TMj,a.HF2,a.zJY,c.Ov,y.X$,a.HbD],styles:[".system-status-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.system-status-header[_ngcontent-%COMP%]   .status-detail[_ngcontent-%COMP%]{font-weight:700;margin-right:6px}.system-status-header[_ngcontent-%COMP%]   .last-checked[_ngcontent-%COMP%]{font-weight:400;color:var(--color-grey-500)}"],changeDetection:0})}class p{get iconShape(){switch(this.job.state){case a.Zyh.COMPLETED:return"check-circle";case a.Zyh.FAILED:return"exclamation-circle";case a.Zyh.CANCELLED:return"ban";case a.Zyh.PENDING:case a.Zyh.RETRYING:return"hourglass";case a.Zyh.RUNNING:return"sync"}}get colorType(){switch(this.job.state){case a.Zyh.COMPLETED:return"success";case a.Zyh.FAILED:case a.Zyh.CANCELLED:return"error";case a.Zyh.PENDING:case a.Zyh.RETRYING:return"";case a.Zyh.RUNNING:return"warning"}}static#e=this.\u0275fac=function(t){return new(t||p)};static#t=this.\u0275cmp=e.Xpm({type:p,selectors:[["vdr-job-state-label"]],inputs:{job:"job"},decls:5,vars:6,consts:[[3,"colorType"],[1,"mr1"],["class","progress",4,"ngIf"],[1,"progress"]],template:function(t,o){1&t&&(e.TgZ(0,"vdr-chip",0),e._UZ(1,"clr-icon",1),e._uU(2),e.ALo(3,"titlecase"),e.YNc(4,U,3,3,"span",2),e.qZA()),2&t&&(e.Q6J("colorType",o.colorType),e.xp6(1),e.uIk("shape",o.iconShape),e.xp6(1),e.hij(" ",e.lcZ(3,4,o.job.state)," "),e.xp6(2),e.Q6J("ngIf","RUNNING"===o.job.state))},dependencies:[d.qvL,c.O5,a.Ywx,c.Zx,c.rS],styles:[".progress[_ngcontent-%COMP%]{margin-left:3px}clr-icon[_ngcontent-%COMP%]{min-width:12px}"],changeDetection:0})}class u extends a.t7C{constructor(r,t,o,l,i){super(l,i),this.dataService=r,this.modalService=t,this.notificationService=o,this.liveUpdate=new _.p4(!0),this.hideSettled=new _.p4(!0),this.queueFilter=new _.p4("all"),super.setQueryFn((...g)=>this.dataService.settings.getAllJobs(...g),g=>g.jobs,(g,X)=>({options:{skip:g,take:X,filter:{..."all"===this.queueFilter.value?null:{queueName:{eq:this.queueFilter.value}},...this.hideSettled.value?{isSettled:{eq:!1}}:{}},sort:{createdAt:a.Asd.DESC}}}))}ngOnInit(){super.ngOnInit(),(0,T.H)(5e3,2e3).pipe((0,A.R)(this.destroy$),(0,E.h)(()=>this.liveUpdate.value)).subscribe(()=>{this.refresh()}),this.queues$=this.dataService.settings.getJobQueues().mapStream(r=>r.jobQueues).pipe((0,j.U)(r=>[{name:"all",running:!0},...r]))}hasResult(r){const t=r.result;return null!=t&&("object"!=typeof t||Object.keys(t).length>0)}cancelJob(r){this.dataService.settings.cancelJob(r).subscribe(()=>this.refresh())}static#e=this.\u0275fac=function(t){return new(t||u)(e.Y36(a.DoR),e.Y36(a.Z7U),e.Y36(a.gqp),e.Y36(b.F0),e.Y36(b.gz))};static#t=this.\u0275cmp=e.Xpm({type:u,selectors:[["vdr-job-list"]],features:[e.qOj],decls:47,vars:53,consts:[[1,"mr-2"],["type","checkbox","clrCheckbox","","name","live-update",3,"formControl"],["type","checkbox","clrCheckbox","","name","hide-settled",3,"formControl","change"],["locationId","job-list"],["bindValue","name",3,"addTag","items","hideSelected","multiple","markFirst","clearable","searchable","formControl","change"],["ng-label-tmp","","ng-option-tmp",""],["id","job-list",3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"heading"],[3,"heading","optional"],[4,"ngIf","ngIfElse"],["others",""],[3,"colorFrom"],[4,"ngIf"],["vdrDropdownTrigger","",1,"btn","btn-link","btn-icon",3,"title"],["shape","details"],[1,"result-detail"],[3,"value"],[3,"job"],["class","retry-info",4,"ngIf"],[1,"retry-info"],["vdrDropdownTrigger","",1,"btn","btn-link","btn-sm","details-button"],["shape","exclamation-circle"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","ban",1,"is-danger"]],template:function(t,o){1&t&&(e.TgZ(0,"vdr-page-header"),e._UZ(1,"vdr-page-title"),e.qZA(),e.TgZ(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left")(6,"clr-checkbox-wrapper",0),e._UZ(7,"input",1),e.TgZ(8,"label"),e._uU(9),e.ALo(10,"translate"),e.qZA()(),e.TgZ(11,"clr-checkbox-wrapper")(12,"input",2),e.NdJ("change",function(){return o.refresh()}),e.qZA(),e.TgZ(13,"label"),e._uU(14),e.ALo(15,"translate"),e.qZA()()(),e.TgZ(16,"vdr-ab-right"),e._UZ(17,"vdr-action-bar-items",3),e.TgZ(18,"ng-select",4),e.NdJ("change",function(){return o.refresh()}),e.ALo(19,"async"),e.YNc(20,J,3,2,"ng-template",5),e.qZA()()()(),e.TgZ(21,"vdr-data-table-2",6),e.NdJ("pageChange",function(i){return o.setPageNumber(i)})("itemsPerPageChange",function(i){return o.setItemsPerPage(i)}),e.ALo(22,"async"),e.ALo(23,"async"),e.ALo(24,"async"),e.ALo(25,"async"),e.TgZ(26,"vdr-dt2-column",7),e.ALo(27,"translate"),e.YNc(28,N,1,1,"ng-template"),e.qZA(),e.TgZ(29,"vdr-dt2-column",7),e.ALo(30,"translate"),e.YNc(31,q,2,3,"ng-template"),e.qZA(),e.TgZ(32,"vdr-dt2-column",8),e.ALo(33,"translate"),e.YNc(34,R,2,2,"ng-template"),e.qZA(),e.TgZ(35,"vdr-dt2-column",8),e.ALo(36,"translate"),e.YNc(37,B,1,1,"ng-template"),e.qZA(),e.TgZ(38,"vdr-dt2-column",7),e.ALo(39,"translate"),e.YNc(40,Q,3,3,"ng-template"),e.qZA(),e.TgZ(41,"vdr-dt2-column",7),e.ALo(42,"translate"),e.YNc(43,Y,2,3,"ng-template"),e.qZA(),e.TgZ(44,"vdr-dt2-column",7),e.ALo(45,"translate"),e.YNc(46,z,3,3,"ng-template"),e.qZA()()()),2&t&&(e.xp6(7),e.Q6J("formControl",o.liveUpdate),e.xp6(2),e.Oqu(e.lcZ(10,25,"common.live-update")),e.xp6(3),e.Q6J("formControl",o.hideSettled),e.xp6(2),e.Oqu(e.lcZ(15,27,"system.hide-settled-jobs")),e.xp6(4),e.Q6J("addTag",!1)("items",e.lcZ(19,29,o.queues$))("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",o.queueFilter),e.xp6(3),e.Q6J("items",e.lcZ(22,31,o.items$))("itemsPerPage",e.lcZ(23,33,o.itemsPerPage$))("totalItems",e.lcZ(24,35,o.totalItems$))("currentPage",e.lcZ(25,37,o.currentPage$)),e.xp6(5),e.Q6J("heading",e.lcZ(27,39,"common.id")),e.xp6(3),e.Q6J("heading",e.lcZ(30,41,"common.created-at")),e.xp6(3),e.Q6J("heading",e.lcZ(33,43,"system.job-queue-name"))("optional",!1),e.xp6(3),e.Q6J("heading",e.lcZ(36,45,"system.job-data"))("optional",!1),e.xp6(3),e.Q6J("heading",e.lcZ(39,47,"system.job-state")),e.xp6(3),e.Q6J("heading",e.lcZ(42,49,"system.job-duration")),e.xp6(3),e.Q6J("heading",e.lcZ(45,51,"system.job-result")))},dependencies:[d.qvL,d.MgK,d.KKC,d.PEh,c.O5,_.Wl,_.JJ,_.oH,v.w9,v.ir,v.mR,a.KkL,a.BND,a.mz,a.Ywx,a.y_K,a.JOL,a.N9E,a.UaT,a.HH4,a._8q,a.WWO,a.eJ5,a.Up6,a.qA0,a.TMj,a.HF2,a.zJY,p,c.Ov,y.X$,a.j$k,a.eGd,a.uGI],styles:[".result-detail[_ngcontent-%COMP%]{margin:0 12px}.retry-info[_ngcontent-%COMP%]{margin-left:6px;color:var(--color-grey-400)}"],changeDetection:0})}const C=[{path:"jobs",component:u,data:{breadcrumb:(0,Z.J)("breadcrumb.job-queue")}},{path:"system-status",component:m,data:{breadcrumb:(0,Z.J)("breadcrumb.system-status")}}];class h{static#e=this.\u0275fac=function(t){return new(t||h)};static#t=this.\u0275mod=e.oAB({type:h});static#n=this.\u0275inj=e.cJS({imports:[a.m81,b.Bz.forChild(C)]})}}}]);
//# sourceMappingURL=281.dcf4a36a60aae1aa.js.map