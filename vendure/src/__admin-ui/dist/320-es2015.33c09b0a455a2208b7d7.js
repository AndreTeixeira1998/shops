"use strict";(self.webpackChunkvendure_admin_ui=self.webpackChunkvendure_admin_ui||[]).push([[320],{50320:function(e,t,r){r.r(t),r.d(t,{OrderExportModule:function(){return m}});var o=r(41460),i=r(49962),a=r(3189),n=r(83974),s=r(51694),l=r(21067),d=r(56258),c=r(70942),u=r(53198);function p(e,t){if(1&e&&(s.TgZ(0,"option",8),s._uU(1),s.qZA()),2&e){const e=t.$implicit;s.Q6J("value",e),s.xp6(1),s.hij(" ",e," ")}}class h{constructor(e,t,r,o,a){this.formBuilder=e,this.dataService=t,this.changeDetector=r,this.notificationService=o,this.localStorageService=a,this.strategies=[],this.form=this.formBuilder.group({startsAt:null,endsAt:null,strategy:null}),this.serverPath=(0,i.VC)()}ngOnInit(){this.dataService.query(n.ZP`
          query availableOrderExportStrategies {
            availableOrderExportStrategies
          }
        `).single$.subscribe(e=>{var t;this.strategies=e.availableOrderExportStrategies,this.form.controls.strategy.setValue(null===(t=this.strategies)||void 0===t?void 0:t[0])})}download(){return(0,a.mG)(this,void 0,void 0,function*(){try{const e=yield fetch(`${this.serverPath}/export-orders/export/${this.form.value.strategy}?startDate=${this.form.value.startsAt}&endDate=${this.form.value.endsAt}`,{headers:this.getHeaders()});if(!e.ok){const t=yield e.json();throw Error(null==t?void 0:t.message)}const t=e.headers.get("Content-Disposition").split(";")[1].split("=")[1],r=yield e.blob();yield this.downloadBlob(r,t)}catch(e){console.error(e),this.notificationService.error(e.message)}})}getHeaders(){const e={},t=this.localStorageService.get("activeChannelToken");t&&(e["vendure-token"]=t);const r=this.localStorageService.get("authToken");return r&&(e.authorization=`Bearer ${r}`),e}downloadBlob(e,t){return(0,a.mG)(this,void 0,void 0,function*(){const r=window.URL.createObjectURL(e),o=document.createElement("a");document.body.appendChild(o),o.setAttribute("hidden","true"),o.href=r,o.download=t,o.setAttribute("target","_blank"),o.click()})}}h.\u0275fac=function(e){return new(e||h)(s.Y36(l.qu),s.Y36(i.DoR),s.Y36(s.sBO),s.Y36(i.gqp),s.Y36(i.n2A))},h.\u0275cmp=s.Xpm({type:h,selectors:[["order-export-component"]],decls:24,vars:9,consts:[["id","export-form",1,"form",3,"formGroup"],[1,"form-block"],[1,"flex"],["required","","timeGranularityInterval","60","formControlName","startsAt"],["required","","timeGranularityInterval","60","formControlName","endsAt"],["clrSelect","","name","options","formControlName","strategy","required",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"disabled","click"],[3,"value"]],template:function(e,t){1&e&&(s.TgZ(0,"h1"),s._uU(1,"Export orders"),s.qZA(),s.TgZ(2,"form",0),s.TgZ(3,"section",1),s.TgZ(4,"div",2),s.TgZ(5,"div"),s.TgZ(6,"label"),s._uU(7),s.ALo(8,"translate"),s.qZA(),s._UZ(9,"vdr-datetime-picker",3),s.qZA(),s.TgZ(10,"div"),s.TgZ(11,"label"),s._uU(12),s.ALo(13,"translate"),s.qZA(),s._UZ(14,"vdr-datetime-picker",4),s.qZA(),s.qZA(),s._UZ(15,"br"),s.TgZ(16,"clr-select-container"),s.TgZ(17,"label"),s._uU(18,"Export as"),s.qZA(),s.TgZ(19,"select",5),s.YNc(20,p,2,2,"option",6),s.qZA(),s.qZA(),s._UZ(21,"br"),s.TgZ(22,"button",7),s.NdJ("click",function(){return t.download()}),s._uU(23," Export "),s.qZA(),s.qZA(),s.qZA()),2&e&&(s.xp6(2),s.Q6J("formGroup",t.form),s.xp6(5),s.Oqu(s.lcZ(8,5,"order.placed-at-start")),s.xp6(5),s.Oqu(s.lcZ(13,7,"order.placed-at-end")),s.xp6(8),s.Q6J("ngForOf",t.strategies),s.xp6(2),s.Q6J("disabled",t.form.invalid||t.form.pristine))},directives:[l._Y,l.JL,l.sg,d.MgK,i.IPv,l.Q7,l.JJ,l.u,d.dTv,i.y_K,l.EJ,d.otW,c.sg,l.YN,l.Kr],pipes:[u.X$],encapsulation:2});class m{}m.\u0275fac=function(e){return new(e||m)},m.\u0275mod=s.oAB({type:m}),m.\u0275inj=s.cJS({providers:[],imports:[[i.m81,o.Bz.forChild([{path:"",pathMatch:"full",component:h,data:{breadcrumb:"Export orders"}}])]]})}}]);
//# sourceMappingURL=320-es2015.33c09b0a455a2208b7d7.js.map