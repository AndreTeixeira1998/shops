{"version":3,"mappings":"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","names":["r","b","n","m","h","g","y","e","a","constructor","o","t","u","f","this","form","formBuilder","group","enabled","apiKey","webshopUuid","autoFulfill","orderWebhookUrl","orderWebhookKey","stockWebhookUrl","stockWebhookKey","ngOnInit","dataService","query","mapStream","goedgepicktConfig","subscribe","controls","setValue","save","dirty","value","mutate","input","toPromise","updateGoedgepicktConfig","markAsPristine","changeDetector","markForCheck","notificationService","success","entity","error","fullSync","loadingSync","message","test","testFailed","testResultName","U","method","headers","Accept","Authorization","redirect","status","json","items","find","G","uuid","name","selectors","c","s","id","label","routerLink","icon","imports","path","pathMatch","component","data","breadcrumb"],"sources":["webpack:///node_modules/node-fetch/browser.js","webpack:///src/extensions/79dd65be1b10de15f35ec97ed089446708764ccf2a7352e7c43ec3ffc50569b9/queries.graphql.ts","webpack:///src/extensions/79dd65be1b10de15f35ec97ed089446708764ccf2a7352e7c43ec3ffc50569b9/goedgepickt.component.ts","webpack:///src/extensions/79dd65be1b10de15f35ec97ed089446708764ccf2a7352e7c43ec3ffc50569b9/goedgepickt.module.ts"],"sourcesContent":["\"use strict\";\n\n// ref: https://github.com/tc39/proposal-global\nvar getGlobal = function () {\n\t// the only reliable means to get the global object is\n\t// `Function('return this')()`\n\t// However, this causes CSP violations in Chrome apps.\n\tif (typeof self !== 'undefined') { return self; }\n\tif (typeof window !== 'undefined') { return window; }\n\tif (typeof global !== 'undefined') { return global; }\n\tthrow new Error('unable to locate global object');\n}\n\nvar global = getGlobal();\n\nmodule.exports = exports = global.fetch;\n\n// Needed for TypeScript and Webpack.\nif (global.fetch) {\n\texports.default = global.fetch.bind(global);\n}\n\nexports.Headers = global.Headers;\nexports.Request = global.Request;\nexports.Response = global.Response;","import gql from 'graphql-tag';\n\nexport const updateGoedgepicktConfig = gql`\n  mutation updateGoedgepicktConfig($input: GoedgepicktConfigInput!) {\n    updateGoedgepicktConfig(input: $input) {\n      ... on GoedgepicktConfig {\n        enabled\n        apiKey\n        webshopUuid\n        autoFulfill\n        orderWebhookKey\n        orderWebhookUrl\n        stockWebhookKey\n        stockWebhookUrl\n      }\n      ... on GoedgepicktError {\n        message\n      }\n    }\n  }\n`;\n\nexport const getGoedgepicktConfig = gql`\n  query goedgepicktConfig {\n    goedgepicktConfig {\n      enabled\n      apiKey\n      webshopUuid\n      autoFulfill\n      orderWebhookKey\n      orderWebhookUrl\n      stockWebhookKey\n      stockWebhookUrl\n    }\n  }\n`;\n\nexport const runGoedgepicktFullSync = gql`\n  mutation runGoedgepicktFullSync {\n    runGoedgepicktFullSync\n  }\n`;\n","import { ChangeDetectorRef, Component, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup } from '@angular/forms';\nimport { DataService, NotificationService } from '@vendure/admin-ui/core';\nimport {\n  getGoedgepicktConfig,\n  runGoedgepicktFullSync,\n  updateGoedgepicktConfig,\n} from './queries.graphql';\nimport fetch from 'node-fetch';\nimport { GoedgepicktConfig } from './generated/graphql';\n\n@Component({\n  selector: 'goedgepickt-component',\n  template: `\n    <div class=\"clr-row\">\n      <div class=\"clr-col\">\n        <button\n          class=\"btn btn-secondary\"\n          [disabled]=\"loadingSync\"\n          (click)=\"fullSync()\"\n        >\n          Synchronize\n        </button>\n        <vdr-help-tooltip\n          content=\"Pushes products and pulls stocklevels from Goedgepickt\"\n        ></vdr-help-tooltip>\n        <form class=\"form\" [formGroup]=\"form\">\n          <section class=\"form-block\">\n            <vdr-form-field label=\"Enabled\" for=\"enabled\">\n              <input\n                type=\"checkbox\"\n                name=\"enabled\"\n                clrCheckbox\n                formControlName=\"enabled\"\n              />\n            </vdr-form-field>\n            <vdr-form-field label=\"apikey\" for=\"apiKey\">\n              <input id=\"apiKey\" type=\"text\" formControlName=\"apiKey\" />\n            </vdr-form-field>\n            <vdr-form-field label=\"webshopUuid\" for=\"webshopUuid\">\n              <input\n                id=\"webshopUuid\"\n                type=\"text\"\n                formControlName=\"webshopUuid\"\n              />\n            </vdr-form-field>\n            <vdr-form-field\n              label=\"Autofulfill\"\n              for=\"autoFulfill\"\n              tooltip=\"Automatically send orders to Goedgepickt on PaymentSettled\"\n            >\n              <input\n                type=\"checkbox\"\n                name=\"autoFulfill\"\n                clrCheckbox\n                formControlName=\"autoFulfill\"\n              />\n            </vdr-form-field>\n            <button\n              class=\"btn btn-primary\"\n              (click)=\"save()\"\n              [disabled]=\"form.invalid || form.pristine\"\n            >\n              Save\n            </button>\n            <button class=\"btn btn-secondary\" (click)=\"test()\">Test</button>\n            <vdr-chip *ngIf=\"testFailed\" title=\"Failed\" colorType=\"error\">\n              <clr-icon shape=\"error-standard\"></clr-icon>\n              {{ testFailed }}\n            </vdr-chip>\n            <vdr-chip\n              *ngIf=\"testResultName\"\n              title=\"Success!\"\n              colorType=\"success\"\n            >\n              <clr-icon shape=\"check-circle\"></clr-icon>\n              {{ testResultName }}\n            </vdr-chip>\n          </section>\n          <section class=\"form-block\">\n            <p>\n              The following settings are set automatically and cannot be edited\n            </p>\n            <br />\n            <vdr-form-field\n              label=\"Order webhook\"\n              for=\"orderWebhookUrl\"\n              tooltip=\"Goedgepickt will call this URL for order status updates\"\n            >\n              <input\n                id=\"orderWebhookUrl\"\n                type=\"text\"\n                formControlName=\"orderWebhookUrl\"\n                disabled=\"disabled\"\n              />\n            </vdr-form-field>\n            <vdr-form-field label=\"Webhook auth secret\" for=\"orderWebhookKey\">\n              <input\n                id=\"orderWebhookKey\"\n                type=\"text\"\n                formControlName=\"orderWebhookKey\"\n                disabled=\"disabled\"\n              />\n            </vdr-form-field>\n          </section>\n          <section class=\"form-block\">\n            <vdr-form-field\n              label=\"Stock webhook\"\n              for=\"stockWebhookUrl\"\n              tooltip=\"Goedgepickt will call this URL for stocklevel updates\"\n            >\n              <input\n                id=\"stockWebhookUrl\"\n                type=\"text\"\n                formControlName=\"stockWebhookUrl\"\n                disabled=\"disabled\"\n              />\n            </vdr-form-field>\n            <vdr-form-field label=\"Webhook auth secret\" for=\"stockWebhookKey\">\n              <input\n                id=\"stockWebhookKey\"\n                type=\"text\"\n                formControlName=\"stockWebhookKey\"\n                disabled=\"disabled\"\n              />\n            </vdr-form-field>\n          </section>\n        </form>\n      </div>\n    </div>\n  `,\n})\nexport class GoedgepicktComponent implements OnInit {\n  form: FormGroup;\n  testFailed?: string;\n  testResultName?: string;\n  loadingSync = false;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    protected dataService: DataService,\n    private changeDetector: ChangeDetectorRef,\n    private notificationService: NotificationService\n  ) {\n    this.form = this.formBuilder.group({\n      enabled: ['enabled'],\n      apiKey: ['your-api-key'],\n      webshopUuid: ['webshopUuid'],\n      autoFulfill: ['autoFulfill'],\n      orderWebhookUrl: ['orderWebhookUrl'],\n      orderWebhookKey: ['orderWebhookKey'],\n      stockWebhookUrl: ['stockWebhookUrl'],\n      stockWebhookKey: ['stockWebhookKey'],\n    });\n  }\n\n  async ngOnInit(): Promise<void> {\n    await this.dataService\n      .query(getGoedgepicktConfig)\n      .mapStream((d: any) => d.goedgepicktConfig)\n      .subscribe((config: GoedgepicktConfig) => {\n        this.form.controls['enabled'].setValue(config.enabled);\n        this.form.controls['apiKey'].setValue(config.apiKey);\n        this.form.controls['webshopUuid'].setValue(config.webshopUuid);\n        this.form.controls['autoFulfill'].setValue(config.autoFulfill);\n        this.form.controls['orderWebhookUrl'].setValue(config.orderWebhookUrl);\n        this.form.controls['orderWebhookKey'].setValue(config.orderWebhookKey);\n        this.form.controls['stockWebhookUrl'].setValue(config.stockWebhookUrl);\n        this.form.controls['stockWebhookKey'].setValue(config.stockWebhookKey);\n      });\n  }\n\n  async save(): Promise<void> {\n    try {\n      if (this.form.dirty) {\n        const formValue = this.form.value;\n        const { updateGoedgepicktConfig: result } = (await this.dataService\n          .mutate(updateGoedgepicktConfig, {\n            input: {\n              enabled: formValue.enabled,\n              apiKey: formValue.apiKey,\n              webshopUuid: formValue.webshopUuid,\n              autoFulfill: formValue.autoFulfill,\n            },\n          })\n          .toPromise()) as any;\n        this.form.controls['enabled'].setValue(result.enabled);\n        this.form.controls['apiKey'].setValue(result.apiKey);\n        this.form.controls['webshopUuid'].setValue(result.webshopUuid);\n        this.form.controls['autoFulfill'].setValue(result.autoFulfill);\n        this.form.controls['orderWebhookUrl'].setValue(result.orderWebhookUrl);\n        this.form.controls['orderWebhookKey'].setValue(result.orderWebhookKey);\n        this.form.controls['stockWebhookUrl'].setValue(result.stockWebhookUrl);\n        this.form.controls['stockWebhookKey'].setValue(result.stockWebhookKey);\n      }\n      this.form.markAsPristine();\n      this.changeDetector.markForCheck();\n      this.notificationService.success('common.notify-update-success', {\n        entity: 'GoedgepicktConfig',\n      });\n    } catch (e) {\n      this.notificationService.error('common.notify-update-error', {\n        entity: 'GoedgepicktConfig',\n      });\n    }\n  }\n\n  async fullSync(): Promise<void> {\n    try {\n      this.loadingSync = true;\n      await this.dataService.mutate(runGoedgepicktFullSync).toPromise();\n      this.notificationService.success('common.notify-update-success', {\n        entity: 'products and stocklevels',\n      });\n    } catch (e) {\n      this.notificationService.error(e.message);\n    } finally {\n      this.loadingSync = false;\n    }\n  }\n\n  async test(): Promise<void> {\n    this.testFailed = undefined;\n    this.testResultName = undefined;\n    const result = await fetch(\n      'https://account.goedgepickt.nl/api/v1/webshops',\n      {\n        method: 'GET',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${this.form.controls['apiKey'].value}`,\n        },\n        redirect: 'follow',\n      }\n    );\n    if (result.status !== 200) {\n      this.testFailed = 'Invalid ApiKey';\n      return;\n    }\n    const json = await result.json();\n    const webshop = json.items?.find(\n      (item: { uuid: string }) =>\n        item.uuid === this.form.controls['webshopUuid'].value\n    );\n    if (!webshop) {\n      this.testFailed = 'Apikey is correct, but cannot find webshopUuid';\n    } else {\n      this.testResultName = webshop.name;\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { RouterModule } from '@angular/router';\nimport { addNavMenuItem, SharedModule } from '@vendure/admin-ui/core';\nimport { GoedgepicktComponent } from './goedgepickt.component';\n\n@NgModule({\n  imports: [\n    SharedModule,\n    RouterModule.forChild([\n      {\n        path: '',\n        pathMatch: 'full',\n        component: GoedgepicktComponent,\n        data: { breadcrumb: 'Goedgepickt' },\n      },\n    ]),\n  ],\n  providers: [\n    addNavMenuItem(\n      {\n        id: 'goedgepickt',\n        label: 'Goedgepickt',\n        routerLink: ['/extensions/goedgepickt'],\n        icon: 'cursor-hand-open',\n      },\n      'settings'\n    ),\n  ],\n  declarations: [GoedgepicktComponent],\n})\nexport class GoedgepicktModule {}\n"]}