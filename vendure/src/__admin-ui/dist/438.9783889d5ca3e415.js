"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[438],{1438:(st,A,m)=>{m.r(A),m.d(A,{GET_PROMOTION_DETAIL:()=>rt,GET_PROMOTION_LIST:()=>it,MarketingModule:()=>f,PromotionDetailComponent:()=>_,PromotionListComponent:()=>g,assignPromotionsToChannelBulkAction:()=>y,createRoutes:()=>Z,deletePromotionsBulkAction:()=>D,promotionBreadcrumb:()=>at,removePromotionsFromChannelBulkAction:()=>T});var t=m(6108),c=m(5086),d=m(186),i=m(5592),v=m(859),O=m(9034),E=m(1452),F=m(6526),P=m(3044),u=m(2977),p=m(8046),L=m(4611),C=m(4285);function I(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(n);const a=t.oxw();return t.KtG(a.create())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&e){const n=t.oxw();t.Q6J("disabled",!n.saveButtonEnabled()),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.create")," ")}}function U(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(n);const a=t.oxw(2);return t.KtG(a.save())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&e){const n=t.oxw(2);t.Q6J("disabled",!n.saveButtonEnabled()),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.update")," ")}}function x(e,o){1&e&&t.YNc(0,U,3,4,"button",26),2&e&&t.Q6J("vdrIfPermissions","UpdatePromotion")}function k(e,o){1&e&&(t.TgZ(0,"vdr-card")(1,"clr-toggle-wrapper"),t._UZ(2,"input",27),t.TgZ(3,"label"),t._uU(4),t.ALo(5,"translate"),t.qZA()()()),2&e&&(t.xp6(4),t.Oqu(t.lcZ(5,1,"common.enabled")))}function M(e,o){if(1&e&&(t.TgZ(0,"vdr-card"),t._UZ(1,"vdr-page-entity-info",28),t.qZA()),2&e){const n=o.ngIf;t.xp6(1),t.Q6J("entity",n)}}function N(e,o){if(1&e&&(t.TgZ(0,"vdr-card",29),t.ALo(1,"translate"),t._UZ(2,"vdr-tabbed-custom-fields",30),t.ALo(3,"hasPermission"),t.qZA()),2&e){const n=t.oxw();t.Q6J("title",t.lcZ(1,4,"common.custom-fields")),t.xp6(2),t.Q6J("customFields",n.customFields)("customFieldsFormGroup",n.detailForm.get("customFields"))("readonly",!t.lcZ(3,6,"UpdatePromotion"))}}function J(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"div")(1,"vdr-configurable-input",31),t.NdJ("remove",function(a){t.CHM(n);const s=t.oxw();return t.KtG(s.removeCondition(a))}),t.ALo(2,"hasPermission"),t.qZA()()}if(2&e){const n=o.$implicit,r=o.index,a=t.oxw();t.xp6(1),t.Q6J("position",r)("readonly",!t.lcZ(2,5,"UpdatePromotion"))("operation",n)("operationDefinition",a.getConditionDefinition(n))("formControlName",r)}}function B(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"button",36),t.NdJ("click",function(){const s=t.CHM(n).$implicit,l=t.oxw(2);return t.KtG(l.addCondition(s))}),t._uU(1),t.qZA()}if(2&e){const n=o.$implicit;t.xp6(1),t.hij(" ",n.description," ")}}function w(e,o){if(1&e&&(t.TgZ(0,"vdr-dropdown")(1,"button",32),t._UZ(2,"clr-icon",33),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"vdr-dropdown-menu",34),t.YNc(6,B,2,1,"button",35),t.qZA()()),2&e){const n=t.oxw();t.xp6(3),t.hij(" ",t.lcZ(4,2,"marketing.add-condition")," "),t.xp6(3),t.Q6J("ngForOf",n.getAvailableConditions())}}function $(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"div")(1,"vdr-configurable-input",37),t.NdJ("remove",function(a){t.CHM(n);const s=t.oxw();return t.KtG(s.removeAction(a))}),t.ALo(2,"hasPermission"),t.qZA()()}if(2&e){const n=o.$implicit,r=o.index,a=t.oxw();t.xp6(1),t.Q6J("position",r)("operation",n)("readonly",!t.lcZ(2,5,"UpdatePromotion"))("operationDefinition",a.getActionDefinition(n))("formControlName",r)}}function R(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"button",36),t.NdJ("click",function(){const s=t.CHM(n).$implicit,l=t.oxw(2);return t.KtG(l.addAction(s))}),t._uU(1),t.qZA()}if(2&e){const n=o.$implicit;t.xp6(1),t.hij(" ",n.description," ")}}function Q(e,o){if(1&e&&(t.TgZ(0,"vdr-dropdown")(1,"button",32),t._UZ(2,"clr-icon",33),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"vdr-dropdown-menu",34),t.YNc(6,R,2,1,"button",35),t.qZA()()),2&e){const n=t.oxw();t.xp6(3),t.hij(" ",t.lcZ(4,2,"marketing.add-action")," "),t.xp6(3),t.Q6J("ngForOf",n.getAvailableActions())}}const q=function(){return["./create"]};function K(e,o){1&e&&(t.TgZ(0,"a",13),t._UZ(1,"clr-icon",14),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&e&&(t.Q6J("routerLink",t.DdM(4,q)),t.xp6(2),t.hij(" ",t.lcZ(3,2,"marketing.create-new-promotion")," "))}function W(e,o){if(1&e&&t._uU(0),2&e){const n=o.item;t.Oqu(n.id)}}function Y(e,o){if(1&e&&(t._uU(0),t.ALo(1,"localeDate")),2&e){const n=o.item;t.hij(" ",t.xi3(1,1,n.createdAt,"short")," ")}}function j(e,o){if(1&e&&(t._uU(0),t.ALo(1,"localeDate")),2&e){const n=o.item;t.hij(" ",t.xi3(1,1,n.updatedAt,"short")," ")}}const G=function(e){return["./",e]};function S(e,o){if(1&e&&(t.TgZ(0,"a",15)(1,"span"),t._uU(2),t.qZA(),t._UZ(3,"clr-icon",16),t.qZA()),2&e){const n=o.item;t.Q6J("routerLink",t.VKq(2,G,n.id)),t.xp6(2),t.hij(" ",n.name,"")}}function H(e,o){1&e&&(t.TgZ(0,"vdr-chip",19),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.enabled")))}function V(e,o){1&e&&(t.TgZ(0,"vdr-chip",20),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.disabled")))}function z(e,o){if(1&e&&(t.YNc(0,H,3,3,"vdr-chip",17),t.YNc(1,V,3,3,"vdr-chip",18)),2&e){const n=o.item;t.Q6J("ngIf",n.enabled),t.xp6(1),t.Q6J("ngIf",!n.enabled)}}function X(e,o){if(1&e&&t._uU(0),2&e){const n=o.item;t.hij(" ",n.couponCode," ")}}function tt(e,o){if(1&e&&(t._uU(0),t.ALo(1,"localeDate")),2&e){const n=o.item;t.hij(" ",t.xi3(1,1,n.startsAt,"short")," ")}}function ot(e,o){if(1&e&&(t._uU(0),t.ALo(1,"localeDate")),2&e){const n=o.item;t.hij(" ",t.xi3(1,1,n.endsAt,"short")," ")}}function nt(e,o){if(1&e&&t._uU(0),2&e){const n=o.item;t.hij(" ",n.perCustomerUsageLimit," ")}}function et(e,o){if(1&e&&t._UZ(0,"vdr-dt2-custom-field-column",21),2&e){const n=o.$implicit,r=t.oxw();t.Q6J("customField",n)("sorts",r.sorts)}}const rt=v.Ps`
    query GetPromotionDetail($id: ID!) {
        promotion(id: $id) {
            ...Promotion
        }
    }
    ${i.CXu}
`;class _ extends i.VE7{constructor(o,n,r,a){super(),this.changeDetector=o,this.dataService=n,this.formBuilder=r,this.notificationService=a,this.customFields=this.getCustomFieldConfig("Promotion"),this.detailForm=this.formBuilder.group({name:["",c.kI.required],description:"",enabled:!0,couponCode:null,perCustomerUsageLimit:null,startsAt:null,endsAt:null,conditions:this.formBuilder.array([]),actions:this.formBuilder.array([]),customFields:this.formBuilder.group((0,i.Lrj)(this.customFields))}),this.conditions=[],this.actions=[],this.allConditions=[],this.allActions=[],this.customFields=this.getCustomFieldConfig("Promotion")}ngOnInit(){this.init(),this.dataService.promotion.getPromotionActionsAndConditions().single$.subscribe(o=>{this.allActions=o.promotionActions,this.allConditions=o.promotionConditions,this.changeDetector.markForCheck()})}ngOnDestroy(){this.destroy()}getAvailableConditions(){return this.allConditions.filter(o=>!this.conditions.find(n=>n.code===o.code))}getConditionDefinition(o){return this.allConditions.find(n=>n.code===o.code)}getAvailableActions(){return this.allActions.filter(o=>!this.actions.find(n=>n.code===o.code))}getActionDefinition(o){return this.allActions.find(n=>n.code===o.code)}saveButtonEnabled(){return!(!this.detailForm.dirty||!this.detailForm.valid||0===this.conditions.length&&!this.detailForm.value.couponCode||0===this.actions.length)}addCondition(o){this.addOperation("conditions",o),this.detailForm.markAsDirty()}addAction(o){this.addOperation("actions",o),this.detailForm.markAsDirty()}removeCondition(o){this.removeOperation("conditions",o),this.detailForm.markAsDirty()}removeAction(o){this.removeOperation("actions",o),this.detailForm.markAsDirty()}formArrayOf(o){return this.detailForm.get(o)}create(){if(!this.detailForm.dirty)return;const o=this.getUpdatedPromotion({id:"",createdAt:"",updatedAt:"",startsAt:"",endsAt:"",name:"",description:"",couponCode:null,perCustomerUsageLimit:null,enabled:!1,conditions:[],actions:[],translations:[]},this.detailForm,this.languageCode);this.dataService.promotion.createPromotion(o).subscribe(({createPromotion:n})=>{switch(n.__typename){case"Promotion":this.notificationService.success((0,d.J)("common.notify-create-success"),{entity:"Promotion"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",n.id],{relativeTo:this.route});break;case"MissingConditionsError":this.notificationService.error(n.message)}},n=>{this.notificationService.error((0,d.J)("common.notify-create-error"),{entity:"Promotion"})})}save(){this.detailForm.dirty&&(0,O.a)(this.entity$,this.languageCode$).pipe((0,E.q)(1),(0,F.z)(([o,n])=>{const r=this.getUpdatedPromotion(o,this.detailForm,n);return this.dataService.promotion.updatePromotion(r)})).subscribe(o=>{this.notificationService.success((0,d.J)("common.notify-update-success"),{entity:"Promotion"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck()},o=>{this.notificationService.error((0,d.J)("common.notify-update-error"),{entity:"Promotion"})})}getUpdatedPromotion(o,n,r){const a=n.value;return{...(0,i.iSy)({translatable:o,updatedFields:a,customFieldConfig:this.customFields,languageCode:r,defaultTranslation:{languageCode:r,name:o.name||"",description:o.description||""}}),conditions:this.mapOperationsToInputs(this.conditions,a.conditions),actions:this.mapOperationsToInputs(this.actions,a.actions)}}setFormValues(o,n){const r=(0,i.ZIM)(o,n);this.detailForm.patchValue({name:r?.name,description:r?.description,enabled:o.enabled,couponCode:o.couponCode,perCustomerUsageLimit:o.perCustomerUsageLimit,startsAt:o.startsAt,endsAt:o.endsAt}),o.conditions.forEach(a=>{this.addOperation("conditions",a)}),o.actions.forEach(a=>this.addOperation("actions",a)),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get("customFields"),o)}mapOperationsToInputs(o,n){return o.map((r,a)=>({code:r.code,arguments:Object.values(n[a].args).map((s,l)=>({name:r.args[l].name,value:(0,i.qrw)(s)}))}))}addOperation(o,n){const r=this.formArrayOf(o),a="conditions"===o?this.conditions:this.actions;if(-1===r.value.findIndex(l=>l.code===n.code)){const l=n.args.reduce((h,b)=>({...h,[b.name]:(0,i.sux)(b.value)??this.getDefaultArgValue(o,n,b.name)}),{});r.push(this.formBuilder.control({code:n.code,args:l})),a.push({code:n.code,args:n.args.map(h=>({name:h.name,value:(0,i.sux)(h.value)}))})}}getDefaultArgValue(o,n,r){const a="conditions"===o?this.allConditions.find(s=>s.code===n.code):this.allActions.find(s=>s.code===n.code);if(a){const s=a.args.find(l=>l.name===r);if(s)return(0,i.NWQ)(s)}throw new Error('Could not determine default value for "argName"')}removeOperation(o,n){const r=this.formArrayOf(o),a="conditions"===o?this.conditions:this.actions,s=r.value.findIndex(l=>l.code===n.code);-1!==s&&(r.removeAt(s),a.splice(s,1))}static#t=this.\u0275fac=function(n){return new(n||_)(t.Y36(t.sBO),t.Y36(i.DoR),t.Y36(c.qu),t.Y36(i.gqp))};static#o=this.\u0275cmp=t.Xpm({type:_,selectors:[["vdr-promotion-detail"]],features:[t.qOj],decls:56,vars:61,consts:[[1,"flex","clr-align-items-center"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","promotion-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],[4,"vdrIfPermissions"],[4,"ngIf"],[1,"form-grid"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["formControlName","description",1,"form-grid-span",3,"readonly","label"],["for","startsAt",3,"label"],["formControlName","startsAt"],["for","endsAt",3,"label"],["formControlName","endsAt"],["for","couponCode",3,"label"],["id","couponCode","type","text","formControlName","couponCode",3,"readonly"],["for","perCustomerUsageLimit",3,"label"],["id","perCustomerUsageLimit","type","number","min","1","max","999","formControlName","perCustomerUsageLimit",3,"readonly"],["formGroupName","customFields",3,"title",4,"ngIf"],["locationId","promotion-detail",3,"entity$","detailForm"],["formArrayName","conditions",3,"title"],[4,"ngFor","ngForOf"],["formArrayName","actions",3,"title"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled"],[3,"entity"],["formGroupName","customFields",3,"title"],["entityName","Promotion",3,"customFields","customFieldsFormGroup","readonly"],[3,"position","readonly","operation","operationDefinition","formControlName","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","","class","item-wrap",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",1,"item-wrap",3,"click"],[3,"position","operation","readonly","operationDefinition","formControlName","remove"]],template:function(n,r){if(1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left")(3,"div",0)(4,"vdr-language-selector",1),t.NdJ("languageCodeChange",function(s){return r.setLanguage(s)}),t.ALo(5,"async"),t.ALo(6,"async"),t.ALo(7,"async"),t.qZA()()(),t.TgZ(8,"vdr-ab-right"),t._UZ(9,"vdr-action-bar-items",2),t.YNc(10,I,3,4,"button",3),t.ALo(11,"async"),t.YNc(12,x,1,1,"ng-template",null,4,t.W1O),t.qZA()()(),t.TgZ(14,"form",5)(15,"vdr-page-detail-layout")(16,"vdr-page-detail-sidebar"),t.YNc(17,k,6,3,"vdr-card",6),t.YNc(18,M,2,1,"vdr-card",7),t.ALo(19,"async"),t.qZA(),t.TgZ(20,"vdr-page-block")(21,"vdr-card")(22,"div",8)(23,"vdr-form-field",9),t.ALo(24,"translate"),t._UZ(25,"input",10),t.ALo(26,"hasPermission"),t.qZA(),t._UZ(27,"vdr-rich-text-editor",11),t.ALo(28,"hasPermission"),t.ALo(29,"translate"),t.TgZ(30,"vdr-form-field",12),t.ALo(31,"translate"),t._UZ(32,"vdr-datetime-picker",13),t.qZA(),t.TgZ(33,"vdr-form-field",14),t.ALo(34,"translate"),t._UZ(35,"vdr-datetime-picker",15),t.qZA(),t.TgZ(36,"vdr-form-field",16),t.ALo(37,"translate"),t._UZ(38,"input",17),t.ALo(39,"hasPermission"),t.qZA(),t.TgZ(40,"vdr-form-field",18),t.ALo(41,"translate"),t._UZ(42,"input",19),t.ALo(43,"hasPermission"),t.qZA()()(),t.YNc(44,N,4,8,"vdr-card",20),t._UZ(45,"vdr-custom-detail-component-host",21),t.TgZ(46,"vdr-card",22),t.ALo(47,"translate"),t.YNc(48,J,3,7,"div",23),t.TgZ(49,"div"),t.YNc(50,w,7,4,"vdr-dropdown",6),t.qZA()(),t.TgZ(51,"vdr-card",24),t.ALo(52,"translate"),t.YNc(53,$,3,7,"div",23),t.TgZ(54,"div"),t.YNc(55,Q,7,4,"vdr-dropdown",6),t.qZA()()()()()),2&n){const a=t.MAs(13);t.xp6(4),t.Q6J("disabled",t.lcZ(5,27,r.isNew$))("availableLanguageCodes",t.lcZ(6,29,r.availableLanguages$))("currentLanguageCode",t.lcZ(7,31,r.languageCode$)),t.xp6(6),t.Q6J("ngIf",t.lcZ(11,33,r.isNew$))("ngIfElse",a),t.xp6(4),t.Q6J("formGroup",r.detailForm),t.xp6(3),t.Q6J("vdrIfPermissions","UpdatePromotion"),t.xp6(1),t.Q6J("ngIf",t.lcZ(19,35,r.entity$)),t.xp6(5),t.Q6J("label",t.lcZ(24,37,"common.name")),t.xp6(2),t.Q6J("readonly",!t.lcZ(26,39,"UpdatePromotion")),t.xp6(2),t.Q6J("readonly",!t.lcZ(28,41,"UpdatePromotion"))("label",t.lcZ(29,43,"common.description")),t.xp6(3),t.Q6J("label",t.lcZ(31,45,"marketing.starts-at")),t.xp6(3),t.Q6J("label",t.lcZ(34,47,"marketing.ends-at")),t.xp6(3),t.Q6J("label",t.lcZ(37,49,"marketing.coupon-code")),t.xp6(2),t.Q6J("readonly",!t.lcZ(39,51,"UpdatePromotion")),t.xp6(2),t.Q6J("label",t.lcZ(41,53,"marketing.per-customer-limit")),t.xp6(2),t.Q6J("readonly",!t.lcZ(43,55,"UpdatePromotion")),t.xp6(2),t.Q6J("ngIf",r.customFields.length),t.xp6(1),t.Q6J("entity$",r.entity$)("detailForm",r.detailForm),t.xp6(1),t.Q6J("title",t.lcZ(47,57,"marketing.conditions")),t.xp6(2),t.Q6J("ngForOf",r.conditions),t.xp6(2),t.Q6J("vdrIfPermissions","UpdatePromotion"),t.xp6(1),t.Q6J("title",t.lcZ(52,59,"marketing.actions")),t.xp6(2),t.Q6J("ngForOf",r.actions),t.xp6(2),t.Q6J("vdrIfPermissions","UpdatePromotion")}},dependencies:[u.qvL,u.MgK,u.KKC,u.PEh,p.sg,p.O5,c._Y,c.Fj,c.wV,c.Wl,c.JJ,c.JL,c.qQ,c.Fd,c.sg,c.u,c.x0,c.CE,i.KkL,i.BND,i.mz,i.qq8,i.hgI,i.y_K,i.SdP,i.YI,i.JOL,i.N9E,i.UaT,i.HH4,i.HAh,i.WWO,i.IPv,i.yc0,i.CWh,i.zJY,i.DME,i.TeL,i.W1W,i.AkF,p.Ov,L.X$,i.j$k],styles:[".item-wrap[_ngcontent-%COMP%]{white-space:normal}"],changeDetection:0})}v.Ps`
    mutation AssignPromotionsToChannel($input: AssignPromotionsToChannelInput!) {
        assignPromotionsToChannel(input: $input) {
            id
            name
        }
    }
`,v.Ps`
    mutation RemovePromotionsFromChannel($input: RemovePromotionsFromChannelInput!) {
        removePromotionsFromChannel(input: $input) {
            id
            name
        }
    }
`;const D=(0,i.wwB)({location:"promotion-list",requiresPermission:i.y3$.DeletePromotion,getItemName:e=>e.name,bulkDelete:(e,o)=>e.promotion.deletePromotions(o).pipe((0,P.U)(n=>n.deletePromotions))}),y=(0,i.z1G)({location:"promotion-list",requiresPermission:i.y3$.UpdatePromotion,getItemName:e=>e.name,bulkAssignToChannel:(e,o,n)=>e.mutate(i.bPU,{input:{channelId:n,promotionIds:o}}).pipe((0,P.U)(r=>r.assignPromotionsToChannel))}),T=(0,i.RBx)({location:"promotion-list",requiresPermission:i.y3$.DeleteCatalog,getItemName:e=>e.name,bulkRemoveFromChannel:(e,o,n)=>e.mutate(i.o1U,{input:{channelId:n,promotionIds:o}}).pipe((0,P.U)(r=>r.removePromotionsFromChannel))}),it=v.Ps`
    query GetPromotionList($options: PromotionListOptions) {
        promotions(options: $options) {
            items {
                ...Promotion
            }
            totalItems
        }
    }
    ${i.CXu}
`;class g extends i.$ms{constructor(){super(),this.customFields=this.getCustomFieldConfig("Promotion"),this.filters=this.createFilterCollection().addIdFilter().addDateFilters().addFilters([{name:"startsAt",type:{kind:"dateRange"},label:(0,d.J)("marketing.starts-at"),filterField:"startsAt"},{name:"endsAt",type:{kind:"dateRange"},label:(0,d.J)("marketing.ends-at"),filterField:"endsAt"},{name:"enabled",type:{kind:"boolean"},label:(0,d.J)("common.enabled"),filterField:"enabled"},{name:"name",type:{kind:"text"},label:(0,d.J)("common.name"),filterField:"name"},{name:"couponCode",type:{kind:"text"},label:(0,d.J)("marketing.coupon-code"),filterField:"couponCode"},{name:"desc",type:{kind:"text"},label:(0,d.J)("common.description"),filterField:"description"},{name:"usageLimit",type:{kind:"number"},label:(0,d.J)("marketing.per-customer-limit"),filterField:"perCustomerUsageLimit"}]).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("createdAt","DESC").addSorts([{name:"createdAt"},{name:"updatedAt"},{name:"startsAt"},{name:"endsAt"},{name:"name"},{name:"couponCode"},{name:"perCustomerUsageLimit"}]).addCustomFieldSorts(this.customFields).connectToRoute(this.route),super.configure({document:i.dnZ,getItems:o=>o.promotions,setVariables:(o,n)=>this.createQueryOptions(o,n,this.searchTermControl.value),refreshListOnChanges:[this.filters.valueChanges,this.sorts.valueChanges]})}createQueryOptions(o,n,r){const a=this.filters.createFilterInput(),s=this.sorts.createSortInput();let l=i.FnJ.AND;return r&&(a.couponCode={contains:r},a.name={contains:r},l=i.FnJ.OR),{options:{skip:o,take:n,filter:a,filterOperator:l,sort:s}}}static#t=this.\u0275fac=function(n){return new(n||g)};static#o=this.\u0275cmp=t.Xpm({type:g,selectors:[["vdr-promotion-list"]],features:[t.qOj],decls:45,vars:66,consts:[[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","customer-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],["id","promotion-list",3,"items","itemsPerPage","totalItems","currentPage","filters","pageChange","itemsPerPageChange"],["locationId","promotion-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],[3,"heading","hiddenByDefault"],[3,"heading","hiddenByDefault","sort"],[3,"heading","optional","sort"],[3,"heading"],[3,"heading","sort"],[3,"heading","sort","hiddenByDefault"],[3,"customField","sorts",4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],["colorType","success",4,"ngIf"],["colorType","warning",4,"ngIf"],["colorType","success"],["colorType","warning"],[3,"customField","sorts"]],template:function(n,r){1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left")(3,"vdr-language-selector",0),t.NdJ("languageCodeChange",function(s){return r.setLanguage(s)}),t.ALo(4,"async"),t.ALo(5,"async"),t.qZA()(),t.TgZ(6,"vdr-ab-right"),t._UZ(7,"vdr-action-bar-items",1),t.YNc(8,K,4,5,"a",2),t.qZA()()(),t.TgZ(9,"vdr-data-table-2",3),t.NdJ("pageChange",function(s){return r.setPageNumber(s)})("itemsPerPageChange",function(s){return r.setItemsPerPage(s)}),t.ALo(10,"async"),t.ALo(11,"async"),t.ALo(12,"async"),t.ALo(13,"async"),t._UZ(14,"vdr-bulk-action-menu",4)(15,"vdr-dt2-search",5),t.ALo(16,"translate"),t.TgZ(17,"vdr-dt2-column",6),t.ALo(18,"translate"),t.YNc(19,W,1,1,"ng-template"),t.qZA(),t.TgZ(20,"vdr-dt2-column",7),t.ALo(21,"translate"),t.YNc(22,Y,2,4,"ng-template"),t.qZA(),t.TgZ(23,"vdr-dt2-column",7),t.ALo(24,"translate"),t.YNc(25,j,2,4,"ng-template"),t.qZA(),t.TgZ(26,"vdr-dt2-column",8),t.ALo(27,"translate"),t.YNc(28,S,4,4,"ng-template"),t.qZA(),t.TgZ(29,"vdr-dt2-column",9),t.ALo(30,"translate"),t.YNc(31,z,2,2,"ng-template"),t.qZA(),t.TgZ(32,"vdr-dt2-column",10),t.ALo(33,"translate"),t.YNc(34,X,1,1,"ng-template"),t.qZA(),t.TgZ(35,"vdr-dt2-column",10),t.ALo(36,"translate"),t.YNc(37,tt,2,4,"ng-template"),t.qZA(),t.TgZ(38,"vdr-dt2-column",10),t.ALo(39,"translate"),t.YNc(40,ot,2,4,"ng-template"),t.qZA(),t.TgZ(41,"vdr-dt2-column",11),t.ALo(42,"translate"),t.YNc(43,nt,1,1,"ng-template"),t.qZA(),t.YNc(44,et,1,2,"vdr-dt2-custom-field-column",12),t.qZA()),2&n&&(t.xp6(3),t.Q6J("availableLanguageCodes",t.lcZ(4,34,r.availableLanguages$))("currentLanguageCode",t.lcZ(5,36,r.contentLanguage$)),t.xp6(5),t.Q6J("vdrIfPermissions","CreatePromotion"),t.xp6(1),t.Q6J("items",t.lcZ(10,38,r.items$))("itemsPerPage",t.lcZ(11,40,r.itemsPerPage$))("totalItems",t.lcZ(12,42,r.totalItems$))("currentPage",t.lcZ(13,44,r.currentPage$))("filters",r.filters),t.xp6(5),t.Q6J("hostComponent",r)("selectionManager",r.selectionManager),t.xp6(1),t.Q6J("searchTermControl",r.searchTermControl)("searchTermPlaceholder",t.lcZ(16,46,"marketing.search-by-name-or-coupon-code")),t.xp6(2),t.Q6J("heading",t.lcZ(18,48,"common.id"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(21,50,"common.created-at"))("hiddenByDefault",!0)("sort",r.sorts.get("createdAt")),t.xp6(3),t.Q6J("heading",t.lcZ(24,52,"common.updated-at"))("hiddenByDefault",!0)("sort",r.sorts.get("updatedAt")),t.xp6(3),t.Q6J("heading",t.lcZ(27,54,"common.name"))("optional",!1)("sort",r.sorts.get("name")),t.xp6(3),t.Q6J("heading",t.lcZ(30,56,"common.enabled")),t.xp6(3),t.Q6J("heading",t.lcZ(33,58,"marketing.coupon-code"))("sort",r.sorts.get("couponCode")),t.xp6(3),t.Q6J("heading",t.lcZ(36,60,"marketing.starts-at"))("sort",r.sorts.get("startsAt")),t.xp6(3),t.Q6J("heading",t.lcZ(39,62,"marketing.ends-at"))("sort",r.sorts.get("endsAt")),t.xp6(3),t.Q6J("heading",t.lcZ(42,64,"marketing.per-customer-limit"))("sort",r.sorts.get("perCustomerUsageLimit"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("ngForOf",r.customFields))},dependencies:[u.qvL,p.sg,p.O5,C.rH,i.KkL,i.BND,i.mz,i.Ywx,i.SdP,i.HAh,i.WWO,i.cuf,i.eJ5,i.Up6,i.JBy,i.jrk,i.zJY,p.Ov,L.X$,i.HbD],styles:[".search-form[_ngcontent-%COMP%]{padding:0}.search-input[_ngcontent-%COMP%]{margin:6px 8px 0 0;min-width:200px}"],changeDetection:0})}const Z=e=>[{path:"promotions",component:i.IIO,data:{locationId:"promotion-list",breadcrumb:(0,d.J)("breadcrumb.promotions")},children:e.getPageTabRoutes("promotion-list")},{path:"promotions/:id",component:i.IIO,data:{locationId:"promotion-detail",breadcrumb:{label:(0,d.J)("breadcrumb.promotions"),link:["../","promotions"]}},children:e.getPageTabRoutes("promotion-detail")}];function at(e,o){return(0,i.YWC)({entity:e.entity,id:o.id,breadcrumbKey:"breadcrumb.promotions",getName:n=>n.name,route:"promotions"})}class f{constructor(o,n){this.bulkActionRegistryService=o,o.registerBulkAction(y),o.registerBulkAction(T),o.registerBulkAction(D),n.registerPageTab({priority:0,location:"promotion-list",tab:(0,d.J)("breadcrumb.promotions"),route:"",component:g}),n.registerPageTab({priority:0,location:"promotion-detail",tab:(0,d.J)("marketing.promotion"),route:"",component:(0,i.IX9)({component:_,query:i.cRD,entityKey:"promotion",getBreadcrumbs:r=>[{label:r?r.name:(0,d.J)("marketing.create-new-promotion"),link:[r?.id]}]})})}static#t=this.\u0275fac=function(n){return new(n||f)(t.LFG(i._4w),t.LFG(i.PhL))};static#o=this.\u0275mod=t.oAB({type:f});static#n=this.\u0275inj=t.cJS({providers:[{provide:C.Z6,useFactory:o=>Z(o),multi:!0,deps:[i.PhL]}],imports:[i.m81,C.Bz.forChild([]),i.m81,i.m81]})}}}]);
//# sourceMappingURL=438.9783889d5ca3e415.js.map