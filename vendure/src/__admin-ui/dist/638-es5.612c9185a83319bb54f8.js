!function(){"use strict";function t(){return(t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,o,n){var r=e(t,o);if(r){var i=Object.getOwnPropertyDescriptor(r,o);return i.get?i.get.call(arguments.length<3?t:n):i.value}}).apply(this,arguments)}function e(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=d(t)););return t}function o(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}function c(t,e){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var o,n=d(t);if(e){var r=d(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return u(this,o)}}function u(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return l(t)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(self.webpackChunkvendure_admin_ui=self.webpackChunkvendure_admin_ui||[]).push([[638],{17638:function(e,r,c){c.r(r),c.d(r,{MarketingModule:function(){return V},PromotionDetailComponent:function(){return B},PromotionListComponent:function(){return R},PromotionResolver:function(){return M},marketingRoutes:function(){return z},promotionBreadcrumb:function(){return K},"\u02750":function(){return H},"\u02751":function(){return G}});var u=c(51694),m=c(21067),p=c(41460),f=c(24791),g=c(329),v=c(94769),h=c(15405),Z=c(72041),y=c(8603),b=c(86184),A=c(82957),C=c(65519),x=c(70942),P=c(56258),q=c(53198),F=function(){return["enabled"]};function k(t,e){if(1&t&&(u.TgZ(0,"clr-toggle-wrapper"),u._UZ(1,"input",25),u.TgZ(2,"label"),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.qZA()),2&t){var o=u.oxw();u.xp6(1),u.Q6J("formControl",o.detailForm.get(u.DdM(4,F))),u.xp6(2),u.Oqu(u.lcZ(4,2,"common.enabled"))}}function O(t,e){if(1&t){var o=u.EpF();u.TgZ(0,"button",26),u.NdJ("click",function(){return u.CHM(o),u.oxw().create()}),u._uU(1),u.ALo(2,"translate"),u.qZA()}if(2&t){var n=u.oxw();u.Q6J("disabled",!n.saveButtonEnabled()),u.xp6(1),u.hij(" ",u.lcZ(2,2,"common.create")," ")}}function T(t,e){if(1&t){var o=u.EpF();u.TgZ(0,"button",26),u.NdJ("click",function(){return u.CHM(o),u.oxw(2).save()}),u._uU(1),u.ALo(2,"translate"),u.qZA()}if(2&t){var n=u.oxw(2);u.Q6J("disabled",!n.saveButtonEnabled()),u.xp6(1),u.hij(" ",u.lcZ(2,2,"common.update")," ")}}function w(t,e){1&t&&u.YNc(0,T,3,4,"button",27),2&t&&u.Q6J("vdrIfPermissions","UpdatePromotion")}function _(t,e){if(1&t&&(u.TgZ(0,"section",28),u.TgZ(1,"label"),u._uU(2),u.ALo(3,"translate"),u.qZA(),u._UZ(4,"vdr-tabbed-custom-fields",29),u.ALo(5,"hasPermission"),u.qZA()),2&t){var o=u.oxw();u.xp6(2),u.Oqu(u.lcZ(3,4,"common.custom-fields")),u.xp6(2),u.Q6J("customFields",o.customFields)("customFieldsFormGroup",o.detailForm.get("customFields"))("readonly",!u.lcZ(5,6,"UpdatePromotion"))}}function U(t,e){if(1&t){var o=u.EpF();u.ynx(0),u.TgZ(1,"vdr-configurable-input",30),u.NdJ("remove",function(t){return u.CHM(o),u.oxw().removeCondition(t)}),u.ALo(2,"hasPermission"),u.qZA(),u.BQk()}if(2&t){var n=e.$implicit,r=e.index,i=u.oxw();u.xp6(1),u.Q6J("position",r)("readonly",!u.lcZ(2,5,"UpdatePromotion"))("operation",n)("operationDefinition",i.getConditionDefinition(n))("formControlName",r)}}function L(t,e){if(1&t){var o=u.EpF();u.TgZ(0,"button",35),u.NdJ("click",function(){var t=u.CHM(o).$implicit;return u.oxw(2).addCondition(t)}),u._uU(1),u.qZA()}if(2&t){var n=e.$implicit;u.xp6(1),u.hij(" ",n.description," ")}}function J(t,e){if(1&t&&(u.TgZ(0,"vdr-dropdown"),u.TgZ(1,"button",31),u._UZ(2,"clr-icon",32),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"vdr-dropdown-menu",33),u.YNc(6,L,2,1,"button",34),u.qZA(),u.qZA()),2&t){var o=u.oxw();u.xp6(3),u.hij(" ",u.lcZ(4,2,"marketing.add-condition")," "),u.xp6(3),u.Q6J("ngForOf",o.getAvailableConditions())}}function N(t,e){if(1&t){var o=u.EpF();u.TgZ(0,"vdr-configurable-input",36),u.NdJ("remove",function(t){return u.CHM(o),u.oxw().removeAction(t)}),u.ALo(1,"hasPermission"),u.qZA()}if(2&t){var n=e.$implicit,r=e.index,i=u.oxw();u.Q6J("position",r)("operation",n)("readonly",!u.lcZ(1,5,"UpdatePromotion"))("operationDefinition",i.getActionDefinition(n))("formControlName",r)}}function D(t,e){if(1&t){var o=u.EpF();u.TgZ(0,"button",35),u.NdJ("click",function(){var t=u.CHM(o).$implicit;return u.oxw(2).addAction(t)}),u._uU(1),u.qZA()}if(2&t){var n=e.$implicit;u.xp6(1),u.hij(" ",n.description," ")}}function Q(t,e){if(1&t&&(u.TgZ(0,"vdr-dropdown"),u.TgZ(1,"button",31),u._UZ(2,"clr-icon",32),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"vdr-dropdown-menu",33),u.YNc(6,D,2,1,"button",34),u.qZA(),u.qZA()),2&t){var o=u.oxw();u.xp6(3),u.hij(" ",u.lcZ(4,2,"marketing.add-action")," "),u.xp6(3),u.Q6J("ngForOf",o.getAvailableActions())}}var I=function(){return["./create"]};function j(t,e){1&t&&(u.TgZ(0,"a",6),u._UZ(1,"clr-icon",7),u._uU(2),u.ALo(3,"translate"),u.qZA()),2&t&&(u.Q6J("routerLink",u.DdM(4,I)),u.xp6(2),u.hij(" ",u.lcZ(3,2,"marketing.create-new-promotion")," "))}function Y(t,e){if(1&t&&(u.TgZ(0,"vdr-chip"),u._uU(1),u.qZA()),2&t){var o=u.oxw().item;u.xp6(1),u.hij(" ",o.couponCode," ")}}function E(t,e){1&t&&(u.TgZ(0,"vdr-chip"),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&t&&(u.xp6(1),u.Oqu(u.lcZ(2,1,"common.disabled")))}var S=function(t){return["./",t]};function $(t,e){if(1&t){var o=u.EpF();u.TgZ(0,"td",8),u._uU(1),u.qZA(),u.TgZ(2,"td",8),u.YNc(3,Y,2,1,"vdr-chip",9),u.qZA(),u.TgZ(4,"td",8),u._uU(5),u.ALo(6,"localeDate"),u.qZA(),u.TgZ(7,"td",8),u._uU(8),u.ALo(9,"localeDate"),u.qZA(),u.TgZ(10,"td",10),u.YNc(11,E,3,3,"vdr-chip",9),u.qZA(),u.TgZ(12,"td",11),u._UZ(13,"vdr-table-row-action",12),u.ALo(14,"translate"),u.qZA(),u.TgZ(15,"td",11),u.TgZ(16,"vdr-dropdown"),u.TgZ(17,"button",13),u._uU(18),u.ALo(19,"translate"),u._UZ(20,"clr-icon",14),u.qZA(),u.TgZ(21,"vdr-dropdown-menu",15),u.TgZ(22,"button",16),u.NdJ("click",function(){var t=u.CHM(o).item;return u.oxw().deletePromotion(t.id)}),u.ALo(23,"hasPermission"),u._UZ(24,"clr-icon",17),u._uU(25),u.ALo(26,"translate"),u.qZA(),u.qZA(),u.qZA(),u.qZA()}if(2&t){var n=e.item;u.xp6(1),u.Oqu(n.name),u.xp6(2),u.Q6J("ngIf",n.couponCode),u.xp6(2),u.Oqu(u.xi3(6,10,n.startsAt,"longDate")),u.xp6(3),u.Oqu(u.xi3(9,13,n.endsAt,"longDate")),u.xp6(3),u.Q6J("ngIf",!n.enabled),u.xp6(2),u.Q6J("label",u.lcZ(14,16,"common.edit"))("linkTo",u.VKq(24,S,n.id)),u.xp6(5),u.hij(" ",u.lcZ(19,18,"common.actions")," "),u.xp6(4),u.Q6J("disabled",!u.lcZ(23,20,"DeletePromotion")),u.xp6(3),u.hij(" ",u.lcZ(26,22,"common.delete")," ")}}var B=function(t){a(r,t);var e=s(r);function r(t,i,a,c,s,u,l){var d;return n(this,r),(d=e.call(this,i,t,a,s)).changeDetector=c,d.dataService=s,d.formBuilder=u,d.notificationService=l,d.conditions=[],d.actions=[],d.allConditions=[],d.allActions=[],d.customFields=d.getCustomFieldConfig("Promotion"),d.detailForm=d.formBuilder.group({name:["",m.kI.required],enabled:!0,couponCode:null,perCustomerUsageLimit:null,startsAt:null,endsAt:null,conditions:d.formBuilder.array([]),actions:d.formBuilder.array([]),customFields:d.formBuilder.group(d.customFields.reduce(function(t,e){return Object.assign(Object.assign({},t),o({},e.name,""))},{}))}),d}return i(r,[{key:"ngOnInit",value:function(){var t=this;this.init(),this.promotion$=this.entity$,this.dataService.promotion.getPromotionActionsAndConditions().single$.subscribe(function(e){t.allActions=e.promotionActions,t.allConditions=e.promotionConditions,t.changeDetector.markForCheck()})}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"getAvailableConditions",value:function(){var t=this;return this.allConditions.filter(function(e){return!t.conditions.find(function(t){return t.code===e.code})})}},{key:"getConditionDefinition",value:function(t){return this.allConditions.find(function(e){return e.code===t.code})}},{key:"getAvailableActions",value:function(){var t=this;return this.allActions.filter(function(e){return!t.actions.find(function(t){return t.code===e.code})})}},{key:"getActionDefinition",value:function(t){return this.allActions.find(function(e){return e.code===t.code})}},{key:"saveButtonEnabled",value:function(){return this.detailForm.dirty&&this.detailForm.valid&&(0!==this.conditions.length||this.detailForm.value.couponCode)&&0!==this.actions.length}},{key:"addCondition",value:function(t){this.addOperation("conditions",t),this.detailForm.markAsDirty()}},{key:"addAction",value:function(t){this.addOperation("actions",t),this.detailForm.markAsDirty()}},{key:"removeCondition",value:function(t){this.removeOperation("conditions",t),this.detailForm.markAsDirty()}},{key:"removeAction",value:function(t){this.removeOperation("actions",t),this.detailForm.markAsDirty()}},{key:"formArrayOf",value:function(t){return this.detailForm.get(t)}},{key:"create",value:function(){var t=this;if(this.detailForm.dirty){var e=this.detailForm.value,o={name:e.name,enabled:!0,couponCode:e.couponCode,perCustomerUsageLimit:e.perCustomerUsageLimit,startsAt:e.startsAt,endsAt:e.endsAt,conditions:this.mapOperationsToInputs(this.conditions,e.conditions),actions:this.mapOperationsToInputs(this.actions,e.actions),customFields:e.customFields};this.dataService.promotion.createPromotion(o).subscribe(function(e){var o=e.createPromotion;switch(o.__typename){case"Promotion":t.notificationService.success((0,f.J)("common.notify-create-success"),{entity:"Promotion"}),t.detailForm.markAsPristine(),t.changeDetector.markForCheck(),t.router.navigate(["../",o.id],{relativeTo:t.route});break;case"MissingConditionsError":t.notificationService.error(o.message)}},function(e){t.notificationService.error((0,f.J)("common.notify-create-error"),{entity:"Promotion"})})}}},{key:"save",value:function(){var t=this;if(this.detailForm.dirty){var e=this.detailForm.value;this.promotion$.pipe((0,v.q)(1),(0,h.zg)(function(o){var n={id:o.id,name:e.name,enabled:e.enabled,couponCode:e.couponCode,perCustomerUsageLimit:e.perCustomerUsageLimit,startsAt:e.startsAt,endsAt:e.endsAt,conditions:t.mapOperationsToInputs(t.conditions,e.conditions),actions:t.mapOperationsToInputs(t.actions,e.actions),customFields:e.customFields};return t.dataService.promotion.updatePromotion(n)})).subscribe(function(e){t.notificationService.success((0,f.J)("common.notify-update-success"),{entity:"Promotion"}),t.detailForm.markAsPristine(),t.changeDetector.markForCheck()},function(e){t.notificationService.error((0,f.J)("common.notify-update-error"),{entity:"Promotion"})})}}},{key:"setFormValues",value:function(t,e){var o=this;this.detailForm.patchValue({name:t.name,enabled:t.enabled,couponCode:t.couponCode,perCustomerUsageLimit:t.perCustomerUsageLimit,startsAt:t.startsAt,endsAt:t.endsAt}),t.conditions.forEach(function(t){o.addOperation("conditions",t)}),t.actions.forEach(function(t){return o.addOperation("actions",t)}),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get("customFields"),t)}},{key:"mapOperationsToInputs",value:function(t,e){return t.map(function(t,o){return{code:t.code,arguments:Object.values(e[o].args).map(function(e,o){return{name:t.args[o].name,value:(0,g.qrw)(e)}})}})}},{key:"addOperation",value:function(t,e){var n=this,r=this.formArrayOf(t),i="conditions"===t?this.conditions:this.actions;if(-1===r.value.findIndex(function(t){return t.code===e.code})){var a=e.args.reduce(function(r,i){var a;return Object.assign(Object.assign({},r),o({},i.name,null!==(a=(0,g.sux)(i.value))&&void 0!==a?a:n.getDefaultArgValue(t,e,i.name)))},{});r.push(this.formBuilder.control({code:e.code,args:a})),i.push({code:e.code,args:e.args.map(function(t){return{name:t.name,value:(0,g.sux)(t.value)}})})}}},{key:"getDefaultArgValue",value:function(t,e,o){var n="conditions"===t?this.allConditions.find(function(t){return t.code===e.code}):this.allActions.find(function(t){return t.code===e.code});if(n){var r=n.args.find(function(t){return t.name===o});if(r)return(0,g.NWQ)(r)}throw new Error('Could not determine default value for "argName"')}},{key:"removeOperation",value:function(t,e){var o=this.formArrayOf(t),n="conditions"===t?this.conditions:this.actions,r=o.value.findIndex(function(t){return t.code===e.code});-1!==r&&(o.removeAt(r),n.splice(r,1))}}]),r}(g.UT_);B.\u0275fac=function(t){return new(t||B)(u.Y36(p.F0),u.Y36(p.gz),u.Y36(g.iHG),u.Y36(u.sBO),u.Y36(g.DoR),u.Y36(m.qu),u.Y36(g.gqp))},B.\u0275cmp=u.Xpm({type:B,selectors:[["vdr-promotion-detail"]],features:[u.qOj],decls:48,vars:46,consts:[[1,"flex","clr-align-items-center"],[3,"entity"],[4,"vdrIfPermissions"],["locationId","promotion-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["for","startsAt",3,"label"],["formControlName","startsAt"],["for","endsAt",3,"label"],["formControlName","endsAt"],["for","couponCode",3,"label"],["id","couponCode","type","text","formControlName","couponCode",3,"readonly"],["for","perCustomerUsageLimit",3,"label"],["id","perCustomerUsageLimit","type","number","min","1","max","999","formControlName","perCustomerUsageLimit",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["locationId","promotion-detail",3,"entity$","detailForm"],[1,"clr-row"],["formArrayName","conditions",1,"clr-col"],[1,"clr-control-label"],[4,"ngFor","ngForOf"],["formArrayName","actions",1,"clr-col"],[3,"position","operation","readonly","operationDefinition","formControlName","remove",4,"ngFor","ngForOf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["formGroupName","customFields"],["entityName","Promotion",3,"customFields","customFieldsFormGroup","readonly"],[3,"position","readonly","operation","operationDefinition","formControlName","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","","class","item-wrap",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",1,"item-wrap",3,"click"],[3,"position","operation","readonly","operationDefinition","formControlName","remove"]],template:function(t,e){if(1&t&&(u.TgZ(0,"vdr-action-bar"),u.TgZ(1,"vdr-ab-left"),u.TgZ(2,"div",0),u._UZ(3,"vdr-entity-info",1),u.ALo(4,"async"),u.YNc(5,k,5,5,"clr-toggle-wrapper",2),u.qZA(),u.qZA(),u.TgZ(6,"vdr-ab-right"),u._UZ(7,"vdr-action-bar-items",3),u.YNc(8,O,3,4,"button",4),u.ALo(9,"async"),u.YNc(10,w,1,1,"ng-template",null,5,u.W1O),u.qZA(),u.qZA(),u.TgZ(12,"form",6),u.TgZ(13,"vdr-form-field",7),u.ALo(14,"translate"),u._UZ(15,"input",8),u.ALo(16,"hasPermission"),u.qZA(),u.TgZ(17,"vdr-form-field",9),u.ALo(18,"translate"),u._UZ(19,"vdr-datetime-picker",10),u.qZA(),u.TgZ(20,"vdr-form-field",11),u.ALo(21,"translate"),u._UZ(22,"vdr-datetime-picker",12),u.qZA(),u.TgZ(23,"vdr-form-field",13),u.ALo(24,"translate"),u._UZ(25,"input",14),u.ALo(26,"hasPermission"),u.qZA(),u.TgZ(27,"vdr-form-field",15),u.ALo(28,"translate"),u._UZ(29,"input",16),u.ALo(30,"hasPermission"),u.qZA(),u.YNc(31,_,6,8,"section",17),u._UZ(32,"vdr-custom-detail-component-host",18),u.TgZ(33,"div",19),u.TgZ(34,"div",20),u.TgZ(35,"label",21),u._uU(36),u.ALo(37,"translate"),u.qZA(),u.YNc(38,U,3,7,"ng-container",22),u.TgZ(39,"div"),u.YNc(40,J,7,4,"vdr-dropdown",2),u.qZA(),u.qZA(),u.TgZ(41,"div",23),u.TgZ(42,"label",21),u._uU(43),u.ALo(44,"translate"),u.qZA(),u.YNc(45,N,2,7,"vdr-configurable-input",24),u.TgZ(46,"div"),u.YNc(47,Q,7,4,"vdr-dropdown",2),u.qZA(),u.qZA(),u.qZA(),u.qZA()),2&t){var o=u.MAs(11);u.xp6(3),u.Q6J("entity",u.lcZ(4,22,e.entity$)),u.xp6(2),u.Q6J("vdrIfPermissions","UpdatePromotion"),u.xp6(3),u.Q6J("ngIf",u.lcZ(9,24,e.isNew$))("ngIfElse",o),u.xp6(4),u.Q6J("formGroup",e.detailForm),u.xp6(1),u.Q6J("label",u.lcZ(14,26,"common.name")),u.xp6(2),u.Q6J("readonly",!u.lcZ(16,28,"UpdatePromotion")),u.xp6(2),u.Q6J("label",u.lcZ(18,30,"marketing.starts-at")),u.xp6(3),u.Q6J("label",u.lcZ(21,32,"marketing.ends-at")),u.xp6(3),u.Q6J("label",u.lcZ(24,34,"marketing.coupon-code")),u.xp6(2),u.Q6J("readonly",!u.lcZ(26,36,"UpdatePromotion")),u.xp6(2),u.Q6J("label",u.lcZ(28,38,"marketing.per-customer-limit")),u.xp6(2),u.Q6J("readonly",!u.lcZ(30,40,"UpdatePromotion")),u.xp6(2),u.Q6J("ngIf",e.customFields.length),u.xp6(1),u.Q6J("entity$",e.entity$)("detailForm",e.detailForm),u.xp6(4),u.Oqu(u.lcZ(37,42,"marketing.conditions")),u.xp6(2),u.Q6J("ngForOf",e.conditions),u.xp6(2),u.Q6J("vdrIfPermissions","UpdatePromotion"),u.xp6(3),u.Oqu(u.lcZ(44,44,"marketing.actions")),u.xp6(2),u.Q6J("ngForOf",e.actions),u.xp6(2),u.Q6J("vdrIfPermissions","UpdatePromotion")}},directives:[g.KkL,g.BND,g.Vqt,g.HAh,g.mz,g.WWO,x.O5,m._Y,m.JL,m.sg,g.hgI,g.y_K,m.Fj,m.JJ,m.u,g.IPv,m.qQ,m.Fd,m.wV,g.CWh,m.CE,P.MgK,x.sg,P.PEh,m.Wl,P.KKC,m.oH,m.x0,g.yc0,g.qq8,g.JOL,g.UaT,P.qvL,g.N9E,g.HH4],pipes:[x.Ov,q.X$,g.j$k],styles:[".item-wrap[_ngcontent-%COMP%]{white-space:normal}"],changeDetection:0}),B.ctorParameters=function(){return[{type:p.F0},{type:p.gz},{type:g.iHG},{type:u.sBO},{type:g.DoR},{type:m.qu},{type:g.gqp}]};var R=function(e){a(r,e);var o=s(r);function r(e,i,a,c,s){var u,p;return n(this,r),(p=o.call(this,i,a)).dataService=e,p.notificationService=c,p.modalService=s,p.searchForm=new m.cw({name:new m.NI(""),couponCode:new m.NI("")}),t((u=l(p),d(r.prototype)),"setQueryFn",u).call(u,function(){var t;return(t=p.dataService.promotion).getPromotions.apply(t,arguments).refetchOnChannelChange()},function(t){return t.promotions},function(t,e){return p.createQueryOptions(t,e,p.searchForm.value)}),p}return i(r,[{key:"ngOnInit",value:function(){var e=this;t(d(r.prototype),"ngOnInit",this).call(this),(0,A.T)(this.searchForm.valueChanges.pipe((0,Z.b)(250)),this.route.queryParamMap).pipe((0,y.R)(this.destroy$)).subscribe(function(t){t.params||e.setPageNumber(1),e.refresh()})}},{key:"deletePromotion",value:function(t){var e=this;this.modalService.dialog({title:(0,f.J)("catalog.confirm-delete-promotion"),buttons:[{type:"secondary",label:(0,f.J)("common.cancel")},{type:"danger",label:(0,f.J)("common.delete"),returnValue:!0}]}).pipe((0,b.w)(function(o){return o?e.dataService.promotion.deletePromotion(t):C.E})).subscribe(function(){e.notificationService.success((0,f.J)("common.notify-delete-success"),{entity:"Promotion"}),e.refresh()},function(t){e.notificationService.error((0,f.J)("common.notify-delete-error"),{entity:"Promotion"})})}},{key:"createQueryOptions",value:function(t,e,o){var n={};return o.couponCode&&(n.couponCode={contains:o.couponCode}),o.name&&(n.name={contains:o.name}),{options:{skip:t,take:e,filter:n}}}}]),r}(g.t7C);R.\u0275fac=function(t){return new(t||R)(u.Y36(g.DoR),u.Y36(p.F0),u.Y36(p.gz),u.Y36(g.gqp),u.Y36(g.Z7U))},R.\u0275cmp=u.Xpm({type:R,selectors:[["vdr-promotion-list"]],features:[u.qOj],decls:31,vars:32,consts:[[1,"search-form",3,"formGroup"],["type","text","formControlName","name",1,"search-input",3,"placeholder"],["type","text","formControlName","couponCode",1,"search-input",3,"placeholder"],["locationId","promotion-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[4,"ngIf"],[1,"align-middle"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"]],template:function(t,e){1&t&&(u.TgZ(0,"vdr-action-bar"),u.TgZ(1,"vdr-ab-left"),u.TgZ(2,"form",0),u._UZ(3,"input",1),u.ALo(4,"translate"),u._UZ(5,"input",2),u.ALo(6,"translate"),u.qZA(),u.qZA(),u.TgZ(7,"vdr-ab-right"),u._UZ(8,"vdr-action-bar-items",3),u.YNc(9,j,4,5,"a",4),u.qZA(),u.qZA(),u.TgZ(10,"vdr-data-table",5),u.NdJ("pageChange",function(t){return e.setPageNumber(t)})("itemsPerPageChange",function(t){return e.setItemsPerPage(t)}),u.ALo(11,"async"),u.ALo(12,"async"),u.ALo(13,"async"),u.ALo(14,"async"),u.TgZ(15,"vdr-dt-column"),u._uU(16),u.ALo(17,"translate"),u.qZA(),u.TgZ(18,"vdr-dt-column"),u._uU(19),u.ALo(20,"translate"),u.qZA(),u.TgZ(21,"vdr-dt-column"),u._uU(22),u.ALo(23,"translate"),u.qZA(),u.TgZ(24,"vdr-dt-column"),u._uU(25),u.ALo(26,"translate"),u.qZA(),u._UZ(27,"vdr-dt-column"),u._UZ(28,"vdr-dt-column"),u._UZ(29,"vdr-dt-column"),u.YNc(30,$,27,26,"ng-template"),u.qZA()),2&t&&(u.xp6(2),u.Q6J("formGroup",e.searchForm),u.xp6(1),u.Q6J("placeholder",u.lcZ(4,12,"marketing.search-by-name")),u.xp6(2),u.Q6J("placeholder",u.lcZ(6,14,"marketing.search-by-coupon-code")),u.xp6(4),u.Q6J("vdrIfPermissions","CreatePromotion"),u.xp6(1),u.Q6J("items",u.lcZ(11,16,e.items$))("itemsPerPage",u.lcZ(12,18,e.itemsPerPage$))("totalItems",u.lcZ(13,20,e.totalItems$))("currentPage",u.lcZ(14,22,e.currentPage$)),u.xp6(6),u.Oqu(u.lcZ(17,24,"common.name")),u.xp6(3),u.Oqu(u.lcZ(20,26,"marketing.coupon-code")),u.xp6(3),u.Oqu(u.lcZ(23,28,"marketing.starts-at")),u.xp6(3),u.Oqu(u.lcZ(26,30,"marketing.ends-at")))},directives:[g.KkL,g.BND,m._Y,m.JL,m.sg,g.y_K,m.Fj,m.JJ,m.u,g.mz,g.WWO,g.HAh,g.Qj_,g.Egy,p.yS,P.qvL,x.O5,g.v_8,g.JOL,g.UaT,g.N9E,g.HH4,g.Ywx],pipes:[q.X$,x.Ov,g.HbD,g.j$k],styles:[".search-form[_ngcontent-%COMP%]{padding:0}.search-input[_ngcontent-%COMP%]{margin:6px 8px 0 0;min-width:200px}"],changeDetection:0}),R.ctorParameters=function(){return[{type:g.DoR},{type:p.F0},{type:p.gz},{type:g.gqp},{type:g.Z7U}]};var M=function(t){a(o,t);var e=s(o);function o(t,r){return n(this,o),e.call(this,t,{__typename:"Promotion",id:"",createdAt:"",updatedAt:"",name:"",enabled:!1,conditions:[],actions:[]},function(t){return r.promotion.getPromotion(t).mapStream(function(t){return t.promotion})})}return i(o)}(g.p_9);M.\u0275fac=function(t){return new(t||M)(u.LFG(p.F0),u.LFG(g.DoR))},M.\u0275prov=u.Yz7({factory:function(){return new M(u.LFG(p.F0),u.LFG(g.DoR))},token:M,providedIn:"root"}),M.ctorParameters=function(){return[{type:p.F0},{type:g.DoR}]};var H={breadcrumb:(0,f.J)("breadcrumb.promotions")},G={breadcrumb:K},z=[{path:"promotions",component:R,data:H},{path:"promotions/:id",component:B,resolve:(0,g.Po4)(M),canDeactivate:[g.TSp],data:G}];function K(t,e){return(0,g.YWC)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.promotions",getName:function(t){return t.name},route:"promotions"})}var V=i(function t(){n(this,t)});V.\u0275fac=function(t){return new(t||V)},V.\u0275mod=u.oAB({type:V}),V.\u0275inj=u.cJS({imports:[[g.m81,p.Bz.forChild(z)]]})}}])}();
//# sourceMappingURL=638-es5.612c9185a83319bb54f8.js.map