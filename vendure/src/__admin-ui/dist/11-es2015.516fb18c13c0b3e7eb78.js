(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{Gk25:function(t,e,o){"use strict";o.r(e),o.d(e,"MarketingModule",function(){return $}),o.d(e,"PromotionDetailComponent",function(){return V}),o.d(e,"PromotionListComponent",function(){return T}),o.d(e,"PromotionResolver",function(){return U}),o.d(e,"marketingRoutes",function(){return E}),o.d(e,"promotionBreadcrumb",function(){return L}),o.d(e,"\u02750",function(){return M}),o.d(e,"\u02751",function(){return N});var i=o("Iq5M"),n=o("RlrJ"),c=o("oIEy"),r=o("48Dx"),a=o("FWuv"),s=o("LgQE"),d=o("3MHA"),m=o("jOUA"),l=o("C/3P"),u=o("HKMU"),p=o("OLIJ"),b=o("Tm5P");const f=function(){return["enabled"]};function h(t,e){if(1&t&&(i.jc(0,"clr-toggle-wrapper"),i.ec(1,"input",23),i.jc(2,"label"),i.Vc(3),i.tc(4,"translate"),i.ic(),i.ic()),2&t){const t=i.sc();i.Sb(1),i.zc("formControl",t.detailForm.get(i.Cc(4,f))),i.Sb(2),i.Wc(i.uc(4,2,"common.enabled"))}}function g(t,e){if(1&t){const t=i.kc();i.jc(0,"button",24),i.qc("click",function(){i.Mc(t);return i.sc().create()}),i.Vc(1),i.tc(2,"translate"),i.ic()}if(2&t){const t=i.sc();i.zc("disabled",!t.saveButtonEnabled()),i.Sb(1),i.Xc(" ",i.uc(2,2,"common.create")," ")}}function v(t,e){if(1&t){const t=i.kc();i.jc(0,"button",24),i.qc("click",function(){i.Mc(t);return i.sc(2).save()}),i.Vc(1),i.tc(2,"translate"),i.ic()}if(2&t){const t=i.sc(2);i.zc("disabled",!t.saveButtonEnabled()),i.Sb(1),i.Xc(" ",i.uc(2,2,"common.update")," ")}}function y(t,e){1&t&&i.Tc(0,v,3,4,"button",25),2&t&&i.zc("vdrIfPermissions","UpdatePromotion")}function j(t,e){if(1&t){const t=i.kc();i.hc(0),i.jc(1,"vdr-configurable-input",26),i.qc("remove",function(e){i.Mc(t);return i.sc().removeCondition(e)}),i.tc(2,"hasPermission"),i.ic(),i.gc()}if(2&t){const t=e.$implicit,o=e.index,n=i.sc();i.Sb(1),i.zc("readonly",!i.uc(2,4,"UpdatePromotion"))("operation",t)("operationDefinition",n.getConditionDefinition(t))("formControlName",o)}}function P(t,e){if(1&t){const t=i.kc();i.jc(0,"button",31),i.qc("click",function(){i.Mc(t);const o=e.$implicit;return i.sc(2).addCondition(o)}),i.Vc(1),i.ic()}if(2&t){const t=e.$implicit;i.Sb(1),i.Xc(" ",t.description," ")}}function C(t,e){if(1&t&&(i.jc(0,"vdr-dropdown"),i.jc(1,"button",27),i.ec(2,"clr-icon",28),i.Vc(3),i.tc(4,"translate"),i.ic(),i.jc(5,"vdr-dropdown-menu",29),i.Tc(6,P,2,1,"button",30),i.ic(),i.ic()),2&t){const t=i.sc();i.Sb(3),i.Xc(" ",i.uc(4,2,"marketing.add-condition")," "),i.Sb(3),i.zc("ngForOf",t.getAvailableConditions())}}function S(t,e){if(1&t){const t=i.kc();i.jc(0,"vdr-configurable-input",32),i.qc("remove",function(e){i.Mc(t);return i.sc().removeAction(e)}),i.tc(1,"hasPermission"),i.ic()}if(2&t){const t=e.$implicit,o=e.index,n=i.sc();i.zc("operation",t)("readonly",!i.uc(1,4,"UpdatePromotion"))("operationDefinition",n.getActionDefinition(t))("formControlName",o)}}function k(t,e){if(1&t){const t=i.kc();i.jc(0,"button",31),i.qc("click",function(){i.Mc(t);const o=e.$implicit;return i.sc(2).addAction(o)}),i.Vc(1),i.ic()}if(2&t){const t=e.$implicit;i.Sb(1),i.Xc(" ",t.description," ")}}function A(t,e){if(1&t&&(i.jc(0,"vdr-dropdown"),i.jc(1,"button",27),i.ec(2,"clr-icon",28),i.Vc(3),i.tc(4,"translate"),i.ic(),i.jc(5,"vdr-dropdown-menu",29),i.Tc(6,k,2,1,"button",30),i.ic(),i.ic()),2&t){const t=i.sc();i.Sb(3),i.Xc(" ",i.uc(4,2,"marketing.add-action")," "),i.Sb(3),i.zc("ngForOf",t.getAvailableActions())}}const O=function(){return["./create"]};function D(t,e){1&t&&(i.jc(0,"a",3),i.ec(1,"clr-icon",4),i.Vc(2),i.tc(3,"translate"),i.ic()),2&t&&(i.zc("routerLink",i.Cc(4,O)),i.Sb(2),i.Xc(" ",i.uc(3,2,"marketing.create-new-promotion")," "))}function I(t,e){if(1&t&&(i.jc(0,"vdr-chip"),i.Vc(1),i.ic()),2&t){const t=i.sc().item;i.Sb(1),i.Xc(" ",t.couponCode," ")}}function w(t,e){1&t&&(i.jc(0,"vdr-chip"),i.Vc(1),i.tc(2,"translate"),i.ic()),2&t&&(i.Sb(1),i.Wc(i.uc(2,1,"common.disabled")))}const F=function(t){return["./",t]};function z(t,e){if(1&t){const t=i.kc();i.jc(0,"td",5),i.Vc(1),i.ic(),i.jc(2,"td",5),i.Tc(3,I,2,1,"vdr-chip",6),i.ic(),i.jc(4,"td",5),i.Vc(5),i.tc(6,"localeDate"),i.ic(),i.jc(7,"td",5),i.Vc(8),i.tc(9,"localeDate"),i.ic(),i.jc(10,"td",7),i.Tc(11,w,3,3,"vdr-chip",6),i.ic(),i.jc(12,"td",8),i.ec(13,"vdr-table-row-action",9),i.tc(14,"translate"),i.ic(),i.jc(15,"td",8),i.jc(16,"vdr-dropdown"),i.jc(17,"button",10),i.Vc(18),i.tc(19,"translate"),i.ec(20,"clr-icon",11),i.ic(),i.jc(21,"vdr-dropdown-menu",12),i.jc(22,"button",13),i.qc("click",function(){i.Mc(t);const o=e.item;return i.sc().deletePromotion(o.id)}),i.tc(23,"hasPermission"),i.ec(24,"clr-icon",14),i.Vc(25),i.tc(26,"translate"),i.ic(),i.ic(),i.ic(),i.ic()}if(2&t){const t=e.item;i.Sb(1),i.Wc(t.name),i.Sb(2),i.zc("ngIf",t.couponCode),i.Sb(2),i.Wc(i.vc(6,10,t.startsAt,"longDate")),i.Sb(3),i.Wc(i.vc(9,13,t.endsAt,"longDate")),i.Sb(3),i.zc("ngIf",!t.enabled),i.Sb(2),i.zc("label",i.uc(14,16,"common.edit"))("linkTo",i.Dc(24,F,t.id)),i.Sb(5),i.Xc(" ",i.uc(19,18,"common.actions")," "),i.Sb(4),i.zc("disabled",!i.uc(23,20,"DeletePromotion")),i.Sb(3),i.Xc(" ",i.uc(26,22,"common.delete")," ")}}class V extends a.w{constructor(t,e,o,i,c,r,a){super(e,t,o,c),this.changeDetector=i,this.dataService=c,this.formBuilder=r,this.notificationService=a,this.conditions=[],this.actions=[],this.allConditions=[],this.allActions=[],this.detailForm=this.formBuilder.group({name:["",n.C.required],enabled:!0,couponCode:null,perCustomerUsageLimit:null,startsAt:null,endsAt:null,conditions:this.formBuilder.array([]),actions:this.formBuilder.array([])})}ngOnInit(){this.init(),this.promotion$=this.entity$,this.dataService.promotion.getPromotionActionsAndConditions().single$.subscribe(t=>{this.allActions=t.promotionActions,this.allConditions=t.promotionConditions,this.changeDetector.markForCheck()})}ngOnDestroy(){this.destroy()}getAvailableConditions(){return this.allConditions.filter(t=>!this.conditions.find(e=>e.code===t.code))}getConditionDefinition(t){return this.allConditions.find(e=>e.code===t.code)}getAvailableActions(){return this.allActions.filter(t=>!this.actions.find(e=>e.code===t.code))}getActionDefinition(t){return this.allActions.find(e=>e.code===t.code)}saveButtonEnabled(){return this.detailForm.dirty&&this.detailForm.valid&&(0!==this.conditions.length||this.detailForm.value.couponCode)&&0!==this.actions.length}addCondition(t){this.addOperation("conditions",t),this.detailForm.markAsDirty()}addAction(t){this.addOperation("actions",t),this.detailForm.markAsDirty()}removeCondition(t){this.removeOperation("conditions",t),this.detailForm.markAsDirty()}removeAction(t){this.removeOperation("actions",t),this.detailForm.markAsDirty()}formArrayOf(t){return this.detailForm.get(t)}create(){if(!this.detailForm.dirty)return;const t=this.detailForm.value,e={name:t.name,enabled:!0,couponCode:t.couponCode,perCustomerUsageLimit:t.perCustomerUsageLimit,startsAt:t.startsAt,endsAt:t.endsAt,conditions:this.mapOperationsToInputs(this.conditions,t.conditions),actions:this.mapOperationsToInputs(this.actions,t.actions)};this.dataService.promotion.createPromotion(e).subscribe(({createPromotion:t})=>{switch(t.__typename){case"Promotion":this.notificationService.success(Object(r.a)("common.notify-create-success"),{entity:"Promotion"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",t.id],{relativeTo:this.route});break;case"MissingConditionsError":this.notificationService.error(t.message)}},t=>{this.notificationService.error(Object(r.a)("common.notify-create-error"),{entity:"Promotion"})})}save(){if(!this.detailForm.dirty)return;const t=this.detailForm.value;this.promotion$.pipe(Object(s.a)(1),Object(d.a)(e=>{const o={id:e.id,name:t.name,enabled:t.enabled,couponCode:t.couponCode,perCustomerUsageLimit:t.perCustomerUsageLimit,startsAt:t.startsAt,endsAt:t.endsAt,conditions:this.mapOperationsToInputs(this.conditions,t.conditions),actions:this.mapOperationsToInputs(this.actions,t.actions)};return this.dataService.promotion.updatePromotion(o)})).subscribe(t=>{this.notificationService.success(Object(r.a)("common.notify-update-success"),{entity:"Promotion"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck()},t=>{this.notificationService.error(Object(r.a)("common.notify-update-error"),{entity:"Promotion"})})}setFormValues(t,e){this.detailForm.patchValue({name:t.name,enabled:t.enabled,couponCode:t.couponCode,perCustomerUsageLimit:t.perCustomerUsageLimit,startsAt:t.startsAt,endsAt:t.endsAt}),t.conditions.forEach(t=>{this.addOperation("conditions",t)}),t.actions.forEach(t=>this.addOperation("actions",t))}mapOperationsToInputs(t,e){return t.map((t,o)=>({code:t.code,arguments:Object.values(e[o].args).map((e,o)=>({name:t.args[o].name,value:Object(a.dc)(e)}))}))}addOperation(t,e){const o=this.formArrayOf(t),i="conditions"===t?this.conditions:this.actions;if(-1===o.value.findIndex(t=>t.code===e.code)){const n=e.args.reduce((o,i)=>{var n;return Object.assign(Object.assign({},o),{[i.name]:null!==(n=Object(a.hc)(i.value))&&void 0!==n?n:this.getDefaultArgValue(t,e,i.name)})},{});o.push(this.formBuilder.control({code:e.code,args:n})),i.push({code:e.code,args:e.args.map(t=>({name:t.name,value:Object(a.hc)(t.value)}))})}}getDefaultArgValue(t,e,o){const i="conditions"===t?this.allConditions.find(t=>t.code===e.code):this.allActions.find(t=>t.code===e.code);if(i){const t=i.args.find(t=>t.name===o);if(t)return Object(a.ic)(t)}throw new Error('Could not determine default value for "argName"')}removeOperation(t,e){const o=this.formArrayOf(t),i="conditions"===t?this.conditions:this.actions,n=o.value.findIndex(t=>t.code===e.code);-1!==n&&(o.removeAt(n),i.splice(n,1))}}V.\u0275fac=function(t){return new(t||V)(i.dc(c.e),i.dc(c.a),i.dc(a.Mb),i.dc(i.k),i.dc(a.M),i.dc(n.e),i.dc(a.Eb))},V.\u0275cmp=i.Xb({type:V,selectors:[["vdr-promotion-detail"]],features:[i.Pb],decls:46,vars:43,consts:[[1,"flex","clr-align-items-center"],[3,"entity"],[4,"vdrIfPermissions"],["locationId","promotion-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["for","startsAt",3,"label"],["formControlName","startsAt"],["for","endsAt",3,"label"],["formControlName","endsAt"],["for","couponCode",3,"label"],["id","couponCode","type","text","formControlName","couponCode",3,"readonly"],["for","perCustomerUsageLimit",3,"label"],["id","perCustomerUsageLimit","type","number","min","1","max","999","formControlName","perCustomerUsageLimit",3,"readonly"],[1,"clr-row"],["formArrayName","conditions",1,"clr-col"],[1,"clr-control-label"],[4,"ngFor","ngForOf"],["formArrayName","actions",1,"clr-col"],[3,"operation","readonly","operationDefinition","formControlName","remove",4,"ngFor","ngForOf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"readonly","operation","operationDefinition","formControlName","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[3,"operation","readonly","operationDefinition","formControlName","remove"]],template:function(t,e){if(1&t&&(i.jc(0,"vdr-action-bar"),i.jc(1,"vdr-ab-left"),i.jc(2,"div",0),i.ec(3,"vdr-entity-info",1),i.tc(4,"async"),i.Tc(5,h,5,5,"clr-toggle-wrapper",2),i.ic(),i.ic(),i.jc(6,"vdr-ab-right"),i.ec(7,"vdr-action-bar-items",3),i.Tc(8,g,3,4,"button",4),i.tc(9,"async"),i.Tc(10,y,1,1,"ng-template",null,5,i.Uc),i.ic(),i.ic(),i.jc(12,"form",6),i.jc(13,"vdr-form-field",7),i.tc(14,"translate"),i.ec(15,"input",8),i.tc(16,"hasPermission"),i.ic(),i.jc(17,"vdr-form-field",9),i.tc(18,"translate"),i.ec(19,"vdr-datetime-picker",10),i.ic(),i.jc(20,"vdr-form-field",11),i.tc(21,"translate"),i.ec(22,"vdr-datetime-picker",12),i.ic(),i.jc(23,"vdr-form-field",13),i.tc(24,"translate"),i.ec(25,"input",14),i.tc(26,"hasPermission"),i.ic(),i.jc(27,"vdr-form-field",15),i.tc(28,"translate"),i.ec(29,"input",16),i.tc(30,"hasPermission"),i.ic(),i.jc(31,"div",17),i.jc(32,"div",18),i.jc(33,"label",19),i.Vc(34),i.tc(35,"translate"),i.ic(),i.Tc(36,j,3,6,"ng-container",20),i.jc(37,"div"),i.Tc(38,C,7,4,"vdr-dropdown",2),i.ic(),i.ic(),i.jc(39,"div",21),i.jc(40,"label",19),i.Vc(41),i.tc(42,"translate"),i.ic(),i.Tc(43,S,2,6,"vdr-configurable-input",22),i.jc(44,"div"),i.Tc(45,A,7,4,"vdr-dropdown",2),i.ic(),i.ic(),i.ic(),i.ic()),2&t){const t=i.Jc(11);i.Sb(3),i.zc("entity",i.uc(4,19,e.entity$)),i.Sb(2),i.zc("vdrIfPermissions","UpdatePromotion"),i.Sb(3),i.zc("ngIf",i.uc(9,21,e.isNew$))("ngIfElse",t),i.Sb(4),i.zc("formGroup",e.detailForm),i.Sb(1),i.zc("label",i.uc(14,23,"common.name")),i.Sb(2),i.zc("readonly",!i.uc(16,25,"UpdatePromotion")),i.Sb(2),i.zc("label",i.uc(18,27,"marketing.starts-at")),i.Sb(3),i.zc("label",i.uc(21,29,"marketing.ends-at")),i.Sb(3),i.zc("label",i.uc(24,31,"marketing.coupon-code")),i.Sb(2),i.zc("readonly",!i.uc(26,33,"UpdatePromotion")),i.Sb(2),i.zc("label",i.uc(28,35,"marketing.per-customer-limit")),i.Sb(2),i.zc("readonly",!i.uc(30,37,"UpdatePromotion")),i.Sb(5),i.Wc(i.uc(35,39,"marketing.conditions")),i.Sb(2),i.zc("ngForOf",e.conditions),i.Sb(2),i.zc("vdrIfPermissions","UpdatePromotion"),i.Sb(3),i.Wc(i.uc(42,41,"marketing.actions")),i.Sb(2),i.zc("ngForOf",e.actions),i.Sb(2),i.zc("vdrIfPermissions","UpdatePromotion")}},directives:[a.c,a.e,a.bb,a.rb,a.f,a.d,u.o,n.E,n.q,n.j,a.eb,a.fb,n.b,n.p,n.h,a.P,n.v,n.d,p.u,u.n,p.k,n.a,p.i,n.g,a.E,a.U,a.X,p.o,a.W,a.V],pipes:[u.b,b.d,a.jb],styles:[""],changeDetection:0}),V.ctorParameters=()=>[{type:c.e},{type:c.a},{type:a.Mb},{type:i.k},{type:a.M},{type:n.e},{type:a.Eb}];class T extends a.y{constructor(t,e,o,i,n){super(e,o),this.dataService=t,this.notificationService=i,this.modalService=n,super.setQueryFn((...t)=>this.dataService.promotion.getPromotions(...t).refetchOnChannelChange(),t=>t.promotions)}deletePromotion(t){this.modalService.dialog({title:Object(r.a)("catalog.confirm-delete-promotion"),buttons:[{type:"secondary",label:Object(r.a)("common.cancel")},{type:"danger",label:Object(r.a)("common.delete"),returnValue:!0}]}).pipe(Object(m.a)(e=>e?this.dataService.promotion.deletePromotion(t):l.a)).subscribe(()=>{this.notificationService.success(Object(r.a)("common.notify-delete-success"),{entity:"Promotion"}),this.refresh()},t=>{this.notificationService.error(Object(r.a)("common.notify-delete-error"),{entity:"Promotion"})})}}T.\u0275fac=function(t){return new(t||T)(i.dc(a.M),i.dc(c.e),i.dc(c.a),i.dc(a.Eb),i.dc(a.Db))},T.\u0275cmp=i.Xb({type:T,selectors:[["vdr-promotion-list"]],features:[i.Pb],decls:25,vars:25,consts:[["locationId","promotion-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[4,"ngIf"],[1,"align-middle"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"]],template:function(t,e){1&t&&(i.jc(0,"vdr-action-bar"),i.jc(1,"vdr-ab-right"),i.ec(2,"vdr-action-bar-items",0),i.Tc(3,D,4,5,"a",1),i.ic(),i.ic(),i.jc(4,"vdr-data-table",2),i.qc("pageChange",function(t){return e.setPageNumber(t)})("itemsPerPageChange",function(t){return e.setItemsPerPage(t)}),i.tc(5,"async"),i.tc(6,"async"),i.tc(7,"async"),i.tc(8,"async"),i.jc(9,"vdr-dt-column"),i.Vc(10),i.tc(11,"translate"),i.ic(),i.jc(12,"vdr-dt-column"),i.Vc(13),i.tc(14,"translate"),i.ic(),i.jc(15,"vdr-dt-column"),i.Vc(16),i.tc(17,"translate"),i.ic(),i.jc(18,"vdr-dt-column"),i.Vc(19),i.tc(20,"translate"),i.ic(),i.ec(21,"vdr-dt-column"),i.ec(22,"vdr-dt-column"),i.ec(23,"vdr-dt-column"),i.Tc(24,z,27,26,"ng-template"),i.ic()),2&t&&(i.Sb(3),i.zc("vdrIfPermissions","CreatePromotion"),i.Sb(1),i.zc("items",i.uc(5,9,e.items$))("itemsPerPage",i.uc(6,11,e.itemsPerPage$))("totalItems",i.uc(7,13,e.totalItems$))("currentPage",i.uc(8,15,e.currentPage$)),i.Sb(6),i.Wc(i.uc(11,17,"common.name")),i.Sb(3),i.Wc(i.uc(14,19,"marketing.coupon-code")),i.Sb(3),i.Wc(i.uc(17,21,"marketing.starts-at")),i.Sb(3),i.Wc(i.uc(20,23,"marketing.ends-at")))},directives:[a.c,a.f,a.d,a.rb,a.O,a.N,c.h,p.o,u.o,a.Tb,a.U,a.X,a.W,a.V,a.D],pipes:[u.b,b.d,a.Bb,a.jb],styles:[""],changeDetection:0}),T.ctorParameters=()=>[{type:a.M},{type:c.e},{type:c.a},{type:a.Eb},{type:a.Db}];class U extends a.x{constructor(t,e){super(t,{__typename:"Promotion",id:"",createdAt:"",updatedAt:"",name:"",enabled:!1,conditions:[],actions:[]},t=>e.promotion.getPromotion(t).mapStream(t=>t.promotion))}}U.\u0275fac=function(t){return new(t||U)(i.nc(c.e),i.nc(a.M))},U.\u0275prov=Object(i.Zb)({factory:function(){return new U(Object(i.nc)(c.e),Object(i.nc)(a.M))},token:U,providedIn:"root"}),U.ctorParameters=()=>[{type:c.e},{type:a.M}];const M={breadcrumb:Object(r.a)("breadcrumb.promotions")},N={breadcrumb:L},E=[{path:"promotions",component:T,data:M},{path:"promotions/:id",component:V,resolve:Object(a.ac)(U),canDeactivate:[a.z],data:N}];function L(t,e){return Object(a.cc)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.promotions",getName:t=>t.name,route:"promotions"})}class ${}$.\u0275fac=function(t){return new(t||$)},$.\u0275mod=i.bc({type:$}),$.\u0275inj=i.ac({imports:[[a.Nb,c.i.forChild(E)]]})}}]);
//# sourceMappingURL=11-es2015.516fb18c13c0b3e7eb78.js.map