{"version":3,"mappings":"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","names":["r","k","n","m","f","b","g","e","constructor","o","t","u","h","this","form","formBuilder","group","apiKey","webshopUuid","orderWebhookUrl","orderWebhookKey","stockWebhookUrl","stockWebhookKey","ngOnInit","dataService","query","mapStream","goedgepicktConfig","subscribe","controls","setValue","save","dirty","value","updateGoedgepicktConfig","mutate","input","toPromise","markAsPristine","changeDetector","markForCheck","notificationService","success","entity","error","fullSync","message","test","testFailed","testResultName","v","method","headers","Accept","Authorization","redirect","status","json","items","find","K","uuid","name","a","selectors","l","c","id","label","routerLink","icon","imports","path","pathMatch","component","data","breadcrumb"],"sources":["webpack:///node_modules/node-fetch/browser.js","webpack:///src/extensions/79dd65be1b10de15f35ec97ed089446708764ccf2a7352e7c43ec3ffc50569b9/queries.graphql.ts","webpack:///src/extensions/79dd65be1b10de15f35ec97ed089446708764ccf2a7352e7c43ec3ffc50569b9/goedgepickt.component.ts","webpack:///src/extensions/79dd65be1b10de15f35ec97ed089446708764ccf2a7352e7c43ec3ffc50569b9/goedgepickt.module.ts"],"sourcesContent":["\"use strict\";\n\n// ref: https://github.com/tc39/proposal-global\nvar getGlobal = function () {\n\t// the only reliable means to get the global object is\n\t// `Function('return this')()`\n\t// However, this causes CSP violations in Chrome apps.\n\tif (typeof self !== 'undefined') { return self; }\n\tif (typeof window !== 'undefined') { return window; }\n\tif (typeof global !== 'undefined') { return global; }\n\tthrow new Error('unable to locate global object');\n}\n\nvar global = getGlobal();\n\nmodule.exports = exports = global.fetch;\n\n// Needed for TypeScript and Webpack.\nif (global.fetch) {\n\texports.default = global.fetch.bind(global);\n}\n\nexports.Headers = global.Headers;\nexports.Request = global.Request;\nexports.Response = global.Response;","import gql from 'graphql-tag';\n\nexport const updateGoedgepicktConfig = gql`\n  mutation updateGoedgepicktConfig($input: GoedgepicktConfigInput!) {\n    updateGoedgepicktConfig(input: $input) {\n      ... on GoedgepicktConfig {\n        apiKey\n        webshopUuid\n        orderWebhookKey\n        orderWebhookUrl\n        stockWebhookKey\n        stockWebhookUrl\n      }\n      ... on GoedgepicktError {\n        message\n      }\n    }\n  }\n`;\n\nexport const getGoedgepicktConfig = gql`\n  query goedgepicktConfig {\n    goedgepicktConfig {\n      apiKey\n      webshopUuid\n      orderWebhookKey\n      orderWebhookUrl\n      stockWebhookKey\n      stockWebhookUrl\n    }\n  }\n`;\n\nexport const runGoedgepicktFullSync = gql`\n  mutation runGoedgepicktFullSync {\n    runGoedgepicktFullSync\n  }\n`;\n","import { ChangeDetectorRef, Component, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup } from '@angular/forms';\nimport { DataService, NotificationService } from '@vendure/admin-ui/core';\nimport {\n  getGoedgepicktConfig,\n  runGoedgepicktFullSync,\n  updateGoedgepicktConfig,\n} from './queries.graphql';\nimport fetch from 'node-fetch';\nimport { GoedgepicktConfig } from './generated/graphql';\n\n@Component({\n  selector: 'goedgepickt-component',\n  template: `\n    <div class=\"clr-row\">\n      <div class=\"clr-col\">\n        <button class=\"btn btn-secondary\" (click)=\"fullSync()\">\n          Synchronize\n        </button>\n        <vdr-help-tooltip\n          content=\"Pushes products and pulls stocklevels from Goedgepickt\"\n        ></vdr-help-tooltip>\n        <form class=\"form\" [formGroup]=\"form\">\n          <section class=\"form-block\">\n            <vdr-form-field label=\"apikey\" for=\"apiKey\">\n              <input id=\"apiKey\" type=\"text\" formControlName=\"apiKey\" />\n            </vdr-form-field>\n            <vdr-form-field label=\"webshopUuid\" for=\"webshopUuid\">\n              <input\n                id=\"webshopUuid\"\n                type=\"text\"\n                formControlName=\"webshopUuid\"\n              />\n            </vdr-form-field>\n            <button\n              class=\"btn btn-primary\"\n              (click)=\"save()\"\n              [disabled]=\"form.invalid || form.pristine\"\n            >\n              Save\n            </button>\n            <button class=\"btn btn-secondary\" (click)=\"test()\">Test</button>\n            <vdr-chip *ngIf=\"testFailed\" title=\"Failed\" colorType=\"error\">\n              <clr-icon shape=\"error-standard\"></clr-icon>\n              {{ testFailed }}\n            </vdr-chip>\n            <vdr-chip\n              *ngIf=\"testResultName\"\n              title=\"Success!\"\n              colorType=\"success\"\n            >\n              <clr-icon shape=\"check-circle\"></clr-icon>\n              {{ testResultName }}\n            </vdr-chip>\n          </section>\n          <section class=\"form-block\">\n            <p>\n              The following settings are set automatically and cannot be edited\n            </p>\n            <br />\n            <vdr-form-field\n              label=\"Order webhook\"\n              for=\"orderWebhookUrl\"\n              tooltip=\"Goedgepickt will call this URL for order status updates\"\n            >\n              <input\n                id=\"orderWebhookUrl\"\n                type=\"text\"\n                formControlName=\"orderWebhookUrl\"\n                disabled=\"disabled\"\n              />\n            </vdr-form-field>\n            <vdr-form-field label=\"Webhook auth secret\" for=\"orderWebhookKey\">\n              <input\n                id=\"orderWebhookKey\"\n                type=\"text\"\n                formControlName=\"orderWebhookKey\"\n                disabled=\"disabled\"\n              />\n            </vdr-form-field>\n          </section>\n          <section class=\"form-block\">\n            <vdr-form-field\n              label=\"Stock webhook\"\n              for=\"stockWebhookUrl\"\n              tooltip=\"Goedgepickt will call this URL for stocklevel updates\"\n            >\n              <input\n                id=\"stockWebhookUrl\"\n                type=\"text\"\n                formControlName=\"stockWebhookUrl\"\n                disabled=\"disabled\"\n              />\n            </vdr-form-field>\n            <vdr-form-field label=\"Webhook auth secret\" for=\"stockWebhookKey\">\n              <input\n                id=\"stockWebhookKey\"\n                type=\"text\"\n                formControlName=\"stockWebhookKey\"\n                disabled=\"disabled\"\n              />\n            </vdr-form-field>\n          </section>\n        </form>\n      </div>\n    </div>\n  `,\n})\nexport class GoedgepicktComponent implements OnInit {\n  form: FormGroup;\n  testFailed?: string;\n  testResultName?: string;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    protected dataService: DataService,\n    private changeDetector: ChangeDetectorRef,\n    private notificationService: NotificationService\n  ) {\n    this.form = this.formBuilder.group({\n      apiKey: ['your-api-key'],\n      webshopUuid: ['webshopUuid'],\n      orderWebhookUrl: ['orderWebhookUrl'],\n      orderWebhookKey: ['orderWebhookKey'],\n      stockWebhookUrl: ['stockWebhookUrl'],\n      stockWebhookKey: ['stockWebhookKey'],\n    });\n  }\n\n  async ngOnInit(): Promise<void> {\n    await this.dataService\n      .query(getGoedgepicktConfig)\n      .mapStream((d: any) => d.goedgepicktConfig)\n      .subscribe((config: GoedgepicktConfig) => {\n        this.form.controls['apiKey'].setValue(config.apiKey);\n        this.form.controls['webshopUuid'].setValue(config.webshopUuid);\n        this.form.controls['orderWebhookUrl'].setValue(config.orderWebhookUrl);\n        this.form.controls['orderWebhookKey'].setValue(config.orderWebhookKey);\n        this.form.controls['stockWebhookUrl'].setValue(config.stockWebhookUrl);\n        this.form.controls['stockWebhookKey'].setValue(config.stockWebhookKey);\n      });\n  }\n\n  async save(): Promise<void> {\n    try {\n      if (this.form.dirty) {\n        const formValue = this.form.value;\n        const { updateGoedgepicktConfig: result } = (await this.dataService\n          .mutate(updateGoedgepicktConfig, {\n            input: {\n              apiKey: formValue.apiKey,\n              webshopUuid: formValue.webshopUuid,\n            },\n          })\n          .toPromise()) as any;\n        this.form.controls['apiKey'].setValue(result.apiKey);\n        this.form.controls['webshopUuid'].setValue(result.webshopUuid);\n        this.form.controls['orderWebhookUrl'].setValue(result.orderWebhookUrl);\n        this.form.controls['orderWebhookKey'].setValue(result.orderWebhookKey);\n        this.form.controls['stockWebhookUrl'].setValue(result.stockWebhookUrl);\n        this.form.controls['stockWebhookKey'].setValue(result.stockWebhookKey);\n      }\n      this.form.markAsPristine();\n      this.changeDetector.markForCheck();\n      this.notificationService.success('common.notify-update-success', {\n        entity: 'GoedgepicktConfig',\n      });\n    } catch (e) {\n      this.notificationService.error('common.notify-update-error', {\n        entity: 'GoedgepicktConfig',\n      });\n    }\n  }\n\n  async fullSync(): Promise<void> {\n    try {\n      await this.dataService.mutate(runGoedgepicktFullSync).toPromise();\n      this.notificationService.success('common.notify-update-success', {\n        entity: 'products and stocklevels',\n      });\n    } catch (e) {\n      this.notificationService.error(e.message);\n    }\n  }\n\n  async test(): Promise<void> {\n    this.testFailed = undefined;\n    this.testResultName = undefined;\n    const result = await fetch(\n      'https://account.goedgepickt.nl/api/v1/webshops',\n      {\n        method: 'GET',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${this.form.controls['apiKey'].value}`,\n        },\n        redirect: 'follow',\n      }\n    );\n    if (result.status !== 200) {\n      this.testFailed = 'Invalid ApiKey';\n      return;\n    }\n    const json = await result.json();\n    const webshop = json.items?.find(\n      (item: { uuid: string }) =>\n        item.uuid === this.form.controls['webshopUuid'].value\n    );\n    if (!webshop) {\n      this.testFailed = 'Apikey is correct, but cannot find webshopUuid';\n    } else {\n      this.testResultName = webshop.name;\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { RouterModule } from '@angular/router';\nimport { addNavMenuItem, SharedModule } from '@vendure/admin-ui/core';\nimport { GoedgepicktComponent } from './goedgepickt.component';\n\n@NgModule({\n  imports: [\n    SharedModule,\n    RouterModule.forChild([\n      {\n        path: '',\n        pathMatch: 'full',\n        component: GoedgepicktComponent,\n        data: { breadcrumb: 'Goedgepickt' },\n      },\n    ]),\n  ],\n  providers: [\n    addNavMenuItem(\n      {\n        id: 'goedgepickt',\n        label: 'Goedgepickt',\n        routerLink: ['/extensions/goedgepickt'],\n        icon: 'cursor-hand-open',\n      },\n      'settings'\n    ),\n  ],\n  declarations: [GoedgepicktComponent],\n})\nexport class GoedgepicktModule {}\n"]}