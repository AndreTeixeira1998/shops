"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[101],{5101:(N,g,i)=>{i.r(g),i.d(g,{WebhookModule:()=>d});var v=i(4285),r=i(5592),c=i(6335);const p=c.ZP`
  mutation setWebhooks($webhooks: [WebhookInput!]!) {
    setWebhooks(webhooks: $webhooks) {
      id
      event
      requestTransformer {
        name
        supportedEvents
      }
      url
    }
  }
`,f=c.ZP`
  query webhooks {
    webhooks {
      id
      event
      requestTransformer {
        name
        supportedEvents
      }
      url
    }
  }
`,k=c.ZP`
  query availableWebhookEvents {
    availableWebhookEvents
  }
`,_=c.ZP`
  query availableWebhookRequestTransformers {
    availableWebhookRequestTransformers {
      name
      supportedEvents
    }
  }
`;var e=i(6108),h=i(5086),u=i(2977),T=i(8046),Z=i(4611);function W(l,o){if(1&l&&(e.TgZ(0,"option",13),e._uU(1),e.qZA()),2&l){const t=o.$implicit;e.Q6J("value",t.name),e.xp6(1),e.hij(" ",t.name," ")}}function q(l,o){if(1&l&&(e.TgZ(0,"option",13),e._uU(1),e.qZA()),2&l){const t=o.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function C(l,o){if(1&l){const t=e.EpF();e.TgZ(0,"td",19),e._uU(1),e.qZA(),e.TgZ(2,"td",19),e._uU(3),e.qZA(),e.TgZ(4,"td",19),e._uU(5),e.qZA(),e.TgZ(6,"td")(7,"vdr-dropdown")(8,"button",20),e._uU(9),e.ALo(10,"translate"),e._UZ(11,"clr-icon",21),e.qZA(),e.TgZ(12,"vdr-dropdown-menu",22)(13,"button",23),e.NdJ("click",function(){const s=e.CHM(t).item,b=e.oxw();return e.KtG(b.deleteWeebhook(s.id))}),e._UZ(14,"clr-icon",24),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"button",25),e.NdJ("click",function(){const s=e.CHM(t).item,b=e.oxw();return e.KtG(b.duplicate(null==s.requestTransformer?null:s.requestTransformer.name,s.url))}),e._UZ(18,"clr-icon",26),e._uU(19," Duplicate "),e.qZA()()()()}if(2&l){const t=o.item;e.xp6(1),e.hij(" ",t.event," "),e.xp6(2),e.hij(" ",null==t.requestTransformer?null:t.requestTransformer.name," "),e.xp6(2),e.hij(" ",t.url," "),e.xp6(4),e.hij(" ",e.lcZ(10,5,"common.actions")," "),e.xp6(6),e.hij(" ",e.lcZ(16,7,"common.delete")," ")}}class m{constructor(o,t,n,a){this.formBuilder=o,this.dataService=t,this.changeDetector=n,this.notificationService=a,this.webhooks=[],this.currentPage=1,this.itemsPerPage=10,this.showMessage=!1,this.availableWeebhookEvents=[],this.filteredWeebhookEvents=[],this.avaiabelWebhookRequestTransformers=[]}ngOnInit(){this.dataService.query(k).single$.subscribe(o=>{this.filteredWeebhookEvents=this.availableWeebhookEvents=o.availableWebhookEvents}),this.dataService.query(f).single$.subscribe(o=>{this.webhooks=o.webhooks}),this.dataService.query(_).single$.toPromise().then(o=>{this.avaiabelWebhookRequestTransformers=o.availableWebhookRequestTransformers})}setPageNumber(o){this.currentPage=o}setItemsPerPage(o){this.itemsPerPage=o}showCreateModal(){this.showMessage=!0,this.eventName="",this.requestTransformerName="",this.url="",this.changeDetector.detectChanges()}create(){this.url&&""!==this.url&&this.eventName&&""!==this.eventName?this.dataService.mutate(p,{webhooks:[...this.webhooks.map(o=>({event:o.event,transformerName:o.requestTransformer?.name,url:o.url})),{event:this.eventName,transformerName:this.requestTransformerName,url:this.url}]}).subscribe(o=>{this.showMessage=!1,this.notificationService.success("Webhook created successfully"),this.webhooks=o.setWebhooks,this.changeDetector.detectChanges()}):this.notificationService.error("Please enter all the required fields")}deleteWeebhook(o){this.webhooks=this.webhooks.filter(t=>t.id!=o),this.changeDetector.detectChanges(),this.dataService.mutate(p,{webhooks:[...this.webhooks.map(t=>({event:t.event,transformerName:t.requestTransformer?.name,url:t.url}))]}).subscribe(t=>{this.webhooks=t.setWebhooks,this.notificationService.success("Webhook deleted successfully")})}requestTransformerSelected(o){o||this.requestTransformerName?this.filteredWeebhookEvents=this.avaiabelWebhookRequestTransformers.find(t=>t.name===this.requestTransformerName)?.supportedEvents??[]:this.filteredWeebhookEvents=this.availableWeebhookEvents,this.eventName=this.filteredWeebhookEvents.find(t=>t===this.eventName),this.changeDetector.detectChanges()}duplicate(o,t){this.requestTransformerName=o,this.requestTransformerSelected(o),this.url=t,this.showMessage=!0,this.changeDetector.detectChanges()}static#e=this.\u0275fac=function(t){return new(t||m)(e.Y36(h.qu),e.Y36(r.DoR),e.Y36(e.sBO),e.Y36(r.gqp))};static#t=this.\u0275cmp=e.Xpm({type:m,selectors:[["webhook-component"]],decls:46,vars:12,consts:[["locationId","collection-list"],[1,"btn","btn-primary",3,"click"],["shape","add"],[3,"clrModalOpen","clrModalOpenChange"],[1,"modal-title"],[1,"modal-body"],[1,"popupContainer"],[1,"card"],[2,"width","100%"],[1,"list-group","list-group-flush"],[1,"list-group-item"],[1,"card-title"],["clrSelect","",3,"ngModel","ngModelChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["clrInput","","placeholder","https://","name","input",3,"ngModel","ngModelChange"],[1,"modal-footer"],["type","button",1,"btn","btn-outline",3,"click"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"left","align-middle"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"],["type","button","vdrDropdownItem","",3,"click"],["shape","copy"]],template:function(t,n){1&t&&(e.TgZ(0,"vdr-action-bar")(1,"vdr-ab-right"),e._UZ(2,"vdr-action-bar-items",0),e.TgZ(3,"button",1),e.NdJ("click",function(){return n.showCreateModal()}),e._UZ(4,"clr-icon",2),e._uU(5," Add Webhook "),e.qZA()()(),e.TgZ(6,"clr-modal",3),e.NdJ("clrModalOpenChange",function(s){return n.showMessage=s}),e.TgZ(7,"h3",4),e._uU(8,"Add Webhook"),e.qZA(),e.TgZ(9,"div",5)(10,"div",6)(11,"div",7)(12,"div",8)(13,"ul",9)(14,"li",10)(15,"h4",11),e._uU(16,"Request Transformer"),e.qZA(),e.TgZ(17,"select",12),e.NdJ("ngModelChange",function(s){return n.requestTransformerName=s})("ngModelChange",function(){return n.requestTransformerSelected()}),e.TgZ(18,"option",13),e._uU(19,"--select---"),e.qZA(),e.YNc(20,W,2,2,"option",14),e.qZA()(),e.TgZ(21,"li",10)(22,"h4",11),e._uU(23,"Event *"),e.qZA(),e.TgZ(24,"select",12),e.NdJ("ngModelChange",function(s){return n.eventName=s}),e.TgZ(25,"option",13),e._uU(26,"--select---"),e.qZA(),e.YNc(27,q,2,2,"option",14),e.qZA()(),e.TgZ(28,"li",10)(29,"h4",11),e._uU(30,"URL *"),e.qZA(),e.TgZ(31,"input",15),e.NdJ("ngModelChange",function(s){return n.url=s}),e.qZA()()()()()()(),e.TgZ(32,"div",16)(33,"button",17),e.NdJ("click",function(){return n.showMessage=!1}),e._uU(34," Cancel "),e.qZA(),e.TgZ(35,"button",1),e.NdJ("click",function(){return n.create()}),e._uU(36,"Submit"),e.qZA()()(),e.TgZ(37,"vdr-data-table",18),e.NdJ("pageChange",function(s){return n.setPageNumber(s)})("itemsPerPageChange",function(s){return n.setItemsPerPage(s)}),e.TgZ(38,"vdr-dt-column"),e._uU(39,"Event"),e.qZA(),e.TgZ(40,"vdr-dt-column"),e._uU(41,"Request Transformer"),e.qZA(),e.TgZ(42,"vdr-dt-column"),e._uU(43,"URL"),e.qZA(),e._UZ(44,"vdr-dt-column"),e.YNc(45,C,20,9,"ng-template"),e.qZA()),2&t&&(e.xp6(6),e.Q6J("clrModalOpen",n.showMessage),e.xp6(11),e.Q6J("ngModel",n.requestTransformerName),e.xp6(1),e.s9C("value",void 0),e.xp6(2),e.Q6J("ngForOf",n.avaiabelWebhookRequestTransformers),e.xp6(4),e.Q6J("ngModel",n.eventName),e.xp6(1),e.s9C("value",void 0),e.xp6(2),e.Q6J("ngForOf",n.filteredWeebhookEvents),e.xp6(4),e.Q6J("ngModel",n.url),e.xp6(6),e.Q6J("items",n.webhooks)("itemsPerPage",n.itemsPerPage)("totalItems",n.webhooks.length)("currentPage",n.currentPage))},dependencies:[u.qvL,u.qAN,u.VLi,u.xRP,u.otW,T.sg,h.YN,h.Kr,h.Fj,h.EJ,h.JJ,h.On,r.KkL,r.mz,r.Qj_,r.Egy,r.y_K,r.JOL,r.N9E,r.UaT,r.HH4,r.WWO,Z.X$],encapsulation:2})}class d{static#e=this.\u0275fac=function(t){return new(t||d)};static#t=this.\u0275mod=e.oAB({type:d});static#o=this.\u0275inj=e.cJS({providers:[(0,r.e$Y)({id:"webhook",label:"Webhook",routerLink:["/extensions/webhook"],icon:"cursor-hand-open"},"settings")],imports:[r.m81,v.Bz.forChild([{path:"",pathMatch:"full",component:m,data:{breadcrumb:"Webhook"}}])]})}}}]);
//# sourceMappingURL=101.e36bbfbd6aa9b1b2.js.map