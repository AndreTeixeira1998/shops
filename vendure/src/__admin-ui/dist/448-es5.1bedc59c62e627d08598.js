!function(){"use strict";var e,o,t;function r(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function n(e,o){for(var t=0;t<o.length;t++){var r=o[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,o,t){return o&&n(e.prototype,o),t&&n(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,o){return o||(o=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(o)}}))}(self.webpackChunkvendure_admin_ui=self.webpackChunkvendure_admin_ui||[]).push([[448],{6738:function(e,o){var t=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();e.exports=o=t.fetch,t.fetch&&(o.default=t.fetch.bind(t)),o.Headers=t.Headers,o.Request=t.Request,o.Response=t.Response},15448:function(n,c,a){a.r(c),a.d(c,{GoedgepicktModule:function(){return K}});var u=a(41460),d=a(39155),l=a(3189),p=a(83974),f=p.ZP(e||(e=s(["\n  mutation updateGoedgepicktConfig($input: GoedgepicktConfigInput!) {\n    updateGoedgepicktConfig(input: $input) {\n      ... on GoedgepicktConfig {\n        apiKey\n        webshopUuid\n        orderWebhookKey\n        orderWebhookUrl\n        stockWebhookKey\n        stockWebhookUrl\n      }\n      ... on GoedgepicktError {\n        message\n      }\n    }\n  }\n"]))),h=p.ZP(o||(o=s(["\n  query goedgepicktConfig {\n    goedgepicktConfig {\n      apiKey\n      webshopUuid\n      orderWebhookKey\n      orderWebhookUrl\n      stockWebhookKey\n      stockWebhookUrl\n    }\n  }\n"]))),k=p.ZP(t||(t=s(["\n  mutation runGoedgepicktFullSync {\n    runGoedgepicktFullSync\n  }\n"]))),b=a(6738),m=a.n(b),g=a(51694),y=a(21067),v=a(70942),U=a(96789);function w(e,o){if(1&e&&(g.TgZ(0,"vdr-chip",21),g._UZ(1,"clr-icon",22),g._uU(2),g.qZA()),2&e){var t=g.oxw();g.xp6(2),g.hij(" ",t.testFailed," ")}}function Z(e,o){if(1&e&&(g.TgZ(0,"vdr-chip",23),g._UZ(1,"clr-icon",24),g._uU(2),g.qZA()),2&e){var t=g.oxw();g.xp6(2),g.hij(" ",t.testResultName," ")}}var W=function(){function e(o,t,n,i){r(this,e),this.formBuilder=o,this.dataService=t,this.changeDetector=n,this.notificationService=i,this.form=this.formBuilder.group({apiKey:["your-api-key"],webshopUuid:["webshopUuid"],orderWebhookUrl:["orderWebhookUrl"],orderWebhookKey:["orderWebhookKey"],stockWebhookUrl:["stockWebhookUrl"],stockWebhookKey:["stockWebhookKey"]})}return i(e,[{key:"ngOnInit",value:function(){return(0,l.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataService.query(h).mapStream(function(e){return e.goedgepicktConfig}).subscribe(function(e){o.form.controls.apiKey.setValue(e.apiKey),o.form.controls.webshopUuid.setValue(e.webshopUuid),o.form.controls.orderWebhookUrl.setValue(e.orderWebhookUrl),o.form.controls.orderWebhookKey.setValue(e.orderWebhookKey),o.form.controls.stockWebhookUrl.setValue(e.stockWebhookUrl),o.form.controls.stockWebhookKey.setValue(e.stockWebhookKey)});case 2:case"end":return e.stop()}},e,this)}))}},{key:"save",value:function(){return(0,l.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var o,t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.form.dirty){e.next=8;break}return o=this.form.value,e.next=5,this.dataService.mutate(f,{input:{apiKey:o.apiKey,webshopUuid:o.webshopUuid}}).toPromise();case 5:t=e.sent,r=t.updateGoedgepicktConfig,this.form.controls.apiKey.setValue(r.apiKey),this.form.controls.webshopUuid.setValue(r.webshopUuid),this.form.controls.orderWebhookUrl.setValue(r.orderWebhookUrl),this.form.controls.orderWebhookKey.setValue(r.orderWebhookKey),this.form.controls.stockWebhookUrl.setValue(r.stockWebhookUrl),this.form.controls.stockWebhookKey.setValue(r.stockWebhookKey);case 8:this.form.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success("common.notify-update-success",{entity:"GoedgepicktConfig"}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),this.notificationService.error("common.notify-update-error",{entity:"GoedgepicktConfig"});case 14:case"end":return e.stop()}},e,this,[[0,11]])}))}},{key:"fullSync",value:function(){return(0,l.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.dataService.mutate(k).toPromise();case 3:this.notificationService.success("common.notify-update-success",{entity:"products and stocklevels"}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),this.notificationService.error(e.t0.message);case 9:case"end":return e.stop()}},e,this,[[0,6]])}))}},{key:"test",value:function(){var e;return(0,l.mG)(this,void 0,void 0,regeneratorRuntime.mark(function o(){var t,r,n=this;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.testFailed=void 0,this.testResultName=void 0,o.next=3,m()("https://account.goedgepickt.nl/api/v1/webshops",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(this.form.controls.apiKey.value)},redirect:"follow"});case 3:if(200===(t=o.sent).status){o.next=6;break}return o.abrupt("return",void(this.testFailed="Invalid ApiKey"));case 6:return o.next=8,t.json();case 8:if(o.t1=e=o.sent.items,o.t0=null===o.t1,o.t0){o.next=12;break}o.t0=void 0===e;case 12:if(!o.t0){o.next=16;break}o.t2=void 0,o.next=17;break;case 16:o.t2=e.find(function(e){return e.uuid===n.form.controls.webshopUuid.value});case 17:(r=o.t2)?this.testResultName=r.name:this.testFailed="Apikey is correct, but cannot find webshopUuid";case 19:case"end":return o.stop()}},o,this)}))}}]),e}();W.\u0275fac=function(e){return new(e||W)(g.Y36(y.qu),g.Y36(d.DoR),g.Y36(g.sBO),g.Y36(d.gqp))},W.\u0275cmp=g.Xpm({type:W,selectors:[["goedgepickt-component"]],decls:30,vars:4,consts:[[1,"clr-row"],[1,"clr-col"],[1,"btn","btn-secondary",3,"click"],["content","Pushes products and pulls stocklevels from Goedgepickt"],[1,"form",3,"formGroup"],[1,"form-block"],["label","apikey","for","apiKey"],["id","apiKey","type","text","formControlName","apiKey"],["label","webshopUuid","for","webshopUuid"],["id","webshopUuid","type","text","formControlName","webshopUuid"],[1,"btn","btn-primary",3,"disabled","click"],["title","Failed","colorType","error",4,"ngIf"],["title","Success!","colorType","success",4,"ngIf"],["label","Order webhook","for","orderWebhookUrl","tooltip","Goedgepickt will call this URL for order status updates"],["id","orderWebhookUrl","type","text","formControlName","orderWebhookUrl","disabled","disabled"],["label","Webhook auth secret","for","orderWebhookKey"],["id","orderWebhookKey","type","text","formControlName","orderWebhookKey","disabled","disabled"],["label","Stock webhook","for","stockWebhookUrl","tooltip","Goedgepickt will call this URL for stocklevel updates"],["id","stockWebhookUrl","type","text","formControlName","stockWebhookUrl","disabled","disabled"],["label","Webhook auth secret","for","stockWebhookKey"],["id","stockWebhookKey","type","text","formControlName","stockWebhookKey","disabled","disabled"],["title","Failed","colorType","error"],["shape","error-standard"],["title","Success!","colorType","success"],["shape","check-circle"]],template:function(e,o){1&e&&(g.TgZ(0,"div",0),g.TgZ(1,"div",1),g.TgZ(2,"button",2),g.NdJ("click",function(){return o.fullSync()}),g._uU(3," Synchronize "),g.qZA(),g._UZ(4,"vdr-help-tooltip",3),g.TgZ(5,"form",4),g.TgZ(6,"section",5),g.TgZ(7,"vdr-form-field",6),g._UZ(8,"input",7),g.qZA(),g.TgZ(9,"vdr-form-field",8),g._UZ(10,"input",9),g.qZA(),g.TgZ(11,"button",10),g.NdJ("click",function(){return o.save()}),g._uU(12," Save "),g.qZA(),g.TgZ(13,"button",2),g.NdJ("click",function(){return o.test()}),g._uU(14,"Test"),g.qZA(),g.YNc(15,w,3,1,"vdr-chip",11),g.YNc(16,Z,3,1,"vdr-chip",12),g.qZA(),g.TgZ(17,"section",5),g.TgZ(18,"p"),g._uU(19," The following settings are set automatically and cannot be edited "),g.qZA(),g._UZ(20,"br"),g.TgZ(21,"vdr-form-field",13),g._UZ(22,"input",14),g.qZA(),g.TgZ(23,"vdr-form-field",15),g._UZ(24,"input",16),g.qZA(),g.qZA(),g.TgZ(25,"section",5),g.TgZ(26,"vdr-form-field",17),g._UZ(27,"input",18),g.qZA(),g.TgZ(28,"vdr-form-field",19),g._UZ(29,"input",20),g.qZA(),g.qZA(),g.qZA(),g.qZA(),g.qZA()),2&e&&(g.xp6(5),g.Q6J("formGroup",o.form),g.xp6(6),g.Q6J("disabled",o.form.invalid||o.form.pristine),g.xp6(4),g.Q6J("ngIf",o.testFailed),g.xp6(1),g.Q6J("ngIf",o.testResultName))},directives:[d.opf,y._Y,y.JL,y.sg,d.hgI,d.y_K,y.Fj,y.JJ,y.u,v.O5,d.Ywx,U.qvL],encapsulation:2});var K=i(function e(){r(this,e)});K.\u0275fac=function(e){return new(e||K)},K.\u0275mod=g.oAB({type:K}),K.\u0275inj=g.cJS({providers:[(0,d.e$Y)({id:"goedgepickt",label:"Goedgepickt",routerLink:["/extensions/goedgepickt"],icon:"cursor-hand-open"},"settings")],imports:[[d.m81,u.Bz.forChild([{path:"",pathMatch:"full",component:W,data:{breadcrumb:"Goedgepickt"}}])]]})}}])}();
//# sourceMappingURL=448-es5.1bedc59c62e627d08598.js.map